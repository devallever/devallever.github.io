<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Allever Blog</title>
  <subtitle>Android Developer</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://devallever.github.io/"/>
  <updated>2017-08-09T09:45:51.648Z</updated>
  <id>https://devallever.github.io/</id>
  
  <author>
    <name>Allever</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Android Seekbar调节系统音量</title>
    <link href="https://devallever.github.io/2017/08/09/android-seekbar-and-volume/"/>
    <id>https://devallever.github.io/2017/08/09/android-seekbar-and-volume/</id>
    <published>2017-08-09T09:28:01.000Z</published>
    <updated>2017-08-09T09:45:51.648Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SeekBar简介"><a href="#SeekBar简介" class="headerlink" title="SeekBar简介"></a>SeekBar简介</h1><p>就是拖动的进度条, 可以用来调节音量</p>
<h1 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h1><p>需要两张图片,一张是背景,一张是选中的]时候的样式,<br>还有一张图片,用来显示当前进度的指示图标<br>这些可用用图片,亦可以永drawable绘图</p>
<h2 id="背景图片"><a href="#背景图片" class="headerlink" title="背景图片"></a>背景图片</h2><p>volume_control_bg.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line"></div><div class="line">&lt;layer-list xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;</div><div class="line">    &lt;item</div><div class="line">        android:id=&quot;@android:id/background&quot;</div><div class="line">        android:drawable=&quot;@drawable/set_voice_bar_nor&quot; /&gt;</div><div class="line">    &lt;item</div><div class="line">        android:id=&quot;@android:id/progress&quot;</div><div class="line">        android:drawable=&quot;@drawable/set_voice_bar_sel&quot; /&gt;</div><div class="line">&lt;/layer-list&gt;</div></pre></td></tr></table></figure></p>
<p>控制点volume_control_point.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:shape=&quot;oval&quot;&gt;</div><div class="line"></div><div class="line">    &lt;solid</div><div class="line">        android:color=&quot;@color/white&quot;/&gt;</div><div class="line">    &lt;size</div><div class="line">        android:width=&quot;15dp&quot;</div><div class="line">        android:height=&quot;15dp&quot;/&gt;</div><div class="line">    &lt;stroke</div><div class="line">        android:color=&quot;@color/code_blue&quot;</div><div class="line">        android:width=&quot;2dp&quot;/&gt;</div><div class="line"></div><div class="line">&lt;/shape&gt;</div></pre></td></tr></table></figure></p>
<h2 id="使用SeekBar"><a href="#使用SeekBar" class="headerlink" title="使用SeekBar"></a>使用SeekBar</h2><p>在布局文件中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;SeekBar</div><div class="line">	android:id=&quot;@+id/setting_volume_control_sb&quot;</div><div class="line">	android:layout_width=&quot;200dp&quot;</div><div class="line">	android:layout_height=&quot;wrap_content&quot;</div><div class="line">	android:layout_centerVertical=&quot;true&quot;</div><div class="line">	android:layout_toLeftOf=&quot;@id/setting_loud_iv&quot;</div><div class="line">	android:thumb=&quot;@drawable/volume_control_point&quot;</div><div class="line">	android:thumbOffset=&quot;0dp&quot;</div><div class="line">	android:maxHeight=&quot;2dp&quot;</div><div class="line">	android:minHeight=&quot;2dp&quot;</div><div class="line">	android:progressDrawable=&quot;@drawable/volume_control_bg&quot;</div><div class="line">/&gt;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>thumb:指定控制点<br>progressDrawable:指定背景<br>maxHeight:指定图片最大高度</p>
</blockquote>
<p>在代码中,不用任何操作,就可以看到该空间,并拖动了</p>
<h2 id="控制音量"><a href="#控制音量" class="headerlink" title="控制音量"></a>控制音量</h2><p>首先获取AudioManager,用来管理音量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mAudioManager = (AudioManager)getSystemService(AUDIO_SERVICE);</div></pre></td></tr></table></figure></p>
<p>获取最大音量和当前音量设置给seekbar<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">int maxVolume = mAudioManager.getStreamMaxVolume(AudioManager.STREAM_MUSIC);//获取媒体声音最大值</div><div class="line">seekBar.setMax(maxVolume);</div><div class="line">int currentVolume = mAudioManager.getStreamVolume(AudioManager.STREAM_MUSIC);</div><div class="line">seekBar.setProgress(currentVolume);//设置当前进度</div></pre></td></tr></table></figure></p>
<p>监听seekbar的拖动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">seekBar.setOnSeekBarChangeListener(new SeekBar.OnSeekBarChangeListener() &#123;</div><div class="line">	@Override</div><div class="line">	public void onProgressChanged(SeekBar seekBar, int progress, boolean fromUser) &#123;</div><div class="line">		if(fromUser)&#123;</div><div class="line">		//设置媒体音量</div><div class="line">			mAudioManager.setStreamVolume(AudioManager.STREAM_MUSIC, progress, 0);</div><div class="line">			int currentVolume = mAudioManager.getStreamVolume(AudioManager.STREAM_MUSIC);</div><div class="line">			seekBar.setProgress(currentVolume);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void onStartTrackingTouch(SeekBar seekBar) &#123;</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void onStopTrackingTouch(SeekBar seekBar) &#123;</div><div class="line"></div><div class="line">	&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>监听系统音量变化<br>当系统音量改变时,会发送广播,因此需要定义广播接收器监听广播<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">private class VolumeReceiver extends BroadcastReceiver&#123;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void onReceive(Context context, Intent intent) &#123;</div><div class="line">		if(intent.getAction().equals(&quot;android.media.VOLUME_CHANGED_ACTION&quot;))&#123;</div><div class="line">		int currentVolume = mAudioManager.getStreamVolume(AudioManager.STREAM_MUSIC);</div><div class="line">		seekBar.setProgress(currentVolume);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;SeekBar简介&quot;&gt;&lt;a href=&quot;#SeekBar简介&quot; class=&quot;headerlink&quot; title=&quot;SeekBar简介&quot;&gt;&lt;/a&gt;SeekBar简介&lt;/h1&gt;&lt;p&gt;就是拖动的进度条, 可以用来调节音量&lt;/p&gt;
&lt;h1 id=&quot;基本使用&quot;&gt;&lt;a hr
    
    </summary>
    
      <category term="Android" scheme="https://devallever.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://devallever.github.io/tags/Android/"/>
    
      <category term="SeekBar" scheme="https://devallever.github.io/tags/SeekBar/"/>
    
  </entry>
  
  <entry>
    <title>Android ExpandableListView基础用法</title>
    <link href="https://devallever.github.io/2017/08/09/android-expandablelistview-basic-use/"/>
    <id>https://devallever.github.io/2017/08/09/android-expandablelistview-basic-use/</id>
    <published>2017-08-09T08:28:24.000Z</published>
    <updated>2017-08-09T09:13:33.946Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ExpandableListView简介"><a href="#ExpandableListView简介" class="headerlink" title="ExpandableListView简介"></a>ExpandableListView简介</h1><p>可以折叠的ListView</p>
<h1 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h1><p>使用方法和ListView大同小异,都是需要item的布局,需要adapter<br>But:<br>ExpandableListView需要父Item布局,需要子Item布局.Adapter需要的是BaseExpandableListAdapter<br>下面以一个好友分组的例子总结一下用法</p>
<h2 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h2><p>分组Item布局<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">     android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;wrap_content&quot;</div><div class="line">    android:padding=&quot;10dp&quot;</div><div class="line">    android:background=&quot;@color/color_green_50&quot;&gt;</div><div class="line">    &lt;RelativeLayout</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;&gt;</div><div class="line">        &lt;ImageView</div><div class="line">            android:id=&quot;@+id/id_friendgroup_item_parent_iv_expand&quot;</div><div class="line">            android:layout_width=&quot;wrap_content&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:src=&quot;@mipmap/ic_unexpanded&quot;/&gt;</div><div class="line">        &lt;TextView</div><div class="line">            android:id=&quot;@+id/id_friendgroup_item_parent_tv_friendgroup_name&quot;</div><div class="line">            android:layout_width=&quot;wrap_content&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">            android:layout_toRightOf=&quot;@id/id_friendgroup_item_parent_iv_expand&quot;</div><div class="line">            android:text=&quot;我的好友&quot;</div><div class="line">            android:layout_centerVertical=&quot;true&quot;</div><div class="line">            android:textSize=&quot;18sp&quot;</div><div class="line">            android:textColor=&quot;@color/colorPrimary&quot;/&gt;</div><div class="line">        &lt;TextView</div><div class="line">            android:id=&quot;@+id/id_friendgroup_item_parent_tv_friend_count&quot;</div><div class="line">            android:layout_width=&quot;wrap_content&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:text=&quot;0&quot;</div><div class="line">            android:layout_marginRight=&quot;5dp&quot;</div><div class="line">            android:textSize=&quot;18sp&quot;</div><div class="line">            android:textColor=&quot;@color/colorGray_500&quot;</div><div class="line">            android:layout_centerVertical=&quot;true&quot;</div><div class="line">            android:layout_alignParentRight=&quot;true&quot;/&gt;</div><div class="line">    &lt;/RelativeLayout&gt;</div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure></p>
<p>效果图:<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/DataProject/blob/master/data/expandablelistview/group_item.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure></p>
<p>好友Item布局<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:orientation=&quot;vertical&quot; android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;wrap_content&quot;</div><div class="line">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</div><div class="line">    &gt;</div><div class="line"></div><div class="line">    &lt;RelativeLayout</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:padding=&quot;10dp&quot;&gt;</div><div class="line"></div><div class="line">        &lt;de.hdodenhof.circleimageview.CircleImageView</div><div class="line">            android:id=&quot;@+id/id_friendgroup_item_child_iv_head&quot;</div><div class="line">            android:layout_width=&quot;56dp&quot;</div><div class="line">            android:layout_height=&quot;56dp&quot;</div><div class="line">            app:civ_border_width=&quot;0.5dp&quot;</div><div class="line">            app:civ_border_color=&quot;#fff&quot;</div><div class="line">            android:src=&quot;@mipmap/winchen&quot;/&gt;</div><div class="line"></div><div class="line">        &lt;TextView</div><div class="line">            android:id=&quot;@+id/id_friendgroup_item_child_tv_nickname&quot;</div><div class="line">            android:layout_width=&quot;wrap_content&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:text=&quot;Nickname&quot;</div><div class="line">            android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">            android:textColor=&quot;@color/black_deep&quot;</div><div class="line">            android:textSize=&quot;18sp&quot;</div><div class="line">            android:layout_toRightOf=&quot;@id/id_friendgroup_item_child_iv_head&quot;/&gt;</div><div class="line">        &lt;TextView</div><div class="line">            android:id=&quot;@+id/id_friendgroup_item_child_tv_signature&quot;</div><div class="line">            android:layout_width=&quot;wrap_content&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:text=&quot;Signature&quot;</div><div class="line">            android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">            android:layout_marginTop=&quot;4dp&quot;</div><div class="line">            android:maxLines=&quot;1&quot;</div><div class="line">            android:ellipsize=&quot;end&quot;</div><div class="line">            android:layout_below=&quot;@id/id_friendgroup_item_child_tv_nickname&quot;</div><div class="line">            android:layout_toRightOf=&quot;@id/id_friendgroup_item_child_iv_head&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;/RelativeLayout&gt;</div><div class="line"></div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure></p>
<p>效果图:<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/DataProject/blob/master/data/expandablelistview/user_item.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure></p>
<h2 id="封装数据"><a href="#封装数据" class="headerlink" title="封装数据"></a>封装数据</h2><p>FriendGroupItem<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">public class FriendGroupItem &#123;</div><div class="line">    private String id;</div><div class="line">    private String friendgroup_name;</div><div class="line">    private List&lt;FriendItem&gt; list_friend;</div><div class="line">    public String getId() &#123;</div><div class="line">        return id;</div><div class="line">    &#125;</div><div class="line">    public void setId(String id) &#123;</div><div class="line">        this.id = id;</div><div class="line">    &#125;</div><div class="line">    public String getFriendgroup_name() &#123;</div><div class="line">        return friendgroup_name;</div><div class="line">    &#125;</div><div class="line">    public void setFriendgroup_name(String friendgroup_name) &#123;</div><div class="line">        this.friendgroup_name = friendgroup_name;</div><div class="line">    &#125;</div><div class="line">    public List&lt;FriendItem&gt; getList_friend() &#123;</div><div class="line">        return list_friend;</div><div class="line">    &#125;</div><div class="line">    public void setList_friend(List&lt;FriendItem&gt; list_friend) &#123;</div><div class="line">        this.list_friend = list_friend;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>FriendGroupItem<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">public class FriendItem  &#123;</div><div class="line">    private String sortLetters;  //显示数据拼音的首字母</div><div class="line">    private String user_id;</div><div class="line">    private String nickname;</div><div class="line">    private String username;</div><div class="line">    private String user_head_path;</div><div class="line">    private String signature;</div><div class="line">    public String getUser_id() &#123;</div><div class="line">        return user_id;</div><div class="line">    &#125;</div><div class="line">    public void setUser_id(String user_id) &#123;</div><div class="line">        this.user_id = user_id;</div><div class="line">    &#125;</div><div class="line">    public String getNickname() &#123;</div><div class="line">        return nickname;</div><div class="line">    &#125;</div><div class="line">    public void setNickname(String nickname) &#123;</div><div class="line">        this.nickname = nickname;</div><div class="line">    &#125;</div><div class="line">    public String getUser_head_path() &#123;</div><div class="line">        return user_head_path;</div><div class="line">    &#125;</div><div class="line">    public void setUser_head_path(String user_head_path) &#123;</div><div class="line">        this.user_head_path = user_head_path;</div><div class="line">    &#125;</div><div class="line">    public String getSignature() &#123;</div><div class="line">        return signature;</div><div class="line">    &#125;</div><div class="line">    public void setSignature(String signature) &#123;</div><div class="line">        this.signature = signature;</div><div class="line">    &#125;</div><div class="line">    public void setUsername(String username)&#123;</div><div class="line">        this.username = username;</div><div class="line">    &#125;</div><div class="line">    public String getUsername()&#123;</div><div class="line">        return this.username;</div><div class="line">    &#125;</div><div class="line">    public String getSortLetters() &#123;</div><div class="line">        return sortLetters;</div><div class="line">    &#125;</div><div class="line">    public void setSortLetters(String sortLetters) &#123;</div><div class="line">        this.sortLetters = sortLetters;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Adapter适配器"><a href="#Adapter适配器" class="headerlink" title="Adapter适配器"></a>Adapter适配器</h2><p>FriendGroupItemExpandableBaseAdapter<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Created by Allever on 2016/6/14.</div><div class="line"> * 好友分组项适配器</div><div class="line"> */</div><div class="line">public class FriendGroupItemExpandableBaseAdapter extends BaseExpandableListAdapter &#123;</div><div class="line"></div><div class="line">    private Context context;</div><div class="line">    private LayoutInflater inflater;</div><div class="line">    private List&lt;FriendGroupItem&gt; list_friendgroupItem;</div><div class="line"></div><div class="line">    public FriendGroupItemExpandableBaseAdapter(Context context, List&lt;FriendGroupItem&gt; list_friendgroupItem)&#123;</div><div class="line">        this.context = context;</div><div class="line">        this.list_friendgroupItem = list_friendgroupItem;</div><div class="line">        inflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    @Override</div><div class="line">    public View getGroupView(int parentPosition, boolean isExpanded, View convertView, ViewGroup parent) &#123;</div><div class="line">        FriendGroupItem friendGroupItem = list_friendgroupItem.get(parentPosition);</div><div class="line">        View view;</div><div class="line">        ParentViewHolder parentViewHolder;</div><div class="line">        if (convertView == null)&#123;</div><div class="line">            view = inflater.inflate(R.layout.friendgroup_item_parent,parent,false);</div><div class="line">            parentViewHolder = new ParentViewHolder();</div><div class="line">            parentViewHolder.tv_friendgroup_name = (TextView)view.findViewById(R.id.id_friendgroup_item_parent_tv_friendgroup_name);</div><div class="line">            parentViewHolder.iv_expand = (ImageView)view.findViewById(R.id.id_friendgroup_item_parent_iv_expand);</div><div class="line">            parentViewHolder.tv_friend_count = (TextView)view.findViewById(R.id.id_friendgroup_item_parent_tv_friend_count);</div><div class="line">            view.setTag(parentViewHolder);</div><div class="line">        &#125;else&#123;</div><div class="line">            view  = convertView;</div><div class="line">            parentViewHolder = (ParentViewHolder)view.getTag();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        //判断isExpanded就可以控制是按下还是关闭，同时更换图片</div><div class="line">        if (isExpanded)&#123;</div><div class="line">            parentViewHolder.iv_expand.setImageDrawable(context.getResources().getDrawable(R.mipmap.ic_expanded));</div><div class="line">        &#125;else&#123;</div><div class="line">            parentViewHolder.iv_expand.setImageDrawable(context.getResources().getDrawable(R.mipmap.ic_unexpanded));</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        parentViewHolder.tv_friend_count.setText(friendGroupItem.getList_friend().size()+&quot;&quot;);</div><div class="line">        parentViewHolder.tv_friendgroup_name.setText(friendGroupItem.getFriendgroup_name());</div><div class="line">        return view;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public View getChildView(int parentPosition, int childPosition, boolean b, View convertView, ViewGroup parent) &#123;</div><div class="line">        FriendItem friendItem = list_friendgroupItem.get(parentPosition).getList_friend().get(childPosition);</div><div class="line">        View view;</div><div class="line">        ChildViewHolder childViewHolder;</div><div class="line">        if(convertView == null)&#123;</div><div class="line">            view = inflater.inflate(R.layout.friendgroup_item_child,parent,false);</div><div class="line">            childViewHolder = new ChildViewHolder();</div><div class="line">            childViewHolder.iv_head = (CircleImageView)view.findViewById(R.id.id_friendgroup_item_child_iv_head);</div><div class="line">            childViewHolder.tv_nickname = (TextView)view.findViewById(R.id.id_friendgroup_item_child_tv_nickname);</div><div class="line">            childViewHolder.tv_signature = (TextView)view.findViewById(R.id.id_friendgroup_item_child_tv_signature);</div><div class="line">            view.setTag(childViewHolder);</div><div class="line">        &#125;else&#123;</div><div class="line">            view = convertView;</div><div class="line">            childViewHolder = (ChildViewHolder)view.getTag();</div><div class="line">        &#125;</div><div class="line">        Glide.with(context)</div><div class="line">                .load(WebUtil.HTTP_ADDRESS + friendItem.getUser_head_path())</div><div class="line">                .into(childViewHolder.iv_head);</div><div class="line">        childViewHolder.tv_nickname.setText(friendItem.getNickname());</div><div class="line">        childViewHolder.tv_signature.setText(friendItem.getSignature());</div><div class="line">        return view;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private class ParentViewHolder&#123;</div><div class="line">        ImageView iv_expand;</div><div class="line">        TextView tv_friendgroup_name;</div><div class="line">        TextView tv_friend_count;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private class ChildViewHolder&#123;</div><div class="line">        CircleImageView iv_head;</div><div class="line">        TextView tv_nickname;</div><div class="line">        TextView tv_signature;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public int getGroupCount() &#123;</div><div class="line">        return list_friendgroupItem.size();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public int getChildrenCount(int parentPosition) &#123;</div><div class="line">        return list_friendgroupItem.get(parentPosition).getList_friend().size();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public Object getGroup(int parengPosition) &#123;</div><div class="line">        return list_friendgroupItem.get(parengPosition);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public Object getChild(int parentPosition, int childPosition) &#123;</div><div class="line">        return list_friendgroupItem.get(parentPosition).getList_friend().get(childPosition);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public long getGroupId(int parentPosition) &#123;</div><div class="line">        return parentPosition;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public long getChildId(int parentPosition, int childPosition) &#123;</div><div class="line">        return childPosition;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public boolean hasStableIds() &#123;</div><div class="line">        return false;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    @Override</div><div class="line">    public boolean isChildSelectable(int i, int i1) &#123;</div><div class="line">        return true;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>继承自BaseExpandableListAdapter,重写里面几个方法, 看方法名就知道该方法是干什么的了,如果你熟悉ListView的话. 方法中很多都是成对存在的.根据方法名返回相应的值.重点就是getChildView()方法和getGroupView()方法;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public View getGroupView(int parentPosition, boolean isExpanded, View convertView, ViewGroup parent) &#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@Override</div><div class="line">public View getChildView(int parentPosition, int childPosition, boolean b, View convertView, ViewGroup parent) &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>参数含义在上面已经标明了.</p>
<h2 id="使用ExpandableListView"><a href="#使用ExpandableListView" class="headerlink" title="使用ExpandableListView"></a>使用ExpandableListView</h2><p>在布局文件中使用该控件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;ExpandableListView</div><div class="line">	android:id=&quot;@+id/id_contact_fg2_expandable_listview&quot;</div><div class="line">	android:layout_width=&quot;match_parent&quot;</div><div class="line">	android:layout_height=&quot;match_parent&quot;&gt;</div><div class="line">&lt;/ExpandableListView&gt;</div></pre></td></tr></table></figure></p>
<p>在代码中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">expandableListView = (ExpandableListView)view.findViewById(R.id.id_contact_fg2_expandable_listview);</div><div class="line">expandableListView.setGroupIndicator(null); //设置指示器隐藏</div><div class="line"></div><div class="line">friendGroupItemExpandableBaseAdapter = new FriendGroupItemExpandableBaseAdapter(getActivity(),list_friendgroupItem);</div><div class="line">expandableListView.setAdapter(friendGroupItemExpandableBaseAdapter);</div><div class="line"></div><div class="line">//设置监听器</div><div class="line">expandableListView.setOnChildClickListener(new ExpandableListView.OnChildClickListener() &#123;</div><div class="line">	@Override</div><div class="line">	public boolean onChildClick(ExpandableListView expandableListView, View view, int parentPosition, int childPosition, long l) &#123;</div><div class="line">		Intent intent = new Intent(getActivity(), UserDataDetailActivity.class);</div><div class="line">		intent.putExtra(&quot;username&quot;, list_friendgroupItem.get(parentPosition).getList_friend().get(childPosition).getUsername());</div><div class="line">		startActivity(intent);</div><div class="line">		return false;</div><div class="line">	&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>效果图:<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/DataProject/blob/master/data/expandablelistview/review.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;ExpandableListView简介&quot;&gt;&lt;a href=&quot;#ExpandableListView简介&quot; class=&quot;headerlink&quot; title=&quot;ExpandableListView简介&quot;&gt;&lt;/a&gt;ExpandableListView简介&lt;/h1&gt;&lt;
    
    </summary>
    
      <category term="Android" scheme="https://devallever.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://devallever.github.io/tags/Android/"/>
    
      <category term="ExpandableListView" scheme="https://devallever.github.io/tags/ExpandableListView/"/>
    
  </entry>
  
  <entry>
    <title>Android 零碎知识点和技巧</title>
    <link href="https://devallever.github.io/2017/08/06/android-piece-knowledge/"/>
    <id>https://devallever.github.io/2017/08/06/android-piece-knowledge/</id>
    <published>2017-08-06T04:24:45.000Z</published>
    <updated>2017-08-09T09:27:03.666Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ListView-RecyclerView-的单选效果"><a href="#ListView-RecyclerView-的单选效果" class="headerlink" title="ListView(RecyclerView)的单选效果"></a>ListView(RecyclerView)的单选效果</h1><p>在Adapter中公开一个方法,传入选中的position,然后刷新<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public void setSelected(int selectedPosition)&#123;</div><div class="line">	mSelectedPosition = selectedPosition;</div><div class="line">	notifyDataSetChanged();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>listView设置选项监听,在监听回调方法中,记录选中的position,调用上面方法setSelected()</p>
<p>在getView方法中判断position是否为mSelectedPosition,然后进行相应操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">if (mSelectedPosition == position)&#123;</div><div class="line">	deviceListViewHolder.iv_select.setVisibility(View.VISIBLE);</div><div class="line">	deviceListViewHolder.tv_device_name.setTextColor(context.getResources().getColor(R.color.code_blue));</div><div class="line">&#125;else &#123;</div><div class="line">	deviceListViewHolder.iv_select.setVisibility(View.INVISIBLE);</div><div class="line">	deviceListViewHolder.tv_device_name.setTextColor(context.getResources().getColor(R.color.gray));</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="EditText相关"><a href="#EditText相关" class="headerlink" title="EditText相关"></a>EditText相关</h1><h2 id="光标颜色"><a href="#光标颜色" class="headerlink" title="光标颜色"></a>光标颜色</h2><h1 id="TextView相关"><a href="#TextView相关" class="headerlink" title="TextView相关"></a>TextView相关</h1><h2 id="设置行距"><a href="#设置行距" class="headerlink" title="设置行距"></a>设置行距</h2><h1 id="修改语言"><a href="#修改语言" class="headerlink" title="修改语言"></a>修改语言</h1><h1 id="全屏显示"><a href="#全屏显示" class="headerlink" title="全屏显示"></a>全屏显示</h1><h1 id="强制横屏"><a href="#强制横屏" class="headerlink" title="强制横屏"></a>强制横屏</h1><h1 id="透明状态栏"><a href="#透明状态栏" class="headerlink" title="透明状态栏"></a>透明状态栏</h1>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;ListView-RecyclerView-的单选效果&quot;&gt;&lt;a href=&quot;#ListView-RecyclerView-的单选效果&quot; class=&quot;headerlink&quot; title=&quot;ListView(RecyclerView)的单选效果&quot;&gt;&lt;/a&gt;ListV
    
    </summary>
    
      <category term="Android" scheme="https://devallever.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://devallever.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Android 根据一系列坐标点绘制贝塞尔曲线</title>
    <link href="https://devallever.github.io/2017/07/30/custom-bezier-line/"/>
    <id>https://devallever.github.io/2017/07/30/custom-bezier-line/</id>
    <published>2017-07-30T08:54:18.000Z</published>
    <updated>2017-07-30T09:37:29.785Z</updated>
    
    <content type="html"><![CDATA[<h1 id="功能概述："><a href="#功能概述：" class="headerlink" title="功能概述："></a>功能概述：</h1><p>给定一系列坐标，绘制它的贝塞尔曲线，并有渐变效果，如图:<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/DataProject/blob/master/data/bicycle/line-01.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure></p>
<h1 id="详细实现"><a href="#详细实现" class="headerlink" title="详细实现"></a>详细实现</h1><h2 id="把一般坐标转为-Android中的视图坐标"><a href="#把一般坐标转为-Android中的视图坐标" class="headerlink" title="把一般坐标转为 Android中的视图坐标"></a>把一般坐标转为 Android中的视图坐标</h2><p>因为现实中的坐标和Android中的坐标是不同的，Android中向下为Y轴正方向<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">List&lt;PointF&gt; oldPointF1 = new ArrayList&lt;&gt;();</div><div class="line">oldPointF1.add(new PointF(1, 100));</div><div class="line">oldPointF1.add(new PointF(2, 200));</div><div class="line">oldPointF1.add(new PointF(3, 150));</div><div class="line">oldPointF1.add(new PointF(4, 200));</div><div class="line">oldPointF1.add(new PointF(5, 50));</div><div class="line">oldPointF1.add(new PointF(6, 150));</div><div class="line">oldPointF1.add(new PointF(7, 100));</div><div class="line">oldPointF1.add(new PointF(8, 200));</div><div class="line">oldPointF1.add(new PointF(9, 100));</div><div class="line">oldPointF1.add(new PointF(10, 150));</div><div class="line">oldPointF1.add(new PointF(11, 50));</div><div class="line">oldPointF1.add(new PointF(12, 100));</div><div class="line">List&lt;PointF&gt; pointFs1 = changePoint(oldPointF1);</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 把一般坐标转为 Android中的视图坐标**/</div><div class="line">private List&lt;PointF&gt; changePoint(List&lt;PointF&gt; oldPointFs)&#123;</div><div class="line">    List&lt;PointF&gt; pointFs = new ArrayList&lt;&gt;();</div><div class="line">    //间隔，减去某个值是为了空出多余空间，为了画线以外，还要写坐标轴的值，除以坐标轴最大值(这里设为定值)</div><div class="line">    //相当于缩小图像</div><div class="line">    int intervalX = (getMeasuredWidth()-20)/12;</div><div class="line">    int intervalY = (getMeasuredHeight()-20)/250;</div><div class="line">    int height = getMeasuredHeight();</div><div class="line">    PointF p;</div><div class="line">    float x;</div><div class="line">    float y;</div><div class="line">    for (PointF pointF: oldPointFs)&#123;</div><div class="line">        //最后的正负值是左移右移</div><div class="line">        x = pointF.x * intervalX + 0;</div><div class="line">        y = height - pointF.y * intervalY - 100;</div><div class="line">        p = new PointF(x, y);</div><div class="line">        pointFs.add(p);</div><div class="line">    &#125;</div><div class="line">    return pointFs;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="计算控制点"><a href="#计算控制点" class="headerlink" title="计算控制点"></a>计算控制点</h2><p>参考文章：<a href="http://www.zheng-hang.com/?id=43" target="_blank" rel="external">根据多个点使用canvas贝赛尔曲线画一条平滑的曲线</a></p>
<p>在这里仅把求控制点公式转换成java代码<br>首先封装控制点类：ControlPoint.java<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div></pre></td><td class="code"><pre><div class="line">package com.allever.bicycle.chartTest;</div><div class="line"></div><div class="line">import android.graphics.PointF;</div><div class="line"></div><div class="line">import java.util.ArrayList;</div><div class="line">import java.util.List;</div><div class="line"></div><div class="line">/**</div><div class="line"> * Created by allever on 17-7-27.</div><div class="line"> */</div><div class="line"></div><div class="line">public class ControlPoint &#123;</div><div class="line">    private PointF conPoint1;</div><div class="line">    private PointF conPoint2;</div><div class="line"></div><div class="line">    public ControlPoint(PointF p1, PointF p2)&#123;</div><div class="line">        this.conPoint1 = p1;</div><div class="line">        this.conPoint2 = p2;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public PointF getConPoint1() &#123;</div><div class="line">        return conPoint1;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setConPoint1(PointF conPoint1) &#123;</div><div class="line">        this.conPoint1 = conPoint1;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public PointF getConPoint2() &#123;</div><div class="line">        return conPoint2;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setConPoint2(PointF conPoint2) &#123;</div><div class="line">        this.conPoint2 = conPoint2;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static List&lt;ControlPoint&gt; getControlPointList(List&lt;PointF&gt; pointFs)&#123;</div><div class="line">        List&lt;ControlPoint&gt; controlPoints = new ArrayList&lt;&gt;();</div><div class="line"></div><div class="line">        PointF p1;</div><div class="line">        PointF p2;</div><div class="line">        float conP1x;</div><div class="line">        float conP1y;</div><div class="line">        float conP2x;</div><div class="line">        float conP2y;</div><div class="line">        for (int i=0; i&lt;pointFs.size()-1;i++)&#123;</div><div class="line"></div><div class="line">            if (i == 0)&#123;</div><div class="line">                //第一断1曲线 控制点</div><div class="line">                conP1x = pointFs.get(i).x + (pointFs.get(i + 1).x-pointFs.get(i).x)/4;</div><div class="line">                conP1y = pointFs.get(i).y + (pointFs.get(i + 1).y-pointFs.get(i).y)/4;</div><div class="line"></div><div class="line">                conP2x = pointFs.get(i+1).x - (pointFs.get(i + 2).x - pointFs.get(i).x)/4;</div><div class="line">                conP2y = pointFs.get(i+1).y - (pointFs.get(i + 2).y - pointFs.get(i).y)/4;</div><div class="line"></div><div class="line">            &#125;else if (i == pointFs.size() - 2)&#123;</div><div class="line">                //最后一段曲线 控制点</div><div class="line">                conP1x = pointFs.get(i).x + (pointFs.get(i + 1).x-pointFs.get(i - 1).x)/4;</div><div class="line">                conP1y = pointFs.get(i).y + (pointFs.get(i + 1).y-pointFs.get(i - 1).y)/4;</div><div class="line"></div><div class="line">                conP2x = pointFs.get(i+1).x - (pointFs.get(i + 1).x - pointFs.get(i).x)/4;</div><div class="line">                conP2y = pointFs.get(i+1).y - (pointFs.get(i + 1).y - pointFs.get(i).y)/4;</div><div class="line">            &#125;else &#123;</div><div class="line">                conP1x = pointFs.get(i).x + (pointFs.get(i + 1).x-pointFs.get(i - 1).x)/4;</div><div class="line">                conP1y = pointFs.get(i).y + (pointFs.get(i + 1).y-pointFs.get(i - 1).y)/4;</div><div class="line"></div><div class="line">                conP2x = pointFs.get(i+1).x - (pointFs.get(i + 2).x - pointFs.get(i).x)/4;</div><div class="line">                conP2y = pointFs.get(i+1).y - (pointFs.get(i + 2).y - pointFs.get(i).y)/4;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            p1 = new PointF(conP1x,conP1y);</div><div class="line">            p2 = new PointF(conP2x,conP2y);</div><div class="line"></div><div class="line">            ControlPoint controlPoint = new ControlPoint(p1, p2);</div><div class="line">            controlPoints.add(controlPoint);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        return controlPoints;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其中getControlPointList()方法用来求每一断贝塞尔曲线的控制点，需要传入点坐标的List。一段曲线有两个控制点，因为使用三阶贝塞尔曲线，把每一段的控制点(两个)放到List中返回。<br>这里进行了判断，是因为第一段和左后一段求控制点与其他断有区别。可以查看上面文章公式。</p>
<h3 id="绘制贝塞尔曲线"><a href="#绘制贝塞尔曲线" class="headerlink" title="绘制贝塞尔曲线"></a>绘制贝塞尔曲线</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">Path mPath1 = new Path();</div><div class="line">//贝塞尔曲线获取控制点</div><div class="line">List&lt;ControlPoint&gt; controlPoints1 = ControlPoint.getControlPointList(pointFs1);</div><div class="line">for (int i=0; i&lt;controlPoints1.size(); i++)&#123;</div><div class="line">    if (i == 0)&#123;</div><div class="line">        mPath1.moveTo(pointFs1.get(i).x,pointFs1.get(i).y);</div><div class="line">    &#125;</div><div class="line">    //画三价贝塞尔曲线</div><div class="line">    mPath1.cubicTo(</div><div class="line">            controlPoints1.get(i).getConPoint1().x,controlPoints1.get(i).getConPoint1().y,</div><div class="line">            controlPoints1.get(i).getConPoint2().x,controlPoints1.get(i).getConPoint2().y,</div><div class="line">            pointFs1.get(i+1).x, pointFs1.get(i+1).y</div><div class="line">    );</div><div class="line">&#125;</div><div class="line">LinearGradient mLinearGradient = new LinearGradient(</div><div class="line">        0,</div><div class="line">        0,</div><div class="line">        0,</div><div class="line">        getMeasuredHeight(),</div><div class="line">        new int[]&#123;</div><div class="line">                0xffffffff,</div><div class="line">                getResources().getColor(R.color.cyan),</div><div class="line">                getResources().getColor(R.color.colorPrimary),</div><div class="line">                getResources().getColor(R.color.colorPrimary),</div><div class="line">                getResources().getColor(R.color.colorPrimary)&#125;,</div><div class="line">        null,</div><div class="line">        Shader.TileMode.CLAMP</div><div class="line">);</div><div class="line">mPaint.setShader(mLinearGradient);</div><div class="line"></div><div class="line">canvas.drawPath(mPath1,mPaint);</div><div class="line">canvas.save();</div></pre></td></tr></table></figure>
<h3 id="颜色渐变"><a href="#颜色渐变" class="headerlink" title="颜色渐变"></a>颜色渐变</h3><p>把画笔paint设置线性渐变LinearGradient，查看该构造方法，可以知道，<br>第一个参数，0，为x中开始渐变<br>第二个参数，0，为y轴开始渐变<br>第三个参数。0，为x轴结束渐变<br>第四个参数，为y轴结束渐变，<br>这里这样设置就是只在y轴上渐变<br>颜色数组：<br>依次是从上到下的渐变颜色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">LinearGradient mLinearGradient = new LinearGradient(</div><div class="line">        0,</div><div class="line">        0,</div><div class="line">        0,</div><div class="line">        getMeasuredHeight(),</div><div class="line">        new int[]&#123;</div><div class="line">                0xffffffff,</div><div class="line">                getResources().getColor(R.color.cyan),</div><div class="line">                getResources().getColor(R.color.colorPrimary),</div><div class="line">                getResources().getColor(R.color.colorPrimary),</div><div class="line">                getResources().getColor(R.color.colorPrimary)&#125;,</div><div class="line">        null,</div><div class="line">        Shader.TileMode.CLAMP</div><div class="line">);</div><div class="line">mPaint.setShader(mLinearGradient);</div></pre></td></tr></table></figure></p>
<h3 id="绘制坐标和分割线"><a href="#绘制坐标和分割线" class="headerlink" title="绘制坐标和分割线"></a>绘制坐标和分割线</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">//画分割线和纵坐标</div><div class="line">Paint linePaint = new Paint();</div><div class="line">linePaint.setColor(0x66cccccc);</div><div class="line">linePaint.setTextSize(40f);</div><div class="line">//画5条分割线</div><div class="line">for (int i=0; i&lt;5; i++)&#123;</div><div class="line">    canvas.drawLine(90, getMeasuredHeight()-((getMeasuredHeight()/6) * i) - 140, getMeasuredWidth(), getMeasuredHeight()-((getMeasuredHeight()/6) * i) - 140,linePaint);</div><div class="line">    canvas.drawText(45*i+&quot;&quot;,10, getMeasuredHeight()-((getMeasuredHeight()/6) * i) - 130,linePaint);</div><div class="line">    canvas.save();</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">//画横坐标</div><div class="line">linePaint.setTextSize(30f);</div><div class="line">for (int i=0; i&lt;12; i++)&#123;</div><div class="line">    canvas.drawText((i+1)+&quot;:00&quot;, (getMeasuredWidth())/13*i + 100, getMeasuredHeight()-((getMeasuredHeight()/5) * 0) - 60, linePaint);</div><div class="line">    canvas.save();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="后续更新"><a href="#后续更新" class="headerlink" title="后续更新"></a>后续更新</h1><p>可以设置数据，曲线数量</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;功能概述：&quot;&gt;&lt;a href=&quot;#功能概述：&quot; class=&quot;headerlink&quot; title=&quot;功能概述：&quot;&gt;&lt;/a&gt;功能概述：&lt;/h1&gt;&lt;p&gt;给定一系列坐标，绘制它的贝塞尔曲线，并有渐变效果，如图:&lt;br&gt;&lt;figure class=&quot;image-bubbl
    
    </summary>
    
      <category term="Android" scheme="https://devallever.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://devallever.github.io/tags/Android/"/>
    
      <category term="自定义View" scheme="https://devallever.github.io/tags/%E8%87%AA%E5%AE%9A%E4%B9%89View/"/>
    
  </entry>
  
  <entry>
    <title>Android  选择器</title>
    <link href="https://devallever.github.io/2017/07/30/selected-demo/"/>
    <id>https://devallever.github.io/2017/07/30/selected-demo/</id>
    <published>2017-07-30T06:13:16.000Z</published>
    <updated>2017-07-30T15:23:26.127Z</updated>
    
    <content type="html"><![CDATA[<h1 id="功能概述："><a href="#功能概述：" class="headerlink" title="功能概述："></a>功能概述：</h1><p>选中状态：选中时候变为蓝色，并有个减号，里面也是蓝色，<br>未选中状态：未选中时候为空白，并有个加号，<br>点中选中的状态变为未选中状态，点击未选中状态变为选中状态，当仅剩下一个选中时候，减号消失，表示不允许改变当前状态，即最少有一个选中状态</p>
<p>效果图1：<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/DataProject/blob/master/data/bicycle/selected-item-01.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure></p>
<p>效果图2：<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/DataProject/blob/master/data/bicycle/selected-item-02.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure></p>
<h1 id="实现思路："><a href="#实现思路：" class="headerlink" title="实现思路："></a>实现思路：</h1><p>UI：因为背景是透明的，所以使用shape逐个绘图，然后把这些绘图用layer组合起来。<br>逻辑：可以有两中方式<br>1.每一项是一个布局，然后在这个布局添加内容，对这个布局使用单击监听。<br>2.使用列表RecyclerView。</p>
<h1 id="详细实现"><a href="#详细实现" class="headerlink" title="详细实现"></a>详细实现</h1><h2 id="画UI图"><a href="#画UI图" class="headerlink" title="画UI图"></a>画UI图</h2><h3 id="绘制蓝色背景："><a href="#绘制蓝色背景：" class="headerlink" title="绘制蓝色背景："></a>绘制蓝色背景：</h3><p>target_item_one_selected.xml<br>这个很简单，就是画个矩形，使用圆角和填充颜色<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/DataProject/blob/master/data/bicycle/bg_blue.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:shape=&quot;rectangle&quot;&gt;</div><div class="line">    &lt;solid</div><div class="line">        android:color=&quot;@color/deep_blue&quot; /&gt;</div><div class="line">    &lt;corners</div><div class="line">        android:radius=&quot;10dp&quot;/&gt;</div><div class="line">&lt;/shape&gt;</div></pre></td></tr></table></figure></p>
<h3 id="绘制白色边框："><a href="#绘制白色边框：" class="headerlink" title="绘制白色边框："></a>绘制白色边框：</h3><p>target_item_none_selected_framework.xml<br>这个跟上面差不多，不适用填充，设置边框颜色和圆角即可<br>效果图：<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/DataProject/blob/master/data/bicycle/bg_framework.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:shape=&quot;rectangle&quot;&gt;</div><div class="line"></div><div class="line">    &lt;stroke</div><div class="line">        android:width=&quot;1dp&quot;</div><div class="line">        android:color=&quot;@color/white&quot;/&gt;</div><div class="line">    &lt;corners</div><div class="line">        android:radius=&quot;10dp&quot;/&gt;</div><div class="line">&lt;/shape&gt;</div></pre></td></tr></table></figure></p>
<h3 id="绘制减号"><a href="#绘制减号" class="headerlink" title="绘制减号"></a>绘制减号</h3><p>首先绘制一个圆形：target_item_selected_circle_delete.xml<br>画一个圆形，填充蓝色，边框白色<br>效果图:<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/DataProject/blob/master/data/bicycle/delete_circle.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:shape=&quot;oval&quot;&gt;</div><div class="line">    &lt;solid</div><div class="line">        android:color=&quot;@color/deep_blue&quot;/&gt;</div><div class="line">    &lt;stroke</div><div class="line">        android:width=&quot;1dp&quot;</div><div class="line">        android:color=&quot;@color/white&quot;/&gt;</div><div class="line">    &lt;size</div><div class="line">        android:width=&quot;20dp&quot;</div><div class="line">        android:height=&quot;20dp&quot;/&gt;</div><div class="line">&lt;/shape&gt;</div></pre></td></tr></table></figure></p>
<p>绘制减号的横线：target_item_selected_line.xml<br>效果图：<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/DataProject/blob/master/data/bicycle/h_line.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:shape=&quot;line&quot;</div><div class="line">    android:gravity=&quot;bottom|right&quot;&gt;</div><div class="line">        &lt;stroke android:width=&quot;1dp&quot;</div><div class="line">            android:color=&quot;@color/white&quot; /&gt;</div><div class="line">        &lt;size</div><div class="line">            android:width=&quot;10dp&quot;</div><div class="line">            android:height=&quot;20dp&quot; /&gt;</div><div class="line">        &lt;padding</div><div class="line">            android:left=&quot;10dp&quot;</div><div class="line">            android:right=&quot;10dp&quot;/&gt;</div><div class="line">&lt;/shape&gt;</div></pre></td></tr></table></figure></p>
<p>绘制减号：target_item_delete.xml<br>使用layer把上面两个shape组合起来<br>效果图：<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/DataProject/blob/master/data/bicycle/delete.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;layer-list xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;</div><div class="line">    &lt;item</div><div class="line">        android:drawable=&quot;@drawable/target_item_selected_circle_delete&quot;</div><div class="line">        android:gravity=&quot;bottom|right&quot;&gt;</div><div class="line">    &lt;/item&gt;</div><div class="line">    &lt;item</div><div class="line">        android:gravity=&quot;bottom|right&quot;</div><div class="line">        android:drawable=&quot;@drawable/target_item_selected_line&quot;</div><div class="line">        android:right=&quot;5dp&quot;&gt;</div><div class="line">    &lt;/item&gt;</div><div class="line">&lt;/layer-list&gt;</div></pre></td></tr></table></figure></p>
<h3 id="绘制加号"><a href="#绘制加号" class="headerlink" title="绘制加号"></a>绘制加号</h3><p>首先绘制一个圆:target_item_none_selected_circle.xml<br>填充白色，边框白色<br>效果图：<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/DataProject/blob/master/data/bicycle/add_circle.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:shape=&quot;oval&quot;&gt;</div><div class="line">    &lt;solid</div><div class="line">        android:color=&quot;@color/black&quot;/&gt;</div><div class="line">    &lt;stroke</div><div class="line">        android:width=&quot;1dp&quot;</div><div class="line">        android:color=&quot;@color/white&quot;/&gt;</div><div class="line">    &lt;size</div><div class="line">        android:width=&quot;20dp&quot;</div><div class="line">        android:height=&quot;20dp&quot;/&gt;</div><div class="line">&lt;/shape&gt;</div></pre></td></tr></table></figure></p>
<p>绘制加号的横线，跟上面的横线相同的</p>
<p>绘制加号的竖线：target_item_none_selected_vertical_line.xml<br>就是把横线旋转90度即形成竖直的线<br>效果图：<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/DataProject/blob/master/data/bicycle/v_line.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;rotate xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:fromDegrees=&quot;90&quot;</div><div class="line">    android:toDegrees=&quot;90&quot;&gt;</div><div class="line"></div><div class="line">    &lt;shape</div><div class="line">        android:shape=&quot;line&quot;&gt;</div><div class="line">        &lt;stroke</div><div class="line">            android:width=&quot;1dp&quot;</div><div class="line">            android:color=&quot;@color/white&quot;/&gt;</div><div class="line">        &lt;size</div><div class="line">            android:width=&quot;10dp&quot;</div><div class="line">            android:height=&quot;10dp&quot;/&gt;</div><div class="line">    &lt;/shape&gt;</div><div class="line"></div><div class="line"></div><div class="line">&lt;/rotate&gt;</div></pre></td></tr></table></figure></p>
<p>最后把以上三个shape组合起来就成了一个加号：target_item_add.xml<br>效果图：<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/DataProject/blob/master/data/bicycle/add.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;layer-list xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;</div><div class="line">    &lt;item</div><div class="line">        android:drawable=&quot;@drawable/target_item_none_selected_circle&quot;</div><div class="line">        android:gravity=&quot;bottom|right&quot;&gt;</div><div class="line">    &lt;/item&gt;</div><div class="line">    &lt;item</div><div class="line">        android:drawable=&quot;@drawable/target_item_none_selected_vertical_line&quot;</div><div class="line">        android:gravity=&quot;bottom|right&quot;</div><div class="line">        android:right=&quot;5dp&quot;</div><div class="line">        android:bottom=&quot;5dp&quot;&gt;</div><div class="line">    &lt;/item&gt;</div><div class="line">    &lt;item</div><div class="line">        android:gravity=&quot;bottom|right&quot;</div><div class="line">        android:drawable=&quot;@drawable/target_item_none_selected_line&quot;</div><div class="line">        android:right=&quot;5dp&quot;&gt;</div><div class="line">    &lt;/item&gt;</div><div class="line">&lt;/layer-list&gt;</div></pre></td></tr></table></figure></p>
<h3 id="UI组合"><a href="#UI组合" class="headerlink" title="UI组合"></a>UI组合</h3><p>我觉得这里的难点就是右下角的加减好在边框上向右下方移动那么一点点，这里及解决方法就是，用一个总体父布局，里面包含两部分，第一部分是中心框部分，把这部分设置居中，并且在四周留有空间，第二部分是加减号，设置在父布局的右下方，这样看起来就是个效果了。当然还有其他方法，例如找图片，这种图片应该很难找得到，或者是知己制作这种图片，设置给父布局就好了。</p>
<h1 id="逻辑实现"><a href="#逻辑实现" class="headerlink" title="逻辑实现"></a>逻辑实现</h1><p>这里有两种方式：<br>第一种就是每一项就是一个布局，总共有八个布局<br>第二种就是使用列表RecyclerView</p>
<h2 id="布局实现方式"><a href="#布局实现方式" class="headerlink" title="布局实现方式"></a>布局实现方式</h2><h3 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h3><p>在布局文件中放这八个布局<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:orientation=&quot;vertical&quot; android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;</div><div class="line">    android:background=&quot;@mipmap/bg1&quot;</div><div class="line">    android:gravity=&quot;right&quot;&gt;</div><div class="line">    &lt;LinearLayout</div><div class="line">        android:id=&quot;@+id/id_target_ll_first_line&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;0dp&quot;</div><div class="line">        android:layout_weight=&quot;1&quot;</div><div class="line">        android:orientation=&quot;horizontal&quot;</div><div class="line">        android:layout_alignParentRight=&quot;true&quot;</div><div class="line">        android:layout_marginTop=&quot;10dp&quot;&gt;</div><div class="line"></div><div class="line">        &lt;RelativeLayout</div><div class="line">            android:layout_width=&quot;110dp&quot;</div><div class="line">            android:layout_height=&quot;110dp&quot;</div><div class="line">            android:padding=&quot;10dp&quot;&gt;</div><div class="line">            &lt;RelativeLayout</div><div class="line">                android:id=&quot;@+id/id_target_item_container_speed&quot;</div><div class="line">                android:layout_width=&quot;80dp&quot;</div><div class="line">                android:layout_height=&quot;80dp&quot;</div><div class="line">                android:layout_centerInParent=&quot;true&quot;</div><div class="line">                android:background=&quot;@drawable/target_item_one_selected&quot;&gt;</div><div class="line"></div><div class="line">                &lt;TextView</div><div class="line">                    android:layout_width=&quot;wrap_content&quot;</div><div class="line">                    android:layout_height=&quot;wrap_content&quot;</div><div class="line">                    android:text=&quot;速度&quot;</div><div class="line">                    android:layout_centerHorizontal=&quot;true&quot;</div><div class="line">                    android:textColor=&quot;@color/white&quot;</div><div class="line">                    android:layout_marginTop=&quot;10dp&quot;/&gt;</div><div class="line">                &lt;TextView</div><div class="line">                    android:id=&quot;@+id/id_target_item_tv_speed&quot;</div><div class="line">                    android:layout_width=&quot;wrap_content&quot;</div><div class="line">                    android:layout_height=&quot;wrap_content&quot;</div><div class="line">                    android:text=&quot;6&quot;</div><div class="line">                    android:textSize=&quot;30sp&quot;</div><div class="line">                    android:textColor=&quot;@color/white&quot;</div><div class="line">                    android:layout_centerHorizontal=&quot;true&quot;</div><div class="line">                    android:layout_alignParentBottom=&quot;true&quot;</div><div class="line">                    android:layout_marginBottom=&quot;10dp&quot;/&gt;</div><div class="line"></div><div class="line">            &lt;/RelativeLayout&gt;</div><div class="line">            &lt;RelativeLayout</div><div class="line">                android:id=&quot;@+id/id_target_item_rl_speed_option&quot;</div><div class="line">                android:layout_width=&quot;wrap_content&quot;</div><div class="line">                android:layout_height=&quot;wrap_content&quot;</div><div class="line">                android:layout_alignParentRight=&quot;true&quot;</div><div class="line">                android:layout_alignParentBottom=&quot;true&quot;</div><div class="line">                android:background=&quot;@drawable/target_item_one_selected&quot;&gt;</div><div class="line">            &lt;/RelativeLayout&gt;</div><div class="line"></div><div class="line">        &lt;/RelativeLayout&gt;</div><div class="line"></div><div class="line">        &lt;RelativeLayout</div><div class="line">            android:layout_width=&quot;110dp&quot;</div><div class="line">            android:layout_height=&quot;110dp&quot;</div><div class="line">            android:padding=&quot;10dp&quot;&gt;</div><div class="line">            &lt;RelativeLayout</div><div class="line">                android:id=&quot;@+id/id_target_item_container_distance&quot;</div><div class="line">                android:layout_width=&quot;80dp&quot;</div><div class="line">                android:layout_height=&quot;80dp&quot;</div><div class="line">                android:layout_centerInParent=&quot;true&quot;</div><div class="line">                android:background=&quot;@drawable/target_item_none_selected_framework&quot;&gt;</div><div class="line"></div><div class="line">                &lt;TextView</div><div class="line">                    android:layout_width=&quot;wrap_content&quot;</div><div class="line">                    android:layout_height=&quot;wrap_content&quot;</div><div class="line">                    android:text=&quot;距离&quot;</div><div class="line">                    android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">                    android:textColor=&quot;@color/white&quot;</div><div class="line">                    android:layout_marginTop=&quot;10dp&quot;/&gt;</div><div class="line">                &lt;TextView</div><div class="line">                    android:id=&quot;@+id/id_target_item_tv_distance&quot;</div><div class="line">                    android:layout_width=&quot;wrap_content&quot;</div><div class="line">                    android:layout_height=&quot;wrap_content&quot;</div><div class="line">                    android:text=&quot;0.7&quot;</div><div class="line">                    android:textSize=&quot;30sp&quot;</div><div class="line">                    android:textColor=&quot;@color/white&quot;</div><div class="line">                    android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">                    android:layout_alignParentBottom=&quot;true&quot;</div><div class="line">                    android:layout_marginBottom=&quot;10dp&quot;/&gt;</div><div class="line"></div><div class="line">                &lt;TextView</div><div class="line">                    android:layout_width=&quot;wrap_content&quot;</div><div class="line">                    android:layout_height=&quot;wrap_content&quot;</div><div class="line">                    android:text=&quot;km&quot;</div><div class="line">                    android:textColor=&quot;@color/white&quot;</div><div class="line">                    android:layout_alignParentBottom=&quot;true&quot;</div><div class="line">                    android:layout_marginBottom=&quot;15dp&quot;</div><div class="line">                    android:layout_marginLeft=&quot;2dp&quot;</div><div class="line">                    android:layout_toRightOf=&quot;@id/id_target_item_tv_distance&quot; /&gt;</div><div class="line"></div><div class="line">            &lt;/RelativeLayout&gt;</div><div class="line">            &lt;RelativeLayout</div><div class="line">                android:id=&quot;@+id/id_target_item_rl_distance_option&quot;</div><div class="line">                android:layout_width=&quot;wrap_content&quot;</div><div class="line">                android:layout_height=&quot;wrap_content&quot;</div><div class="line">                android:layout_alignParentRight=&quot;true&quot;</div><div class="line">                android:layout_alignParentBottom=&quot;true&quot;</div><div class="line">                android:background=&quot;@drawable/target_item_add&quot;&gt;</div><div class="line">            &lt;/RelativeLayout&gt;</div><div class="line">        &lt;/RelativeLayout&gt;</div><div class="line"></div><div class="line">        &lt;RelativeLayout</div><div class="line">            android:layout_width=&quot;110dp&quot;</div><div class="line">            android:layout_height=&quot;110dp&quot;</div><div class="line">            android:padding=&quot;10dp&quot;</div><div class="line">            android:layout_alignParentRight=&quot;true&quot;&gt;</div><div class="line">            &lt;RelativeLayout</div><div class="line">                android:id=&quot;@+id/id_target_item_container_power&quot;</div><div class="line">                android:layout_width=&quot;80dp&quot;</div><div class="line">                android:layout_height=&quot;80dp&quot;</div><div class="line">                android:layout_centerInParent=&quot;true&quot;</div><div class="line">                android:background=&quot;@drawable/target_item_none_selected_framework&quot;&gt;</div><div class="line"></div><div class="line">                &lt;TextView</div><div class="line">                    android:layout_width=&quot;wrap_content&quot;</div><div class="line">                    android:layout_height=&quot;wrap_content&quot;</div><div class="line">                    android:text=&quot;功率&quot;</div><div class="line">                    android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">                    android:textColor=&quot;@color/white&quot;</div><div class="line">                    android:layout_marginTop=&quot;10dp&quot;/&gt;</div><div class="line">                &lt;TextView</div><div class="line">                    android:id=&quot;@+id/id_target_item_tv_power&quot;</div><div class="line">                    android:layout_width=&quot;wrap_content&quot;</div><div class="line">                    android:layout_height=&quot;wrap_content&quot;</div><div class="line">                    android:text=&quot;74&quot;</div><div class="line">                    android:textSize=&quot;30sp&quot;</div><div class="line">                    android:textColor=&quot;@color/white&quot;</div><div class="line">                    android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">                    android:layout_alignParentBottom=&quot;true&quot;</div><div class="line">                    android:layout_marginBottom=&quot;10dp&quot;/&gt;</div><div class="line"></div><div class="line">                &lt;TextView</div><div class="line">                    android:layout_width=&quot;wrap_content&quot;</div><div class="line">                    android:layout_height=&quot;wrap_content&quot;</div><div class="line">                    android:text=&quot;w&quot;</div><div class="line">                    android:textColor=&quot;@color/white&quot;</div><div class="line">                    android:layout_alignParentBottom=&quot;true&quot;</div><div class="line">                    android:layout_marginBottom=&quot;15dp&quot;</div><div class="line">                    android:layout_marginLeft=&quot;2dp&quot;</div><div class="line">                    android:layout_toRightOf=&quot;@id/id_target_item_tv_power&quot; /&gt;</div><div class="line"></div><div class="line">            &lt;/RelativeLayout&gt;</div><div class="line">            &lt;RelativeLayout</div><div class="line">                android:id=&quot;@+id/id_target_item_rl_power_option&quot;</div><div class="line">                android:layout_width=&quot;wrap_content&quot;</div><div class="line">                android:layout_height=&quot;wrap_content&quot;</div><div class="line">                android:layout_alignParentRight=&quot;true&quot;</div><div class="line">                android:layout_alignParentBottom=&quot;true&quot;</div><div class="line">                android:background=&quot;@drawable/target_item_add&quot;&gt;</div><div class="line">            &lt;/RelativeLayout&gt;</div><div class="line">        &lt;/RelativeLayout&gt;</div><div class="line"></div><div class="line">    &lt;/LinearLayout&gt;</div><div class="line"></div><div class="line"></div><div class="line">    &lt;!-- The Second line--&gt;</div><div class="line">    &lt;LinearLayout</div><div class="line">        android:id=&quot;@+id/id_target_ll_second_line&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;0dp&quot;</div><div class="line">        android:layout_weight=&quot;1&quot;</div><div class="line">        android:orientation=&quot;horizontal&quot;</div><div class="line">        android:layout_alignParentRight=&quot;true&quot;</div><div class="line">        android:layout_below=&quot;@id/id_target_ll_first_line&quot;&gt;</div><div class="line"></div><div class="line">        &lt;RelativeLayout</div><div class="line">            android:layout_width=&quot;110dp&quot;</div><div class="line">            android:layout_height=&quot;110dp&quot;</div><div class="line">            android:padding=&quot;10dp&quot;</div><div class="line">            android:layout_alignParentRight=&quot;true&quot;&gt;</div><div class="line">            &lt;RelativeLayout</div><div class="line">                android:id=&quot;@+id/id_target_item_container_slope_degree&quot;</div><div class="line">                android:layout_width=&quot;80dp&quot;</div><div class="line">                android:layout_height=&quot;80dp&quot;</div><div class="line">                android:layout_centerInParent=&quot;true&quot;</div><div class="line">                android:background=&quot;@drawable/target_item_none_selected_framework&quot;&gt;</div><div class="line"></div><div class="line">                &lt;TextView</div><div class="line">                    android:layout_width=&quot;wrap_content&quot;</div><div class="line">                    android:layout_height=&quot;wrap_content&quot;</div><div class="line">                    android:text=&quot;坡度&quot;</div><div class="line">                    android:layout_centerHorizontal=&quot;true&quot;</div><div class="line">                    android:textColor=&quot;@color/white&quot;</div><div class="line">                    android:layout_marginTop=&quot;10dp&quot;/&gt;</div><div class="line">                &lt;!-- slope degree 坡度--&gt;</div><div class="line">                &lt;TextView</div><div class="line">                    android:id=&quot;@+id/id_target_item_tv_slope_degree&quot;</div><div class="line">                    android:layout_width=&quot;wrap_content&quot;</div><div class="line">                    android:layout_height=&quot;wrap_content&quot;</div><div class="line">                    android:text=&quot;5&quot;</div><div class="line">                    android:textSize=&quot;30sp&quot;</div><div class="line">                    android:textColor=&quot;@color/white&quot;</div><div class="line">                    android:layout_centerHorizontal=&quot;true&quot;</div><div class="line">                    android:layout_alignParentBottom=&quot;true&quot;</div><div class="line">                    android:layout_marginBottom=&quot;10dp&quot;/&gt;</div><div class="line"></div><div class="line">            &lt;/RelativeLayout&gt;</div><div class="line">            &lt;RelativeLayout</div><div class="line">                android:id=&quot;@+id/id_target_item_rl_slope_degree_option&quot;</div><div class="line">                android:layout_width=&quot;wrap_content&quot;</div><div class="line">                android:layout_height=&quot;wrap_content&quot;</div><div class="line">                android:layout_alignParentRight=&quot;true&quot;</div><div class="line">                android:layout_alignParentBottom=&quot;true&quot;</div><div class="line">                android:background=&quot;@drawable/target_item_add&quot;&gt;</div><div class="line">            &lt;/RelativeLayout&gt;</div><div class="line">        &lt;/RelativeLayout&gt;</div><div class="line"></div><div class="line">        &lt;RelativeLayout</div><div class="line">            android:layout_width=&quot;110dp&quot;</div><div class="line">            android:layout_height=&quot;110dp&quot;</div><div class="line">            android:padding=&quot;10dp&quot;&gt;</div><div class="line">            &lt;RelativeLayout</div><div class="line">                android:id=&quot;@+id/id_target_item_container_patch_speed&quot;</div><div class="line">                android:layout_width=&quot;80dp&quot;</div><div class="line">                android:layout_height=&quot;80dp&quot;</div><div class="line">                android:layout_centerInParent=&quot;true&quot;</div><div class="line">                android:background=&quot;@drawable/target_item_none_selected_framework&quot;&gt;</div><div class="line"></div><div class="line">                &lt;TextView</div><div class="line">                    android:layout_width=&quot;wrap_content&quot;</div><div class="line">                    android:layout_height=&quot;wrap_content&quot;</div><div class="line">                    android:text=&quot;配速&quot;</div><div class="line">                    android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">                    android:textColor=&quot;@color/white&quot;</div><div class="line">                    android:layout_marginTop=&quot;10dp&quot;/&gt;</div><div class="line">                &lt;TextView</div><div class="line">                    android:id=&quot;@+id/id_target_item_tv_patch_speed&quot;</div><div class="line">                    android:layout_width=&quot;wrap_content&quot;</div><div class="line">                    android:layout_height=&quot;wrap_content&quot;</div><div class="line">                    android:text=&quot;00:30&quot;</div><div class="line">                    android:textSize=&quot;25sp&quot;</div><div class="line">                    android:textColor=&quot;@color/white&quot;</div><div class="line">                    android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">                    android:layout_alignParentBottom=&quot;true&quot;</div><div class="line">                    android:layout_marginBottom=&quot;15dp&quot;/&gt;</div><div class="line"></div><div class="line">            &lt;/RelativeLayout&gt;</div><div class="line">            &lt;RelativeLayout</div><div class="line">                android:id=&quot;@+id/id_target_item_rl_patch_speed_option&quot;</div><div class="line">                android:layout_width=&quot;wrap_content&quot;</div><div class="line">                android:layout_height=&quot;wrap_content&quot;</div><div class="line">                android:layout_alignParentRight=&quot;true&quot;</div><div class="line">                android:layout_alignParentBottom=&quot;true&quot;</div><div class="line">                android:background=&quot;@drawable/target_item_add&quot;&gt;</div><div class="line">            &lt;/RelativeLayout&gt;</div><div class="line">        &lt;/RelativeLayout&gt;</div><div class="line"></div><div class="line">        &lt;RelativeLayout</div><div class="line">            android:layout_width=&quot;110dp&quot;</div><div class="line">            android:layout_height=&quot;110dp&quot;</div><div class="line">            android:padding=&quot;10dp&quot;</div><div class="line">            android:layout_alignParentRight=&quot;true&quot;&gt;</div><div class="line">            &lt;RelativeLayout</div><div class="line">                android:id=&quot;@+id/id_target_item_container_calorie&quot;</div><div class="line">                android:layout_width=&quot;80dp&quot;</div><div class="line">                android:layout_height=&quot;80dp&quot;</div><div class="line">                android:layout_centerInParent=&quot;true&quot;</div><div class="line">                android:background=&quot;@drawable/target_item_none_selected_framework&quot;&gt;</div><div class="line"></div><div class="line">                &lt;TextView</div><div class="line">                    android:layout_width=&quot;wrap_content&quot;</div><div class="line">                    android:layout_height=&quot;wrap_content&quot;</div><div class="line">                    android:text=&quot;卡路里&quot;</div><div class="line">                    android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">                    android:textColor=&quot;@color/white&quot;</div><div class="line">                    android:layout_marginTop=&quot;10dp&quot;/&gt;</div><div class="line">                &lt;TextView</div><div class="line">                    android:id=&quot;@+id/id_target_item_tv_calorie&quot;</div><div class="line">                    android:layout_width=&quot;wrap_content&quot;</div><div class="line">                    android:layout_height=&quot;wrap_content&quot;</div><div class="line">                    android:text=&quot;119&quot;</div><div class="line">                    android:textSize=&quot;25sp&quot;</div><div class="line">                    android:textColor=&quot;@color/white&quot;</div><div class="line">                    android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">                    android:layout_alignParentBottom=&quot;true&quot;</div><div class="line">                    android:layout_marginBottom=&quot;15dp&quot;/&gt;</div><div class="line"></div><div class="line">                &lt;TextView</div><div class="line">                    android:layout_width=&quot;wrap_content&quot;</div><div class="line">                    android:layout_height=&quot;wrap_content&quot;</div><div class="line">                    android:text=&quot;kcal&quot;</div><div class="line">                    android:textColor=&quot;@color/white&quot;</div><div class="line">                    android:layout_alignParentBottom=&quot;true&quot;</div><div class="line">                    android:layout_marginBottom=&quot;20dp&quot;</div><div class="line">                    android:layout_marginLeft=&quot;2dp&quot;</div><div class="line">                    android:layout_toRightOf=&quot;@id/id_target_item_tv_calorie&quot; /&gt;</div><div class="line"></div><div class="line"></div><div class="line">            &lt;/RelativeLayout&gt;</div><div class="line">            &lt;RelativeLayout</div><div class="line">                android:id=&quot;@+id/id_target_item_rl_calorie_option&quot;</div><div class="line">                android:layout_width=&quot;wrap_content&quot;</div><div class="line">                android:layout_height=&quot;wrap_content&quot;</div><div class="line">                android:layout_alignParentRight=&quot;true&quot;</div><div class="line">                android:layout_alignParentBottom=&quot;true&quot;</div><div class="line">                android:background=&quot;@drawable/target_item_add&quot;&gt;</div><div class="line">            &lt;/RelativeLayout&gt;</div><div class="line">        &lt;/RelativeLayout&gt;</div><div class="line"></div><div class="line">    &lt;/LinearLayout&gt;</div><div class="line"></div><div class="line"></div><div class="line">    &lt;!-- The Third line --&gt;</div><div class="line">    &lt;LinearLayout</div><div class="line">        android:id=&quot;@+id/id_target_ll_third_line&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;0dp&quot;</div><div class="line">        android:layout_weight=&quot;1&quot;</div><div class="line">        android:orientation=&quot;horizontal&quot;</div><div class="line">        android:layout_alignParentRight=&quot;true&quot;</div><div class="line">        android:layout_below=&quot;@id/id_target_ll_second_line&quot;&gt;</div><div class="line"></div><div class="line">        &lt;RelativeLayout</div><div class="line">            android:layout_width=&quot;110dp&quot;</div><div class="line">            android:layout_height=&quot;110dp&quot;</div><div class="line">            android:padding=&quot;10dp&quot;</div><div class="line">            android:layout_alignParentRight=&quot;true&quot;&gt;</div><div class="line">            &lt;RelativeLayout</div><div class="line">                android:id=&quot;@+id/id_target_item_container_time&quot;</div><div class="line">                android:layout_width=&quot;80dp&quot;</div><div class="line">                android:layout_height=&quot;80dp&quot;</div><div class="line">                android:layout_centerInParent=&quot;true&quot;</div><div class="line">                android:background=&quot;@drawable/target_item_none_selected_framework&quot;&gt;</div><div class="line"></div><div class="line">                &lt;TextView</div><div class="line">                    android:layout_width=&quot;wrap_content&quot;</div><div class="line">                    android:layout_height=&quot;wrap_content&quot;</div><div class="line">                    android:text=&quot;时间&quot;</div><div class="line">                    android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">                    android:textColor=&quot;@color/white&quot;</div><div class="line">                    android:layout_marginTop=&quot;10dp&quot;/&gt;</div><div class="line">                &lt;TextView</div><div class="line">                    android:id=&quot;@+id/id_target_item_tv_time&quot;</div><div class="line">                    android:layout_width=&quot;wrap_content&quot;</div><div class="line">                    android:layout_height=&quot;wrap_content&quot;</div><div class="line">                    android:text=&quot;02:30&quot;</div><div class="line">                    android:textSize=&quot;25sp&quot;</div><div class="line">                    android:textColor=&quot;@color/white&quot;</div><div class="line">                    android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">                    android:layout_alignParentBottom=&quot;true&quot;</div><div class="line">                    android:layout_marginBottom=&quot;15dp&quot;/&gt;</div><div class="line"></div><div class="line">            &lt;/RelativeLayout&gt;</div><div class="line">            &lt;RelativeLayout</div><div class="line">                android:id=&quot;@+id/id_target_item_rl_time_option&quot;</div><div class="line">                android:layout_width=&quot;wrap_content&quot;</div><div class="line">                android:layout_height=&quot;wrap_content&quot;</div><div class="line">                android:layout_alignParentRight=&quot;true&quot;</div><div class="line">                android:layout_alignParentBottom=&quot;true&quot;</div><div class="line">                android:background=&quot;@drawable/target_item_add&quot;&gt;</div><div class="line">            &lt;/RelativeLayout&gt;</div><div class="line">        &lt;/RelativeLayout&gt;</div><div class="line"></div><div class="line">        &lt;RelativeLayout</div><div class="line">            android:layout_width=&quot;110dp&quot;</div><div class="line">            android:layout_height=&quot;110dp&quot;</div><div class="line">            android:padding=&quot;10dp&quot;&gt;</div><div class="line">            &lt;RelativeLayout</div><div class="line">                android:id=&quot;@+id/id_target_item_container_bmp&quot;</div><div class="line">                android:layout_width=&quot;80dp&quot;</div><div class="line">                android:layout_height=&quot;80dp&quot;</div><div class="line">                android:layout_centerInParent=&quot;true&quot;</div><div class="line">                android:background=&quot;@drawable/target_item_none_selected_framework&quot;&gt;</div><div class="line"></div><div class="line">                &lt;TextView</div><div class="line">                    android:layout_width=&quot;wrap_content&quot;</div><div class="line">                    android:layout_height=&quot;wrap_content&quot;</div><div class="line">                    android:text=&quot;心率&quot;</div><div class="line">                    android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">                    android:textColor=&quot;@color/white&quot;</div><div class="line">                    android:layout_marginTop=&quot;10dp&quot;/&gt;</div><div class="line">                &lt;TextView</div><div class="line">                    android:id=&quot;@+id/id_target_item_tv_bmp&quot;</div><div class="line">                    android:layout_width=&quot;wrap_content&quot;</div><div class="line">                    android:layout_height=&quot;wrap_content&quot;</div><div class="line">                    android:text=&quot;68&quot;</div><div class="line">                    android:textSize=&quot;30sp&quot;</div><div class="line">                    android:textColor=&quot;@color/white&quot;</div><div class="line">                    android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">                    android:layout_alignParentBottom=&quot;true&quot;</div><div class="line">                    android:layout_marginBottom=&quot;10dp&quot;/&gt;</div><div class="line"></div><div class="line">                &lt;TextView</div><div class="line">                    android:layout_width=&quot;wrap_content&quot;</div><div class="line">                    android:layout_height=&quot;wrap_content&quot;</div><div class="line">                    android:text=&quot;bmp&quot;</div><div class="line">                    android:textColor=&quot;@color/white&quot;</div><div class="line">                    android:layout_alignParentBottom=&quot;true&quot;</div><div class="line">                    android:layout_marginBottom=&quot;15dp&quot;</div><div class="line">                    android:layout_marginLeft=&quot;2dp&quot;</div><div class="line">                    android:layout_toRightOf=&quot;@id/id_target_item_tv_bmp&quot; /&gt;</div><div class="line"></div><div class="line"></div><div class="line">            &lt;/RelativeLayout&gt;</div><div class="line">            &lt;RelativeLayout</div><div class="line">                android:id=&quot;@+id/id_target_item_rl_bmp_option&quot;</div><div class="line">                android:layout_width=&quot;wrap_content&quot;</div><div class="line">                android:layout_height=&quot;wrap_content&quot;</div><div class="line">                android:layout_alignParentRight=&quot;true&quot;</div><div class="line">                android:layout_alignParentBottom=&quot;true&quot;</div><div class="line">                android:background=&quot;@drawable/target_item_add&quot;&gt;</div><div class="line">            &lt;/RelativeLayout&gt;</div><div class="line">        &lt;/RelativeLayout&gt;</div><div class="line"></div><div class="line">        &lt;RelativeLayout</div><div class="line">            android:layout_width=&quot;110dp&quot;</div><div class="line">            android:layout_height=&quot;110dp&quot;</div><div class="line">            android:padding=&quot;10dp&quot;</div><div class="line">            android:layout_alignParentRight=&quot;true&quot;&gt;</div><div class="line">        &lt;/RelativeLayout&gt;</div><div class="line"></div><div class="line">    &lt;/LinearLayout&gt;</div><div class="line"></div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure></p>
<p>文件有一点长，并且很多都是重复的，所以我推荐使用这种方式，但是我第一次想到就是这种方式，所以试试看，因为使用列表的话，其他方面会很复杂，因为每个项其实是有些不同的。</p>
<h3 id="本地数据库"><a href="#本地数据库" class="headerlink" title="本地数据库"></a>本地数据库</h3><p>TargetItem表<br>name：每一项的名称，根据这个名称进行更新状态操作<br>valeu：数值<br>flag_selected：选中状态 0 和 1<br>index：索引，列表方式使用到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">package com.allever.bicycle.bean;</div><div class="line"></div><div class="line">import org.litepal.crud.DataSupport;</div><div class="line"></div><div class="line">/**</div><div class="line"> * Created by allever on 17-7-26.</div><div class="line"> */</div><div class="line"></div><div class="line">public class TargetItem extends DataSupport&#123;</div><div class="line">    private int id;</div><div class="line">    private String name;</div><div class="line">    private String value;</div><div class="line">    private int flag_selected;</div><div class="line">    private int index;</div><div class="line"></div><div class="line">    public int getId() &#123;</div><div class="line">        return id;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setId(int id) &#123;</div><div class="line">        this.id = id;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public String getName() &#123;</div><div class="line">        return name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setName(String name) &#123;</div><div class="line">        this.name = name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public String getValue() &#123;</div><div class="line">        return value;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setValue(String value) &#123;</div><div class="line">        this.value = value;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public int getFlag_selected() &#123;</div><div class="line">        return flag_selected;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setFlag_selected(int flag_selected) &#123;</div><div class="line">        this.flag_selected = flag_selected;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public int getIndex() &#123;</div><div class="line">        return index;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setIndex(int index) &#123;</div><div class="line">        this.index = index;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="交互逻辑"><a href="#交互逻辑" class="headerlink" title="交互逻辑"></a>交互逻辑</h3><p>首次启动创建数据库表和初始化数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">final List&lt;TargetItem&gt; targetItems = DataSupport.findAll(TargetItem.class);</div><div class="line">if (targetItems.size()==0)&#123;</div><div class="line">	initData();</div><div class="line">	//Toast.makeText(this,&quot;initData&quot;,Toast.LENGTH_LONG).show();</div><div class="line">&#125;</div><div class="line">showData();</div></pre></td></tr></table></figure></p>
<p>initData()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 初始化数据</div><div class="line"> * */</div><div class="line">private void initData()&#123;</div><div class="line">    DataSupport.deleteAll(TargetItem.class);</div><div class="line"></div><div class="line">    TargetItem targetSpeed = new TargetItem();</div><div class="line">    targetSpeed.setName(&quot;speed&quot;);</div><div class="line">    targetSpeed.setValue(&quot;6&quot;);</div><div class="line">    targetSpeed.setFlag_selected(1);</div><div class="line">    targetSpeed.save();</div><div class="line"></div><div class="line">    TargetItem targetDistance = new TargetItem();</div><div class="line">    targetDistance.setName(&quot;distance&quot;);</div><div class="line">    targetDistance.setValue(&quot;0.7&quot;);</div><div class="line">    targetDistance.setFlag_selected(0);</div><div class="line">    targetDistance.save();</div><div class="line"></div><div class="line">    TargetItem targetPower = new TargetItem();</div><div class="line">    targetPower.setName(&quot;power&quot;);</div><div class="line">    targetPower.setValue(&quot;74&quot;);</div><div class="line">    targetPower.setFlag_selected(0);</div><div class="line">    targetPower.save();</div><div class="line"></div><div class="line"></div><div class="line">    TargetItem targetSlopeDegree = new TargetItem();</div><div class="line">    targetSlopeDegree.setName(&quot;slope_degree&quot;);</div><div class="line">    targetSlopeDegree.setValue(&quot;5&quot;);</div><div class="line">    targetSlopeDegree.setFlag_selected(0);</div><div class="line">    targetSlopeDegree.save();</div><div class="line"></div><div class="line"></div><div class="line">    TargetItem targetPatchSpeed = new TargetItem();</div><div class="line">    targetPatchSpeed.setName(&quot;patch_speed&quot;);</div><div class="line">    targetPatchSpeed.setValue(&quot;00:29&quot;);</div><div class="line">    targetPatchSpeed.setFlag_selected(0);</div><div class="line">    targetPatchSpeed.save();</div><div class="line"></div><div class="line"></div><div class="line">    TargetItem targetCalorie = new TargetItem();</div><div class="line">    targetCalorie.setName(&quot;calorie&quot;);</div><div class="line">    targetCalorie.setValue(&quot;119&quot;);</div><div class="line">    targetCalorie.setFlag_selected(0);</div><div class="line">    targetCalorie.save();</div><div class="line"></div><div class="line">    TargetItem targetTime = new TargetItem();</div><div class="line">    targetTime.setName(&quot;time&quot;);</div><div class="line">    targetTime.setValue(&quot;02:30&quot;);</div><div class="line">    targetTime.setFlag_selected(0);</div><div class="line">    targetTime.save();</div><div class="line"></div><div class="line">    TargetItem targetBmp = new TargetItem();</div><div class="line">    targetBmp.setName(&quot;bmp&quot;);</div><div class="line">    targetBmp.setValue(&quot;74&quot;);</div><div class="line">    targetBmp.setFlag_selected(0);</div><div class="line">    targetBmp.save();</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>showData()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">private void showData()&#123;</div><div class="line">    TargetItem targetSpeed = DataSupport.where(&quot;name=?&quot;, &quot;speed&quot;).find(TargetItem.class).get(0);</div><div class="line">    tv_speed.setText(targetSpeed.getValue());</div><div class="line">    refreshTargetItem(&quot;speed&quot;,false);</div><div class="line"></div><div class="line">    TargetItem targetDistance = DataSupport.where(&quot;name=?&quot;, &quot;distance&quot;).find(TargetItem.class).get(0);</div><div class="line">    tv_distance.setText(targetDistance.getValue());</div><div class="line">    refreshTargetItem(&quot;distance&quot;,false);</div><div class="line"></div><div class="line">    TargetItem targetPower = DataSupport.where(&quot;name=?&quot;, &quot;power&quot;).find(TargetItem.class).get(0);</div><div class="line">    tv_power.setText(targetPower.getValue());</div><div class="line">    refreshTargetItem(&quot;power&quot;,false);</div><div class="line"></div><div class="line">    TargetItem targetSlopeDegree = DataSupport.where(&quot;name=?&quot;, &quot;slope_degree&quot;).find(TargetItem.class).get(0);</div><div class="line">    tv_slope_degree.setText(targetSlopeDegree.getValue());</div><div class="line">    refreshTargetItem(&quot;slope_degree&quot;,false);</div><div class="line"></div><div class="line">    TargetItem targetPatchSpeed = DataSupport.where(&quot;name=?&quot;, &quot;patch_speed&quot;).find(TargetItem.class).get(0);</div><div class="line">    tv_patch_speed.setText(targetPatchSpeed.getValue());</div><div class="line">    refreshTargetItem(&quot;patch_speed&quot;,false);</div><div class="line"></div><div class="line">    TargetItem targetCalorie = DataSupport.where(&quot;name=?&quot;, &quot;calorie&quot;).find(TargetItem.class).get(0);</div><div class="line">    tv_calorie.setText(targetCalorie.getValue());</div><div class="line">    refreshTargetItem(&quot;calorie&quot;,false);</div><div class="line"></div><div class="line"></div><div class="line">    TargetItem targetTime = DataSupport.where(&quot;name=?&quot;, &quot;time&quot;).find(TargetItem.class).get(0);</div><div class="line">    tv_time.setText(targetTime.getValue());</div><div class="line">    refreshTargetItem(&quot;time&quot;,false);</div><div class="line"></div><div class="line">    TargetItem targetBmp = DataSupport.where(&quot;name=?&quot;, &quot;bmp&quot;).find(TargetItem.class).get(0);</div><div class="line">    tv_bmp.setText(targetBmp.getValue());</div><div class="line">    refreshTargetItem(&quot;bmp&quot;,false);</div><div class="line"></div><div class="line">    List&lt;TargetItem&gt; targetItems = DataSupport.where(&quot;flag_selected=?&quot;, &quot;1&quot;).find(TargetItem.class);</div><div class="line">    if (targetItems.size()==1)&#123;</div><div class="line">        refreshTargetItem(targetItems.get(0).getName(),true);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>默认状态选中是，蓝色背景+减号组成，<br>未选中是白色边框背景+加号组成，考虑到只用一种选中状态时，把减号去掉<br>因此，要判断选中状态的个数，如果是一个，则刷新这个显示方式。即<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">List&lt;TargetItem&gt; targetItems = DataSupport.where(&quot;flag_selected=?&quot;, &quot;1&quot;).find(TargetItem.class);</div><div class="line">if (targetItems.size()==1)&#123;</div><div class="line">	refreshTargetItem(targetItems.get(0).getName(),true);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>刷新界面：refreshTargetItem(String name, boolean isOneSelected)<br>isOneSelected：只有一种选中状态标记</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line">private void refreshTargetItem(String name, boolean isOneSelected)&#123;</div><div class="line">    TargetItem target = DataSupport.where(&quot;name=?&quot;, name).find(TargetItem.class).get(0);</div><div class="line">    switch (name)&#123;</div><div class="line">        case &quot;speed&quot;:</div><div class="line">            if (target.getFlag_selected()==1)&#123;</div><div class="line">                rl_container_speed.setBackgroundResource(R.drawable.target_item_one_selected);</div><div class="line">                rl_speed_option.setBackgroundResource(R.drawable.target_item_delete);</div><div class="line">                if (isOneSelected) rl_speed_option.setVisibility(View.INVISIBLE);</div><div class="line">                else rl_speed_option.setVisibility(View.VISIBLE);</div><div class="line">            &#125;else &#123;</div><div class="line">                rl_container_speed.setBackgroundResource(R.drawable.target_item_none_selected_framework);</div><div class="line">                rl_speed_option.setBackgroundResource(R.drawable.target_item_add);</div><div class="line">            &#125;</div><div class="line">            break;</div><div class="line"></div><div class="line">        case &quot;distance&quot;:</div><div class="line">            if (target.getFlag_selected()==1)&#123;</div><div class="line">                rl_container_distance.setBackgroundResource(R.drawable.target_item_one_selected);</div><div class="line">                rl_distance_option.setBackgroundResource(R.drawable.target_item_delete);</div><div class="line">                if (isOneSelected) rl_distance_option.setVisibility(View.INVISIBLE);</div><div class="line">                else rl_distance_option.setVisibility(View.VISIBLE);</div><div class="line">            &#125;else &#123;</div><div class="line">                rl_container_distance.setBackgroundResource(R.drawable.target_item_none_selected_framework);</div><div class="line">                rl_distance_option.setBackgroundResource(R.drawable.target_item_add);</div><div class="line">            &#125;</div><div class="line">            break;</div><div class="line">        case &quot;power&quot;:</div><div class="line">            if (target.getFlag_selected()==1)&#123;</div><div class="line">                rl_container_power.setBackgroundResource(R.drawable.target_item_one_selected);</div><div class="line">                rl_power_option.setBackgroundResource(R.drawable.target_item_delete);</div><div class="line">                if (isOneSelected) rl_power_option.setVisibility(View.INVISIBLE);</div><div class="line">                else rl_power_option.setVisibility(View.VISIBLE);</div><div class="line">            &#125;else &#123;</div><div class="line">                rl_container_power.setBackgroundResource(R.drawable.target_item_none_selected_framework);</div><div class="line">                rl_power_option.setBackgroundResource(R.drawable.target_item_add);</div><div class="line">            &#125;</div><div class="line">            break;</div><div class="line"></div><div class="line">        case &quot;slope_degree&quot;:</div><div class="line">            if (target.getFlag_selected()==1)&#123;</div><div class="line">                rl_container_slope_degree.setBackgroundResource(R.drawable.target_item_one_selected);</div><div class="line">                rl_slope_degree_option.setBackgroundResource(R.drawable.target_item_delete);</div><div class="line">                if (isOneSelected) rl_slope_degree_option.setVisibility(View.INVISIBLE);</div><div class="line">                else rl_slope_degree_option.setVisibility(View.VISIBLE);</div><div class="line">            &#125;else &#123;</div><div class="line">                rl_container_slope_degree.setBackgroundResource(R.drawable.target_item_none_selected_framework);</div><div class="line">                rl_slope_degree_option.setBackgroundResource(R.drawable.target_item_add);</div><div class="line">            &#125;</div><div class="line">            break;</div><div class="line"></div><div class="line">        case &quot;patch_speed&quot;:</div><div class="line">            if (target.getFlag_selected()==1)&#123;</div><div class="line">                rl_container_patch_speed.setBackgroundResource(R.drawable.target_item_one_selected);</div><div class="line">                rl_patch_speed_option.setBackgroundResource(R.drawable.target_item_delete);</div><div class="line">                if (isOneSelected) rl_patch_speed_option.setVisibility(View.INVISIBLE);</div><div class="line">                else rl_patch_speed_option.setVisibility(View.VISIBLE);</div><div class="line">            &#125;else &#123;</div><div class="line">                rl_container_patch_speed.setBackgroundResource(R.drawable.target_item_none_selected_framework);</div><div class="line">                rl_patch_speed_option.setBackgroundResource(R.drawable.target_item_add);</div><div class="line">            &#125;</div><div class="line">            break;</div><div class="line"></div><div class="line">        case &quot;calorie&quot;:</div><div class="line">            if (target.getFlag_selected()==1)&#123;</div><div class="line">                rl_container_calorie.setBackgroundResource(R.drawable.target_item_one_selected);</div><div class="line">                rl_calorie_option.setBackgroundResource(R.drawable.target_item_delete);</div><div class="line">                if (isOneSelected) rl_calorie_option.setVisibility(View.INVISIBLE);</div><div class="line">                else rl_calorie_option.setVisibility(View.VISIBLE);</div><div class="line">            &#125;else &#123;</div><div class="line">                rl_container_calorie.setBackgroundResource(R.drawable.target_item_none_selected_framework);</div><div class="line">                rl_calorie_option.setBackgroundResource(R.drawable.target_item_add);</div><div class="line">            &#125;</div><div class="line">            break;</div><div class="line">        case &quot;time&quot;:</div><div class="line">            if (target.getFlag_selected()==1)&#123;</div><div class="line">                rl_container_time.setBackgroundResource(R.drawable.target_item_one_selected);</div><div class="line">                rl_time_option.setBackgroundResource(R.drawable.target_item_delete);</div><div class="line">                if (isOneSelected) rl_time_option.setVisibility(View.INVISIBLE);</div><div class="line">                else rl_time_option.setVisibility(View.VISIBLE);</div><div class="line">            &#125;else &#123;</div><div class="line">                rl_container_time.setBackgroundResource(R.drawable.target_item_none_selected_framework);</div><div class="line">                rl_time_option.setBackgroundResource(R.drawable.target_item_add);</div><div class="line">            &#125;</div><div class="line">            break;</div><div class="line">        case &quot;bmp&quot;:</div><div class="line">            if (target.getFlag_selected()==1)&#123;</div><div class="line">                rl_container_bmp.setBackgroundResource(R.drawable.target_item_one_selected);</div><div class="line">                rl_bmp_option.setBackgroundResource(R.drawable.target_item_delete);</div><div class="line">                if (isOneSelected) rl_bmp_option.setVisibility(View.INVISIBLE);</div><div class="line">                else rl_bmp_option.setVisibility(View.VISIBLE);</div><div class="line">            &#125;else &#123;</div><div class="line">                rl_container_bmp.setBackgroundResource(R.drawable.target_item_none_selected_framework);</div><div class="line">                rl_bmp_option.setBackgroundResource(R.drawable.target_item_add);</div><div class="line">            &#125;</div><div class="line">            break;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>监听各个布局<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void onClick(View v) &#123;</div><div class="line">    int id  = v.getId();</div><div class="line">    switch (id)&#123;</div><div class="line">        case R.id.id_target_item_container_speed:</div><div class="line">            updateFlag(&quot;speed&quot;);</div><div class="line">            break;</div><div class="line">        case R.id.id_target_item_container_distance:</div><div class="line">            updateFlag(&quot;distance&quot;);</div><div class="line">            break;</div><div class="line">        case R.id.id_target_item_container_power:</div><div class="line">            updateFlag(&quot;power&quot;);</div><div class="line">            break;</div><div class="line">        case R.id.id_target_item_container_slope_degree:</div><div class="line">            updateFlag(&quot;slope_degree&quot;);</div><div class="line">            break;</div><div class="line">        case R.id.id_target_item_container_patch_speed:</div><div class="line">            updateFlag(&quot;patch_speed&quot;);</div><div class="line">            break;</div><div class="line">        case R.id.id_target_item_container_calorie:</div><div class="line">            updateFlag(&quot;calorie&quot;);</div><div class="line">            break;</div><div class="line">        case R.id.id_target_item_container_time:</div><div class="line">            updateFlag(&quot;time&quot;);</div><div class="line">            break;</div><div class="line">        case R.id.id_target_item_container_bmp:</div><div class="line">            updateFlag(&quot;bmp&quot;);</div><div class="line">            break;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>更新标记<br>首先根据name找到数据库中记录的状态值，如果是1，进行删除操作，如果是0进行添加操作，简单地说就是把标记改为相反。<br>删除操作：<br>首先，查找数据库中选中状态的数量，如果查找到的记录数小于2(即只有一个选中)则不允许删除操作，否则进行删除操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">target.setFlag_selected(0);</div><div class="line">target.save();</div></pre></td></tr></table></figure></p>
<p>删除之后还要判断，当前选中状态为1的记录数，如果记录数为1，则把刷新该记录的界面<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">targetItems = DataSupport.where(&quot;flag_selected=?&quot;,&quot;1&quot;).find(TargetItem.class);</div><div class="line">if (targetItems.size() == 1)&#123;</div><div class="line">	refreshTargetItem(targetItems.get(0).getName(),true);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>添加操作：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">target.setFlag_selected(1);</div><div class="line">target.save();</div></pre></td></tr></table></figure></p>
<p>添加之后，还是判断当前选中状态为1的记录数，如果记录数为2，就刷新该记录的界面，因为原来只有一个选中时，减号是不显示的，要把原来的减号显示出来。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">targetItems = DataSupport.where(&quot;flag_selected=?&quot;,&quot;1&quot;).find(TargetItem.class);</div><div class="line">if (targetItems.size() == 2)&#123;</div><div class="line">	refreshTargetItem(targetItems.get(0).getName(),false);</div><div class="line">	refreshTargetItem(targetItems.get(1).getName(),false);</div><div class="line">&#125;else &#123;</div><div class="line">	refreshTargetItem(name,false);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>updateFlag()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">private void updateFlag(String name)&#123;</div><div class="line">    TargetItem target = DataSupport.where(&quot;name=?&quot;, name).find(TargetItem.class).get(0);</div><div class="line">    List&lt;TargetItem&gt; targetItems;</div><div class="line">    if (target.getFlag_selected()==1)&#123;</div><div class="line">        //删除操作</div><div class="line">        targetItems = DataSupport.where(&quot;flag_selected=?&quot;,&quot;1&quot;).find(TargetItem.class);</div><div class="line">        Log.d(TAG, &quot;selected count = &quot; + targetItems.size());</div><div class="line">        if (targetItems.size() &lt; 2)&#123;</div><div class="line">            //即只有一个选中,不允许操作</div><div class="line">            //Toast.makeText(this,&quot;不允许删除&quot;,Toast.LENGTH_LONG).show();</div><div class="line">        &#125;else &#123;</div><div class="line">            //进行删除操作</div><div class="line">            //Toast.makeText(this,&quot;许删除&quot;,Toast.LENGTH_LONG).show();</div><div class="line">            target.setFlag_selected(0);</div><div class="line">            target.save();</div><div class="line">            //刷新界面</div><div class="line">            refreshTargetItem(name,false);</div><div class="line">            //</div><div class="line">            targetItems = DataSupport.where(&quot;flag_selected=?&quot;,&quot;1&quot;).find(TargetItem.class);</div><div class="line">            if (targetItems.size() == 1)&#123;</div><div class="line">                refreshTargetItem(targetItems.get(0).getName(),true);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;else &#123;</div><div class="line">        //添加操作</div><div class="line">        //Toast.makeText(this,&quot;添加&quot;,Toast.LENGTH_LONG).show();</div><div class="line">        target.setFlag_selected(1);</div><div class="line">        target.save();</div><div class="line">        //刷新界面</div><div class="line">        targetItems = DataSupport.where(&quot;flag_selected=?&quot;,&quot;1&quot;).find(TargetItem.class);</div><div class="line">        if (targetItems.size() == 2)&#123;</div><div class="line">            refreshTargetItem(targetItems.get(0).getName(),false);</div><div class="line">            refreshTargetItem(targetItems.get(1).getName(),false);</div><div class="line">        &#125;else &#123;</div><div class="line">            refreshTargetItem(name,false);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="RecyclerView实现方式"><a href="#RecyclerView实现方式" class="headerlink" title="RecyclerView实现方式"></a>RecyclerView实现方式</h2><h3 id="列表项布局"><a href="#列表项布局" class="headerlink" title="列表项布局"></a>列表项布局</h3><p>跟上面布局中差不多，这里就只重复的那部分<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:layout_width=&quot;110dp&quot;</div><div class="line">    android:layout_height=&quot;110dp&quot;</div><div class="line">    android:padding=&quot;10dp&quot;&gt;</div><div class="line"></div><div class="line">    &lt;RelativeLayout</div><div class="line">        android:id=&quot;@+id/id_target_recycler_item_container&quot;</div><div class="line">        android:layout_width=&quot;80dp&quot;</div><div class="line">        android:layout_height=&quot;80dp&quot;</div><div class="line">        android:layout_centerInParent=&quot;true&quot;</div><div class="line">        android:background=&quot;@drawable/target_item_none_selected_framework&quot;&gt;</div><div class="line"></div><div class="line">        &lt;TextView</div><div class="line">            android:id=&quot;@+id/id_target_recycler_item_tv_name&quot;</div><div class="line">            android:layout_width=&quot;wrap_content&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:text=&quot;距离&quot;</div><div class="line">            android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">            android:textColor=&quot;@color/white&quot;</div><div class="line">            android:layout_marginTop=&quot;10dp&quot;/&gt;</div><div class="line">        &lt;TextView</div><div class="line">            android:id=&quot;@+id/id_target_recycler_item_tv_value&quot;</div><div class="line">            android:layout_width=&quot;wrap_content&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:text=&quot;0.7&quot;</div><div class="line">            android:textSize=&quot;25sp&quot;</div><div class="line">            android:textColor=&quot;@color/white&quot;</div><div class="line">            android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">            android:layout_alignParentBottom=&quot;true&quot;</div><div class="line">            android:layout_marginBottom=&quot;10dp&quot;/&gt;</div><div class="line"></div><div class="line">        &lt;TextView</div><div class="line">            android:id=&quot;@+id/id_target_recycler_item_tv_unit&quot;</div><div class="line">            android:layout_width=&quot;wrap_content&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:text=&quot;km&quot;</div><div class="line">            android:textColor=&quot;@color/white&quot;</div><div class="line">            android:layout_alignParentBottom=&quot;true&quot;</div><div class="line">            android:layout_marginBottom=&quot;15dp&quot;</div><div class="line">            android:layout_marginLeft=&quot;2dp&quot;</div><div class="line">            android:layout_toRightOf=&quot;@id/id_target_recycler_item_tv_value&quot; /&gt;</div><div class="line"></div><div class="line">    &lt;/RelativeLayout&gt;</div><div class="line">    &lt;RelativeLayout</div><div class="line">        android:id=&quot;@+id/id_target_recycler_item_rl_option&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:layout_alignParentRight=&quot;true&quot;</div><div class="line">        android:layout_alignParentBottom=&quot;true&quot;</div><div class="line">        android:background=&quot;@drawable/target_item_add&quot;&gt;</div><div class="line">    &lt;/RelativeLayout&gt;</div><div class="line"></div><div class="line">&lt;/RelativeLayout&gt;</div></pre></td></tr></table></figure></p>
<h3 id="Adapter"><a href="#Adapter" class="headerlink" title="Adapter"></a>Adapter</h3><p>重点就是Adapter实现啦，其实也很简单，根据选中标记选择显示方式<br>初始显示之后判断选中状态为1的数量，如果只有一个选中，就把减号隐藏，这里设置了蓝色背景，可能是没设置大小的原因，看不出而已，正常因该是隐藏布局。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void onBindViewHolder(TargetItemViewHolder holder, int position) &#123;</div><div class="line">    TargetItem targetItem = targetItems.get(position);</div><div class="line">    holder.tv_value.setText(targetItem.getValue());</div><div class="line">    if (targetItem.getFlag_selected()==1)&#123;</div><div class="line">        holder.rl_container.setBackgroundResource(R.drawable.target_item_one_selected);</div><div class="line">        holder.rl_option.setBackgroundResource(R.drawable.target_item_delete);</div><div class="line">    &#125;else &#123;</div><div class="line">        holder.rl_container.setBackgroundResource(R.drawable.target_item_none_selected_framework);</div><div class="line">        holder.rl_option.setBackgroundResource(R.drawable.target_item_add);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    List&lt;TargetItem&gt; list = DataSupport.where(&quot;flag_selected=?&quot;,&quot;1&quot;).find(TargetItem.class);</div><div class="line"></div><div class="line">    if (list.size() == 1)&#123;</div><div class="line">        if (position == list.get(0).getIndex())&#123;</div><div class="line">            holder.rl_option.setBackgroundResource(R.drawable.target_item_one_selected);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    switch (position)&#123;</div><div class="line">        case 0:</div><div class="line">            holder.tv_name.setText(&quot;速度&quot;);</div><div class="line">            holder.tv_unit.setText(&quot;&quot;);</div><div class="line">            break;</div><div class="line"></div><div class="line">        case 1:</div><div class="line">            holder.tv_name.setText(&quot;距离&quot;);</div><div class="line">            holder.tv_unit.setText(&quot;km&quot;);</div><div class="line">            break;</div><div class="line"></div><div class="line">        case 2:</div><div class="line">            holder.tv_name.setText(&quot;功率&quot;);</div><div class="line">            holder.tv_unit.setText(&quot;w&quot;);</div><div class="line">            break;</div><div class="line"></div><div class="line">        case 3:</div><div class="line">            holder.tv_name.setText(&quot;坡度&quot;);</div><div class="line">            holder.tv_unit.setText(&quot;&quot;);</div><div class="line">            break;</div><div class="line"></div><div class="line">        case 4:</div><div class="line">            holder.tv_name.setText(&quot;配速&quot;);</div><div class="line">            holder.tv_unit.setText(&quot;&quot;);</div><div class="line">            break;</div><div class="line"></div><div class="line">        case 5:</div><div class="line">            holder.tv_name.setText(&quot;卡路里&quot;);</div><div class="line">            holder.tv_unit.setText(&quot;kcal&quot;);</div><div class="line">            break;</div><div class="line"></div><div class="line">        case 6:</div><div class="line">            holder.tv_name.setText(&quot;时间&quot;);</div><div class="line">            holder.tv_unit.setText(&quot;&quot;);</div><div class="line">            break;</div><div class="line"></div><div class="line">        case 7:</div><div class="line">            holder.tv_name.setText(&quot;心率&quot;);</div><div class="line">            holder.tv_unit.setText(&quot;bmp&quot;);</div><div class="line">            break;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="事件监听"><a href="#事件监听" class="headerlink" title="事件监听"></a>事件监听</h3><p>RecyclerItemClickListener<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line">package com.allever.bicycle.listener;</div><div class="line"></div><div class="line">import android.content.Context;</div><div class="line">import android.support.v7.widget.RecyclerView;</div><div class="line">import android.view.GestureDetector;</div><div class="line">import android.view.MotionEvent;</div><div class="line">import android.view.View;</div><div class="line"></div><div class="line"></div><div class="line">/**</div><div class="line"> * Created by Allever on 2016/11/5.</div><div class="line"> */</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">public class RecyclerItemClickListener implements RecyclerView.OnItemTouchListener &#123;</div><div class="line"></div><div class="line"></div><div class="line">    private OnItemClickListener mListener;</div><div class="line"></div><div class="line">    private GestureDetector mGestureDetector;</div><div class="line"></div><div class="line">    public RecyclerItemClickListener(Context context, final RecyclerView recyclerView, OnItemClickListener listener) &#123;</div><div class="line">        mListener = listener;</div><div class="line"></div><div class="line">        mGestureDetector = new GestureDetector(context, new GestureDetector.SimpleOnGestureListener() &#123;</div><div class="line">            @Override</div><div class="line">            public boolean onSingleTapUp(MotionEvent e) &#123;</div><div class="line">                return true;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            @Override</div><div class="line">            public void onLongPress(MotionEvent e) &#123;</div><div class="line">                View childView = recyclerView.findChildViewUnder(e.getX(), e.getY());</div><div class="line"></div><div class="line">                if (childView != null &amp;&amp; mListener != null) &#123;</div><div class="line">                    mListener.onItemLongClick(childView, recyclerView.getChildAdapterPosition(childView));</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public boolean onInterceptTouchEvent(RecyclerView view, MotionEvent e) &#123;</div><div class="line">        View childView = view.findChildViewUnder(e.getX(), e.getY());</div><div class="line">        if (childView != null &amp;&amp; mListener != null &amp;&amp; mGestureDetector.onTouchEvent(e)) &#123;</div><div class="line">            mListener.onItemClick(childView, view.getChildAdapterPosition(childView));</div><div class="line">        &#125;</div><div class="line">        return false;</div><div class="line">    &#125;</div><div class="line">    @Override</div><div class="line">    public void onTouchEvent(RecyclerView view, MotionEvent motionEvent) &#123;</div><div class="line">    &#125;</div><div class="line">    @Override</div><div class="line">    public void onRequestDisallowInterceptTouchEvent(boolean disallowIntercept) &#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public interface OnItemClickListener &#123;</div><div class="line">        void onItemClick(View view, int position);</div><div class="line">        void onItemLongClick(View view, int position);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>RecyclerView设置监听<br>具体逻辑跟上面大同小异，注意这里是更新了数据库数据已更新了列表数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">recyclerView.addOnItemTouchListener(new RecyclerItemClickListener(this, recyclerView, new RecyclerItemClickListener.OnItemClickListener() &#123;</div><div class="line">    @Override</div><div class="line">    public void onItemClick(View view, int position) &#123;</div><div class="line">        //根据flag判断进行移除还是添加操作</div><div class="line">        TargetItem target = targetItems.get(position);</div><div class="line">        if (target.getFlag_selected()==1)&#123;</div><div class="line">            //移除操作</div><div class="line">            List&lt;TargetItem&gt; list = DataSupport.where(&quot;flag_selected=?&quot;,&quot;1&quot;).find(TargetItem.class);</div><div class="line">            if (list.size() &lt; 2)&#123;</div><div class="line">                //即只有一个选中,不允许操作</div><div class="line">                Toast.makeText(TargetItemListActivity.this,&quot;不允许删除&quot;,Toast.LENGTH_LONG).show();</div><div class="line">            &#125;else &#123;</div><div class="line">                //进行移除操作</div><div class="line">                //Toast.makeText(this,&quot;许删除&quot;,Toast.LENGTH_LONG).show();</div><div class="line">                target.setFlag_selected(0);</div><div class="line">                targetItems.set(position,target);</div><div class="line">                target.save();</div><div class="line">                targetItemAdapter.notifyDataSetChanged();</div><div class="line">            &#125;</div><div class="line">        &#125;else &#123;</div><div class="line">            //添加操作</div><div class="line">            target.setFlag_selected(1);</div><div class="line">            targetItems.set(position,target);</div><div class="line">            target.save();</div><div class="line">            //刷新界面</div><div class="line">            targetItemAdapter.notifyDataSetChanged();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onItemLongClick(View view, int position) &#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;));</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;功能概述：&quot;&gt;&lt;a href=&quot;#功能概述：&quot; class=&quot;headerlink&quot; title=&quot;功能概述：&quot;&gt;&lt;/a&gt;功能概述：&lt;/h1&gt;&lt;p&gt;选中状态：选中时候变为蓝色，并有个减号，里面也是蓝色，&lt;br&gt;未选中状态：未选中时候为空白，并有个加号，&lt;br&gt;点中
    
    </summary>
    
      <category term="Android" scheme="https://devallever.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://devallever.github.io/tags/Android/"/>
    
      <category term="选择器" scheme="https://devallever.github.io/tags/%E9%80%89%E6%8B%A9%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>NoteBook-1</title>
    <link href="https://devallever.github.io/2017/07/15/notebook-1/"/>
    <id>https://devallever.github.io/2017/07/15/notebook-1/</id>
    <published>2017-07-15T07:22:53.000Z</published>
    <updated>2017-07-15T07:39:43.993Z</updated>
    
    <content type="html"><![CDATA[<h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><ul>
<li><a href="https://devallever.github.io/2016/07/14/101-choose-network-framework/">101.Android 选择适当的网络请求框架</a></li>
<li><a href="https://devallever.github.io/2016/07/14/102-mvc-in-android/">102.MVC在Android中的应用</a></li>
<li><a href="https://devallever.github.io/2016/07/15/104-self-study-in-android-to-find-job/">104.自学到什么程度才能找到工作</a></li>
<li><a href="https://devallever.github.io/2016/07/15/105-recyclerview-basic-using/">105.RecyclerView简单使用</a></li>
<li><a href="https://devallever.github.io/2016/07/15/107-viewpager-basic-using/">107.ViewPager 简单使用</a></li>
<li><a href="https://devallever.github.io/2016/07/15/108-listview-basic-using/">108.ListView 简单使用</a></li>
<li><a href="https://devallever.github.io/2016/07/15/111-toolbar-basic-using/">111. Toolbar 简单使用</a></li>
<li><a href="https://devallever.github.io/2016/07/15/112-property-animation-basic-using/">112.属性动画基本使用</a></li>
<li><a href="https://devallever.github.io/2016/07/15/123-retrofit-2-basic-using/">123.Retrofit 基本使用</a></li>
<li><a href="https://devallever.github.io/2016/07/15/133-first-code-android-chapter-1-note/">133. 第一行代码 第一章 Android架构 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/135-first-code-android-chapter-2-note-activity/">135. 第一行代码 第二章 Activity 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/140-first-code-android-chapter-3-note-ui/">140. 第一行代码 第三章 UI 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/141-first-code-android-chapter-4-note-fragment/">141. 第一行代码 第四章 Fragment 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/143-first-code-android-chapter-5-note-broadcast-receiver/">143. 第一行代码 第五章 Broadcast Receiver 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/145-java-basic/">145. Java 基础</a></li>
<li><a href="https://devallever.github.io/2016/07/15/147-java-basic-common-class/">147. Java常用类</a></li>
<li><a href="https://devallever.github.io/2016/07/15/150-first-code-android-chapter-6-note-file/">150. 第一行代码 第六章 持久化 File 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/151-first-code-android-chapter-6-note-share-preferences/">151. 第一行代码 第六章 持久化 SharePreferences 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/152-java-oop-concept/">152. 面向对象基本概念</a></li>
<li><a href="https://devallever.github.io/2016/07/15/155-java-inner-class/">155. Java 内部类</a></li>
<li><a href="https://devallever.github.io/2016/07/15/157-first-code-android-chapter-6-note-sqlite/">157. 第一行代码 第六章 持久化 Sqlite 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/159-java-list-set-map/">159. List Set Map</a></li>
<li><a href="https://devallever.github.io/2016/07/15/161-first-code-android-chapter-6-note-litepal/">161. 第一行代码 第六章 持久化 LitePal 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/163-first-code-android-chapter-8-note-notification/">163. 第一行代码 第八章 多媒体 Notification 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/165-first-code-android-chapter-8-note-camera/">165-first-code-android-chapter-8-note-camera 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/167-first-code-android-chapter-8-note-choose-pic/">167. 第一行代码 第八章 多媒体 选择图片 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/170-java-exception/">170. Java 异常</a></li>
<li><a href="https://devallever.github.io/2016/07/15/173-first-code-android-chapter-8-note-media/">173. 第一行代码 第八章 多媒体 音频视频 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/174-java-thread/">174. Java 多线程</a></li>
<li><a href="https://devallever.github.io/2016/07/15/176-java-async/">176. Java 同步</a></li>
<li><a href="https://devallever.github.io/2016/07/15/179-android-java-http-url-connection/">179. HttpUrlConnection</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;目录&quot;&gt;&lt;a href=&quot;#目录&quot; class=&quot;headerlink&quot; title=&quot;目录&quot;&gt;&lt;/a&gt;目录&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://devallever.github.io/2016/07/14/101-choose-netw
    
    </summary>
    
      <category term="NoteBook" scheme="https://devallever.github.io/categories/NoteBook/"/>
    
    
      <category term="NoteBook1" scheme="https://devallever.github.io/tags/NoteBook1/"/>
    
  </entry>
  
  <entry>
    <title>Java 线程池</title>
    <link href="https://devallever.github.io/2017/07/02/java-thread-pool-executor-basic/"/>
    <id>https://devallever.github.io/2017/07/02/java-thread-pool-executor-basic/</id>
    <published>2017-07-02T08:35:49.000Z</published>
    <updated>2017-07-02T09:42:58.460Z</updated>
    
    <content type="html"><![CDATA[<h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>当我们使用线程的时候就去创建一个线程，这样实现起来非常简便，但是就会有一个问题：<br>　　如果并发的线程数量很多，并且每个线程都是执行一个时间很短的任务就结束了，这样频繁创建线程就会大大降低系统的效率，因为频繁创建线程和销毁线程需要时间。<br>　　那么有没有一种办法使得线程可以复用，就是执行完一个任务，并不被销毁，而是可以继续执行其他的任务？<br>　　在Java中可以通过线程池来达到这样的效果。今天我们就来详细讲解一下Java的线程池。</p>
<h1 id="ThreadPoolEXecutor"><a href="#ThreadPoolEXecutor" class="headerlink" title="ThreadPoolEXecutor"></a>ThreadPoolEXecutor</h1><p>合理利用线程池能够带来三个好处。</p>
<ul>
<li>降低资源消耗。通过重复利用已创建的线程降低线程创建和销毁造成的消耗。</li>
<li>提高响应速度。当任务到达时，任务可以不需要等到线程创建就能立即执行。</li>
<li>提高线程的可管理性。</li>
</ul>
<p>线程是稀缺资源，如果无限制的创建，不仅会消耗系统资源，还会降低系统的稳定性，使用线程池可以进行统一的分配，调优和监控。但是要做到合理的利用线程池，必须对其原理了如指掌。</p>
<h1 id="构造方法详解"><a href="#构造方法详解" class="headerlink" title="构造方法详解"></a>构造方法详解</h1><p>构造方法有三个：<br>其一：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public ThreadPoolExecutor(</div><div class="line">	int corePoolSize,</div><div class="line">	int maximumPoolSize,</div><div class="line">	long keepAliveTime,</div><div class="line">	TimeUnit unit,</div><div class="line">	BlockingQueue&lt;Runnable&gt; workQueue) </div><div class="line">&#123;</div><div class="line">        this(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,</div><div class="line">             Executors.defaultThreadFactory(), defaultHandler);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其二：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public ThreadPoolExecutor(</div><div class="line">	int corePoolSize,</div><div class="line">	int maximumPoolSize,</div><div class="line">	long keepAliveTime,</div><div class="line">	TimeUnit unit,</div><div class="line">	BlockingQueue&lt;Runnable&gt; workQueue,</div><div class="line">	ThreadFactory threadFactory)</div><div class="line">&#123;</div><div class="line">        this(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,</div><div class="line">             threadFactory, defaultHandler);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其三：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public ThreadPoolExecutor(</div><div class="line">	int corePoolSize,</div><div class="line">	int maximumPoolSize,</div><div class="line">	long keepAliveTime,</div><div class="line">	TimeUnit unit,</div><div class="line">	BlockingQueue&lt;Runnable&gt; workQueue,</div><div class="line">	RejectedExecutionHandler handler) </div><div class="line">&#123;</div><div class="line">        this(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,</div><div class="line">             Executors.defaultThreadFactory(), handler);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>源码对各个参数介绍如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Creates a new &#123;@code ThreadPoolExecutor&#125; with the given initial</div><div class="line"> * parameters and default thread factory.</div><div class="line"> *</div><div class="line"> * @param corePoolSize the number of threads to keep in the pool, even</div><div class="line"> *        if they are idle, unless &#123;@code allowCoreThreadTimeOut&#125; is set</div><div class="line"> * @param maximumPoolSize the maximum number of threads to allow in the</div><div class="line"> *        pool</div><div class="line"> * @param keepAliveTime when the number of threads is greater than</div><div class="line"> *        the core, this is the maximum time that excess idle threads</div><div class="line"> *        will wait for new tasks before terminating.</div><div class="line"> * @param unit the time unit for the &#123;@code keepAliveTime&#125; argument</div><div class="line"> * @param workQueue the queue to use for holding tasks before they are</div><div class="line"> *        executed.  This queue will hold only the &#123;@code Runnable&#125;</div><div class="line"> *        tasks submitted by the &#123;@code execute&#125; method.</div><div class="line"> * @param handler the handler to use when execution is blocked</div><div class="line"> *        because the thread bounds and queue capacities are reached</div><div class="line"> * @throws IllegalArgumentException if one of the following holds:&lt;br&gt;</div><div class="line"> *         &#123;@code corePoolSize &lt; 0&#125;&lt;br&gt;</div><div class="line"> *         &#123;@code keepAliveTime &lt; 0&#125;&lt;br&gt;</div><div class="line"> *         &#123;@code maximumPoolSize &lt;= 0&#125;&lt;br&gt;</div><div class="line"> *         &#123;@code maximumPoolSize &lt; corePoolSize&#125;</div><div class="line"> * @throws NullPointerException if &#123;@code workQueue&#125;</div><div class="line"> *         or &#123;@code handler&#125; is null</div><div class="line"> */</div></pre></td></tr></table></figure></p>
<p>看不懂？没关系，下面一一解释</p>
<ul>
<li>corePoolSize：线程池的核心线程数<br>当提交一个任务到线程池时，线程池会创建一个线程来执行任务，即使其他空闲的基本线程能够执行新任务也会创建线程，等到需要执行的任务数大于线程池基本大小时就不再创建。如果调用了线程池的prestartAllCoreThreads方法，线程池会提前创建并启动所有基本线程。</li>
<li>maximumPoolSize：线程池所能容纳的最大线程数<br>如果队列满了，并且已创建的线程数小于最大线程数，则线程池会再创建新的线程执行任务。值得注意的是如果使用了无界的任务队列这个参数就没什么效果。</li>
<li>keepAliveTime：非核心线程闲置时的超时时长<br>线程池的工作线程空闲后，保持存活的时间。所以如果任务很多，并且每个任务执行的时间比较短，可以调大这个时间，提高线程的利用率。</li>
<li>unit：用于指定keepAliveTime参数的时间单位<br>可选的单位有天（DAYS），小时（HOURS），分钟（MINUTES），毫秒(TimeUnit.MILLISECONDS)，微秒(MICROSECONDS, 千分之一毫秒)和毫微秒(NANOSECONDS, 千分之一微秒)。常用的有分钟，秒，毫秒</li>
<li>workQueue：任务队列<br>用于保存等待执行的任务的阻塞队列。有一下几种<ul>
<li>ArrayBlockingQueue：<br>是一个基于数组结构的有界阻塞队列，此队列按 FIFO（先进先出）原则对元素进行排序。</li>
<li>LinkedBlockingQueue：<br>一个基于链表结构的阻塞队列，此队列按FIFO （先进先出） 排序元素，吞吐量通常要高于ArrayBlockingQueue。静态工厂方法Executors.newFixedThreadPool()使用了这个队列。</li>
<li>SynchronousQueue：<br>一个不存储元素的阻塞队列。每个插入操作必须等到另一个线程调用移除操作，否则插入操作一直处于阻塞状态，吞吐量通常要高于LinkedBlockingQueue，静态工厂方法Executors.newCachedThreadPool使用了这个队列。</li>
<li>PriorityBlockingQueue：一个具有优先级的无限阻塞队列。</li>
</ul>
</li>
<li>handler：饱和策略(不常用)<br>当队列和线程池都满了，说明线程池处于饱和状态，那么必须采取一种策略处理提交的新任务。这个策略默认情况下是AbortPolicy，表示无法处理新任务时抛出异常。以下是JDK1.5提供的四种策略。<ul>
<li>AbortPolicy：直接抛出异常。</li>
<li>CallerRunsPolicy：只用调用者所在线程来运行任务。</li>
<li>DiscardOldestPolicy：丢弃队列里最近的一个任务，并执行当前任务。</li>
<li>DiscardPolicy：不处理，丢弃掉。</li>
<li>当然也可以根据应用场景需要来实现RejectedExecutionHandler接口自定义策略。如记录日志或持久化不能处理的任务。</li>
</ul>
</li>
</ul>
<h1 id="四种常用的线程池"><a href="#四种常用的线程池" class="headerlink" title="四种常用的线程池"></a>四种常用的线程池</h1><h2 id="FixedThreadPool"><a href="#FixedThreadPool" class="headerlink" title="FixedThreadPool"></a>FixedThreadPool</h2><p>是一种线程数量固定的线程池，当线程处于空闲状态时，它们并不会回收，除非线程池关闭了。当所有线程都处于活动状态时，新任务都会处于等待状态，知道有线程空闲出来。由于FixedThreadPool只有核心线程并且这些核心线程都不会被回收，意味着它能够更加快速的响应外界的请求。没有超时机制，任务队列也没有大小限制。  </p>
<p>创建实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ExecutorService fixedThreadPoolExecutor = Executors.newFixedThreadPool(3);</div></pre></td></tr></table></figure></p>
<p>newFixedThreadPool()方法定义如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Creates a thread pool that reuses a fixed number of threads</div><div class="line"> * operating off a shared unbounded queue.  At any point, at most</div><div class="line"> * &#123;<span class="doctag">@code</span> nThreads&#125; threads will be active processing tasks.</div><div class="line"> * If additional tasks are submitted when all threads are active,</div><div class="line"> * they will wait in the queue until a thread is available.</div><div class="line"> * If any thread terminates due to a failure during execution</div><div class="line"> * prior to shutdown, a new one will take its place if needed to</div><div class="line"> * execute subsequent tasks.  The threads in the pool will exist</div><div class="line"> * until it is explicitly &#123;<span class="doctag">@link</span> ExecutorService#shutdown shutdown&#125;.</div><div class="line"> *</div><div class="line"> * <span class="doctag">@param</span> nThreads the number of threads in the pool</div><div class="line"> * <span class="doctag">@return</span> the newly created thread pool</div><div class="line"> * <span class="doctag">@throws</span> IllegalArgumentException if &#123;<span class="doctag">@code</span> nThreads &lt;= 0&#125;</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newFixedThreadPool</span><span class="params">(<span class="keyword">int</span> nThreads)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(nThreads, nThreads,</div><div class="line">                                  <span class="number">0L</span>, TimeUnit.MILLISECONDS,</div><div class="line">                                  <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>举个例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">private static void fixedThreadPoolTest()&#123;</div><div class="line">    ExecutorService fixedThreadPoolExecutor = Executors.newFixedThreadPool(3);</div><div class="line">    for (int i=0; i&lt;10; i++)&#123;</div><div class="line">        final int index = i;</div><div class="line">        System.out.println(System.currentTimeMillis() +</div><div class="line">                &quot;in main thread index = &quot; + index + &quot; &quot; +</div><div class="line">                &quot;Thread id = &quot; + Thread.currentThread().getId());</div><div class="line">        fixedThreadPoolExecutor.execute(new Runnable() &#123;</div><div class="line">            @Override</div><div class="line">            public void run() &#123;</div><div class="line">                System.out.println(System.currentTimeMillis() +</div><div class="line">                        &quot;in thread pool index = &quot; + index + &quot; &quot; +</div><div class="line">                        &quot;Thread id = &quot; + Thread.currentThread().getId());</div><div class="line">                try &#123;</div><div class="line">                    Thread.sleep(2000);</div><div class="line">                &#125;catch (InterruptedException itre)&#123;</div><div class="line">                    itre.printStackTrace();</div><div class="line">                &#125;</div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行结果<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="number">1498982458294</span>in main thread index = <span class="number">0</span> Thread id = <span class="number">1</span></div><div class="line"><span class="number">1498982458296</span>in main thread index = <span class="number">1</span> Thread id = <span class="number">1</span></div><div class="line"><span class="number">1498982458296</span>in thread pool index = <span class="number">0</span> Thread id = <span class="number">10</span></div><div class="line"><span class="number">1498982458296</span>in main thread index = <span class="number">2</span> Thread id = <span class="number">1</span></div><div class="line"><span class="number">1498982458302</span>in thread pool index = <span class="number">1</span> Thread id = <span class="number">11</span></div><div class="line"><span class="number">1498982458302</span>in main thread index = <span class="number">3</span> Thread id = <span class="number">1</span></div><div class="line"><span class="number">1498982458303</span>in main thread index = <span class="number">4</span> Thread id = <span class="number">1</span></div><div class="line"><span class="number">1498982458303</span>in main thread index = <span class="number">5</span> Thread id = <span class="number">1</span></div><div class="line"><span class="number">1498982458303</span>in main thread index = <span class="number">6</span> Thread id = <span class="number">1</span></div><div class="line"><span class="number">1498982458303</span>in main thread index = <span class="number">7</span> Thread id = <span class="number">1</span></div><div class="line"><span class="number">1498982458303</span>in main thread index = <span class="number">8</span> Thread id = <span class="number">1</span></div><div class="line"><span class="number">1498982458303</span>in main thread index = <span class="number">9</span> Thread id = <span class="number">1</span></div><div class="line"><span class="number">1498982458304</span>in thread pool index = <span class="number">2</span> Thread id = <span class="number">12</span></div><div class="line"><span class="comment">// 睡两秒</span></div><div class="line"><span class="number">1498982460296</span>in thread pool index = <span class="number">3</span> Thread id = <span class="number">10</span></div><div class="line"><span class="number">1498982460303</span>in thread pool index = <span class="number">4</span> Thread id = <span class="number">11</span></div><div class="line"><span class="number">1498982460304</span>in thread pool index = <span class="number">5</span> Thread id = <span class="number">12</span></div><div class="line"><span class="comment">// 睡两秒</span></div><div class="line"><span class="number">1498982462297</span>in thread pool index = <span class="number">6</span> Thread id = <span class="number">10</span></div><div class="line"><span class="number">1498982462303</span>in thread pool index = <span class="number">7</span> Thread id = <span class="number">11</span></div><div class="line"><span class="number">1498982462304</span>in thread pool index = <span class="number">8</span> Thread id = <span class="number">12</span></div><div class="line"><span class="comment">// 睡两秒</span></div><div class="line"><span class="number">1498982464297</span>in thread pool index = <span class="number">9</span> Thread id = <span class="number">10</span></div></pre></td></tr></table></figure></p>
<p>可以看到主线程很快就执行完了，它只负责创建了10个任务。然后交给线程池执行。<br>线程池数量为3，因此每次只执行其中3个任务，即打印连续3条记录，执行线程为10,11,12，其余任务处于等待状态。然后等待两秒，此时线程池所有线程应该是空闲的，下一次依然在线程10,11,12中执行3个任务，直到所有任务完成。</p>
<p>主线程id为1，子线程id为10,11,12<br>因为线程池只设置了核心线程数为3，并且最大线程数也是3。</p>
<h2 id="CacheThreadPool"><a href="#CacheThreadPool" class="headerlink" title="CacheThreadPool"></a>CacheThreadPool</h2><p>它是一种线程数量不固定的线程池，它只有非核心线程，并且虽大线程数为Integer.MAX_VALUE(一个很大的数)，相当于最大线程数可以任意大。当线程池中的线程都处于活动状态时，线程池会创建新的线程来处理新任务，否则就会利用空闲的线程来处理新任务。空闲线程有超时机制，60秒，超过60秒，回收空闲线程。<br>从CacheThreadPool的特性可以知道，这类线程池适合执行大量耗时少的任务。当整个线程池都处于闲置状态时候，线程池中的线程都会因为超时而被回收，几乎不占用任何系统资源。</p>
<p>创建实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ExecutorService cacheThreadPoolExecutor = Executors.newCachedThreadPool();</div></pre></td></tr></table></figure></p>
<p>newCachedThreadPool()方法如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Creates a thread pool that creates new threads as needed, but</div><div class="line"> * will reuse previously constructed threads when they are</div><div class="line"> * available.  These pools will typically improve the performance</div><div class="line"> * of programs that execute many short-lived asynchronous tasks.</div><div class="line"> * Calls to &#123;<span class="doctag">@code</span> execute&#125; will reuse previously constructed</div><div class="line"> * threads if available. If no existing thread is available, a new</div><div class="line"> * thread will be created and added to the pool. Threads that have</div><div class="line"> * not been used for sixty seconds are terminated and removed from</div><div class="line"> * the cache. Thus, a pool that remains idle for long enough will</div><div class="line"> * not consume any resources. Note that pools with similar</div><div class="line"> * properties but different details (for example, timeout parameters)</div><div class="line"> * may be created using &#123;<span class="doctag">@link</span> ThreadPoolExecutor&#125; constructors.</div><div class="line"> *</div><div class="line"> * <span class="doctag">@return</span> the newly created thread pool</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newCachedThreadPool</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">0</span>, Integer.MAX_VALUE,</div><div class="line">                                  <span class="number">60L</span>, TimeUnit.SECONDS,</div><div class="line">                                  <span class="keyword">new</span> SynchronousQueue&lt;Runnable&gt;());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>举个例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">private static void cacheThreadPoolTest()&#123;</div><div class="line">    ExecutorService cacheThreadPoolExecutor = Executors.newCachedThreadPool();</div><div class="line"></div><div class="line">    for (int i=0; i&lt;10; i++)&#123;</div><div class="line">        final int index = i;</div><div class="line">        /*</div><div class="line">        try &#123;</div><div class="line">            Thread.sleep(1000);</div><div class="line">        &#125;catch (InterruptedException itre)&#123;</div><div class="line">            itre.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        */</div><div class="line">        </div><div class="line">        cacheThreadPoolExecutor.execute(new Runnable() &#123;</div><div class="line">            @Override</div><div class="line">            public void run() &#123;</div><div class="line">                System.out.println(System.currentTimeMillis() + &quot; &quot; +</div><div class="line">                        &quot;index = &quot; +  index + &quot; &quot; +</div><div class="line">                        &quot;Thread id = &quot; + Thread.currentThread().getId());</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行情况：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">1498985856125 index = 0 Thread id = 10</div><div class="line">1498985856126 index = 1 Thread id = 11</div><div class="line">1498985856126 index = 2 Thread id = 12</div><div class="line">1498985856127 index = 3 Thread id = 13</div><div class="line">1498985856127 index = 7 Thread id = 10</div><div class="line">1498985856127 index = 6 Thread id = 14</div><div class="line">1498985856127 index = 9 Thread id = 14</div><div class="line">1498985856127 index = 4 Thread id = 12</div><div class="line">1498985856127 index = 5 Thread id = 11</div><div class="line">1498985856131 index = 8 Thread id = 15</div></pre></td></tr></table></figure></p>
<p>可以看出，当线程池的所有线程活动的时候，线程池不断创建线程了执行新的任务</p>
<p>如果去掉线程等待的注释，再运行一次<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">private static void cacheThreadPoolTest()&#123;</div><div class="line">    ExecutorService cacheThreadPoolExecutor = Executors.newCachedThreadPool();</div><div class="line"></div><div class="line">    for (int i=0; i&lt;10; i++)&#123;</div><div class="line">        final int index = i;</div><div class="line">        </div><div class="line">        try &#123;</div><div class="line">            Thread.sleep(1000);</div><div class="line">        &#125;catch (InterruptedException itre)&#123;</div><div class="line">            itre.printStackTrace();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        cacheThreadPoolExecutor.execute(new Runnable() &#123;</div><div class="line">            @Override</div><div class="line">            public void run() &#123;</div><div class="line">                System.out.println(System.currentTimeMillis() + &quot; &quot; +</div><div class="line">                        &quot;index = &quot; +  index + &quot; &quot; +</div><div class="line">                        &quot;Thread id = &quot; + Thread.currentThread().getId());</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">1498985981855 index = 0 Thread id = 10</div><div class="line">// 间隔一秒</div><div class="line">1498985982854 index = 1 Thread id = 10</div><div class="line">// 间隔一秒</div><div class="line">1498985983854 index = 2 Thread id = 10</div><div class="line">// 间隔一秒 下同省略了</div><div class="line">1498985984854 index = 3 Thread id = 10</div><div class="line">1498985985855 index = 4 Thread id = 10</div><div class="line">1498985986855 index = 5 Thread id = 10</div><div class="line">1498985987855 index = 6 Thread id = 10</div><div class="line">1498985988855 index = 7 Thread id = 10</div><div class="line">1498985989855 index = 8 Thread id = 10</div><div class="line">1498985990855 index = 9 Thread id = 10</div></pre></td></tr></table></figure></p>
<p>可以看到，当等待的时候，活动线程已经执行完毕，变成闲置线程，由于等待时间少于60秒，闲置线程未被回收，因此始终在10号线程中执行。</p>
<h2 id="ScheduledThreadPool"><a href="#ScheduledThreadPool" class="headerlink" title="ScheduledThreadPool"></a>ScheduledThreadPool</h2><p>它的核心线程数量是固定的，而非核心线程数没有限制，并且非核心线程闲置时会立即被回收。这类线程池主要用于执行定时任务或具有固定周期的重复任务</p>
<p>创建实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ScheduledExecutorService scheduledThreadPool = Executors.newScheduledThreadPool(4);</div></pre></td></tr></table></figure></p>
<p>newScheduledThreadPool()方法如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Creates a thread pool that can schedule commands to run after a</div><div class="line"> * given delay, or to execute periodically.</div><div class="line"> * <span class="doctag">@param</span> corePoolSize the number of threads to keep in the pool,</div><div class="line"> * even if they are idle</div><div class="line"> * <span class="doctag">@return</span> a newly created scheduled thread pool</div><div class="line"> * <span class="doctag">@throws</span> IllegalArgumentException if &#123;<span class="doctag">@code</span> corePoolSize &lt; 0&#125;</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ScheduledExecutorService <span class="title">newScheduledThreadPool</span><span class="params">(<span class="keyword">int</span> corePoolSize)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ScheduledThreadPoolExecutor(corePoolSize);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ScheduledThreadPoolExecutor()构造如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Creates a new &#123;@code ScheduledThreadPoolExecutor&#125; with the</div><div class="line"> * given core pool size.</div><div class="line"> *</div><div class="line"> * @param corePoolSize the number of threads to keep in the pool, even</div><div class="line"> *        if they are idle, unless &#123;@code allowCoreThreadTimeOut&#125; is set</div><div class="line"> * @throws IllegalArgumentException if &#123;@code corePoolSize &lt; 0&#125;</div><div class="line"> */</div><div class="line">public ScheduledThreadPoolExecutor(int corePoolSize) &#123;</div><div class="line">    super(corePoolSize, Integer.MAX_VALUE, 0, NANOSECONDS,</div><div class="line">          new DelayedWorkQueue());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>举个例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">private static void scheduledThreadPoolTest()&#123;</div><div class="line">    Runnable runnable = new Runnable() &#123;</div><div class="line">        @Override</div><div class="line">        public void run() &#123;</div><div class="line">            System.out.println(&quot;Thread id = &quot; + Thread.currentThread().getId());</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    ScheduledExecutorService scheduledThreadPool = Executors.newScheduledThreadPool(4);</div><div class="line">    //延时2s</div><div class="line">    scheduledThreadPool.schedule(runnable,2, TimeUnit.SECONDS);</div><div class="line">    //延迟1000ms后, 每隔500ms执行一次runnable</div><div class="line">    scheduledThreadPool.scheduleAtFixedRate(runnable,1000, 500, TimeUnit.MILLISECONDS);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="SingleThreadExecutor"><a href="#SingleThreadExecutor" class="headerlink" title="SingleThreadExecutor"></a>SingleThreadExecutor</h2><p>这类线程池内部只有一个核心线程，它确保所有的任务都在同一线程中按顺序执行。SingleThreadExecutor的意义在于同一所有的外界任务到一个线程中，这使得在这些任务之间不需要处理线程同步问题。</p>
<p>创建实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ExecutorService singleThreadExecutor = Executors.newSingleThreadExecutor();</div></pre></td></tr></table></figure></p>
<p>newSingleThreadExecutor()方法如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Creates an Executor that uses a single worker thread operating</div><div class="line"> * off an unbounded queue. (Note however that if this single</div><div class="line"> * thread terminates due to a failure during execution prior to</div><div class="line"> * shutdown, a new one will take its place if needed to execute</div><div class="line"> * subsequent tasks.)  Tasks are guaranteed to execute</div><div class="line"> * sequentially, and no more than one task will be active at any</div><div class="line"> * given time. Unlike the otherwise equivalent</div><div class="line"> * &#123;<span class="doctag">@code</span> newFixedThreadPool(1)&#125; the returned executor is</div><div class="line"> * guaranteed not to be reconfigurable to use additional threads.</div><div class="line"> *</div><div class="line"> * <span class="doctag">@return</span> the newly created single-threaded Executor</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newSingleThreadExecutor</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FinalizableDelegatedExecutorService</div><div class="line">        (<span class="keyword">new</span> ThreadPoolExecutor(<span class="number">1</span>, <span class="number">1</span>,</div><div class="line">                                <span class="number">0L</span>, TimeUnit.MILLISECONDS,</div><div class="line">                                <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;()));</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>举个例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">private static void singleThreadExecutorTest()&#123;</div><div class="line">    ExecutorService singleThreadExecutor = Executors.newSingleThreadExecutor();</div><div class="line">    for (int i=0; i&lt;10; i++)&#123;</div><div class="line">        final int index = i;</div><div class="line">        singleThreadExecutor.execute(new Runnable() &#123;</div><div class="line">            @Override</div><div class="line">            public void run() &#123;</div><div class="line">                System.out.println(&quot;index = &quot; + index+ &quot; Thread id = &quot; + Thread.currentThread().getId());</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">index = 0 Thread id = 10</div><div class="line">index = 1 Thread id = 10</div><div class="line">index = 2 Thread id = 10</div><div class="line">index = 3 Thread id = 10</div><div class="line">index = 4 Thread id = 10</div><div class="line">index = 5 Thread id = 10</div><div class="line">index = 6 Thread id = 10</div><div class="line">index = 7 Thread id = 10</div><div class="line">index = 8 Thread id = 10</div><div class="line">index = 9 Thread id = 10</div></pre></td></tr></table></figure></p>
<p>可以看出，所有任务都在同一个线程中排队等待执行。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;引言&quot;&gt;&lt;a href=&quot;#引言&quot; class=&quot;headerlink&quot; title=&quot;引言&quot;&gt;&lt;/a&gt;引言&lt;/h1&gt;&lt;p&gt;当我们使用线程的时候就去创建一个线程，这样实现起来非常简便，但是就会有一个问题：&lt;br&gt;　　如果并发的线程数量很多，并且每个线程都是执行一个
    
    </summary>
    
      <category term="Java" scheme="https://devallever.github.io/categories/Java/"/>
    
    
      <category term="Java" scheme="https://devallever.github.io/tags/Java/"/>
    
      <category term="ThreadPoolExecutor" scheme="https://devallever.github.io/tags/ThreadPoolExecutor/"/>
    
  </entry>
  
  <entry>
    <title>IntentService 工作原理</title>
    <link href="https://devallever.github.io/2017/07/02/android-intent-service/"/>
    <id>https://devallever.github.io/2017/07/02/android-intent-service/</id>
    <published>2017-07-02T01:22:13.000Z</published>
    <updated>2017-07-02T01:50:58.132Z</updated>
    
    <content type="html"><![CDATA[<h1 id="IntentService简介"><a href="#IntentService简介" class="headerlink" title="IntentService简介"></a>IntentService简介</h1><p>是一种特殊的Service，继承了Service并且是个抽象类，可用于执行后台耗时任务，当任务结束后自动停止，同时由于是服务的原因，它的优先级比普通线程高很多，因此不容易被系统杀死。在实现上，IntentService封装了HandlerThread和Handler。</p>
<h1 id="基本流程"><a href="#基本流程" class="headerlink" title="基本流程"></a>基本流程</h1><p>startService(intentService):<br>onCreate()-&gt;<br>onStartCommand()-&gt;<br>onStart()-&gt;<br>sendMessage()-&gt;<br>handlerMessage()-&gt;<br>onHandlerIntent()-&gt;<br>stopSelf(startId)-&gt;<br>onDestroy-&gt;</p>
<h1 id="详细解剖"><a href="#详细解剖" class="headerlink" title="详细解剖"></a>详细解剖</h1><h2 id="onCreate"><a href="#onCreate" class="headerlink" title="onCreate()"></a>onCreate()</h2><p>当服务第一次创建的时候调用onCreate()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void onCreate() &#123;</div><div class="line">    // TODO: It would be nice to have an option to hold a partial wakelock</div><div class="line">    // during processing, and to have a static startService(Context, Intent)</div><div class="line">    // method that would launch the service &amp; hand off a wakelock.</div><div class="line"></div><div class="line">    super.onCreate();</div><div class="line">    HandlerThread thread = new HandlerThread(&quot;IntentService[&quot; + mName + &quot;]&quot;);</div><div class="line">    thread.start();</div><div class="line"></div><div class="line">    mServiceLooper = thread.getLooper();</div><div class="line">    mServiceHandler = new ServiceHandler(mServiceLooper);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>该方法封装了HandlerThread 和 Handler</p>
<h2 id="onStartCommand"><a href="#onStartCommand" class="headerlink" title="onStartCommand()"></a>onStartCommand()</h2><p>每一次启动服务的时候调用onStartCommand()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public int onStartCommand(@Nullable Intent intent, int flags, int startId) &#123;</div><div class="line">    onStart(intent, startId);</div><div class="line">    return mRedelivery ? START_REDELIVER_INTENT : START_NOT_STICKY;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>该方法仅仅调用了onStart()方法</p>
<h2 id="onStart"><a href="#onStart" class="headerlink" title="onStart()"></a>onStart()</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void onStart(@Nullable Intent intent, int startId) &#123;</div><div class="line">    Message msg = mServiceHandler.obtainMessage();</div><div class="line">    msg.arg1 = startId;</div><div class="line">    msg.obj = intent;</div><div class="line">    mServiceHandler.sendMessage(msg);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>该方法把startService传来的Intent和startId封装成Message消息，然后通过handler发送消息，接着执行mServiceHandler.handleMessage()<br>其中ServiceHandler是IntentService的一个内部类，它的定义如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">private final class ServiceHandler extends Handler &#123;</div><div class="line">    public ServiceHandler(Looper looper) &#123;</div><div class="line">        super(looper);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void handleMessage(Message msg) &#123;</div><div class="line">        onHandleIntent((Intent)msg.obj);</div><div class="line">        stopSelf(msg.arg1);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="handleMessage"><a href="#handleMessage" class="headerlink" title="handleMessage()"></a>handleMessage()</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void handleMessage(Message msg) &#123;</div><div class="line">	onHandleIntent((Intent)msg.obj);</div><div class="line">	stopSelf(msg.arg1);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>该方法会执行onHandleIntent()方法，它是个抽象方法，因此我们自定义IntentService的时候必须重写onHandleIntent()方法。因为发送消息那那个handler是HandlerThread所关联的，所以处理信息的时候是在子线程进行的。不会的可以看看HandlerThread原理。</p>
<h2 id="stopSelf"><a href="#stopSelf" class="headerlink" title="stopSelf()"></a>stopSelf()</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void handleMessage(Message msg) &#123;</div><div class="line">	onHandleIntent((Intent)msg.obj);</div><div class="line">	stopSelf(msg.arg1);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>当onHandleIntent()方法执行完毕之后，会调用stopSelf(int)方法结束服务</p>
<h2 id="onDestroy"><a href="#onDestroy" class="headerlink" title="onDestroy()"></a>onDestroy()</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void onDestroy() &#123;</div><div class="line">    mServiceLooper.quit();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最后销毁服务的时候，终止线程执行</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;IntentService简介&quot;&gt;&lt;a href=&quot;#IntentService简介&quot; class=&quot;headerlink&quot; title=&quot;IntentService简介&quot;&gt;&lt;/a&gt;IntentService简介&lt;/h1&gt;&lt;p&gt;是一种特殊的Service，继承了S
    
    </summary>
    
      <category term="Android" scheme="https://devallever.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://devallever.github.io/tags/Android/"/>
    
      <category term="Thread" scheme="https://devallever.github.io/tags/Thread/"/>
    
      <category term="IntentService" scheme="https://devallever.github.io/tags/IntentService/"/>
    
      <category term="Service" scheme="https://devallever.github.io/tags/Service/"/>
    
  </entry>
  
  <entry>
    <title>HandlerThread简单使用</title>
    <link href="https://devallever.github.io/2017/07/01/handler-thread-basic/"/>
    <id>https://devallever.github.io/2017/07/01/handler-thread-basic/</id>
    <published>2017-07-01T08:59:50.000Z</published>
    <updated>2017-07-01T09:35:43.310Z</updated>
    
    <content type="html"><![CDATA[<h1 id="HandlerThread简介"><a href="#HandlerThread简介" class="headerlink" title="HandlerThread简介"></a>HandlerThread简介</h1><p>HandlerThread继承了Thread，它是一种可以使用Handler的Thread，它的实现就是在run()方法中通过Looper.prepare()创建消息队列，并通过Looper.loop()开启消息循环。这样在实际使用中就允许在HandlerThread中创建Handler了。<br>由于HandlerThread的run()方法是一个无限循环，因此当明确不需要使用HandlerThread的时候可以通过Looper的quit()或quitSafely()来终止线程执行。</p>
<h1 id="使用Handler"><a href="#使用Handler" class="headerlink" title="使用Handler"></a>使用Handler</h1><p>通常我们会在主线程中创建Handler，在子线程中调用handler.post(runnable)传递消息到主线程的消息队列中处理runnable的run方法.这样完成了子线程到主线的切换。<br>在onCreate()方法中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mainHandler = new Handler();</div></pre></td></tr></table></figure></p>
<p>然后在子线程中post<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">btn_post_to_main_thread.setOnClickListener(new View.OnClickListener() &#123;</div><div class="line">	@Override</div><div class="line">	public void onClick(View v) &#123;</div><div class="line">		new Thread(new Runnable() &#123;</div><div class="line">			@Override</div><div class="line">			public void run() &#123;</div><div class="line">				Log.d(TAG, &quot;Thread id = &quot; + Thread.currentThread().getId());</div><div class="line">				mainHandler.post(runnable);</div><div class="line">			&#125;</div><div class="line">		&#125;).start();</div><div class="line">                </div><div class="line">	&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>runnable<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">private Runnable runnable = new Runnable() &#123;</div><div class="line">    @Override</div><div class="line">    public void run() &#123;</div><div class="line">        Log.d(TAG, &quot;Thread id = &quot; + Thread.currentThread().getId());</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>运行结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">HandlerThreadActivity: Thread id = 10383</div><div class="line">HandlerThreadActivity: Thread id = 1</div></pre></td></tr></table></figure></p>
<h1 id="使用HandlerThread"><a href="#使用HandlerThread" class="headerlink" title="使用HandlerThread"></a>使用HandlerThread</h1><p>先创建HandlerThread实例，在onCreate()方法中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">handlerThread = new HandlerThread(&quot;handlerThread&quot;);</div><div class="line">handlerThread.start();</div></pre></td></tr></table></figure></p>
<p>这样就开启了一个带Looper的子线程，因为HandlerThread是继承自Thread，它的run方法是这样定义的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public void run() &#123;</div><div class="line">    mTid = Process.myTid();</div><div class="line">    Looper.prepare();</div><div class="line">    synchronized (this) &#123;</div><div class="line">        mLooper = Looper.myLooper();</div><div class="line">        notifyAll();</div><div class="line">    &#125;</div><div class="line">    Process.setThreadPriority(mPriority);</div><div class="line">    onLooperPrepared();</div><div class="line">    Looper.loop();</div><div class="line">    mTid = -1;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>关于Looper原理，可以参考《Android开发艺术探索》中的消息机制，我的理解是:</p>
<ul>
<li>Looper.prepare();创建Looper实例</li>
<li>Looper.loop();进入一个无限循环中，不断监听消息队列中是否有消息，有则把他取出来分发给handler的handlerMessage()中处理。</li>
</ul>
<p>因为线程中需要有一个Looper，线程绑定的handler才可以发送消息到消息队列中，那么相应的线程才会得到处理。</p>
<p>然后就是利用handlerThread获取到Looper用来创建Handler实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">handler = new Handler(handlerThread.getLooper());</div></pre></td></tr></table></figure></p>
<p>此时这个handler即使实在主线程中创建，但是它与子线程的Looper关联了，所以处理消息时候也会在子线程中处理的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">btn_post_to_sub_thread.setOnClickListener(new View.OnClickListener() &#123;</div><div class="line">	@Override</div><div class="line">	public void onClick(View v) &#123;</div><div class="line">		handler.post(runnable);</div><div class="line">	&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>运行结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">HandlerThreadActivity: Thread id = 10382</div><div class="line">HandlerThreadActivity: Thread id = 10382</div><div class="line">HandlerThreadActivity: Thread id = 10382</div></pre></td></tr></table></figure></p>
<p>可以知道是在子线程中处理的。</p>
<h1 id="HandlerThread和Thread的区别"><a href="#HandlerThread和Thread的区别" class="headerlink" title="HandlerThread和Thread的区别"></a>HandlerThread和Thread的区别</h1><ul>
<li>普通Thread主要用于在run()方法中执行一个耗时的任务</li>
<li>HandlerThread内部创建消息队列，需要handler消息方式来通知HandlerThread去执行一个具体的任务。</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;HandlerThread简介&quot;&gt;&lt;a href=&quot;#HandlerThread简介&quot; class=&quot;headerlink&quot; title=&quot;HandlerThread简介&quot;&gt;&lt;/a&gt;HandlerThread简介&lt;/h1&gt;&lt;p&gt;HandlerThread继承了Th
    
    </summary>
    
      <category term="Android" scheme="https://devallever.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://devallever.github.io/tags/Android/"/>
    
      <category term="Thread" scheme="https://devallever.github.io/tags/Thread/"/>
    
      <category term="HandlerThread" scheme="https://devallever.github.io/tags/HandlerThread/"/>
    
  </entry>
  
  <entry>
    <title>OkHttp的简单使用</title>
    <link href="https://devallever.github.io/2017/06/30/okhttp-sample/"/>
    <id>https://devallever.github.io/2017/06/30/okhttp-sample/</id>
    <published>2017-06-30T12:07:13.000Z</published>
    <updated>2017-06-30T12:46:53.374Z</updated>
    
    <content type="html"><![CDATA[<h1 id="OkHttp简介"><a href="#OkHttp简介" class="headerlink" title="OkHttp简介"></a>OkHttp简介</h1><p>关于Okhttp的简介，相信大家都不陌生了，这里就不讲了。</p>
<h1 id="初级用法"><a href="#初级用法" class="headerlink" title="初级用法"></a>初级用法</h1><h2 id="Get请求"><a href="#Get请求" class="headerlink" title="Get请求"></a>Get请求</h2><p>比如这里的使用get方法进行登录操作<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doLoginGet</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">final</span> String url = <span class="string">"xxxxx?username=allever?password=123456"</span></div><div class="line">    OkHttpUtil.loginGet(url, <span class="keyword">new</span> Callback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, <span class="keyword">final</span> Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">            handleLogin(response.body().string(););</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>loginGet方法如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loginGet</span><span class="params">(String url, Callback callback)</span></span>&#123;</div><div class="line">    OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</div><div class="line">    Request request = <span class="keyword">new</span> Request.Builder()</div><div class="line">            .url(url)</div><div class="line">            .build();</div><div class="line">    client.newCall(request).enqueue(callback);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>是不是很简单，创建OkhttpClient实例，创建请求，然后执行请求，然后进行回调</p>
<p>处理结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">private void handleLogin(final String result)&#123;</div><div class="line">    runOnUiThread(new Runnable() &#123;</div><div class="line">        @Override</div><div class="line">        public void run() &#123;</div><div class="line">            Gson gson = new Gson();</div><div class="line">            LoginRoot loginRoot = gson.fromJson(result,LoginRoot.class);</div><div class="line">            User user = loginRoot.getUser();</div><div class="line">            tv_result.setText(user.getNickname() + &quot;\n&quot; + user.getSignature());</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>因为回调方法在子线程中，所以要切回到主线程中，方法有很多，可以使用Handler，这里直接runOnUiThread()就好了。简单起见，另外Gson处理json数据不在讨论范围之内，</p>
<h2 id="Post请求"><a href="#Post请求" class="headerlink" title="Post请求"></a>Post请求</h2><p>例子同上，登录操作<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doLoginPost</span><span class="params">()</span></span>&#123;</div><div class="line">    OkHttpUtil.loginPost(username, password, <span class="keyword">new</span> Callback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">            handleLogin(response.body().string());</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public static void loginPost(String username, String password, Callback callback)&#123;</div><div class="line">    String url = BASE_URL + &quot;LoginServlet&quot;;</div><div class="line">    OkHttpClient client = new OkHttpClient();</div><div class="line">    FormBody.Builder builder = new FormBody.Builder();</div><div class="line">    builder.add(&quot;username&quot;,username);</div><div class="line">    RequestBody requestBody = builder.build();</div><div class="line">    Request request = new Request.Builder()</div><div class="line">            .url(url)</div><div class="line">            .post(requestBody)</div><div class="line">            .build();</div><div class="line">    client.newCall(request).enqueue(callback);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>唯一不同的就是这里啦，首先还是创建OkhttpClient实例，这里使用了FormBody表单, 用这个表单创建请求体，然后创建请求，最后执行请求，回调<br>最后的处理方法同上。</p>
<h2 id="异步请求"><a href="#异步请求" class="headerlink" title="异步请求"></a>异步请求</h2><p>上面两个例子都是异步请求，因为不用咋们手动开启子线程，它会自动的开启线程去处理的</p>
<h2 id="同步请求"><a href="#同步请求" class="headerlink" title="同步请求"></a>同步请求</h2><p>例如，退出登录的例子<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doLogoutTongBu</span><span class="params">()</span></span>&#123;</div><div class="line">        OkHttpUtil.logoutTongBu(handler);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">logoutTongBu</span><span class="params">(<span class="keyword">final</span> Handler handler)</span></span>&#123;</div><div class="line">    <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">            String url = <span class="string">"xxxxx/logout"</span>;</div><div class="line">            OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</div><div class="line">            FormBody.Builder builder = <span class="keyword">new</span> FormBody.Builder();</div><div class="line">            <span class="keyword">if</span> (!SharePreferenceUtil.getSessionId().equals(<span class="string">""</span>))&#123;</div><div class="line">                RequestBody requestBody = builder.build();</div><div class="line">                Request request = <span class="keyword">new</span> Request.Builder()</div><div class="line">                        .url(url)</div><div class="line">                        .post(requestBody)</div><div class="line">                        .addHeader(<span class="string">"Cookie"</span>, <span class="string">"JSESSIONID="</span> + SharePreferenceUtil.getSessionId())</div><div class="line">                        .build();</div><div class="line">                Response response = <span class="keyword">null</span>;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    response = client.newCall(request).execute();</div><div class="line">                    String result = response.body().string();</div><div class="line">                    Message message = <span class="keyword">new</span> Message();</div><div class="line">                    message.what = MESSAGE_LOGOUT;</div><div class="line">                    message.obj = result;</div><div class="line">                    handler.sendMessage(message);</div><div class="line">                &#125;<span class="keyword">catch</span> (IOException ioe)&#123;</div><div class="line">                    ioe.printStackTrace();</div><div class="line">                &#125;</div><div class="line"></div><div class="line">            &#125;<span class="keyword">else</span> &#123;</div><div class="line">                Message message = <span class="keyword">new</span> Message();</div><div class="line">                message.what = MESSAGE_LOGOUT;</div><div class="line">                message.obj = <span class="string">"未登录"</span>;</div><div class="line">                handler.sendMessage(message);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;).start();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里手动开启了一个线程进行网络请求，还是使用Post方法，跟上面的没啥区别，注意这里<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">addHeader(&quot;Cookie&quot;, &quot;JSESSIONID=&quot; + SharePreferenceUtil.getSessionId())</div></pre></td></tr></table></figure></p>
<p>添加Cookie的头部信息，Cookie就是用来持久化用户登录<br>还有就是执行请求的方法有些区别，同步执行是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">response = client.newCall(request).execute();</div></pre></td></tr></table></figure></p>
<p>异步执行是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">client.newCall(request).enqueue(callback);</div></pre></td></tr></table></figure></p>
<p>同步执行的结果为Response对象，就是服务器返回的数据</p>
<h1 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h1><h2 id="上传文件和表单数据"><a href="#上传文件和表单数据" class="headerlink" title="上传文件和表单数据"></a>上传文件和表单数据</h2><p>例如发一条说说，包括图片和文字<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doAddNews</span><span class="params">(String content)</span></span>&#123;</div><div class="line">    OkHttpUtil.addNews(content, <span class="keyword">new</span> Callback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">            Log.d(TAG, <span class="string">"onResponse: result = "</span> + response.body().string());</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">public static void addNews(String content,Callback callback)&#123;</div><div class="line">    OkHttpClient client = new OkHttpClient();</div><div class="line">    MultipartBody multipartBody = new MultipartBody.Builder()</div><div class="line">            .setType(MultipartBody.FORM)</div><div class="line">            .addFormDataPart(&quot;content&quot;,content)</div><div class="line">            .addFormDataPart(&quot;city&quot;,&quot;番禺&quot;)</div><div class="line">            .addFormDataPart(&quot;longitude&quot;,&quot;111.22&quot;)</div><div class="line">            .addFormDataPart(&quot;latitude&quot;,&quot;22.22&quot;)</div><div class="line">            .addPart(Headers.of(&quot;Content-Disposition&quot;,</div><div class="line">                    &quot;form-data; name=\&quot;part1&quot;+ &quot;\&quot;&quot;),</div><div class="line">                    RequestBody.create(</div><div class="line">                            MediaType.parse(&quot;application/octet-stream&quot;),</div><div class="line">                            new File(Environment.getExternalStorageDirectory().getPath()+&quot;/&quot;,&quot;jiaxin.png&quot;)))</div><div class="line">            .build();</div><div class="line"></div><div class="line">    if (SharePreferenceUtil.getSessionId().equals(&quot;&quot;))&#123;</div><div class="line">    &#125;</div><div class="line">    Request request = new Request.Builder()</div><div class="line">            .url(BASE_URL + &quot;AddNewsServlet&quot;)</div><div class="line">            .post(multipartBody)</div><div class="line">            .addHeader(&quot;Cookie&quot;, &quot;JSESSIONID=&quot; + SharePreferenceUtil.getSessionId())</div><div class="line">            .build();</div><div class="line"></div><div class="line">    client.newCall(request).enqueue(callback);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>设置表单类型<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">setType(MultipartBody.FORM)</div></pre></td></tr></table></figure></p>
<p>使用MultipartBody对象把表单数据和文件数据形式封装，表单使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">addFormDataPart(&quot;content&quot;,content)</div></pre></td></tr></table></figure></p>
<p>用键值对保存</p>
<p>文件用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">.addPart(Headers.of(&quot;Content-Disposition&quot;,</div><div class="line">                        &quot;form-data; name=\&quot;part1&quot;+ &quot;\&quot;&quot;),</div><div class="line">                        RequestBody.create(</div><div class="line">                                MediaType.parse(&quot;application/octet-stream&quot;),</div><div class="line">                                fileObject))</div></pre></td></tr></table></figure></p>
<p>其中：part1是服务器根据键找到part的那个键<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">request.getPart(&quot;part1&quot;);</div></pre></td></tr></table></figure></p>
<p>如果多文件的话就多次调用addPart()</p>
<blockquote>
<p>必须设置表单类型</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">setType(MultipartBody.FORM)</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;OkHttp简介&quot;&gt;&lt;a href=&quot;#OkHttp简介&quot; class=&quot;headerlink&quot; title=&quot;OkHttp简介&quot;&gt;&lt;/a&gt;OkHttp简介&lt;/h1&gt;&lt;p&gt;关于Okhttp的简介，相信大家都不陌生了，这里就不讲了。&lt;/p&gt;
&lt;h1 id=&quot;初级用法
    
    </summary>
    
      <category term="Android" scheme="https://devallever.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://devallever.github.io/tags/Android/"/>
    
      <category term="Network" scheme="https://devallever.github.io/tags/Network/"/>
    
      <category term="OkHttp" scheme="https://devallever.github.io/tags/OkHttp/"/>
    
  </entry>
  
  <entry>
    <title>社交圈</title>
    <link href="https://devallever.github.io/2017/06/21/social-app/"/>
    <id>https://devallever.github.io/2017/06/21/social-app/</id>
    <published>2017-06-21T13:17:26.000Z</published>
    <updated>2017-06-24T11:45:08.943Z</updated>
    
    <content type="html"><![CDATA[<h1 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h1><p>一款社交 APP<br>附近人模块:中可以关注,聊天,加好友,好友分组管理。查找,筛选用户<br>动态模块:可以,点赞,评论。可以发布语音动态,和语音评论并且实时通知。<br>聊天模块,集成环信 IM。文本,表情,图片,位置,语音通话,视频聊天。设置在<br>线状态,离开自动回复。<br>推荐模块包括热点(浏览量最多的动态)、圈子(好友的动态)、定位(查看好友登录地<br>理位置)<br>通知模块:使用极光推送。刷新,发布动态,评论,点赞,好友请求。<br>其他功能:查看关注用户,粉丝用户,谁看过我,照片墙。</p>
<h1 id="项目架构"><a href="#项目架构" class="headerlink" title="项目架构"></a>项目架构</h1><ul>
<li>发现<ul>
<li>用户<ul>
<li>查看用户资料</li>
<li>查找用户</li>
<li>添加好友 删除好友</li>
<li>关注</li>
<li>聊天</li>
</ul>
</li>
<li>动态<ul>
<li>查看动态详细信息</li>
<li>发布动态</li>
<li>评论</li>
<li>点赞</li>
</ul>
</li>
</ul>
</li>
<li>聊天<ul>
<li>消息列表</li>
<li>好友管理<ul>
<li>分组管理：添加分组，删除分组，修改分组</li>
<li>修改好友备注，移动分组</li>
</ul>
</li>
</ul>
</li>
<li>推荐<ul>
<li>热点：浏览量最多的动态</li>
<li>圈子：好友的动态</li>
<li>足迹(定位)：好友位置</li>
</ul>
</li>
<li>我的<ul>
<li>修改用户资料</li>
<li>修改在线状态</li>
<li>动态数，关注数，粉丝数</li>
<li>照片墙：添加照片，删除照片</li>
<li>访客：访问主页，访问动态</li>
<li>设置：视频聊天，清理缓存，自动回复</li>
</ul>
</li>
</ul>
<h1 id="功能实现细节"><a href="#功能实现细节" class="headerlink" title="功能实现细节"></a>功能实现细节</h1><h1 id="欢迎界面"><a href="#欢迎界面" class="headerlink" title="欢迎界面"></a>欢迎界面</h1><h1 id="登录-注册"><a href="#登录-注册" class="headerlink" title="登录-注册"></a>登录-注册</h1><h1 id="刷刷"><a href="#刷刷" class="headerlink" title="刷刷"></a>刷刷</h1><h1 id="主界面"><a href="#主界面" class="headerlink" title="主界面"></a>主界面</h1><h2 id="发现"><a href="#发现" class="headerlink" title="发现"></a>发现</h2><h3 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h3><h4 id="用户列表"><a href="#用户列表" class="headerlink" title="用户列表"></a>用户列表</h4><h4 id="查找用户"><a href="#查找用户" class="headerlink" title="查找用户"></a>查找用户</h4><h4 id="用户资料"><a href="#用户资料" class="headerlink" title="用户资料"></a>用户资料</h4><h4 id="添加好友"><a href="#添加好友" class="headerlink" title="添加好友"></a>添加好友</h4><h4 id="删除好友"><a href="#删除好友" class="headerlink" title="删除好友"></a>删除好友</h4><h4 id="关注-粉丝数"><a href="#关注-粉丝数" class="headerlink" title="关注-粉丝数"></a>关注-粉丝数</h4><h3 id="动态"><a href="#动态" class="headerlink" title="动态"></a>动态</h3><h4 id="发布动态"><a href="#发布动态" class="headerlink" title="发布动态"></a>发布动态</h4><h4 id="查看动态"><a href="#查看动态" class="headerlink" title="查看动态"></a>查看动态</h4><h4 id="评论"><a href="#评论" class="headerlink" title="评论"></a>评论</h4><h4 id="点赞"><a href="#点赞" class="headerlink" title="点赞"></a>点赞</h4><h4 id="查看大图"><a href="#查看大图" class="headerlink" title="查看大图"></a>查看大图</h4><h2 id="聊天"><a href="#聊天" class="headerlink" title="聊天"></a>聊天</h2><h3 id="好友管理"><a href="#好友管理" class="headerlink" title="好友管理"></a>好友管理</h3><h4 id="好友列表"><a href="#好友列表" class="headerlink" title="好友列表"></a>好友列表</h4><h4 id="分组管理"><a href="#分组管理" class="headerlink" title="分组管理"></a>分组管理</h4><h4 id="添加分组"><a href="#添加分组" class="headerlink" title="添加分组"></a>添加分组</h4><h4 id="修改分组"><a href="#修改分组" class="headerlink" title="修改分组"></a>修改分组</h4><h4 id="删除分组"><a href="#删除分组" class="headerlink" title="删除分组"></a>删除分组</h4><h4 id="移动分组"><a href="#移动分组" class="headerlink" title="移动分组"></a>移动分组</h4><h4 id="修改备注"><a href="#修改备注" class="headerlink" title="修改备注"></a>修改备注</h4><p>##推荐</p>
<h3 id="热点"><a href="#热点" class="headerlink" title="热点"></a>热点</h3><h3 id="圈子"><a href="#圈子" class="headerlink" title="圈子"></a>圈子</h3><h3 id="足迹-定位"><a href="#足迹-定位" class="headerlink" title="足迹(定位)"></a>足迹(定位)</h3><h3 id="排行榜"><a href="#排行榜" class="headerlink" title="排行榜"></a>排行榜</h3><h2 id="我的"><a href="#我的" class="headerlink" title="我的"></a>我的</h2><h3 id="修改用户资料"><a href="#修改用户资料" class="headerlink" title="修改用户资料"></a>修改用户资料</h3><h3 id="修改在线状态"><a href="#修改在线状态" class="headerlink" title="修改在线状态"></a>修改在线状态</h3><h3 id="照片墙"><a href="#照片墙" class="headerlink" title="照片墙"></a>照片墙</h3><h3 id="访客"><a href="#访客" class="headerlink" title="访客"></a>访客</h3><h3 id="动态数-关注数-粉丝数"><a href="#动态数-关注数-粉丝数" class="headerlink" title="动态数-关注数-粉丝数"></a>动态数-关注数-粉丝数</h3><h3 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h3><h4 id="视频聊天"><a href="#视频聊天" class="headerlink" title="视频聊天"></a>视频聊天</h4><h4 id="清理缓存"><a href="#清理缓存" class="headerlink" title="清理缓存"></a>清理缓存</h4><h4 id="自动回复"><a href="#自动回复" class="headerlink" title="自动回复"></a>自动回复</h4>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;项目简介&quot;&gt;&lt;a href=&quot;#项目简介&quot; class=&quot;headerlink&quot; title=&quot;项目简介&quot;&gt;&lt;/a&gt;项目简介&lt;/h1&gt;&lt;p&gt;一款社交 APP&lt;br&gt;附近人模块:中可以关注,聊天,加好友,好友分组管理。查找,筛选用户&lt;br&gt;动态模块:可以,点赞,评论
    
    </summary>
    
      <category term="Android" scheme="https://devallever.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://devallever.github.io/tags/Android/"/>
    
      <category term="Project" scheme="https://devallever.github.io/tags/Project/"/>
    
      <category term="社交" scheme="https://devallever.github.io/tags/%E7%A4%BE%E4%BA%A4/"/>
    
  </entry>
  
  <entry>
    <title>深入理解Java垃圾回收机制</title>
    <link href="https://devallever.github.io/2017/06/11/java-gc/"/>
    <id>https://devallever.github.io/2017/06/11/java-gc/</id>
    <published>2017-06-11T02:43:45.000Z</published>
    <updated>2017-06-15T05:26:47.239Z</updated>
    
    <content type="html"><![CDATA[<h1 id="垃圾回收机制的意义"><a href="#垃圾回收机制的意义" class="headerlink" title="垃圾回收机制的意义"></a>垃圾回收机制的意义</h1><p>Java语言中一个显著的特点就是引入了垃圾回收机制，使c++程序员最头疼的内存管理的问题迎刃而解，它使得Java程序员在编写程序的时候不再需要考虑内存管理。由于有个垃圾回收机制，Java中的对象不再有“作用域”的概念，只有对象的引用才有“作用域”。垃圾回收可以有效的防止内存泄露，有效的使用空闲的内存。  </p>
<p>　　ps:内存泄露是指该内存空间使用完毕之后未回收，在不涉及复杂数据结构的一般情况下，Java 的内存泄露表现为一个内存对象的生命周期超出了程序需要它的时间长度，我们有时也将其称为“对象游离”。
　　</p>
<h1 id="垃圾回收机制中的算法"><a href="#垃圾回收机制中的算法" class="headerlink" title="垃圾回收机制中的算法"></a>垃圾回收机制中的算法</h1><p>　Java语言规范没有明确地说明JVM使用哪种垃圾回收算法，但是任何一种垃圾回收算法一般要做2件基本的事情：<br>　（1）发现无用信息对象；<br>　（2）回收被无用对象占用的内存空间，使该空间可被程序再次使用。
　</p>
<h1 id="Jvm-Java虚拟机-内存模型"><a href="#Jvm-Java虚拟机-内存模型" class="headerlink" title="Jvm(Java虚拟机)内存模型"></a>Jvm(Java虚拟机)内存模型</h1><p>在了解垃圾回收算法之前先简单了解一下jvm内存模型.<br>从Jvm内存模型中入手对于理解GC会有很大的帮助，不过这里只需要了解一个大概，说多了反而混淆视线。  </p>
<p>Jvm(Java虚拟机)主要管理两种类型内存：堆和非堆。</p>
<ul>
<li>堆是运行时数据区域，所有类实例和数组的内存均从此处分配。</li>
<li>非堆是JVM留给自己用的，包含方法区、JVM内部处理或优化所需的内存（如 JIT Compiler，Just-in-time Compiler，即时编译后的代码缓存）、每个类结构（如运行时常数池、字段和方法数据）以及方法和构造方法的代码。</li>
</ul>
<p>简言之，Java程序内存主要（这里强调主要二字）分两部分，堆和非堆。大家一般new的对象和数组都是在堆中的，而GC主要回收的内存也是这块堆内存。  </p>
<p>配一张示意图总结一下：<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.jayfeng.com/images/gc_jvm_memory.gif" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure></p>
<blockquote>
<p>堆内存（Heap Memory）： 存放Java对象<br>非堆内存（Non-Heap Memory）： 存放类加载信息和其它meta-data<br>其它（Other）： 存放JVM 自身代码等</p>
</blockquote>
<p>重点是堆内存，我们就再看看堆的内存模型。</p>
<ul>
<li>堆内存由垃圾回收器的自动内存管理系统回收。</li>
<li>堆内存分为两大部分：新生代和老年代。比例为1：2。</li>
<li>老年代主要存放应用程序中生命周期长的存活对象。</li>
<li>新生代又分为三个部分：一个Eden区和两个Survivor区，比例为8：1：1。</li>
<li>Eden区存放新生的对象。</li>
<li>Survivor存放每次垃圾回收后存活的对象。</li>
</ul>
<p><img src="http://www.jayfeng.com/images/gc_heap.png" alt=""></p>
<p>其实只需要关注这几个问题:</p>
<ul>
<li>为什么要分新生代和老年代？</li>
<li>新生代为什么分一个Eden区和两个Survivor区?</li>
<li>一个Eden区和两个Survivor区的比例为什么是8:1:1？</li>
</ul>
<p>现在还不能解释为什么，但这几个问题都是垃圾回收机制所采用的算法决定的。<br>所以问题转化为，是何种算法？为什么要采用此种算法？</p>
<h1 id="可回收对象的判定"><a href="#可回收对象的判定" class="headerlink" title="可回收对象的判定"></a>可回收对象的判定</h1><p>讲算法之前，我们先要搞清楚一个问题，什么样的对象是垃圾（无用对象），需要被回收？<br>目前市面上有两种算法用来判定一个对象是否为垃圾。</p>
<ul>
<li>引用计数算法</li>
<li>可达性分析算法（根搜索算法）</li>
</ul>
<h2 id="引用计数法-Reference-Counting-Collector"><a href="#引用计数法-Reference-Counting-Collector" class="headerlink" title="引用计数法(Reference Counting Collector)"></a>引用计数法(Reference Counting Collector)</h2><h3 id="算法分析"><a href="#算法分析" class="headerlink" title="算法分析"></a>算法分析</h3><p>引用计数是垃圾收集器中的早期策略。在这种方法中，堆中每个对象实例都有一个引用计数。当一个对象被创建时，且将该对象实例分配给一个变量，该变量计数设置为1。当任何其它变量被赋值为这个对象的引用时，计数加1（a = b,则b引用的对象实例的计数器+1），但当一个对象实例的某个引用超过了生命周期或者被设置为一个新值时，对象实例的引用计数器减1。任何引用计数器为0的对象实例可以被当作垃圾收集。当一个对象实例被垃圾收集时，它引用的任何对象实例的引用计数器减1。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.jayfeng.com/images/gc_recycled_object.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<h3 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h3><ul>
<li>优点: 简单，高效<br>引用计数收集器可以很快的执行，交织在程序运行中。对程序需要不被长时间打断的实时环境比较有利。</li>
<li>缺点: 无法检测出循环引用<br> 如父对象有一个对子对象的引用，子对象反过来引用父对象。这样，他们的引用计数永远不可能为0.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        MyObject object1 = <span class="keyword">new</span> MyObject();</div><div class="line">        MyObject object2 = <span class="keyword">new</span> MyObject();</div><div class="line">         </div><div class="line">        object1.object = object2;</div><div class="line">        object2.object = object1;</div><div class="line">         </div><div class="line">        object1 = <span class="keyword">null</span>;</div><div class="line">        object2 = <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最后面两句将object1和object2赋值为null，也就是说object1和object2指向的对象已经不可能再被访问，但是由于它们互相引用对方，导致它们的引用计数器都不为0，那么垃圾收集器就永远不会回收它们。</p>
<h2 id="可达性分析算法（根搜索算法）"><a href="#可达性分析算法（根搜索算法）" class="headerlink" title="可达性分析算法（根搜索算法）"></a>可达性分析算法（根搜索算法）</h2><h3 id="算法分析-1"><a href="#算法分析-1" class="headerlink" title="算法分析"></a>算法分析</h3><p>根搜索算法是从离散数学中的图论引入的，程序把所有的引用关系看作一张图，从一个节点GC ROOT开始，寻找对应的引用节点，找到这个节点以后，继续寻找这个节点的引用节点，当所有的引用节点寻找完毕之后，剩余的节点则被认为是没有被引用到的节点，即无用的节点。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://images0.cnblogs.com/blog2015/694841/201506/141050566294022.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>java中可作为GC Root的对象有:</p>
<ul>
<li>虚拟机栈中引用的对象（本地变量表）</li>
<li>方法区中静态属性引用的对象</li>
<li>方法区中常量引用的对象</li>
<li>本地方法栈中引用的对象（Native对象）</li>
</ul>
<h3 id="优缺点-1"><a href="#优缺点-1" class="headerlink" title="优缺点"></a>优缺点</h3><ul>
<li>优点:<br>  解决循环引用问题</li>
<li>缺点:</li>
</ul>
<h1 id="Stop-The-World"><a href="#Stop-The-World" class="headerlink" title="Stop The World"></a>Stop The World</h1><p>在学习GC前，你应该知道一个技术名词:这个词是“stop-the-world。“ 无论你选择哪种GC算法，Stop-the-world都会发生。Stop-the-world意味着JVM停止应用程序，而去进行垃圾回收。当stop-the-world发生时，除了进行垃圾回收的线程，其他所有线程都将停止运行。被中断的任务将在GC任务完成后恢复执行。GC调优往往意味着减少stop-the-world的时间.  </p>
<p>垃圾回收的时候，需要整个的引用状态保持不变，否则判定是判定垃圾，等我稍后回收的时候它又被引用了，这就全乱套了。所以，GC的时候，其他所有的程序执行处于暂停状态，卡住了。  </p>
<p>幸运的是，这个卡顿是非常短（尤其是新生代），对程序的影响微乎其微 （关于其他GC比如并发GC之类的，在此不讨论）。<br>所以GC的卡顿问题由此而来，也是情有可原，暂时无可避免。</p>
<h1 id="垃圾回收算法"><a href="#垃圾回收算法" class="headerlink" title="垃圾回收算法"></a>垃圾回收算法</h1><h2 id="标记清除算法-Mark-Sweep"><a href="#标记清除算法-Mark-Sweep" class="headerlink" title="标记清除算法 (Mark-Sweep)"></a>标记清除算法 (Mark-Sweep)</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>分为两个阶段: 标记阶段(Mark) 和清除阶段(Sweep):</p>
<ul>
<li>标记阶段:<br>  collector从mutator根对象开始进行遍历，对从mutator根对象可以访问到的对象都打上一个标识，一般是在对象的header中，将其记录为可达对象。</li>
<li>清除阶段:<br>  collector对堆内存(heap memory)从头到尾进行线性的遍历，如果发现某个对象没有标记为可达对象-通过读取对象的header信息，则就将其回收。</li>
</ul>
<blockquote>
<p>collector指的就是垃圾收集器，而mutator是指除了垃圾收集器之外的部分，比如说我们应用程序本身。mutator的职责一般是NEW(分配内存),READ(从内存中读取内容),WRITE(将内容写入内存)，而collector则就是回收不再使用的内存来供mutator进行NEW操作的使用。<br>mutator根对象一般指的是分配在堆内存之外，可以直接被mutator直接访问到的对象，一般是指静态/全局变量以及Thread-Local变量<br>可达对象的定义，从mutator根对象开始进行遍历，可以被访问到的对象都称为是可达对象。这些对象也是mutator(你的应用程序)正在使用的对象。</p>
</blockquote>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.processon.com/chart_image/530043e10cf2a3dc99dd9439.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<h3 id="优缺点-2"><a href="#优缺点-2" class="headerlink" title="优缺点"></a>优缺点</h3><ul>
<li>优点:简单,容易实现</li>
<li>缺点:容易产生内存碎片，碎片太多可能会导致后续过程中需要为大对象分配空间时无法找到足够的空间而提前触发新的一次垃圾收集动作。</li>
</ul>
<h2 id="复制算法-Copying"><a href="#复制算法-Copying" class="headerlink" title="复制算法 (Copying)"></a>复制算法 (Copying)</h2><h3 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h3><p>复制算法将内存划分为两个区间,活动区和空闲区，在任意时间点，所有动态分配的对象都只能分配在活动区<br>当有效内存空间耗尽时，JVM将暂停程序运行，开启复制算法GC线程。接下来GC线程会将活动区间内的存活对象，全部复制到空闲区间，且严格按照内存地址依次排列，与此同时，GC线程将更新存活对象的内存引用地址指向新的内存地址。<br>此时，空闲区间已经与活动区间交换，而垃圾对象现在已经全部留在了原来的活动区间，也就是现在的空闲区间。事实上，在活动区间转换为空间区间的同时，垃圾对象已经被一次性全部回收。</p>
<p>清理前:<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://images.cnitblog.com/blog/558323/201308/20004315-b6d8b69879b94b518e98b5854b12f0f1.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure></p>
<p>清理后:<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://images.cnitblog.com/blog/558323/201308/20004628-0ff08e1b8cd04e448703b01f0461e266.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure></p>
<blockquote>
<p>通俗的讲,就是:<br>    复制算法将可用内存按容量划分为大小相等的两块，每次只使用其中的一块。当这一块的内存用完了，就将还存活着的对象复制到另外一块上面，然后再把已使用的内存空间一次清理掉，这样一来就不容易出现内存碎片的问题。</p>
</blockquote>
<p><img src="http://jayfeng.com/images/gc_copying.png" alt=""></p>
<h3 id="优缺点-3"><a href="#优缺点-3" class="headerlink" title="优缺点"></a>优缺点</h3><ul>
<li>优点:实现简单，运行高效且不容易产生内存碎片</li>
<li>缺点:浪费内存</li>
</ul>
<h2 id="标记整理算法-Mark-Compact"><a href="#标记整理算法-Mark-Compact" class="headerlink" title="标记整理算法 (Mark-Compact)"></a>标记整理算法 (Mark-Compact)</h2><h3 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h3><p>分为两个阶段: 标记阶段(Mark) 和整理阶段(Compact)</p>
<ul>
<li>标记阶段: 与标记/清除算法是一模一样</li>
<li>整理阶段: 移动所有存活的对象，且按照内存地址次序依次排列，然后将末端内存地址以后的内存全部回收。</li>
</ul>
<p>标记-整理算法采用标记-清除算法一样的方式进行对象的标记，但在清除时不同，在回收不存活的对象占用的空间后，会将所有的存活对象往左端空闲空间移动，并更新对应的指针。标记-整理算法是在标记-清除算法的基础上，又进行了对象的移动，因此成本更高，但是却解决了内存碎片的问题。</p>
<h3 id="优缺点-4"><a href="#优缺点-4" class="headerlink" title="优缺点"></a>优缺点</h3><ul>
<li>优点: 标记/整理算法不仅可以弥补标记/清除算法当中，内存区域分散的缺点，也消除了复制算法当中，内存减半的高额代价</li>
<li>缺点: 低效</li>
</ul>
<h2 id="分代回收算法-Generational-Collector"><a href="#分代回收算法-Generational-Collector" class="headerlink" title="分代回收算法(Generational Collector)"></a>分代回收算法(Generational Collector)</h2><p>分代回收算法其实不算一种新的算法，而是根据复制算法和标记整理算法的的特点综合而成。这种综合是考虑到java的语言特性的。<br>这里重复一下两种老算法的适用场景：</p>
<ul>
<li>复制算法：适用于存活对象很少。回收对象多</li>
<li><p>适用用于存活对象多，回收对象少</p>
<p>复习下面这个图:</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.jayfeng.com/images/gc_heap.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
</li>
</ul>
<p>解析：</p>
<ul>
<li>堆内存分为两大部分：新生代和老年代。比例为1：2。</li>
<li>新生代又分为三个部分：一个Eden区和两个Survivor区，比例为8：1：1。</li>
<li>Eden区存放新生的对象。new</li>
<li>Survivor存放每次垃圾回收后存活的对象。</li>
<li>老年代主要存放应用程序中生命周期长的存活对象。</li>
</ul>
<h3 id="原理-过程"><a href="#原理-过程" class="headerlink" title="原理(过程)"></a>原理(过程)</h3><p>所有新生成的对象首先都是放在年轻代的。年轻代的目标就是尽可能快速的收集掉那些生命周期短的对象。</p>
<ul>
<li>分配对象时，保存在Eden区</li>
<li>Eden区满，触发GC(Minor GC), 将Eden区存活对象复制到一个survivor0区，然后清空Eden区</li>
<li>当这个survivor0区也存放满了时，则将eden区和survivor0区存活对象复制到另一个survivor1区，然后清空eden和这个survivor0区</li>
<li>此时survivor0区是空的，然后将survivor0区和survivor1区交换，即保持survivor1区为空， 如此往复</li>
<li>当survivor1区不足以存放 eden和survivor0的存活对象时，就将存活对象直接存放到老年代。若是老年代也满了就会触发一次Full GC，也就是新生代、老年代都进行回收</li>
</ul>
<h3 id="年轻代-年老代-持久代"><a href="#年轻代-年老代-持久代" class="headerlink" title="年轻代 年老代 持久代"></a>年轻代 年老代 持久代</h3><ul>
<li>年轻代(Young Generation)：<br>  所有新生成的对象首先都是放在年轻代的。年轻代的目标就是尽可能快速的收集掉那些生命周期短的对象。<br>  新生代发生的GC也叫做Minor GC，MinorGC发生频率比较高(不一定等Eden区满了才触发)</li>
<li>年老代(Old Generation)：<br>  年老代中存放的都是一些生命周期较长的对象。<br>  老年代内存满时触发Major GC即Full GC，Full GC发生频率比较低，老年代对象存活时间比较长，存活率标记高。</li>
<li>持久代(Permanent Generation)：<br>  用于存放静态文件，如Java类、方法等。持久代对垃圾回收没有显著影响，但是有些应用可能动态生成或者调用一些class，例如Hibernate 等，在这种时候需要设置一个比较大的持久代空间来存放这些运行过程中新增的类。</li>
</ul>
<h1 id="深入理解分代回收算法"><a href="#深入理解分代回收算法" class="headerlink" title="深入理解分代回收算法"></a>深入理解分代回收算法</h1><h2 id="为什么不是一块Survivor空间而是两块？"><a href="#为什么不是一块Survivor空间而是两块？" class="headerlink" title="为什么不是一块Survivor空间而是两块？"></a>为什么不是一块Survivor空间而是两块？</h2><p>这里涉及到一个新生代和老年代的存活周期的问题，比如一个对象在新生代经历15次（仅供参考）GC，就可以移到老年代了。问题来了，当我们第一次GC的时候，我们可以把Eden区的存活对象放到Survivor A空间，但是第二次GC的时候，Survivor A空间的存活对象也需要再次用Copying算法，放到Survivor B空间上，而把刚刚的Survivor A空间和Eden空间清除。第三次GC时，又把Survivor B空间的存活对象复制到Survivor A空间，如此反复。<br>所以，这里就需要两块Survivor空间来回倒腾</p>
<h2 id="为什么Eden空间这么大而Survivor空间要分的少一点？"><a href="#为什么Eden空间这么大而Survivor空间要分的少一点？" class="headerlink" title="为什么Eden空间这么大而Survivor空间要分的少一点？"></a>为什么Eden空间这么大而Survivor空间要分的少一点？</h2><p>新创建的对象都是放在Eden空间，这是很频繁的，尤其是大量的局部变量产生的临时对象，这些对象绝大部分都应该马上被回收，能存活下来被转移到survivor空间的往往不多。所以，设置较大的Eden空间和较小的Survivor空间是合理的，大大提高了内存的使用率，缓解了Copying算法的缺点。<br>我看8：1：1就挺好的，当然这个比例是可以调整的，包括上面的新生代和老年代的1：2的比例也是可以调整的。<br>新的问题又来了，从Eden空间往Survivor空间转移的时候Survivor空间不够了怎么办？直接放到老年代去</p>
<h1 id="垃圾收集器"><a href="#垃圾收集器" class="headerlink" title="垃圾收集器"></a>垃圾收集器</h1><ul>
<li>新生代收集器使用的收集器：Serial、PraNew、Parallel Scavenge</li>
<li>老年代收集器使用的收集器：Serial Old、Parallel Old、CMS</li>
</ul>
<p><img src="http://images0.cnblogs.com/blog2015/694841/201506/141513122384006.jpg" alt=""></p>
<h2 id="Serial收集器（复制算法"><a href="#Serial收集器（复制算法" class="headerlink" title="Serial收集器（复制算法)"></a>Serial收集器（复制算法)</h2><p>　　新生代单线程收集器，标记和清理都是单线程，优点是简单高效。</p>
<h2 id="Serial-Old收集器-标记-整理算法"><a href="#Serial-Old收集器-标记-整理算法" class="headerlink" title="Serial Old收集器(标记-整理算法)"></a>Serial Old收集器(标记-整理算法)</h2><p>　　老年代单线程收集器，Serial收集器的老年代版本。</p>
<h2 id="ParNew收集器-停止-复制算法"><a href="#ParNew收集器-停止-复制算法" class="headerlink" title="ParNew收集器(停止-复制算法)　"></a>ParNew收集器(停止-复制算法)　</h2><p>　　新生代收集器，可以认为是Serial收集器的多线程版本,在多核CPU环境下有着比Serial更好的表现。<br>Parallel Scavenge收集器(停止-复制算法)<br>并行收集器，追求高吞吐量，高效利用CPU。吞吐量一般为99%， 吞吐量= 用户线程时间/(用户线程时间+GC线程时间)。适合后台应用等对交互相应要求不高的场景。</p>
<h2 id="Parallel-Old收集器-停止-复制算法"><a href="#Parallel-Old收集器-停止-复制算法" class="headerlink" title="Parallel Old收集器(停止-复制算法)"></a>Parallel Old收集器(停止-复制算法)</h2><p>　　Parallel Scavenge收集器的老年代版本，并行收集器，吞吐量优先</p>
<h2 id="CMS-Concurrent-Mark-Sweep-收集器（标记-清理算法）"><a href="#CMS-Concurrent-Mark-Sweep-收集器（标记-清理算法）" class="headerlink" title="CMS(Concurrent Mark Sweep)收集器（标记-清理算法）"></a>CMS(Concurrent Mark Sweep)收集器（标记-清理算法）</h2><p>　　高并发、低停顿，追求最短GC回收停顿时间，cpu占用比较高，响应时间快，停顿时间短，多核cpu 追求高响应时间的选择</p>
<h1 id="GC的执行机制"><a href="#GC的执行机制" class="headerlink" title="GC的执行机制"></a>GC的执行机制</h1><h2 id="Scavenge-GC-Minor-GC"><a href="#Scavenge-GC-Minor-GC" class="headerlink" title="Scavenge GC(Minor GC)"></a>Scavenge GC(Minor GC)</h2><p>一般情况下，当新对象生成，并且在Eden申请空间失败时，就会触发Scavenge GC，对Eden区域进行GC，清除非存活对象，并且把尚且存活的对象移动到Survivor区。然后整理Survivor的两个区。这种方式的GC是对年轻代的Eden区进行，不会影响到年老代。因为大部分对象都是从Eden区开始的，同时Eden区不会分配的很大，所以Eden区的GC会频繁进行。因而，一般在这里需要使用速度快、效率高的算法，使Eden去能尽快空闲出来。</p>
<h2 id="Full-GC"><a href="#Full-GC" class="headerlink" title="Full GC"></a>Full GC</h2><p>对整个堆进行整理，包括Young、Tenured和Perm。Full GC因为需要对整个堆进行回收，所以比Scavenge GC要慢，因此应该尽可能减少Full GC的次数。在对JVM调优的过程中，很大一部分工作就是对于FullGC的调节。有如下原因可能导致Full GC：</p>
<ul>
<li>年老代（Tenured）被写满</li>
<li>持久代（Perm）被写满 </li>
<li>System.gc()被显示调用 </li>
<li>上一次GC之后Heap的各域分配策略动态变化</li>
</ul>
<blockquote>
<p>参考:</p>
<p><a href="http://www.cnblogs.com/sunniest/p/4575144.html" target="_blank" rel="external">深入理解java垃圾回收机制</a><br><a href="http://jayfeng.com/2016/03/11/%E7%90%86%E8%A7%A3Java%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/" target="_blank" rel="external">理解Java垃圾回收机制</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;垃圾回收机制的意义&quot;&gt;&lt;a href=&quot;#垃圾回收机制的意义&quot; class=&quot;headerlink&quot; title=&quot;垃圾回收机制的意义&quot;&gt;&lt;/a&gt;垃圾回收机制的意义&lt;/h1&gt;&lt;p&gt;Java语言中一个显著的特点就是引入了垃圾回收机制，使c++程序员最头疼的内存管理的
    
    </summary>
    
      <category term="Java" scheme="https://devallever.github.io/categories/Java/"/>
    
    
      <category term="Java" scheme="https://devallever.github.io/tags/Java/"/>
    
      <category term="GC" scheme="https://devallever.github.io/tags/GC/"/>
    
  </entry>
  
  <entry>
    <title>Adapter中的观察者模式</title>
    <link href="https://devallever.github.io/2017/06/02/observer-adapter/"/>
    <id>https://devallever.github.io/2017/06/02/observer-adapter/</id>
    <published>2017-06-02T01:02:15.000Z</published>
    <updated>2017-06-02T02:01:03.218Z</updated>
    
    <content type="html"><![CDATA[<p>当我们调用Adapter.notifyDataSetChanged()时候, 会调用被观察者的()方法，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseAdapter</span> <span class="keyword">implements</span> <span class="title">ListAdapter</span>, <span class="title">SpinnerAdapter</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="comment">//数据集被观察者</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DataSetObservable mDataSetObservable = <span class="keyword">new</span> DataSetObservable();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasStableIds</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerDataSetObserver</span><span class="params">(DataSetObserver observer)</span> </span>&#123;</div><div class="line">        mDataSetObservable.registerObserver(observer);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unregisterDataSetObserver</span><span class="params">(DataSetObserver observer)</span> </span>&#123;</div><div class="line">        mDataSetObservable.unregisterObserver(observer);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">        <span class="comment">/**</span></div><div class="line">     * Notifies the attached observers that the underlying data has been changed</div><div class="line">     * and any View reflecting the data set should refresh itself.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyDataSetChanged</span><span class="params">()</span> </span>&#123;</div><div class="line">    	<span class="comment">//通知观察者更新</span></div><div class="line">        mDataSetObservable.notifyChanged();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>//</p>
<p>在DataSetObservable.notifyChanged()方法中，遍历每个观察者，并调用观察者的onChanged()方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSetObservable</span> <span class="keyword">extends</span> <span class="title">Observable</span>&lt;<span class="title">DataSetObserver</span>&gt; </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Invokes &#123;<span class="doctag">@link</span> DataSetObserver#onChanged&#125; on each observer.</div><div class="line">     * Called when the contents of the data set have changed.  The recipient</div><div class="line">     * will obtain the new contents the next time it queries the data set.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyChanged</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">synchronized</span>(mObservers) &#123;</div><div class="line">            <span class="comment">// since onChanged() is implemented by the app, it could do anything, including</span></div><div class="line">            <span class="comment">// removing itself from &#123;@link mObservers&#125; - and that could cause problems if</span></div><div class="line">            <span class="comment">// an iterator is used on the ArrayList &#123;@link mObservers&#125;.</span></div><div class="line">            <span class="comment">// to avoid such problems, just march thru the list in the reverse order.</span></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = mObservers.size() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</div><div class="line">                mObservers.get(i).onChanged();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>//<br>这些观察者从哪里来的，又是什么时候绑定到DataSetObservable中的?<br>查看ListView的setAdapter()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">/**</span></div><div class="line">   * Sets the data behind this ListView.</div><div class="line">   *</div><div class="line">   * The adapter passed to this method may be wrapped by a &#123;<span class="doctag">@link</span> WrapperListAdapter&#125;,</div><div class="line">   * depending on the ListView features currently in use. For instance, adding</div><div class="line">   * headers and/or footers will cause the adapter to be wrapped.</div><div class="line">   *</div><div class="line">   * <span class="doctag">@param</span> adapter The ListAdapter which is responsible for maintaining the</div><div class="line">   *        data backing this list and for producing a view to represent an</div><div class="line">   *        item in that data set.</div><div class="line">   *</div><div class="line">   * <span class="doctag">@see</span> #getAdapter() </div><div class="line">   */</div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAdapter</span><span class="params">(ListAdapter adapter)</span> </span>&#123;</div><div class="line">   <span class="comment">//如果已存在adapter先注销原来Adapter对应的观察者</span></div><div class="line">      <span class="keyword">if</span> (mAdapter != <span class="keyword">null</span> &amp;&amp; mDataSetObserver != <span class="keyword">null</span>) &#123;</div><div class="line">          mAdapter.unregisterDataSetObserver(mDataSetObserver);</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      resetList();</div><div class="line">      mRecycler.clear();</div><div class="line"></div><div class="line">      <span class="keyword">if</span> (mHeaderViewInfos.size() &gt; <span class="number">0</span>|| mFooterViewInfos.size() &gt; <span class="number">0</span>) &#123;</div><div class="line">          mAdapter = wrapHeaderListAdapterInternal(mHeaderViewInfos, mFooterViewInfos, adapter);</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">          mAdapter = adapter;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      mOldSelectedPosition = INVALID_POSITION;</div><div class="line">      mOldSelectedRowId = INVALID_ROW_ID;</div><div class="line"></div><div class="line">      <span class="comment">// AbsListView#setAdapter will update choice mode states.</span></div><div class="line">      <span class="keyword">super</span>.setAdapter(adapter);</div><div class="line"></div><div class="line">      <span class="keyword">if</span> (mAdapter != <span class="keyword">null</span>) &#123;</div><div class="line">          mAreAllItemsSelectable = mAdapter.areAllItemsEnabled();</div><div class="line">          mOldItemCount = mItemCount;</div><div class="line">          mItemCount = mAdapter.getCount();</div><div class="line">          checkFocus();</div><div class="line"></div><div class="line"><span class="comment">//创建一个数据集观察者</span></div><div class="line">          mDataSetObserver = <span class="keyword">new</span> AdapterDataSetObserver();</div><div class="line">          </div><div class="line">          	<span class="comment">//注册观察者</span></div><div class="line">          mAdapter.registerDataSetObserver(mDataSetObserver);</div><div class="line"></div><div class="line">          mRecycler.setViewTypeCount(mAdapter.getViewTypeCount());</div><div class="line"></div><div class="line">          <span class="keyword">int</span> position;</div><div class="line">          <span class="keyword">if</span> (mStackFromBottom) &#123;</div><div class="line">              position = lookForSelectablePosition(mItemCount - <span class="number">1</span>, <span class="keyword">false</span>);</div><div class="line">          &#125; <span class="keyword">else</span> &#123;</div><div class="line">              position = lookForSelectablePosition(<span class="number">0</span>, <span class="keyword">true</span>);</div><div class="line">          &#125;</div><div class="line">          setSelectedPositionInt(position);</div><div class="line">          setNextSelectedPositionInt(position);</div><div class="line"></div><div class="line">          <span class="keyword">if</span> (mItemCount == <span class="number">0</span>) &#123;</div><div class="line">              <span class="comment">// Nothing selected</span></div><div class="line">              checkSelectionChanged();</div><div class="line">          &#125;</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">          mAreAllItemsSelectable = <span class="keyword">true</span>;</div><div class="line">          checkFocus();</div><div class="line">          <span class="comment">// Nothing selected</span></div><div class="line">          checkSelectionChanged();</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      requestLayout();</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>///<br>AdapterDataSetObserver是AbsListView中定义的内部类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AdapterDataSetObserver</span> <span class="keyword">extends</span> <span class="title">AdapterView</span>&lt;<span class="title">ListAdapter</span>&gt;.<span class="title">AdapterDataSetObserver</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChanged</span><span class="params">()</span> </span>&#123;</div><div class="line">    	<span class="comment">//调用父类的onChange()方法。</span></div><div class="line">        <span class="keyword">super</span>.onChanged();</div><div class="line">        <span class="keyword">if</span> (mFastScroll != <span class="keyword">null</span>) &#123;</div><div class="line">            mFastScroll.onSectionsChanged();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onInvalidated</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onInvalidated();</div><div class="line">        <span class="keyword">if</span> (mFastScroll != <span class="keyword">null</span>) &#123;</div><div class="line">            mFastScroll.onSectionsChanged();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>而它又继承AdapterView的AdapterDataSetObserver<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">  <span class="class"><span class="keyword">class</span> <span class="title">AdapterDataSetObserver</span> <span class="keyword">extends</span> <span class="title">DataSetObserver</span> </span>&#123;</div><div class="line"></div><div class="line">      <span class="keyword">private</span> Parcelable mInstanceState = <span class="keyword">null</span>;</div><div class="line"></div><div class="line"><span class="comment">//最终调用</span></div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChanged</span><span class="params">()</span> </span>&#123;</div><div class="line">          mDataChanged = <span class="keyword">true</span>;</div><div class="line">          mOldItemCount = mItemCount;</div><div class="line">          mItemCount = getAdapter().getCount();</div><div class="line"></div><div class="line">          <span class="comment">// Detect the case where a cursor that was previously invalidated has</span></div><div class="line">          <span class="comment">// been repopulated with new data.</span></div><div class="line">          <span class="keyword">if</span> (AdapterView.<span class="keyword">this</span>.getAdapter().hasStableIds() &amp;&amp; mInstanceState != <span class="keyword">null</span></div><div class="line">                  &amp;&amp; mOldItemCount == <span class="number">0</span> &amp;&amp; mItemCount &gt; <span class="number">0</span>) &#123;</div><div class="line">              AdapterView.<span class="keyword">this</span>.onRestoreInstanceState(mInstanceState);</div><div class="line">              mInstanceState = <span class="keyword">null</span>;</div><div class="line">          &#125; <span class="keyword">else</span> &#123;</div><div class="line">              rememberSyncState();</div><div class="line">          &#125;</div><div class="line">          checkFocus();</div><div class="line">          requestLayout();</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onInvalidated</span><span class="params">()</span> </span>&#123;</div><div class="line">          mDataChanged = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">          <span class="keyword">if</span> (AdapterView.<span class="keyword">this</span>.getAdapter().hasStableIds()) &#123;</div><div class="line">              <span class="comment">// Remember the current state for the case where our hosting activity is being</span></div><div class="line">              <span class="comment">// stopped and later restarted</span></div><div class="line">              mInstanceState = AdapterView.<span class="keyword">this</span>.onSaveInstanceState();</div><div class="line">          &#125;</div><div class="line"></div><div class="line">          <span class="comment">// Data is invalid so we should reset our state</span></div><div class="line">          mOldItemCount = mItemCount;</div><div class="line">          mItemCount = <span class="number">0</span>;</div><div class="line">          mSelectedPosition = INVALID_POSITION;</div><div class="line">          mSelectedRowId = INVALID_ROW_ID;</div><div class="line">          mNextSelectedPosition = INVALID_POSITION;</div><div class="line">          mNextSelectedRowId = INVALID_ROW_ID;</div><div class="line">          mNeedSync = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">          checkFocus();</div><div class="line">          requestLayout();</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearSavedState</span><span class="params">()</span> </span>&#123;</div><div class="line">          mInstanceState = <span class="keyword">null</span>;</div><div class="line">      &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>我们只关注onChanged()方法<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChanged</span><span class="params">()</span> </span>&#123;</div><div class="line">    mDataChanged = <span class="keyword">true</span>;</div><div class="line">    mOldItemCount = mItemCount;</div><div class="line">    mItemCount = getAdapter().getCount();</div><div class="line"></div><div class="line">    <span class="comment">// Detect the case where a cursor that was previously invalidated has</span></div><div class="line">    <span class="comment">// been repopulated with new data.</span></div><div class="line">    <span class="keyword">if</span> (AdapterView.<span class="keyword">this</span>.getAdapter().hasStableIds() &amp;&amp; mInstanceState != <span class="keyword">null</span></div><div class="line">            &amp;&amp; mOldItemCount == <span class="number">0</span> &amp;&amp; mItemCount &gt; <span class="number">0</span>) &#123;</div><div class="line">        AdapterView.<span class="keyword">this</span>.onRestoreInstanceState(mInstanceState);</div><div class="line">        mInstanceState = <span class="keyword">null</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        rememberSyncState();</div><div class="line">    &#125;</div><div class="line">    checkFocus();</div><div class="line">    requestLayout();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>它会调用requestLayout()方法进行重新布局，从而刷新listvew(GridView ， AdapterView)界面</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;当我们调用Adapter.notifyDataSetChanged()时候, 会调用被观察者的()方法，&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;li
    
    </summary>
    
      <category term="设计模式" scheme="https://devallever.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="Android" scheme="https://devallever.github.io/tags/Android/"/>
    
      <category term="设计模式" scheme="https://devallever.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="观察者模式" scheme="https://devallever.github.io/tags/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>设计模式(四) 抽象工厂模式</title>
    <link href="https://devallever.github.io/2017/05/25/abstract-factory-patterns/"/>
    <id>https://devallever.github.io/2017/05/25/abstract-factory-patterns/</id>
    <published>2017-05-25T01:03:48.000Z</published>
    <updated>2017-05-25T01:55:13.783Z</updated>
    
    <content type="html"><![CDATA[<h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><h1 id="UML类图"><a href="#UML类图" class="headerlink" title="UML类图"></a>UML类图</h1><h1 id="简单实现"><a href="#简单实现" class="headerlink" title="简单实现"></a>简单实现</h1><h2 id="最基本的数据访问程序"><a href="#最基本的数据访问程序" class="headerlink" title="最基本的数据访问程序"></a>最基本的数据访问程序</h2><h3 id="User表"><a href="#User表" class="headerlink" title="User表"></a>User表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">public class User &#123;</div><div class="line">    private int id;</div><div class="line">    private String name;</div><div class="line"></div><div class="line">    public int getId() &#123;</div><div class="line">        return id;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setId(int id) &#123;</div><div class="line">        this.id = id;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public String getName() &#123;</div><div class="line">        return name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setName(String name) &#123;</div><div class="line">        this.name = name;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="SqlServerUser类"><a href="#SqlServerUser类" class="headerlink" title="SqlServerUser类"></a>SqlServerUser类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public class SqlServerUser &#123;</div><div class="line">    private static final String TAG = &quot;SqlServerUser&quot;;</div><div class="line">    public void insertUser(User user)&#123;</div><div class="line">        Log.d(TAG, &quot;insert: 在SQL Server中录入一个用户记录&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public User getUser(int id)&#123;</div><div class="line">        Log.d(TAG, &quot;getUser: 在SQL Server中获取一个用户记录&quot;);</div><div class="line">        return null;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="客户端调用"><a href="#客户端调用" class="headerlink" title="客户端调用"></a>客户端调用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">User user = <span class="keyword">new</span> User();</div><div class="line">user.setId(<span class="number">1</span>);</div><div class="line">user.setName(<span class="string">"Allever"</span>);</div><div class="line">SqlServerUser sqlServerUser = <span class="keyword">new</span> SqlServerUser();</div><div class="line">sqlServerUser.insertUser(user);</div><div class="line">sqlServerUser.getUser(<span class="number">1</span>);</div></pre></td></tr></table></figure>
<p>如果换为MySQL数据库改动就很多</p>
<h2 id="使用工厂方法改进"><a href="#使用工厂方法改进" class="headerlink" title="使用工厂方法改进"></a>使用工厂方法改进</h2><h3 id="IUser接口"><a href="#IUser接口" class="headerlink" title="IUser接口"></a>IUser接口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public interface IUser &#123;</div><div class="line">    void insertUser(User user);</div><div class="line">    User getUser(int id);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="SqlServerUser类-1"><a href="#SqlServerUser类-1" class="headerlink" title="SqlServerUser类"></a>SqlServerUser类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">public class SqlServerUser implements IUser &#123;</div><div class="line"></div><div class="line">    private static final String TAG = &quot;SqlServerUser&quot;;</div><div class="line">    @Override</div><div class="line">    public void insertUser(User user)&#123;</div><div class="line">        Log.d(TAG, &quot;insert: 在SQL Server中录入一个用户记录&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public User getUser(int id)&#123;</div><div class="line">        Log.d(TAG, &quot;getUser: 在SQL Server中获取一个用户记录&quot;);</div><div class="line">        return null;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="MySQLUser类"><a href="#MySQLUser类" class="headerlink" title="MySQLUser类"></a>MySQLUser类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public class MySQLUser implements IUser &#123;</div><div class="line">    private static final String TAG = &quot;MySQLUser&quot;;</div><div class="line">    @Override</div><div class="line">    public void insertUser(User user)&#123;</div><div class="line">        Log.d(TAG, &quot;insert: 在MySQL Server中录入一个用户记录&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public User getUser(int id)&#123;</div><div class="line">        Log.d(TAG, &quot;getUser: 在MySQL Server中获取一个用户记录&quot;);</div><div class="line">        return null;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="IFactory抽象工厂接口"><a href="#IFactory抽象工厂接口" class="headerlink" title="IFactory抽象工厂接口"></a>IFactory抽象工厂接口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public interface IFactory &#123;</div><div class="line">    IUser createUser();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="SqlServerFactory具体工厂类"><a href="#SqlServerFactory具体工厂类" class="headerlink" title="SqlServerFactory具体工厂类"></a>SqlServerFactory具体工厂类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public class SqlServerFactory implements IFactory &#123;</div><div class="line">    @Override</div><div class="line">    public IUser createUser() &#123;</div><div class="line">        return new SqlServerUser();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="MySQLServerFactory具体工厂"><a href="#MySQLServerFactory具体工厂" class="headerlink" title="MySQLServerFactory具体工厂"></a>MySQLServerFactory具体工厂</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public class MySQLServerFactory implements IFactory &#123;</div><div class="line">    @Override</div><div class="line">    public IUser createUser() &#123;</div><div class="line">        return new MySQLUser();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="客户端调用-1"><a href="#客户端调用-1" class="headerlink" title="客户端调用"></a>客户端调用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">User user = new User();</div><div class="line">user.setId(1);</div><div class="line">user.setName(&quot;Allever&quot;);</div><div class="line"></div><div class="line">IFactory factory = new SqlServerFactory();</div><div class="line">IUser iUser = factory.createUser();</div><div class="line">iUser.insertUser(user);</div><div class="line">iUser.getUser(1);</div></pre></td></tr></table></figure>
<p>如果改为MySQL数据库，这改动这里<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">IFactory factory = new MySQLServerFactory();</div></pre></td></tr></table></figure></p>
<h2 id="使用抽象工厂"><a href="#使用抽象工厂" class="headerlink" title="使用抽象工厂"></a>使用抽象工厂</h2><h3 id="新增Department表"><a href="#新增Department表" class="headerlink" title="新增Department表"></a>新增Department表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">public class Department &#123;</div><div class="line">    private int id;</div><div class="line">    private String deptName;</div><div class="line"></div><div class="line">    public int getId() &#123;</div><div class="line">        return id;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setId(int id) &#123;</div><div class="line">        this.id = id;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public String getDeptName() &#123;</div><div class="line">        return deptName;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setDeptName(String deptName) &#123;</div><div class="line">        this.deptName = deptName;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="新增IDepartment接口"><a href="#新增IDepartment接口" class="headerlink" title="新增IDepartment接口"></a>新增IDepartment接口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public interface IDepartment &#123;</div><div class="line">    void insertDepartment(Department department);</div><div class="line">    Department getDepartment(int id);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="新增SqlServerDepartment类"><a href="#新增SqlServerDepartment类" class="headerlink" title="新增SqlServerDepartment类"></a>新增SqlServerDepartment类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public class SqlServerDepartment implements IDepartment &#123;</div><div class="line">    private static final String TAG = &quot;SqlServerDepartment&quot;;</div><div class="line">    @Override</div><div class="line">    public void insertDepartment(Department department) &#123;</div><div class="line">        Log.d(TAG, &quot;insertDepartment: 在Sql Server 中插入Department&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public Department getDepartment(int id) &#123;</div><div class="line">        Log.d(TAG, &quot;insertDepartment: 在Sql Server 中获取Department&quot;);</div><div class="line">        return null;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="新增MySQLDepartment类"><a href="#新增MySQLDepartment类" class="headerlink" title="新增MySQLDepartment类"></a>新增MySQLDepartment类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public class MySQLDepartment implements IDepartment &#123;</div><div class="line">    private static final String TAG = &quot;MySQLDepartment&quot;;</div><div class="line">    @Override</div><div class="line">    public void insertDepartment(Department department) &#123;</div><div class="line">        Log.d(TAG, &quot;insertDepartment: 在MySQL 中插入Department&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public Department getDepartment(int id) &#123;</div><div class="line">        Log.d(TAG, &quot;insertDepartment: 在MySQL 中获取Department&quot;);</div><div class="line">        return null;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="修改IFactory接口"><a href="#修改IFactory接口" class="headerlink" title="修改IFactory接口"></a>修改IFactory接口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public interface IFactory &#123;</div><div class="line">    IUser createUser();</div><div class="line">    IDepartment createDepartment();	//新增</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="修改SqlServerFactory类"><a href="#修改SqlServerFactory类" class="headerlink" title="修改SqlServerFactory类"></a>修改SqlServerFactory类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public class SqlServerFactory implements IFactory &#123;</div><div class="line">    @Override</div><div class="line">    public IUser createUser() &#123;</div><div class="line">        return new SqlServerUser();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public IDepartment createDepartment() &#123;</div><div class="line">        return new SqlServerDepartment();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="修改MySQLServerFactory类"><a href="#修改MySQLServerFactory类" class="headerlink" title="修改MySQLServerFactory类"></a>修改MySQLServerFactory类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public class MySQLServerFactory implements IFactory &#123;</div><div class="line">    @Override</div><div class="line">    public IUser createUser() &#123;</div><div class="line">        return new MySQLUser();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public IDepartment createDepartment() &#123;</div><div class="line">        return new MySQLDepartment();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="客户端调用-2"><a href="#客户端调用-2" class="headerlink" title="客户端调用"></a>客户端调用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">User user = new User();</div><div class="line">user.setId(1);</div><div class="line">user.setName(&quot;Allever&quot;);</div><div class="line">Department department = new Department();</div><div class="line">department.setId(1);</div><div class="line">department.setDeptName(&quot;Computer&quot;);</div><div class="line"></div><div class="line">IFactory factory = new MySQLServerFactory();</div><div class="line">IUser iUser = factory.createUser();</div><div class="line">iUser.insertUser(user);</div><div class="line">iUser.getUser(1);</div><div class="line"></div><div class="line">IDepartment iDepartment = factory.createDepartment();</div><div class="line">iDepartment.insertDepartment(department);</div><div class="line">iDepartment.getDepartment(1);</div></pre></td></tr></table></figure>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>只有一个User类和User操作类的时候，只需要工厂方法模式， 但现在数据库中有很多表， 而SQL Server 和 MySQL 又是两大不同的分类， 所以解决这种涉及到多个产品系列的时候，就要用到抽象工厂模式。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;定义&quot;&gt;&lt;a href=&quot;#定义&quot; class=&quot;headerlink&quot; title=&quot;定义&quot;&gt;&lt;/a&gt;定义&lt;/h1&gt;&lt;h1 id=&quot;UML类图&quot;&gt;&lt;a href=&quot;#UML类图&quot; class=&quot;headerlink&quot; title=&quot;UML类图&quot;&gt;&lt;/a&gt;UML类
    
    </summary>
    
      <category term="设计模式" scheme="https://devallever.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="设计模式" scheme="https://devallever.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="抽象工厂" scheme="https://devallever.github.io/tags/%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82/"/>
    
  </entry>
  
  <entry>
    <title>Android动画实例</title>
    <link href="https://devallever.github.io/2017/05/24/animation-demo-1/"/>
    <id>https://devallever.github.io/2017/05/24/animation-demo-1/</id>
    <published>2017-05-24T06:54:12.000Z</published>
    <updated>2017-05-24T07:13:15.040Z</updated>
    
    <content type="html"><![CDATA[<h1 id="灵动菜单"><a href="#灵动菜单" class="headerlink" title="灵动菜单"></a>灵动菜单</h1><h2 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h2><p>把菜单项目放在菜单按钮同一位置, 当点击带单按钮时候, 每个菜单项开始动画, 从原来位置,移动到指定位置  </p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>布局文件:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;&gt;</div><div class="line">    &lt;ImageView</div><div class="line">        android:id=&quot;@+id/id_dynamic_activity_fab_left&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:src=&quot;@mipmap/ic_launcher&quot;</div><div class="line">        android:layout_centerInParent=&quot;true&quot;</div><div class="line">        android:visibility=&quot;visible&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;ImageView</div><div class="line">        android:id=&quot;@+id/id_dynamic_activity_fab_top&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:src=&quot;@mipmap/ic_launcher&quot;</div><div class="line">        android:layout_centerInParent=&quot;true&quot;</div><div class="line">        android:visibility=&quot;visible&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;ImageView</div><div class="line">        android:id=&quot;@+id/id_dynamic_activity_fab_right&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:src=&quot;@mipmap/ic_launcher&quot;</div><div class="line">        android:layout_centerInParent=&quot;true&quot;</div><div class="line">        android:visibility=&quot;visible&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;ImageView</div><div class="line">        android:id=&quot;@+id/id_dynamic_activity_fab_bottom&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:src=&quot;@mipmap/ic_launcher&quot;</div><div class="line">        android:layout_centerInParent=&quot;true&quot;</div><div class="line">        android:visibility=&quot;visible&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;ImageView</div><div class="line">        android:id=&quot;@+id/id_dynamic_activity_fab_main&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:background=&quot;@mipmap/ic_launcher&quot;</div><div class="line">        android:layout_centerInParent=&quot;true&quot;/&gt;</div><div class="line"></div><div class="line">&lt;/RelativeLayout&gt;</div></pre></td></tr></table></figure></p>
<p>展开菜单:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startMenu</span><span class="params">()</span></span>&#123;</div><div class="line">        ObjectAnimator mainAnimator = ObjectAnimator.ofFloat(ivMain,<span class="string">"alpha"</span>,<span class="number">1f</span>,<span class="number">0.5f</span>);</div><div class="line"></div><div class="line">        <span class="keyword">float</span> leftCurrentX = ivLeft.getTranslationX();</div><div class="line">        ObjectAnimator leftAnimator = ObjectAnimator.ofFloat(ivLeft,<span class="string">"translationX"</span>,leftCurrentX,-<span class="number">200f</span>);</div><div class="line"></div><div class="line">        <span class="keyword">float</span> rightCurrentX = ivRight.getTranslationX();</div><div class="line">        ObjectAnimator rightAnimator = ObjectAnimator.ofFloat(ivRight,<span class="string">"translationX"</span>,rightCurrentX,<span class="number">200f</span>);</div><div class="line"></div><div class="line">        <span class="keyword">float</span> topCurrentY = ivTop.getTranslationY();</div><div class="line">        ObjectAnimator topAnimator = ObjectAnimator.ofFloat(ivTop,<span class="string">"translationY"</span>,topCurrentY,-<span class="number">200f</span>);</div><div class="line"></div><div class="line">        <span class="keyword">float</span> bottomCurrentY = ivBottom.getTranslationY();</div><div class="line">        ObjectAnimator bottomAnimator = ObjectAnimator.ofFloat(ivBottom,<span class="string">"translationY"</span>,bottomCurrentY,<span class="number">200f</span>);</div><div class="line"></div><div class="line"></div><div class="line">        AnimatorSet animatorSet = <span class="keyword">new</span> AnimatorSet();</div><div class="line">        animatorSet.playTogether(mainAnimator,leftAnimator,rightAnimator,topAnimator,bottomAnimator);</div><div class="line">        animatorSet.setDuration(<span class="number">500</span>);</div><div class="line">        animatorSet.setInterpolator(<span class="keyword">new</span> BounceInterpolator());</div><div class="line">        animatorSet.start();</div><div class="line"></div><div class="line">        flag = <span class="keyword">false</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>关闭菜单:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">closeMenu</span><span class="params">()</span></span>&#123;</div><div class="line">        ObjectAnimator mainAnimator = ObjectAnimator.ofFloat(ivMain,<span class="string">"alpha"</span>,<span class="number">0.5f</span>,<span class="number">1f</span>);</div><div class="line"></div><div class="line">        <span class="keyword">float</span> leftCurrentX = ivLeft.getTranslationX();</div><div class="line">        ObjectAnimator leftAnimator = ObjectAnimator.ofFloat(ivLeft,<span class="string">"translationX"</span>,leftCurrentX, <span class="number">0f</span>);</div><div class="line"></div><div class="line">        <span class="keyword">float</span> rightCurrentX = ivRight.getTranslationX();</div><div class="line">        ObjectAnimator rightAnimator = ObjectAnimator.ofFloat(ivRight,<span class="string">"translationX"</span>,rightCurrentX,<span class="number">0f</span>);</div><div class="line"></div><div class="line">        <span class="keyword">float</span> topCurrentY = ivTop.getTranslationY();</div><div class="line">        ObjectAnimator topAnimator = ObjectAnimator.ofFloat(ivTop,<span class="string">"translationY"</span>,topCurrentY,<span class="number">0f</span>);</div><div class="line"></div><div class="line">        <span class="keyword">float</span> bottomCurrentY = ivBottom.getTranslationY();</div><div class="line">        ObjectAnimator bottomAnimator = ObjectAnimator.ofFloat(ivBottom,<span class="string">"translationY"</span>,bottomCurrentY,<span class="number">0f</span>);</div><div class="line"></div><div class="line"></div><div class="line">        AnimatorSet animatorSet = <span class="keyword">new</span> AnimatorSet();</div><div class="line">        animatorSet.playTogether(mainAnimator,leftAnimator,rightAnimator,topAnimator,bottomAnimator);</div><div class="line">        animatorSet.setDuration(<span class="number">500</span>);</div><div class="line">        animatorSet.setInterpolator(<span class="keyword">new</span> BounceInterpolator());</div><div class="line">        animatorSet.start();</div><div class="line"></div><div class="line">        flag = <span class="keyword">true</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>对主菜单按钮监听<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ivMain.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (flag) startMenu();</div><div class="line">		<span class="keyword">else</span> closeMenu();</div><div class="line">	&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h1 id="下拉展开动画"><a href="#下拉展开动画" class="headerlink" title="下拉展开动画"></a>下拉展开动画</h1><h2 id="实现思路-1"><a href="#实现思路-1" class="headerlink" title="实现思路"></a>实现思路</h2><p>两个LinearLayout, 一个visibility为显示,另一个为gone. 当点击showVIew时,把隐藏的LinearLayout设置为visibility,对这个过程使用动画.</p>
<h2 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h2><p>布局文件:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:orientation=&quot;vertical&quot; android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;&gt;</div><div class="line"></div><div class="line">    &lt;LinearLayout</div><div class="line">        android:id=&quot;@+id/id_show_hide_ll_show_view&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:gravity=&quot;center_vertical&quot;</div><div class="line">        android:orientation=&quot;horizontal&quot;&gt;</div><div class="line">        &lt;ImageView</div><div class="line">            android:layout_width=&quot;wrap_content&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:src=&quot;@mipmap/ic_launcher&quot;/&gt;</div><div class="line"></div><div class="line">        &lt;TextView</div><div class="line">            android:layout_width=&quot;wrap_content&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:text=&quot;click me&quot;/&gt;</div><div class="line"></div><div class="line"></div><div class="line">    &lt;/LinearLayout&gt;</div><div class="line"></div><div class="line">    &lt;LinearLayout</div><div class="line">        android:id=&quot;@+id/id_show_hide_ll_hide_view&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;40dp&quot;</div><div class="line">        android:gravity=&quot;center_vertical&quot;</div><div class="line">        android:visibility=&quot;gone&quot;</div><div class="line">        android:background=&quot;@color/colorPrimary&quot;&gt;</div><div class="line"></div><div class="line">        &lt;ImageView</div><div class="line">            android:layout_width=&quot;wrap_content&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:src=&quot;@mipmap/ic_launcher&quot;/&gt;</div><div class="line"></div><div class="line">        &lt;TextView</div><div class="line">            android:layout_width=&quot;wrap_content&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:text=&quot;I am hide&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;/LinearLayout&gt;</div><div class="line"></div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure></p>
<p>获取ValueAnimator:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">private ValueAnimator createValueAnimator(final View view, int start, int end)&#123;</div><div class="line">        final ValueAnimator animator = ValueAnimator.ofInt(start,end);</div><div class="line">        animator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onAnimationUpdate(ValueAnimator valueAnimator) &#123;</div><div class="line">                int value = (int)valueAnimator.getAnimatedValue();</div><div class="line">                ViewGroup.LayoutParams params = view.getLayoutParams();</div><div class="line">                params.height = value;</div><div class="line">                view.setLayoutParams(params);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        return animator;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>展开动画:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">private void openAnimation(View view)&#123;</div><div class="line">        view.setVisibility(View.VISIBLE);</div><div class="line">        ValueAnimator valueAnimator = createValueAnimator(view,0,measureHiddenViewHeight);</div><div class="line">        valueAnimator.start();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>关闭动画:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">private void closeAnimation(final View view) &#123;</div><div class="line">	int origHeight = view.getHeight();</div><div class="line">	ValueAnimator valueAnimator = createValueAnimator(view,origHeight,0);</div><div class="line">	valueAnimator.addListener(new AnimatorListenerAdapter() &#123;</div><div class="line">		@Override</div><div class="line">		public void onAnimationEnd(Animator animation) &#123;</div><div class="line">			view.setVisibility(View.GONE);</div><div class="line">		&#125;</div><div class="line">	&#125;);</div><div class="line">	valueAnimator.start();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;灵动菜单&quot;&gt;&lt;a href=&quot;#灵动菜单&quot; class=&quot;headerlink&quot; title=&quot;灵动菜单&quot;&gt;&lt;/a&gt;灵动菜单&lt;/h1&gt;&lt;h2 id=&quot;实现思路&quot;&gt;&lt;a href=&quot;#实现思路&quot; class=&quot;headerlink&quot; title=&quot;实现思路&quot;&gt;&lt;/a
    
    </summary>
    
      <category term="Android" scheme="https://devallever.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://devallever.github.io/tags/Android/"/>
    
      <category term="动画" scheme="https://devallever.github.io/tags/%E5%8A%A8%E7%94%BB/"/>
    
  </entry>
  
  <entry>
    <title>设计模式(三) 工厂方法模式</title>
    <link href="https://devallever.github.io/2017/05/24/factory-method-patterns/"/>
    <id>https://devallever.github.io/2017/05/24/factory-method-patterns/</id>
    <published>2017-05-24T03:51:32.000Z</published>
    <updated>2017-05-24T04:20:19.029Z</updated>
    
    <content type="html"><![CDATA[<h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><p>定义一个用于创建对象的接口,让子类决定实例化那个类</p>
<h1 id="UML类图"><a href="#UML类图" class="headerlink" title="UML类图"></a>UML类图</h1><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://timgsa.baidu.com/timg?image&quality=80&size=b10000_10000&sec=1495597696&di=b6e459e489113ecdbc79ac8f57f17f19&src=http://pic002.cnblogs.com/images/2012/448009/2012102412230955.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>解读: </p>
<ul>
<li>Product: 产品抽象类, </li>
<li>ConcreteProduct: 产品实现类</li>
<li>Creator: 工厂抽象类, 返回一个Product实例</li>
<li>ConcreteCreator: 工厂实现类, 返回一个ConcreteProduct实例</li>
</ul>
<h1 id="简单实现"><a href="#简单实现" class="headerlink" title="简单实现"></a>简单实现</h1><p>##　Fruit: 作为产品抽象类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Fruit</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">getName</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>##　Banana: 作为产品实现类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Banana</span> <span class="keyword">extends</span> <span class="title">Fruit</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"I am banana"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Apple-作为产品实现类"><a href="#Apple-作为产品实现类" class="headerlink" title="Apple: 作为产品实现类"></a>Apple: 作为产品实现类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Apple</span> <span class="keyword">extends</span> <span class="title">Fruit</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"I am apple"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="FruitFactory-作为抽象工厂类"><a href="#FruitFactory-作为抽象工厂类" class="headerlink" title="FruitFactory: 作为抽象工厂类"></a>FruitFactory: 作为抽象工厂类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">FruitFactory</span>  </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">abstract</span> Fruit <span class="title">createFruit</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="AppleFactory-作为工厂实现类"><a href="#AppleFactory-作为工厂实现类" class="headerlink" title="AppleFactory: 作为工厂实现类"></a>AppleFactory: 作为工厂实现类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppleFactory</span> <span class="keyword">extends</span> <span class="title">FruitFactory</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function">Fruit <span class="title">createFruit</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Apple();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="BananaFactory-作为工厂实现类"><a href="#BananaFactory-作为工厂实现类" class="headerlink" title="BananaFactory: 作为工厂实现类"></a>BananaFactory: 作为工厂实现类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BananaFactory</span> <span class="keyword">extends</span> <span class="title">FruitFactory</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function">Fruit <span class="title">createFruit</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Banana();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>在需要哪一个产品时就生产哪个<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">FruitFactory fruitFactory = new AppleFactory();</div><div class="line">Fruit apple = fruitFactory.createFruit();</div><div class="line">apple.getName();</div></pre></td></tr></table></figure></p>
<h2 id="使用反射"><a href="#使用反射" class="headerlink" title="使用反射"></a>使用反射</h2><h3 id="FruitFactory"><a href="#FruitFactory" class="headerlink" title="FruitFactory"></a>FruitFactory</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">FruitFactory</span>  </span>&#123;</div><div class="line">    <span class="keyword">abstract</span> &lt;T extends Fruit&gt; <span class="function">T <span class="title">createFruit</span><span class="params">(Class&lt;T&gt; className)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>###　ConcreteFruitFactory: 具体工厂类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteFruitFactory</span> <span class="keyword">extends</span> <span class="title">FruitFactory</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    &lt;T extends Fruit&gt; <span class="function">T <span class="title">createFruit</span><span class="params">(Class&lt;T&gt; className)</span> </span>&#123;</div><div class="line">        Fruit fruit = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            fruit = (Fruit)Class.forName(className.getName()).newInstance();</div><div class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> (T)fruit;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h3><p>需要哪个类对象就传入那个类的类型<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">FruitFactory fruitFactory = <span class="keyword">new</span> ConcreteFruitFactory();</div><div class="line">Fruit apple = fruitFactory.createFruit(Apple.class);</div><div class="line">apple.getName();</div></pre></td></tr></table></figure></p>
<h1 id="简单工厂方法模式"><a href="#简单工厂方法模式" class="headerlink" title="简单工厂方法模式"></a>简单工厂方法模式</h1><p>当工厂只有一个的时候, 只需将对应的工厂方法改为静态方法, 并去掉abstract关键字, 此时就变成了简单工厂模式或者静态工厂模式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">public class FruitFactory  &#123;</div><div class="line">    static Fruit createFruit()&#123;</div><div class="line">        return new Apple();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;定义&quot;&gt;&lt;a href=&quot;#定义&quot; class=&quot;headerlink&quot; title=&quot;定义&quot;&gt;&lt;/a&gt;定义&lt;/h1&gt;&lt;p&gt;定义一个用于创建对象的接口,让子类决定实例化那个类&lt;/p&gt;
&lt;h1 id=&quot;UML类图&quot;&gt;&lt;a href=&quot;#UML类图&quot; class=&quot;h
    
    </summary>
    
      <category term="设计模式" scheme="https://devallever.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="设计模式" scheme="https://devallever.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="工厂方法模式" scheme="https://devallever.github.io/tags/%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Android练手项目 极简天气</title>
    <link href="https://devallever.github.io/2017/05/23/myCoolWeather/"/>
    <id>https://devallever.github.io/2017/05/23/myCoolWeather/</id>
    <published>2017-05-23T12:55:18.000Z</published>
    <updated>2017-05-23T13:41:25.138Z</updated>
    
    <content type="html"><![CDATA[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.bing.com/az/hprichbg/rb/CivitadiBagnoregio_ZH-CN12942138675_1366x768.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<blockquote>
<p>项目地址:  <a href="https://github.com/devallever/MyCoolWeather" target="_blank" rel="external">https://github.com/devallever/MyCoolWeather</a></p>
<p><a href="https://raw.githubusercontent.com/devallever/MyCoolWeather/master/app/simpleWeather.apk" target="_blank" rel="external">下载apk</a></p>
<p>我的博客: <a href="https://devallever.github.io/">https://devallever.github.io/</a></p>
</blockquote>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>极简天气, 天气应用,是我看完Android第一行代码后, 参考并修改的练习项目, 以巩固所学知识</p>
<p>感谢开源</p>
<ul>
<li>OkHttp</li>
<li>Retrofit</li>
<li>Glide</li>
<li>RxJava/RxAndroid</li>
<li>LitePal</li>
<li><p>EventBus</p>
<p>感谢郭神提供天气数据接口</p>
</li>
</ul>
<h1 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h1><h2 id="第一版"><a href="#第一版" class="headerlink" title="第一版"></a>第一版</h2><ul>
<li>显示实时天气, 三天预报, 空气质量, 温馨提示</li>
<li>获取Bing每日图片</li>
<li>滑动切换城市</li>
<li>城市管理: 增加,删除</li>
<li>下拉刷新</li>
<li>缓存省市县, 天气信息</li>
</ul>
<p><img src="https://github.com/devallever/MyCoolWeather/blob/master/pic_01.png?raw=true" alt=""><br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/MyCoolWeather/blob/master/pic_02.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/MyCoolWeather/blob/master/pic_03.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/MyCoolWeather/blob/master/pic_04.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/MyCoolWeather/blob/master/pic_05.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/MyCoolWeather/blob/master/pic_06.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/MyCoolWeather/blob/master/pic_07.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/MyCoolWeather/blob/master/pic_08.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>  </p>
<h2 id="第二版"><a href="#第二版" class="headerlink" title="第二版"></a>第二版</h2><ul>
<li>后台自动刷新</li>
<li>自动下载壁纸</li>
<li>天气提醒</li>
<li>查看历史天气</li>
<li>关于</li>
<li>设置刷新频，全局提醒，背景图片</li>
<li>检查更新</li>
</ul>
<h1 id="功能实现细节"><a href="#功能实现细节" class="headerlink" title="功能实现细节"></a>功能实现细节</h1><h2 id="第二版功能细节"><a href="#第二版功能细节" class="headerlink" title="第二版功能细节"></a>第二版功能细节</h2><h3 id="后台自动更新天气信息"><a href="#后台自动更新天气信息" class="headerlink" title="后台自动更新天气信息"></a>后台自动更新天气信息</h3><p>使用服务, 启动服务后通过AlarmManager设置一个定时任务,每隔一小时更新天气信息, 在退出程序时候启动该服务,在服务中主要执行了两个方法分别更新天气信息和壁纸, 请求网络后把数据保存到Weather表中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public int onStartCommand(Intent intent,  int flags, int startId) &#123;</div><div class="line">    Log.d(TAG, &quot;onStartCommand: ()&quot;);</div><div class="line">    updateWeather();</div><div class="line">    updateImage();</div><div class="line">    int anHour = 1 * 60 * 60 * 1000;   //１小时</div><div class="line">    //int anHour = 10* 1000;   //10秒</div><div class="line">    long triggerAtTime = SystemClock.elapsedRealtime() + anHour;</div><div class="line">    AlarmManager alarmManager = (AlarmManager) getSystemService(ALARM_SERVICE);</div><div class="line">    Intent serviceIntent = new Intent(this, AutoUpdateService.class);</div><div class="line">    //Intent receiverIntent = new Intent(this, AutoUpdateReceiver.class);</div><div class="line">    PendingIntent pendingIntent = PendingIntent.getService(this,0,serviceIntent,0);</div><div class="line">    alarmManager.cancel(pendingIntent);</div><div class="line">    alarmManager.set(AlarmManager.ELAPSED_REALTIME_WAKEUP, triggerAtTime,pendingIntent);</div><div class="line">    return super.onStartCommand(intent, flags, startId);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>启动服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">protected void onDestroy() &#123;</div><div class="line">    //启动后台更新服务</div><div class="line">    Intent serviceIntent = new Intent(this, AutoUpdateService.class);</div><div class="line">    startService(serviceIntent);</div><div class="line">    super.onDestroy();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="天气提醒功能"><a href="#天气提醒功能" class="headerlink" title="天气提醒功能"></a>天气提醒功能</h3><p>每次后台获取更新后,判断该城市是否显示通知, 是的话就对天气信息进一步分析:  </p>
<p>昼夜温度大于10度时提醒,<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">int max = Integer.valueOf(newWeather.getDaily_forecast().get(0).getTmp().getMax());</div><div class="line">int min = Integer.valueOf(newWeather.getDaily_forecast().get(0).getTmp().getMin());</div><div class="line">if ((max-min) &gt;=10 )&#123;</div><div class="line">//显示通知</div><div class="line">builder.setContentText( county + &quot;: 昼夜温差较大,请预防感冒!&quot;);</div><div class="line">notificationManager.notify(id,builder.build());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>今明天气相差5度时提醒<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">//2.比较今天明天气温相差5度提示</div><div class="line">Daily_forecast today = newWeather.getDaily_forecast().get(0);</div><div class="line">Daily_forecast tomorrow = newWeather.getDaily_forecast().get(1);</div><div class="line">int todayTmp = Integer.valueOf(today.getTmp().getMin());</div><div class="line">int tomorrowTmp = Integer.valueOf(tomorrow.getTmp().getMin());</div><div class="line">if ( Math.abs(todayTmp-tomorrowTmp) &gt;= 5)&#123;</div><div class="line">	if (tomorrowTmp &gt; todayTmp)&#123;</div><div class="line">		builder.setContentText( county + &quot;: 明天将大幅度升温!&quot;);</div><div class="line">	&#125;else &#123;</div><div class="line">		builder.setContentText( county + &quot;: 明天将大幅度降温温!&quot;);</div><div class="line">	&#125;</div><div class="line">notificationManager.notify(id+1000,builder.build());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>有降水提示带伞<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//3. 有雨的要带伞</div><div class="line">if (tomorrow.getCond().getTxt_d().contains(&quot;雨&quot;))&#123;</div><div class="line">	builder.setContentText( county + &quot;: 明天将有&quot; + tomorrow.getCond().getTxt_d() + &quot;, 出门记得带伞.&quot;);</div><div class="line">	notificationManager.notify(id+1001,builder.build());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当实时天气与上一次的天气有不同时候,提醒<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//4. 比较实时天气</div><div class="line">String old = oldWeather.getNow().getCond().getTxt();</div><div class="line">String newInfo = newWeather.getNow().getCond().getTxt();</div><div class="line">if (!old.equals(newInfo))&#123;</div><div class="line">	builder.setContentText( county + &quot;: &quot; + newWeather.getNow().getCond().getTxt());</div><div class="line">	notificationManager.notify(id+1002,builder.build());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="查看历史天气"><a href="#查看历史天气" class="headerlink" title="查看历史天气"></a>查看历史天气</h3><p>创建一个数据库表HistoryWeather用来保存历史天气信息<br>id, weatherId, countyName, date,  weatehr, min, max<br>每次后台自动更新天气数据时候，解析json数据，获取所需数据封装成HIstoryWeather，然后保存，根据date和weatherId字段获取要保存的记录，如果存在的就更新，不存在的就天机记录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">private void saveHistoryWeather(String result)&#123;</div><div class="line">    Gson gson = new Gson();</div><div class="line">    HeWeather5 heWeather5 = gson.fromJson(result,Root.class).getHeWeather5().get(0);</div><div class="line"></div><div class="line">    List&lt;Daily_forecast&gt; daily_forecastList = heWeather5.getDaily_forecast();</div><div class="line">    //for (Daily_forecast daily_forecast :daily_forecastList)&#123;</div><div class="line">    Daily_forecast today = daily_forecastList.get(0);</div><div class="line">        String date = today.getDate();</div><div class="line">        String weather = today.getCond().getTxt_d();</div><div class="line">        String weatherId = heWeather5.getBasic().getId();</div><div class="line">        String countyName = heWeather5.getBasic().getCity();</div><div class="line">        String min = today.getTmp().getMin();</div><div class="line">        String max = today.getTmp().getMax();</div><div class="line">        HistoryWeather historyWeather = new HistoryWeather();</div><div class="line">        historyWeather.setDate(date);</div><div class="line">        historyWeather.setWeatherId(weatherId);</div><div class="line">        historyWeather.setCountyName(countyName);</div><div class="line">        historyWeather.setWeather(weather);</div><div class="line">        historyWeather.setMin(min);</div><div class="line">        historyWeather.setMax(max);</div><div class="line">        historyWeather.saveOrUpdate(&quot;weatherId=? and date=?&quot;, weatherId, date);</div><div class="line">    //&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>查找历史天气信息时候，默认是查找前30条记录，并且按date降序排列<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">List&lt;HistoryWeather&gt; historyWeatherList;</div><div class="line">historyWeatherList = DataSupport.where(&quot;weatherId=? order by date desc&quot;, weatherId).find(HistoryWeather.class);</div><div class="line">for (HistoryWeather historyWeather: historyWeatherList)&#123;</div><div class="line">    HistoryWeatherItem historyWeatherItem = new HistoryWeatherItem();</div><div class="line">    historyWeatherItem.setWeather(historyWeather.getWeather());</div><div class="line">    historyWeatherItem.setDate(historyWeather.getDate());</div><div class="line">    historyWeatherItem.setMax(historyWeather.getMax());</div><div class="line">    historyWeatherItem.setMin(historyWeather.getMin());</div><div class="line">    historyWeatherItemList.add(historyWeatherItem);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="第一版功能细节"><a href="#第一版功能细节" class="headerlink" title="第一版功能细节"></a>第一版功能细节</h2><h3 id="选择城市-ChooseCItyActivity"><a href="#选择城市-ChooseCItyActivity" class="headerlink" title="选择城市 ChooseCItyActivity"></a>选择城市 ChooseCItyActivity</h3><p>首先访问数据库中是否有所有省份数据,有则获取,没有则请求服务器,然后得到全国省份的json数据,保存到数据库中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">private void queryProvince()&#123;</div><div class="line">    toolbar.setTitle(&quot;中国&quot;);</div><div class="line">    provinceList = DataSupport.findAll(Province.class);</div><div class="line">    if (provinceList.size() &gt; 0)&#123;</div><div class="line">        dataList.clear();</div><div class="line">        for (Province province:provinceList)&#123;</div><div class="line">            dataList.add(province.getProvinceName());</div><div class="line">        &#125;</div><div class="line">        adapter.notifyDataSetChanged();</div><div class="line">        listView.setSelection(0);</div><div class="line">        currentLevel = LEVEL_PROVINCE;</div><div class="line">    &#125;else &#123;</div><div class="line">        String address = &quot;http://guolin.tech/api/china/&quot;;</div><div class="line">        queryFromServer(address, &quot;province&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">public static boolean handleProvinceResponse(String response)&#123;</div><div class="line">    if (!TextUtils.isEmpty(response))&#123;</div><div class="line">        try &#123;</div><div class="line">            JSONArray allProvince = new JSONArray(response);</div><div class="line">            for (int i = 0; i&lt;allProvince.length(); i++)&#123;</div><div class="line">                JSONObject provinceObject = allProvince.getJSONObject(i);</div><div class="line">                Province province = new Province();</div><div class="line">                province.setProvinceCode(provinceObject.getInt(&quot;id&quot;));</div><div class="line">                province.setProvinceName(provinceObject.getString(&quot;name&quot;));</div><div class="line">                province.save();</div><div class="line">            &#125;</div><div class="line">            return  true;</div><div class="line">        &#125;catch (JSONException je)&#123;</div><div class="line">            je.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return false;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后解析json数据,设置到Listview中,点击时记录省份id, 然后根据这个id访问数据库中是否有该省份的城市信息,有则获取,没有则请求服务器,然后得到该省份所有城市的json数据,保存到数据库中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">private void queryCity()&#123;</div><div class="line">    toolbar.setTitle(selectedProvince.getProvinceName());</div><div class="line">    cityList = DataSupport.where(&quot;provinceCode = ? &quot;, String.valueOf(selectedProvince.getProvinceCode())).find(City.class);</div><div class="line">    if (cityList.size() &gt; 0)&#123;</div><div class="line">        dataList.clear();</div><div class="line">        for (City city: cityList)&#123;</div><div class="line">            dataList.add(city.getCityName());</div><div class="line">        &#125;</div><div class="line">        adapter.notifyDataSetChanged();</div><div class="line">        listView.setSelection(0);</div><div class="line">        currentLevel = LEVEL_CITY;</div><div class="line">    &#125;else &#123;</div><div class="line">        int provinceCode = selectedProvince.getProvinceCode();</div><div class="line">        String address = &quot;http://guolin.tech/api/china/&quot; + provinceCode;</div><div class="line">        queryFromServer(address,&quot;city&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">public static boolean handleCityResponse(String response, int provinceCode)&#123;</div><div class="line">    if (!TextUtils.isEmpty(response))&#123;</div><div class="line">        try &#123;</div><div class="line">            Log.d(TAG, &quot;handleCityResponse: \n response = &quot; + response);</div><div class="line">            JSONArray allCity = new JSONArray(response);</div><div class="line">            for (int i = 0; i&lt; allCity.length(); i++)&#123;</div><div class="line">                JSONObject cityObject = allCity.getJSONObject(i);</div><div class="line">                City city = new City();</div><div class="line">                city.setCityCode(cityObject.getInt(&quot;id&quot;));</div><div class="line">                city.setCityName(cityObject.getString(&quot;name&quot;));</div><div class="line">                city.setProvinceCode(provinceCode);</div><div class="line">                city.save();</div><div class="line">            &#125;</div><div class="line">            return true;</div><div class="line">        &#125;catch (JSONException je)&#123;</div><div class="line">            je.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return false;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后解析json数据,清空listview数据源, 然后加载该省的所有城市数据,设置到ListView中,点击时记录该市的id, 然后根据这个id访问数据库中是否存在该市的所有县数据,有则获取, 没有则请求服务器,然后得到该市所有县的json数据,保存到数据库中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">private void queryCounty()&#123;</div><div class="line">    toolbar.setTitle(selectedCity.getCityName());</div><div class="line">    Toast.makeText(this,&quot;cityCode = &quot;+ selectedCity.getCityCode() + &quot;\n&quot; +</div><div class="line">            &quot;id = &quot; + selectedCity.getId(),Toast.LENGTH_LONG ).show();</div><div class="line">    countyList = DataSupport.where(&quot;cityCode = ?&quot;, String.valueOf(selectedCity.getId())).find(County.class);</div><div class="line">    if (countyList.size() &gt; 0 )&#123;</div><div class="line">        dataList.clear();</div><div class="line">        for (County county: countyList)&#123;</div><div class="line">            dataList.add(county.getCountyName());</div><div class="line">        &#125;</div><div class="line">        adapter.notifyDataSetChanged();</div><div class="line">        listView.setSelection(0);</div><div class="line">        currentLevel = LEVEL_COUNTY;</div><div class="line">    &#125;else &#123;</div><div class="line">        int provinceCode = selectedProvince.getProvinceCode();</div><div class="line">        int cityCode = selectedCity.getCityCode();</div><div class="line">        String address = &quot;http://guolin.tech/api/china/&quot; + provinceCode + &quot;/&quot;  + cityCode;</div><div class="line">        queryFromServer(address,&quot;county&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">public static boolean handleCountyResponse(String response, int cityCode)&#123;</div><div class="line">    if (!TextUtils.isEmpty(response)) &#123;</div><div class="line">        try &#123;</div><div class="line">            JSONArray allCounty = new JSONArray(response);</div><div class="line">            for (int i = 0; i &lt; allCounty.length(); i++) &#123;</div><div class="line">                JSONObject countyObject = allCounty.getJSONObject(i);</div><div class="line">                County county = new County();</div><div class="line">                county.setCountyName(countyObject.getString(&quot;name&quot;));</div><div class="line">                county.setWeatherId(countyObject.getString(&quot;weather_id&quot;));</div><div class="line">                county.setCityCode(cityCode);</div><div class="line">                boolean successed = county.save();</div><div class="line">                if (successed) Log.d(TAG, &quot;handleCountyResponse: save success&quot;);</div><div class="line">                else Log.d(TAG, &quot;handleCountyResponse: save fail&quot;);</div><div class="line">            &#125;</div><div class="line">            return true;</div><div class="line">        &#125; catch (JSONException je) &#123;</div><div class="line">            je.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return false;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>选择其中某一项, 获取weatherId和县名称countyName, 通过setResult返回父Activity中,<br>在父Activity中onActivityResult方法中, 把weatherId和countyName保存到Weather数据表中, 然后重新获取weather表中数据.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">listView.setOnItemClickListener(new AdapterView.OnItemClickListener() &#123;</div><div class="line">    @Override</div><div class="line">    public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id) &#123;</div><div class="line">        if (currentLevel == LEVEL_PROVINCE)&#123;</div><div class="line">            selectedProvince = provinceList.get(position);</div><div class="line">            queryCity();</div><div class="line">        &#125;else if (currentLevel == LEVEL_CITY)&#123;</div><div class="line">            selectedCity = cityList.get(position);</div><div class="line">            Toast.makeText(ChooseCityActivity.this,&quot;id = &quot;  + selectedCity.getId() + &quot;\n&quot;+</div><div class="line">                    &quot;cityName = &quot; + selectedCity.getCityName() + &quot;\n&quot; +</div><div class="line">                    &quot;cityCode = &quot; + selectedCity.getCityCode() + &quot;\n&quot; +</div><div class="line">                    &quot;provinceCode = &quot; + selectedCity.getProvinceCode(),Toast.LENGTH_SHORT).show();</div><div class="line">            queryCounty();</div><div class="line">        &#125;else if (currentLevel == LEVEL_COUNTY)&#123;</div><div class="line">            selectedCounty = countyList.get(position);</div><div class="line">            Toast.makeText(ChooseCityActivity.this,&quot;id = &quot;  + selectedCounty.getId() + &quot;\n&quot;+</div><div class="line">                    &quot;countyName = &quot; + selectedCounty.getCountyName() + &quot;\n&quot; +</div><div class="line">                    &quot;weather_id = &quot; + selectedCounty.getWeatherId(),Toast.LENGTH_SHORT).show();</div><div class="line">            Intent intent = new Intent();</div><div class="line">            intent.putExtra(&quot;weather_id&quot;, selectedCounty.getWeatherId());</div><div class="line">            intent.putExtra(&quot;county_name&quot;,selectedCounty.getCountyName());</div><div class="line">            setResult(RESULT_OK,intent);</div><div class="line">            finish();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>回到父Activity进行操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">String weather_id = data.getStringExtra(&quot;weather_id&quot;);</div><div class="line">List&lt;Weather&gt; weatherList = DataSupport.where(&quot;weatherId = ? &quot;, weather_id).find(Weather.class);</div><div class="line">if (weatherList != null &amp;&amp; weatherList.size()==0)&#123;</div><div class="line">	Weather weather = new Weather();</div><div class="line">	weather.setCountyName(data.getStringExtra(&quot;county_name&quot;));</div><div class="line">	weather.setWeatherId(data.getStringExtra(&quot;weather_id&quot;));</div><div class="line">	weather.setIsShow(&quot;1&quot;);</div><div class="line">	weather.save();</div><div class="line">	titleList.add(weather.getCountyName());</div><div class="line">	WeatherFragment weatherFragment = new WeatherFragment(weather.getWeatherId());</div><div class="line">	weatherFragmentList.add(weatherFragment);</div><div class="line">	weatherPageAdapter.notifyDataSetChanged();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="构造ViewPager天气页面数据源"><a href="#构造ViewPager天气页面数据源" class="headerlink" title="构造ViewPager天气页面数据源"></a>构造ViewPager天气页面数据源</h3><p>在MainActivity中,访问数据库weather表, (条件:isShow=1,表示显示是否显示在主界面), 把查询结果存到List中,如果list大小为0, 则打开选择城市界面,如果存在数据,则遍历每个weather对象,创建WeatherFragment,并把weather对象中的weatherId传到Fragment的构造方法中,并添加到fragmengList中, WeatherFragment会根据这个weatherId获取天气信息,同时把weather的countyName添加到titleLists中用于设置每个pager的标题,,,然后通知adapter数据更新了,<br>pagerAdapter是通过fragmengList和titleList绑定数据的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">private void showWeather()&#123;</div><div class="line">    weatherList.clear();</div><div class="line">    weatherFragmentList.clear();</div><div class="line">    titleList.clear();</div><div class="line">    weatherList = DataSupport.where(&quot;isShow=?&quot;, &quot;1&quot;).find(Weather.class);</div><div class="line">    if (weatherList.size() ==0)&#123;</div><div class="line">        //转到选择城市Activity</div><div class="line">        Intent intent = new Intent(this, ChooseCityActivity.class);</div><div class="line">        startActivityForResult(intent, REQUEST_CODE_CHOOSE_CITY);</div><div class="line">    &#125;else &#123;</div><div class="line">        for (Weather weather: weatherList) &#123;</div><div class="line">            titleList.add(weather.getCountyName());</div><div class="line">            WeatherFragment weatherFragment = new WeatherFragment(weather.getWeatherId());</div><div class="line">            weatherFragmentList.add(weatherFragment);</div><div class="line">        &#125;</div><div class="line">        weatherPageAdapter.notifyDataSetChanged();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>选择城市后返回的操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">String weather_id = data.getStringExtra(&quot;weather_id&quot;);</div><div class="line">List&lt;Weather&gt; weatherList = DataSupport.where(&quot;weatherId = ? &quot;, weather_id).find(Weather.class);</div><div class="line">if (weatherList != null &amp;&amp; weatherList.size()==0)&#123;</div><div class="line">	Weather weather = new Weather();</div><div class="line">	weather.setCountyName(data.getStringExtra(&quot;county_name&quot;));</div><div class="line">	weather.setWeatherId(data.getStringExtra(&quot;weather_id&quot;));</div><div class="line">	weather.setIsShow(&quot;1&quot;);</div><div class="line">	weather.save();</div><div class="line">	titleList.add(weather.getCountyName());</div><div class="line">	WeatherFragment weatherFragment = new WeatherFragment(weather.getWeatherId());</div><div class="line">	weatherFragmentList.add(weatherFragment);</div><div class="line">	weatherPageAdapter.notifyDataSetChanged();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="城市管理-CityManageActivity"><a href="#城市管理-CityManageActivity" class="headerlink" title="城市管理-CityManageActivity"></a>城市管理-CityManageActivity</h3><p>该页面有一个RecyclerView,和一个FloatingActionButton, 其中recyclerView的item是一个CardView, 显示了该城市粗略的天气信息,如温度和天气,fab用于添加城市,可以通过左右滑动每一个卡片来删除数据,<br>请求数据库, 访问weather表的所有数据, 抽取其中所需的信息封装到CityItem中,然后添加到cityItemList中,作为RecyclerView的数据源,当成功选择一个城市并返回后,根据返回的weatherId访问数据库是否存在该数据,有则不操作,没有则添加到weather表中.以免产生冗余数据.当滑动删除城市后,会从数据表中删除掉这条记录,(改进的做法是滑动删除后显示一个Snackbar来确认操作)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">weatherList = DataSupport.findAll(Weather.class);</div><div class="line">Gson gson = new Gson();</div><div class="line">Root root;</div><div class="line">for (Weather weather: weatherList)&#123;</div><div class="line">	CityItem cityItem = new CityItem();</div><div class="line">	cityItem.setIsShow(weather.getIsShow());</div><div class="line">	root = gson.fromJson(weather.getWeatherInfo(),Root.class);</div><div class="line">	if (root!=null)&#123;</div><div class="line">		cityItem.setTmp(root.getHeWeather5().get(0).getNow().getTmp());</div><div class="line">		cityItem.setWeather(root.getHeWeather5().get(0).getNow().getCond().getTxt());</div><div class="line">		cityItem.setCounty(weather.getCountyName());</div><div class="line">		cityItem.setWeatherId(weather.getWeatherId());</div><div class="line">		cityItemList.add(cityItem);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">cityRecyclerAdapter.notifyDataSetChanged();</div></pre></td></tr></table></figure></p>
<p>滑动删除后的操作-我还在进一步研究,不是很懂,因为是复制别人的代码<br>关联<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//关联ItemTouchHelper和RecyclerView</div><div class="line">ItemTouchHelper.Callback callback = new ItemTouchHelperCallback(cityRecyclerAdapter);</div><div class="line">ItemTouchHelper mItemTouchHelper = new ItemTouchHelper(callback);</div><div class="line">mItemTouchHelper.attachToRecyclerView(recyclerView);</div></pre></td></tr></table></figure></p>
<p>ItemTouchHelperCallback:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">public class ItemTouchHelperCallback extends ItemTouchHelper.Callback &#123;</div><div class="line"></div><div class="line">    private OnMoveAndSwipedListener moveAndSwipedListener;</div><div class="line"></div><div class="line">    public ItemTouchHelperCallback(OnMoveAndSwipedListener listener) &#123;</div><div class="line">        this.moveAndSwipedListener = listener;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //设置拖动方向以及侧滑方向</div><div class="line">    @Override</div><div class="line">    public int getMovementFlags(RecyclerView recyclerView, RecyclerView.ViewHolder viewHolder) &#123;</div><div class="line">        if (recyclerView.getLayoutManager() instanceof LinearLayoutManager) &#123;</div><div class="line">            //单列的RecyclerView支持上下拖动和左右侧滑</div><div class="line">            final int dragFlags = ItemTouchHelper.UP | ItemTouchHelper.DOWN;</div><div class="line">            final int swipeFlags = ItemTouchHelper.START | ItemTouchHelper.END;</div><div class="line">            return makeMovementFlags(dragFlags, swipeFlags);</div><div class="line">        &#125; else &#123;</div><div class="line">            //多列的RecyclerView支持上下左右拖动和不支持左右侧滑</div><div class="line">            final int dragFlags = ItemTouchHelper.UP | ItemTouchHelper.DOWN | ItemTouchHelper.LEFT | ItemTouchHelper.RIGHT;</div><div class="line">            final int swipeFlags = 0;</div><div class="line">            return makeMovementFlags(dragFlags, swipeFlags);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //拖动item时会调用此方法</div><div class="line">    @Override</div><div class="line">    public boolean onMove(RecyclerView recyclerView, RecyclerView.ViewHolder viewHolder, RecyclerView.ViewHolder target) &#123;</div><div class="line">        //如果两个item不是同一个类型的，不让他拖拽</div><div class="line">        if (viewHolder.getItemViewType() != target.getItemViewType()) &#123;</div><div class="line">            return false;</div><div class="line">        &#125;</div><div class="line">        moveAndSwipedListener.onItemMove(viewHolder.getAdapterPosition(), target.getAdapterPosition());</div><div class="line">        return true;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //侧滑item时会调用此方法</div><div class="line">    @Override</div><div class="line">    public void onSwiped(RecyclerView.ViewHolder viewHolder, int direction) &#123;</div><div class="line">        moveAndSwipedListener.onItemDismiss(viewHolder.getAdapterPosition());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>OnMoveAndSwipedListener:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public interface OnMoveAndSwipedListener &#123;</div><div class="line"></div><div class="line">    boolean onItemMove(int fromPosition, int toPosition);</div><div class="line"></div><div class="line">    void onItemDismiss(int position);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>监听到滑动删除执行以下方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public boolean onItemMove(int fromPosition, int toPosition) &#123;</div><div class="line">    notifyItemMoved(fromPosition, toPosition);</div><div class="line">    return true;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@Override</div><div class="line">public void onItemDismiss(int position) &#123;</div><div class="line">    DataSupport.deleteAll(Weather.class,&quot;weatherId=?&quot;,cityItemList.get(position).getWeatherId());</div><div class="line">    cityItemList.remove(position);</div><div class="line">    notifyItemRemoved(position);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="显示天气-WeatherFragmeng"><a href="#显示天气-WeatherFragmeng" class="headerlink" title="显示天气-WeatherFragmeng"></a>显示天气-WeatherFragmeng</h3><p>显示天气信息是在WeatherFragment中完成的, 也就是每个页面. 从构造方法中获取到该所显示城市的天气数据, 根据这个weatherId访问数据库中该weatherId所在记录是否有weatherInfo信息,如果有则获取该天气信息的json数据, 没有则向服务器请求数据,获取天气信息,成功获取信息之后保存到数据库中.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">weatherList = DataSupport.where(<span class="string">"weatherId = ? "</span>, weather_id).find(Weather.class);</div><div class="line"><span class="keyword">if</span> (weatherList != <span class="keyword">null</span> &amp;&amp; weatherList.size()&gt;<span class="number">0</span>)&#123;</div><div class="line">	<span class="keyword">if</span> (TextUtils.isEmpty(weatherList.get(<span class="number">0</span>).getWeatherInfo())) sendWeatherInfoRequest();</div><div class="line">	<span class="keyword">else</span> handleWeatherInfoResponse(weatherList.get(<span class="number">0</span>).getWeatherInfo());</div><div class="line">&#125;<span class="keyword">else</span> &#123;</div><div class="line">	<span class="comment">//get dada from internet</span></div><div class="line">	sendWeatherInfoRequest();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>获取后保存到数据库<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">String responseText = response.body().string();</div><div class="line">Weather weather = <span class="keyword">new</span> Weather();</div><div class="line">weather.setWeatherInfo(responseText);</div><div class="line">weather.updateAll(<span class="string">"weatherId=?"</span>, weather_id);</div><div class="line">getActivity().runOnUiThread(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">		handleWeatherInfoResponse(responseText);</div><div class="line">	&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<hr>
<p>持续更新……..<br>欢迎大家共同学习共同成长…..</p>
]]></content>
    
    <summary type="html">
    
      &lt;figure class=&quot;image-bubble&quot;&gt;
                &lt;div class=&quot;img-lightbox&quot;&gt;
                    &lt;div class=&quot;overlay&quot;&gt;&lt;/div&gt;
                   
    
    </summary>
    
      <category term="Android" scheme="https://devallever.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://devallever.github.io/tags/Android/"/>
    
      <category term="Project" scheme="https://devallever.github.io/tags/Project/"/>
    
  </entry>
  
  <entry>
    <title>排序算法</title>
    <link href="https://devallever.github.io/2017/05/23/algorithms-sort/"/>
    <id>https://devallever.github.io/2017/05/23/algorithms-sort/</id>
    <published>2017-05-23T12:54:18.000Z</published>
    <updated>2017-06-25T13:25:04.244Z</updated>
    
    <content type="html"><![CDATA[<h1 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h1><h2 id="思想"><a href="#思想" class="headerlink" title="思想"></a>思想</h2><p>比较相邻记录关键字，如果逆序，则进行交换，从而使记录小的像气泡一样逐渐往上“漂浮”(左移)，或者说使记录大的像石头那样”下沉”(右移)</p>
<h2 id="算法实现"><a href="#算法实现" class="headerlink" title="算法实现"></a>算法实现</h2><h3 id="java实现"><a href="#java实现" class="headerlink" title="java实现"></a>java实现</h3><p>原序列<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> a[<span class="number">10</span>] = &#123;<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">0</span>&#125;;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">popSort</span><span class="params">(<span class="keyword">int</span>[] a)</span></span>&#123;</div><div class="line">    <span class="comment">//最基本的冒泡排序写法</span></div><div class="line">    <span class="comment">/*int i;</span></div><div class="line">    for (i=0;i&lt;a.length;i++)&#123;</div><div class="line">        for (int j=0;j&lt;a.length-1;j++)&#123;</div><div class="line">            if (a[j]&gt;a[j+1])&#123;</div><div class="line">                int temp = a[j];</div><div class="line">                a[j] = a[j+1];</div><div class="line">                a[j+1] = temp;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;*/</div><div class="line"></div><div class="line">    <span class="comment">//改进的冒泡排序写法</span></div><div class="line">    <span class="keyword">int</span> len = a.length-<span class="number">1</span>;</div><div class="line">    <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;<span class="comment">//用来标识是否发生交换操作</span></div><div class="line">    <span class="keyword">while</span> (len&gt;<span class="number">0</span> &amp;&amp; flag)&#123;</div><div class="line">        flag = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;len;j++)&#123;</div><div class="line">            <span class="keyword">if</span> (a[j] &gt; a[j+<span class="number">1</span>])&#123;</div><div class="line">                <span class="comment">//交换</span></div><div class="line">                <span class="keyword">int</span> temp = a[j];</div><div class="line">                a[j] = a[j+<span class="number">1</span>];</div><div class="line">                a[j+<span class="number">1</span>] = temp;</div><div class="line">                flag = <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        show(a);</div><div class="line">        len--;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">原序列: 1 6 5 9 3 8 2 7 0 4 </div><div class="line">1 5 6 3 8 2 7 0 4 9 </div><div class="line">1 5 3 6 2 7 0 4 8 9 </div><div class="line">1 3 5 2 6 0 4 7 8 9 </div><div class="line">1 3 2 5 0 4 6 7 8 9 </div><div class="line">1 2 3 0 4 5 6 7 8 9 </div><div class="line">1 2 0 3 4 5 6 7 8 9 </div><div class="line">1 0 2 3 4 5 6 7 8 9 </div><div class="line">0 1 2 3 4 5 6 7 8 9 </div><div class="line">0 1 2 3 4 5 6 7 8 9 </div><div class="line">排序后: 0 1 2 3 4 5 6 7 8 9</div></pre></td></tr></table></figure></p>
<h1 id="快速排序-冒泡排序升级版"><a href="#快速排序-冒泡排序升级版" class="headerlink" title="快速排序(冒泡排序升级版)"></a>快速排序(冒泡排序升级版)</h1><h2 id="思想-1"><a href="#思想-1" class="headerlink" title="思想"></a>思想</h2><p>在待排记录中选择一个记录(通常第一个)作为枢纽(关键记录)pivotkey. 经过一趟排序，以枢纽记录分为两个子表，左边子表记录比枢纽记录小，右边子表比枢纽记录大。然后对每个子表重复以上过程。知道每个子表只有一个记录时，排序结束。</p>
<h2 id="每一趟操做"><a href="#每一趟操做" class="headerlink" title="每一趟操做"></a>每一趟操做</h2><p> 参考《大话数据结构》有详细解析</p>
<ol>
<li>选择表中一个记录作为枢纽(通常是第一个记录) 保存好记录的值pivotkey</li>
<li>(1)从high往左每个记录依次与pivotkey比较，比pivotkey大或相等的，high往左移(high–), 比pivotkey小的结束high移动，交换low和high的值<br> (2) 从low往右每个记录依次与pivotkey比较，比pivotkey小或相等的，low往右移(low++), 比pivotkey小的结束low移动，交换low和high的值</li>
<li>返回pivotkey的值<h2 id="算法实现-1"><a href="#算法实现-1" class="headerlink" title="算法实现"></a>算法实现</h2><h3 id="java实现-1"><a href="#java实现-1" class="headerlink" title="java实现"></a>java实现</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">int a[10] = &#123;4,3,2,6,1,9,5,8,7,0&#125;;</div></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">private static void quickSort(int[] a,int low, int high)&#123;</div><div class="line">    if (low&lt;high)&#123;</div><div class="line">        int povit = partition(a,low,high);</div><div class="line">        quickSort(a,povit+1,high);  //对枢纽记录右边子表进行排序</div><div class="line">        quickSort(a,low,povit-1);   //对枢纽记录左边的子表进行排序</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">private static int partition(int[] a, int low, int high)&#123;</div><div class="line">    System.out.println(&quot;low = &quot; + low);</div><div class="line">    int pivot = a[low]; //用子表的第一个记录作为枢纽记录</div><div class="line">    while (low&lt;high)&#123;   //</div><div class="line">        while (low&lt;high &amp;&amp; a[high]&gt;=pivot)  //右往左比较</div><div class="line">            high--;                         //如果记录比枢纽记录大或者相等，high向左移动一个</div><div class="line">        swap(a,low,high);                   //交换，比枢纽记录小的放左边</div><div class="line">        show(a);</div><div class="line">        while (low&lt;high &amp;&amp; a[low]&lt;=pivot)   //左往右比较</div><div class="line">            low++;                          //如果记录比枢纽记录小或者相等，high向右移动一个</div><div class="line">        swap(a,low,high);                   //交换，比枢纽记录大的放右边</div><div class="line">        show(a);</div><div class="line">    &#125;</div><div class="line">    System.out.println(&quot;pivot = &quot; + pivot);</div><div class="line">    System.out.println();</div><div class="line">    return low;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>调用<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">quickSort(a, <span class="number">0</span>, a.length-<span class="number">1</span>);</div></pre></td></tr></table></figure></p>
<p>运行结果<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">原序列: <span class="number">1</span> <span class="number">6</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">0</span> <span class="number">4</span> </div><div class="line">low = <span class="number">0</span></div><div class="line"><span class="number">0</span> <span class="number">6</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">1</span> <span class="number">4</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">6</span> <span class="number">4</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">6</span> <span class="number">4</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">6</span> <span class="number">4</span> </div><div class="line">pivot = <span class="number">1</span></div><div class="line"></div><div class="line">low = <span class="number">2</span></div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">4</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">4</span> <span class="number">5</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">6</span> <span class="number">9</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">4</span> <span class="number">2</span> <span class="number">3</span> <span class="number">8</span> <span class="number">5</span> <span class="number">7</span> <span class="number">6</span> <span class="number">9</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">4</span> <span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">9</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">4</span> <span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">9</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">4</span> <span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">9</span> </div><div class="line">pivot = <span class="number">5</span></div><div class="line"></div><div class="line">low = <span class="number">6</span></div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">4</span> <span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">4</span> <span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line">pivot = <span class="number">8</span></div><div class="line"></div><div class="line">low = <span class="number">6</span></div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">4</span> <span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">4</span> <span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line">pivot = <span class="number">6</span></div><div class="line"></div><div class="line">low = <span class="number">2</span></div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">3</span> <span class="number">2</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">3</span> <span class="number">2</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line">pivot = <span class="number">4</span></div><div class="line"></div><div class="line">low = <span class="number">2</span></div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line">pivot = <span class="number">3</span></div><div class="line"></div><div class="line">排序后: <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span></div></pre></td></tr></table></figure></p>
<h1 id="选择排序"><a href="#选择排序" class="headerlink" title="选择排序"></a>选择排序</h1><h2 id="思想-2"><a href="#思想-2" class="headerlink" title="思想"></a>思想</h2><p>一个简单的选择排序算法是这样的:<br>首先, 找到数组中最小的一个元素<br>其次, 将它和数组的第一个元素交换位置,(如果第一个元素是最小的那么它就和自己交换).<br>再次, 在剩下元素中继续找到最小的元素,将它和数组中第二个元素交换位置.<br>如此反复操作,直到将整个数组排序<br>这种方法就是简单选择排序.</p>
<h2 id="算法实现-2"><a href="#算法实现-2" class="headerlink" title="算法实现"></a>算法实现</h2><h3 id="C语言"><a href="#C语言" class="headerlink" title="C语言"></a>C语言</h3><p>原序列<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">int a[10] = &#123;4,3,2,6,1,9,5,8,7,0&#125;;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">/**简单选择排序</div><div class="line"> * */</div><div class="line">void SelectSort(int a[], int length)&#123;</div><div class="line">    int i, j;</div><div class="line">    int min;</div><div class="line">    for (i = 0; i &lt; length; ++i) &#123;</div><div class="line">        min = i;</div><div class="line">        for (j = i+1; j &lt; length; ++j) &#123;</div><div class="line">            if (a[j] &lt; a[min])&#123;</div><div class="line">                min = j;</div><div class="line">            &#125;</div><div class="line">            //printf(&quot;min = %d\n&quot;, min);//调试加上,</div><div class="line">        &#125;</div><div class="line">        if (min != i)&#123;</div><div class="line">            int temp = a[i];</div><div class="line">            a[i] = a[min];</div><div class="line">            a[min] = temp;</div><div class="line">        &#125;</div><div class="line">        show(a,length);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">原序列: <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">6</span> <span class="number">1</span> <span class="number">9</span> <span class="number">5</span> <span class="number">8</span> <span class="number">7</span> <span class="number">0</span> </div><div class="line"><span class="number">0</span> <span class="number">3</span> <span class="number">2</span> <span class="number">6</span> <span class="number">1</span> <span class="number">9</span> <span class="number">5</span> <span class="number">8</span> <span class="number">7</span> <span class="number">4</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">6</span> <span class="number">3</span> <span class="number">9</span> <span class="number">5</span> <span class="number">8</span> <span class="number">7</span> <span class="number">4</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">6</span> <span class="number">3</span> <span class="number">9</span> <span class="number">5</span> <span class="number">8</span> <span class="number">7</span> <span class="number">4</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">6</span> <span class="number">9</span> <span class="number">5</span> <span class="number">8</span> <span class="number">7</span> <span class="number">4</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">9</span> <span class="number">5</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">9</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">8</span> <span class="number">7</span> <span class="number">9</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line">排序后: <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span></div></pre></td></tr></table></figure></p>
<h3 id="java实现-2"><a href="#java实现-2" class="headerlink" title="java实现"></a>java实现</h3><p>原序列:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">int[] a = &#123;1,6,5,9,3,8,2,7,0, 4&#125;;</div></pre></td></tr></table></figure></p>
<p>第一次从0-9中选择最小的与第0个交换<br>第二次从1-9中选择最小的与第1个交换<br>重复以上步骤<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">selectSort</span><span class="params">(<span class="keyword">int</span>[] a)</span></span>&#123;</div><div class="line">    System.out.println(<span class="string">"选择排序算法:"</span>);</div><div class="line">    <span class="keyword">int</span> min, i, j;</div><div class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;a.length; i++)&#123;</div><div class="line">        min = i;</div><div class="line">        <span class="keyword">for</span> (j=i+<span class="number">1</span>; j&lt;a.length; j++)&#123;</div><div class="line">            <span class="keyword">if</span> (a[j] &lt; a[min])&#123;</div><div class="line">                min = j;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//System.out.println("min = " + min);</span></div><div class="line">        <span class="keyword">int</span> temp = a[i];</div><div class="line">        a[i] = a[min];</div><div class="line">        a[min] = temp;</div><div class="line">        System.out.print(<span class="string">"第"</span> + (i+<span class="number">1</span>) + <span class="string">"次排序后:"</span>);</div><div class="line">        show(a);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行结果:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">原序列: <span class="number">1</span> <span class="number">6</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">0</span> <span class="number">4</span> </div><div class="line">选择排序算法:</div><div class="line">第<span class="number">1</span>次排序后:<span class="number">0</span> <span class="number">6</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">1</span> <span class="number">4</span> </div><div class="line">第<span class="number">2</span>次排序后:<span class="number">0</span> <span class="number">1</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">6</span> <span class="number">4</span> </div><div class="line">第<span class="number">3</span>次排序后:<span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">5</span> <span class="number">7</span> <span class="number">6</span> <span class="number">4</span> </div><div class="line">第<span class="number">4</span>次排序后:<span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">9</span> <span class="number">8</span> <span class="number">5</span> <span class="number">7</span> <span class="number">6</span> <span class="number">4</span> </div><div class="line">第<span class="number">5</span>次排序后:<span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">8</span> <span class="number">5</span> <span class="number">7</span> <span class="number">6</span> <span class="number">9</span> </div><div class="line">第<span class="number">6</span>次排序后:<span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">9</span> </div><div class="line">第<span class="number">7</span>次排序后:<span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line">第<span class="number">8</span>次排序后:<span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line">第<span class="number">9</span>次排序后:<span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line">第<span class="number">10</span>次排序后:<span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line">排序后: <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span></div></pre></td></tr></table></figure></p>
<h1 id="插入排序"><a href="#插入排序" class="headerlink" title="插入排序"></a>插入排序</h1><h2 id="思想-3"><a href="#思想-3" class="headerlink" title="思想"></a>思想</h2><p>和整理扑克牌一样, 将每一张牌插入到其他已经有序的牌中的适当位置.在计算机实现中,为了要给插入的元素腾出空间, 我们需要将其余所有元素在插入之前都向右移动一位. 这种算法叫做插入排序.</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="C语言实现"><a href="#C语言实现" class="headerlink" title="C语言实现"></a>C语言实现</h3><p>原序列<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> a[<span class="number">10</span>] = &#123;<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">0</span>&#125;;</div></pre></td></tr></table></figure></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 直接插入排序*/</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">InsertSort</span><span class="params">(<span class="keyword">int</span> a[], <span class="keyword">int</span> length)</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> i,j;</div><div class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; length- <span class="number">1</span>; ++i) &#123;</div><div class="line">        <span class="keyword">for</span> (j = i+<span class="number">1</span>; j &gt; <span class="number">0</span> ; j--) &#123;</div><div class="line">            <span class="keyword">if</span> (a[j] &lt; a[j<span class="number">-1</span>])&#123;</div><div class="line">                <span class="comment">//交换</span></div><div class="line">                <span class="keyword">int</span> temp = a[j];</div><div class="line">                a[j] = a[j<span class="number">-1</span>];</div><div class="line">                a[j<span class="number">-1</span>] = temp;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        show(a,MAX_SIZE);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">原序列: 4 3 2 6 1 9 5 8 7 0 </div><div class="line">3 4 2 6 1 9 5 8 7 0 </div><div class="line">2 3 4 6 1 9 5 8 7 0 </div><div class="line">2 3 4 6 1 9 5 8 7 0 </div><div class="line">1 2 3 4 6 9 5 8 7 0 </div><div class="line">1 2 3 4 6 9 5 8 7 0 </div><div class="line">1 2 3 4 5 6 9 8 7 0 </div><div class="line">1 2 3 4 5 6 8 9 7 0 </div><div class="line">1 2 3 4 5 6 7 8 9 0 </div><div class="line">0 1 2 3 4 5 6 7 8 9 </div><div class="line">排序后: 0 1 2 3 4 5 6 7 8 9</div></pre></td></tr></table></figure></p>
<h3 id="Java实现"><a href="#Java实现" class="headerlink" title="Java实现"></a>Java实现</h3><p>原序列:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span>[] a = &#123;<span class="number">1</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">4</span>&#125;;</div></pre></td></tr></table></figure></p>
<p>第一次把第2个数依次从右往左和1个数比较<br>第二次把第3个数依次从右往左和2个数比较<br>重复以上步骤</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">insertSort</span><span class="params">(<span class="keyword">int</span>[] a)</span></span>&#123;</div><div class="line">    System.out.println(<span class="string">"插入排序算法:"</span>);</div><div class="line">    <span class="keyword">int</span> i, j;</div><div class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;a.length; i++)&#123;</div><div class="line">        <span class="keyword">for</span> (j=i; j&gt;<span class="number">0</span>; j--)&#123;</div><div class="line">            <span class="keyword">if</span> (a[j] &lt; a[j-<span class="number">1</span>])&#123;</div><div class="line">                <span class="keyword">int</span> temp = a[j];</div><div class="line">                a[j] = a[j-<span class="number">1</span>];</div><div class="line">                a[j-<span class="number">1</span>] = temp;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        System.out.print(<span class="string">"第"</span> + (i+<span class="number">1</span>) + <span class="string">"次排序后:"</span>);</div><div class="line">        show(a);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">原序列: <span class="number">1</span> <span class="number">6</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">0</span> <span class="number">4</span> </div><div class="line">插入排序算法:</div><div class="line">第<span class="number">1</span>次排序后:<span class="number">1</span> <span class="number">6</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">0</span> <span class="number">4</span> </div><div class="line">第<span class="number">2</span>次排序后:<span class="number">1</span> <span class="number">6</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">0</span> <span class="number">4</span> </div><div class="line">第<span class="number">3</span>次排序后:<span class="number">1</span> <span class="number">5</span> <span class="number">6</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">0</span> <span class="number">4</span> </div><div class="line">第<span class="number">4</span>次排序后:<span class="number">1</span> <span class="number">5</span> <span class="number">6</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">0</span> <span class="number">4</span> </div><div class="line">第<span class="number">5</span>次排序后:<span class="number">1</span> <span class="number">3</span> <span class="number">5</span> <span class="number">6</span> <span class="number">9</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">0</span> <span class="number">4</span> </div><div class="line">第<span class="number">6</span>次排序后:<span class="number">1</span> <span class="number">3</span> <span class="number">5</span> <span class="number">6</span> <span class="number">8</span> <span class="number">9</span> <span class="number">2</span> <span class="number">7</span> <span class="number">0</span> <span class="number">4</span> </div><div class="line">第<span class="number">7</span>次排序后:<span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">6</span> <span class="number">8</span> <span class="number">9</span> <span class="number">7</span> <span class="number">0</span> <span class="number">4</span> </div><div class="line">第<span class="number">8</span>次排序后:<span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">0</span> <span class="number">4</span> </div><div class="line">第<span class="number">9</span>次排序后:<span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">4</span> </div><div class="line">第<span class="number">10</span>次排序后:<span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line">排序后: <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span></div></pre></td></tr></table></figure></p>
<h1 id="希尔排序"><a href="#希尔排序" class="headerlink" title="希尔排序"></a>希尔排序</h1><h2 id="思想-4"><a href="#思想-4" class="headerlink" title="思想"></a>思想</h2><p>希尔排序的思想是使数组中任意间隔为h的元素都是有序的. 这样的数组成为h有序数组<br>简单地说, 一个h有序数组就是h个互相独立的有序数组编织在一起组成的一个数组.<br>在进行排序时, 如果h很大, 我们能将元素移动到很远的地方, 为实现更小的h有序数组创造方便, 用这种方式,对于任意以1结尾的h序列, 我们都能够将数组排序.<br>这就是希尔排序.</p>
<p>##　实现</p>
<h3 id="C语言实现-1"><a href="#C语言实现-1" class="headerlink" title="C语言实现"></a>C语言实现</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 希尔排序*/</div><div class="line"> <span class="function"><span class="keyword">void</span> <span class="title">ShellSort</span><span class="params">(<span class="keyword">int</span> a[], <span class="keyword">int</span> length)</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> h = <span class="number">1</span>;  <span class="comment">//增量</span></div><div class="line">    <span class="comment">//while(h &lt;= length/3) h = 3*h + 1;   //增量初始值 我写的</span></div><div class="line">    <span class="keyword">while</span>(h &lt; length/<span class="number">3</span>) h = <span class="number">3</span>*h + <span class="number">1</span>;   <span class="comment">//增量初始值</span></div><div class="line"></div><div class="line">    <span class="keyword">while</span> (h &gt;= <span class="number">1</span>)&#123;     <span class="comment">//对每个增量都进行排序</span></div><div class="line">        <span class="keyword">int</span> i;</div><div class="line">        <span class="keyword">for</span> (i = h; i &lt; length; ++i) &#123;      <span class="comment">//对同一增量的每个分组进行排序</span></div><div class="line">            <span class="keyword">int</span> j;</div><div class="line">            <span class="comment">//for (j = i; j &lt; length; j= j-h) &#123;   //对每个分组进行插入排序     我写的</span></div><div class="line">            <span class="keyword">for</span> (j = i; j &gt;= h; j= j-h) &#123;   <span class="comment">//对每个分组进行插入排序</span></div><div class="line">                <span class="keyword">if</span>(a[j] &lt; a[j-h])&#123;</div><div class="line">                    <span class="keyword">int</span> temp = a[j];</div><div class="line">                    a[j] = a[j-h];</div><div class="line">                    a[j-h] = temp;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        show(a,MAX_SIZE);</div><div class="line">        h = h/<span class="number">3</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">原序列: <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">6</span> <span class="number">1</span> <span class="number">9</span> <span class="number">5</span> <span class="number">8</span> <span class="number">7</span> <span class="number">0</span> </div><div class="line"><span class="number">1</span> <span class="number">0</span> <span class="number">2</span> <span class="number">6</span> <span class="number">4</span> <span class="number">3</span> <span class="number">5</span> <span class="number">8</span> <span class="number">7</span> <span class="number">9</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line">排序后: <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span></div></pre></td></tr></table></figure></p>
<h3 id="Java实现-1"><a href="#Java实现-1" class="headerlink" title="Java实现"></a>Java实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">shellSort</span><span class="params">(<span class="keyword">int</span>[] a)</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> N = a.length;</div><div class="line">    <span class="keyword">int</span> h = <span class="number">1</span>;</div><div class="line">    <span class="keyword">while</span> (h &lt; (N/<span class="number">3</span>)) h = h * <span class="number">3</span> + <span class="number">1</span>;</div><div class="line">    <span class="keyword">while</span> (h &gt;= <span class="number">1</span>)&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=h; i&lt;N; i++)&#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=i; j&gt;=h;j=j-h)&#123;</div><div class="line">                <span class="comment">//进行插入排序</span></div><div class="line">                <span class="keyword">if</span> (a[j] &lt; a[j-h])&#123;</div><div class="line">                    <span class="keyword">int</span> temp = a[j];</div><div class="line">                    a[j]= a[j-h];</div><div class="line">                    a[j-h] = temp;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        System.out.print(<span class="string">"h = "</span> + h + <span class="string">": "</span>);</div><div class="line">        show(a);</div><div class="line">        h = h/<span class="number">3</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">原序列: <span class="number">1</span> <span class="number">6</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">0</span> <span class="number">4</span> </div><div class="line">h = <span class="number">4</span>: <span class="number">0</span> <span class="number">4</span> <span class="number">2</span> <span class="number">7</span> <span class="number">1</span> <span class="number">6</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> </div><div class="line">h = <span class="number">1</span>: <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line">排序后: <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span></div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;冒泡排序&quot;&gt;&lt;a href=&quot;#冒泡排序&quot; class=&quot;headerlink&quot; title=&quot;冒泡排序&quot;&gt;&lt;/a&gt;冒泡排序&lt;/h1&gt;&lt;h2 id=&quot;思想&quot;&gt;&lt;a href=&quot;#思想&quot; class=&quot;headerlink&quot; title=&quot;思想&quot;&gt;&lt;/a&gt;思想&lt;/h
    
    </summary>
    
      <category term="算法" scheme="https://devallever.github.io/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="Java" scheme="https://devallever.github.io/tags/Java/"/>
    
      <category term="算法" scheme="https://devallever.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
      <category term="排序" scheme="https://devallever.github.io/tags/%E6%8E%92%E5%BA%8F/"/>
    
      <category term="C" scheme="https://devallever.github.io/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>Kotlin学习笔记 1</title>
    <link href="https://devallever.github.io/2017/05/22/kotlin-note-1/"/>
    <id>https://devallever.github.io/2017/05/22/kotlin-note-1/</id>
    <published>2017-05-22T09:30:55.000Z</published>
    <updated>2017-05-22T11:51:54.960Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>这里并没有系统的讲解Kotlin语法, 只是在做Demo时候刻意使用Kotlin语言,并记录一下使用方法<br>如果要学习可以看看官网的文档,以及它推荐的一些书籍</p>
</blockquote>
<h1 id="Activity"><a href="#Activity" class="headerlink" title="Activity"></a>Activity</h1><p>例如创建一个BaseActivity,则这样写<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">open class BaseActivity : AppCompatActivity() &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>open: 关键字, 如果该类用来继承的要加上open, 或者abstract</li>
<li>继承的方式是 : </li>
</ul>
<p>既然是Activity的子类,那么在重写onCreate方法时候会自动补全代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">open class BaseActivity : AppCompatActivity() &#123;</div><div class="line">    override fun onCreate(savedInstanceState: Bundle?) &#123;</div><div class="line">        super.onCreate(savedInstanceState)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>override: 不用看就知道是方法覆盖啦</li>
<li>fun 是定义方法</li>
<li>注意方法参数的表达方式跟Java有点区别,先是变量名,再指明类型.</li>
<li>注意问号?, Kotlin是空安全的, 这里表示Bundle可以为空, 第一次自学Kotlin,理解的不是很到位,望指正哈.</li>
</ul>
<h1 id="Button"><a href="#Button" class="headerlink" title="Button"></a>Button</h1><p>创建了Activity自然就是添加几个按钮,监听,<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">val btn_scale = findViewById(R.id.btn) as TextView</div><div class="line">btn_scale.setOnClickListener &#123;</div><div class="line">	//do something</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>val 定义变量, 相当与final, 之后不能修改引用,<br>var 则是初始化以后也可以指向其他引用</li>
<li>findViewById(R.id.btn) as TextView<br>找到控件之后通过 as 关键字转化TextView类型</li>
<li>设置监听,方法跟java一样,但是不再是传递一个OnClickListener,直接大括号{}<br>当然也可以看看标准使用方式是这样的<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">btn.setOnClickListener(View.OnClickListener &#123; </div><div class="line">	//do something</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</li>
</ul>
<p>如果不想每个Button设置监听都串OnClickListener,则要Activity实现OnClickListener只要在继承的类后面加入 , OnClickListener, 并从写onClick方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">class AnimationActivity : BaseActivity(), View.OnClickListener &#123;</div><div class="line"></div><div class="line">	...</div><div class="line">	override fun onClick(v: View?) &#123;</div><div class="line">        val intent: Intent</div><div class="line">        when(v?.id)&#123;</div><div class="line">            R.id.id_animation_activity_view_animation -&gt;&#123;</div><div class="line">                intent = Intent(this, ViewAnimationActivity::class.java)</div><div class="line">                startActivity(intent)</div><div class="line">            &#125;</div><div class="line">            R.id.id_animation_activity_property_animation -&gt;&#123;</div><div class="line">                intent = Intent(this, PropertyAnimationActivity::class.java)</div><div class="line">                startActivity(intent)</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>细心的你已经发现,这里有很多新奇好玩的东西,下面逐一讲解</p>
<h1 id="使用分支"><a href="#使用分支" class="headerlink" title="使用分支"></a>使用分支</h1><p>在java使用条件的分之是通过switch(){}来使用的,而在Kotlin就是用 when 关键字<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">when(v?.id)&#123;</div><div class="line">	R.id.id_animation_activity_view_animation -&gt;&#123;</div><div class="line">		// do something</div><div class="line">	&#125;</div><div class="line">	R.id.id_animation_activity_property_animation -&gt;&#123;</div><div class="line">		//do something</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>很明显when()括号内就是判断的类型,这里是view的id<br>然后每个分之就是这么判断<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">R.id.id_animation_activity_view_animation -&gt;&#123;</div><div class="line">	//do something</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="启动另一个Acivity"><a href="#启动另一个Acivity" class="headerlink" title="启动另一个Acivity"></a>启动另一个Acivity</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">val intent: Intent</div><div class="line">intent = Intent(this, XXXActivity::class.java)</div><div class="line">startActivity(intent)</div></pre></td></tr></table></figure>
<p>至于为什么这样用,我现在还不是很清楚哎<br>另外,如果在某某控件的监听方法中启动另一个Activity,应该是这样,这里使用的是recyclerView的监听<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">intent = Intent(this@MainActivity, XXXActivity::class.java)</div><div class="line">startActivity(intent)</div></pre></td></tr></table></figure></p>
<h1 id="声明变量"><a href="#声明变量" class="headerlink" title="声明变量"></a>声明变量</h1><p>在声明局部变量时候, 通常使用val,但是当声明一个全局变量时候,通常使用var,并在声明的时候初始化为空, 例如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">private var tv_target: TextView? = null</div></pre></td></tr></table></figure></p>
<p>表示声明一个TextView对象, 并初始化为空,不初始化就报错的<br>然后在Activity中正常使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tv_target = findViewById(R.id.id_view_animation_activity_tv_target) as TextView</div></pre></td></tr></table></figure></p>
<p>当要修改TextView的显示的值时候, 不再是setText(),<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tv_target.setText(&quot;&quot;);</div></pre></td></tr></table></figure></p>
<p>而是通过设置属性值方式,它会调用setText()方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tv_target.text = &quot;hello&quot;</div></pre></td></tr></table></figure></p>
<p>以后setXXX方法都是按这种方式使用 ,但上面的还是报错,因为tv_target定义为 TevtView?<br>报错信息:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Smart cast to &apos;TextView&apos; is impossible, because &apos;tv_target&apos; is a mutable property that could have been changed by this time</div></pre></td></tr></table></figure></p>
<p>so 正确的姿势是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tv_target?.text = &quot;hello&quot;</div></pre></td></tr></table></figure></p>
<h1 id="定义实体类"><a href="#定义实体类" class="headerlink" title="定义实体类"></a>定义实体类</h1><p>在Java中, 需要定义属性,并且创建该属性的gettet和setter方法<br>在Kotlin中只需要这样<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class ListItem(</div><div class="line">        var title: String,</div><div class="line">        var description: String</div><div class="line">)</div></pre></td></tr></table></figure></p>
<p>这样它会自动生成getter和setter方法,并不需要要我们实现<br>通常我们这样使用,<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var listItemA = ListItem(&quot;titleText&quot;, &quot;descriptionText&quot;)</div><div class="line">listItemA.title = &quot;HI Title&quot;</div><div class="line">listItemA.description = &quot;Hi Description&quot;</div></pre></td></tr></table></figure></p>
<h1 id="定义方法并设置参数的默认值"><a href="#定义方法并设置参数的默认值" class="headerlink" title="定义方法并设置参数的默认值"></a>定义方法并设置参数的默认值</h1><p>例如在Activity中定义Toast的方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">private fun toast(message: String, length: Int=Toast.LENGTH_LONG):Unit&#123;</div><div class="line">	Toast.makeText(this@MainActivity, message,length).show()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Unit为返回类型,Unit表相当于示返回值为void,并且可以省略Unit,如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">private fun toast(message: String, length: Int=Toast.LENGTH_LONG)&#123;</div><div class="line">        Toast.makeText(this@MainActivity, message,length).show()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里length参数指定了一个默认值就是Toast.LENGTH_LONG<br>调用是应该这样<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">toast(&quot;HI Android&quot;)</div><div class="line">//或</div><div class="line">toast(&quot;Hi Android&quot;,1000)</div></pre></td></tr></table></figure></p>
<h1 id="使用RecyclerView"><a href="#使用RecyclerView" class="headerlink" title="使用RecyclerView"></a>使用RecyclerView</h1><p>在Activity通常定义一个ArrayList类型的全局变量,作为Adapter的参数<br>因此这样声明一个全局变量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">private var listItems: ArrayList&lt;ListItem&gt;? = null</div></pre></td></tr></table></figure></p>
<blockquote>
<p>注意这里是ArrayList? 类型</p>
</blockquote>
<p>然后创建Adapter,他的构造方法如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class MyRecyclerViewAdapter(private val context: Context,</div><div class="line">                            private val listItems: ArrayList&lt;ListItem&gt;?) </div><div class="line">    : RecyclerView.Adapter&lt;MyRecyclerViewAdapter.MyViewHolder&gt;() &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>构造方法中listItems的类型也是ArrayList?, 因为在Activity中, 定义一个可变的全局变量时候初始化为空,因此这里与之对应<br>初始化listItems对象<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">listItems =  ArrayList&lt;ListItem&gt;()</div><div class="line">listItems?.add(ListItem(&quot;chapter1&quot;, &quot;Android Framework&quot;))</div><div class="line">listItems!!.add(ListItem(&quot;chapter2&quot;, &quot;Android Developer tools&quot;))</div><div class="line">listItems!!.add(ListItem(&quot;chapter3&quot;, &quot;Custom View&quot;))</div><div class="line">listItems!!.add(ListItem(&quot;chapter4&quot;, &quot;listView Demo&quot;))</div><div class="line">listItems!!.add(ListItem(&quot;chapter5&quot;, &quot;Scroll Analysis&quot;))</div><div class="line">listItems!!.add(ListItem(&quot;chapter6&quot;, &quot;Draw&quot;))</div><div class="line">listItems!!.add(ListItem(&quot;chapter7&quot;, &quot;Animation Demo&quot;))</div></pre></td></tr></table></figure></p>
<p>在这里不知道?. 和 !!. 到底有什么区别.有待深入研究,这时候要知道该这么用就够了<br>最后就是这样使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">val recyclerView = findViewById(R.id.id_main_recycler_view) as RecyclerView</div><div class="line">val recyclerViewAdapter = MyRecyclerViewAdapter(this,listItems)</div><div class="line">recyclerView.layoutManager = LinearLayoutManager(this)</div><div class="line">recyclerView.adapter = recyclerViewAdapter</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;这里并没有系统的讲解Kotlin语法, 只是在做Demo时候刻意使用Kotlin语言,并记录一下使用方法&lt;br&gt;如果要学习可以看看官网的文档,以及它推荐的一些书籍&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;Activity&quot;&gt;&lt;a hre
    
    </summary>
    
      <category term="Kotlin" scheme="https://devallever.github.io/categories/Kotlin/"/>
    
    
      <category term="Android" scheme="https://devallever.github.io/tags/Android/"/>
    
      <category term="Kotlin" scheme="https://devallever.github.io/tags/Kotlin/"/>
    
  </entry>
  
  <entry>
    <title>Android 动画 简单使用</title>
    <link href="https://devallever.github.io/2017/05/22/animation-primary/"/>
    <id>https://devallever.github.io/2017/05/22/animation-primary/</id>
    <published>2017-05-22T08:54:53.000Z</published>
    <updated>2017-05-24T07:26:15.204Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>顺便学习一下Kotlin语言</p>
</blockquote>
<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>动画能带来良好的用户体验,作为Android程序员,必须掌握最最最基本的几种动画实现方式,包括透明度,位移,旋转,缩放.</p>
<h1 id="属性动画"><a href="#属性动画" class="headerlink" title="属性动画"></a>属性动画</h1><p>属性动画是Android 3.0推出的动画框架,能实现视图动画所有动画效果,并且能完成视图动画不具备的功能. 例如一个在左上角的按钮使用视图动画将他移动到右下角,点击时候发现原来的点击监听已经不起作用了. 简单说,视图动画仅仅改变了控件的绘制,并没有改变其属性值.如果使用属性动画将它移动,那么原来的监听还是有的,这是真正的移动啊.属性动画就是这么强大  </p>
<p> 属性动画最重要的两个类</p>
<ul>
<li>ValueAnimator</li>
<li>ObjectAnimator</li>
</ul>
<blockquote>
<p>原理:<br>属性动画作用于任何对象, 变化的属性名必须有该对象要有对应的getXXX和setXXX方法.</p>
</blockquote>
<p>下面逐一讲讲</p>
<h2 id="ValueAnimator"><a href="#ValueAnimator" class="headerlink" title="ValueAnimator"></a>ValueAnimator</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">fun startValueAnimation()&#123;</div><div class="line">    val valueAnimator = ValueAnimator.ofFloat(0f,1f)</div><div class="line">    valueAnimator.duration = 3000</div><div class="line">    valueAnimator.repeatCount = 2</div><div class="line">    valueAnimator.repeatMode = ValueAnimator.RESTART    //重复</div><div class="line">    //valueAnimator.repeatMode = ValueAnimator.REVERSE    //倒回</div><div class="line">    valueAnimator.start()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>ofFloat()传入的值类型为float, 表示该值从1f 变化到 3f, 1f是初始值, 3f是最终值, ofFloat()传入的是可变参数, 即可以传入多个值,表示变化过程, 如: ofFloat(1f, 3f, 2f, 5f), 这里逐步并不是一下子从1f直接变化到3f,而是有个过程,每个过程值都不一样,</li>
<li>也许这里看不到变化, 但是动画所设置的值是变化了的,</li>
</ul>
<h2 id="ObjectAnimator"><a href="#ObjectAnimator" class="headerlink" title="ObjectAnimator"></a>ObjectAnimator</h2><p>ObjectAnimator继承了ValueAnimator, 所以可以使用父类方法对动画进行一些通用设置, 不同的是创建ObjectAnimator对象</p>
<h3 id="透明动画"><a href="#透明动画" class="headerlink" title="透明动画"></a>透明动画</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">fun startAlpha(view: View)&#123;</div><div class="line">        val alphaAnimator = ObjectAnimator.ofFloat(view,&quot;alpha&quot;, 1f,0f,1f)</div><div class="line">        alphaAnimator.duration = 1000</div><div class="line">        alphaAnimator.start()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>view: 动画作用的对象</li>
<li>“alpha”: 值变化属性名, 及view对象中必须要有getAlpha()和serAlpha()方法,</li>
<li>1f,0f,1f: 表示变化过程, 不透明-&gt;全透明-&gt;不透明</li>
</ul>
<h3 id="旋转动画"><a href="#旋转动画" class="headerlink" title="旋转动画"></a>旋转动画</h3><p>如旋转30度:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">fun startRotate(view: View)&#123;</div><div class="line">        val rotateAnimator = ObjectAnimator.ofFloat(view,&quot;rotation&quot;, 0f,360f)</div><div class="line">        rotateAnimator.duration = 1000</div><div class="line">        rotateAnimator.start()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="位移动画"><a href="#位移动画" class="headerlink" title="位移动画"></a>位移动画</h3><h4 id="X轴位移"><a href="#X轴位移" class="headerlink" title="X轴位移"></a>X轴位移</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">fun startTranslateX(view: View)&#123;</div><div class="line">        val currentX: Float= view.translationX</div><div class="line">        val translateXAnimator = ObjectAnimator.ofFloat(view,&quot;translationX&quot;,currentX,-500f,currentX,500f,currentX)</div><div class="line">        translateXAnimator.duration = 1000</div><div class="line">        translateXAnimator.start()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>currentX: view原来的X坐标值</li>
<li>动画过程,从原来位置开始,左移500像素,回到原来位置,右移500像素,回到原来位置<h4 id="Y轴位移"><a href="#Y轴位移" class="headerlink" title="Y轴位移"></a>Y轴位移</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">fun startTranslateY(view: View)&#123;</div><div class="line">        val currentY: Float= view.translationY</div><div class="line">        val translateYAnimator = ObjectAnimator.ofFloat(view,&quot;translationY&quot;,currentY,-500f,currentY,500f,currentY)</div><div class="line">        translateYAnimator.duration = 1000</div><div class="line">        translateYAnimator.start()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="缩放动画"><a href="#缩放动画" class="headerlink" title="缩放动画"></a>缩放动画</h3><p>同样，支持Ｘ方向　和Ｙ方向</p>
<h4 id="X轴缩放"><a href="#X轴缩放" class="headerlink" title="X轴缩放"></a>X轴缩放</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">fun startScaleX(view: View)&#123;</div><div class="line">        val scaleXAnimator = ObjectAnimator.ofFloat(view,&quot;scaleX&quot;,1F,3F,1F)</div><div class="line">        scaleXAnimator.duration = 1000</div><div class="line">        scaleXAnimator.start()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="动画集合"><a href="#动画集合" class="headerlink" title="动画集合"></a>动画集合</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">fun startAnimatorSet(view: View)&#123;</div><div class="line">        val animatorSet = AnimatorSet()</div><div class="line"></div><div class="line">        val alphaAnimator = ObjectAnimator.ofFloat(view,&quot;alpha&quot;, 1f,0f,1f)</div><div class="line"></div><div class="line">        val rotateAnimator = ObjectAnimator.ofFloat(view,&quot;rotation&quot;, 0f,360f)</div><div class="line"></div><div class="line">        val scaleXAnimator = ObjectAnimator.ofFloat(view,&quot;scaleX&quot;,1F,3F,1F)</div><div class="line"></div><div class="line">        animatorSet.play(alphaAnimator).after(rotateAnimator).after(scaleXAnimator)</div><div class="line">        animatorSet.duration = 2000</div><div class="line">        animatorSet.start()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="使用XML动画"><a href="#使用XML动画" class="headerlink" title="使用XML动画"></a>使用XML动画</h2><p>在res建立animator文件夹<br>在animator下创建动画的xml文件,如:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;set xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:ordering=&quot;sequentially&quot;&gt;</div><div class="line">    &lt;objectAnimator</div><div class="line">        android:propertyName=&quot;alpha&quot;</div><div class="line">        android:duration=&quot;500&quot;</div><div class="line">        android:valueFrom=&quot;1&quot;</div><div class="line">        android:valueTo=&quot;0&quot;</div><div class="line">        android:valueType=&quot;floatType&quot;&gt;</div><div class="line">    &lt;/objectAnimator&gt;</div><div class="line"></div><div class="line">    &lt;objectAnimator</div><div class="line">        android:propertyName=&quot;alpha&quot;</div><div class="line">        android:duration=&quot;500&quot;</div><div class="line">        android:valueFrom=&quot;0&quot;</div><div class="line">        android:valueTo=&quot;1&quot;</div><div class="line">        android:valueType=&quot;floatType&quot;&gt;</div><div class="line">    &lt;/objectAnimator&gt;</div><div class="line">    &lt;set</div><div class="line">        android:ordering=&quot;together&quot;&gt;</div><div class="line">        &lt;objectAnimator</div><div class="line">            android:propertyName=&quot;rotation&quot;</div><div class="line">            android:duration=&quot;1000&quot;</div><div class="line">            android:valueFrom=&quot;0&quot;</div><div class="line">            android:valueTo=&quot;360&quot;</div><div class="line">            android:valueType=&quot;floatType&quot;&gt;</div><div class="line">        &lt;/objectAnimator&gt;</div><div class="line">        &lt;set</div><div class="line">            android:ordering=&quot;sequentially&quot;&gt;</div><div class="line">            &lt;objectAnimator</div><div class="line">                android:propertyName=&quot;scaleY&quot;</div><div class="line">                android:duration=&quot;500&quot;</div><div class="line">                android:valueFrom=&quot;1&quot;</div><div class="line">                android:valueTo=&quot;3&quot;</div><div class="line">                android:valueType=&quot;floatType&quot;&gt;</div><div class="line">            &lt;/objectAnimator&gt;</div><div class="line">            &lt;objectAnimator</div><div class="line">                android:propertyName=&quot;scaleY&quot;</div><div class="line">                android:duration=&quot;500&quot;</div><div class="line">                android:valueFrom=&quot;3&quot;</div><div class="line">                android:valueTo=&quot;1&quot;</div><div class="line">                android:valueType=&quot;floatType&quot;&gt;</div><div class="line">            &lt;/objectAnimator&gt;</div><div class="line">        &lt;/set&gt;</div><div class="line">    &lt;/set&gt;</div><div class="line">&lt;/set&gt;</div></pre></td></tr></table></figure></p>
<p>在代码中这样调用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">fun startXMLAnimation(view: View)&#123;</div><div class="line">        val animator = AnimatorInflater.loadAnimator(this,R.animator.animator_test)</div><div class="line">        animator.setTarget(view)</div><div class="line">        animator.start()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="视图动画"><a href="#视图动画" class="headerlink" title="视图动画"></a>视图动画</h1><h2 id="透明度动画"><a href="#透明度动画" class="headerlink" title="透明度动画"></a>透明度动画</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 1:不透明</div><div class="line"> * 0:全透明**/</div><div class="line">fun startAlpha()&#123;</div><div class="line">    val alphaAnimation = AlphaAnimation(0f,1f)</div><div class="line">    alphaAnimation.duration = 1000</div><div class="line">    tv_target?.startAnimation(alphaAnimation)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="旋转动画-1"><a href="#旋转动画-1" class="headerlink" title="旋转动画"></a>旋转动画</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 参数1: 开始角</div><div class="line"> * 参数2: 旋转角</div><div class="line"> * 参数3: **/</div><div class="line">fun startRotate()&#123;</div><div class="line">    //val rotateAnimation = RotateAnimation(0f,360f,0f,0f)</div><div class="line"></div><div class="line">    //以自身中心旋转</div><div class="line">    val rotateAnimation = RotateAnimation(</div><div class="line">            0f,360f,</div><div class="line">            RotateAnimation.RELATIVE_TO_SELF,0.5F,</div><div class="line">            RotateAnimation.RELATIVE_TO_SELF,0.5F</div><div class="line">    )</div><div class="line">    rotateAnimation.duration = 1000</div><div class="line">    tv_target?.startAnimation(rotateAnimation)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="位移动画-1"><a href="#位移动画-1" class="headerlink" title="位移动画"></a>位移动画</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * fromX</div><div class="line"> * toX</div><div class="line"> * fromY</div><div class="line"> * toY**/</div><div class="line">fun startTranslate()&#123;</div><div class="line">    val translateAnimation = TranslateAnimation(0f,200f,0f,300f)</div><div class="line">    translateAnimation.duration = 1000</div><div class="line">    tv_target?.startAnimation(translateAnimation)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="缩放动画-1"><a href="#缩放动画-1" class="headerlink" title="缩放动画"></a>缩放动画</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * fromX</div><div class="line"> * toX</div><div class="line"> * fromY</div><div class="line"> * toY**/</div><div class="line">fun startScale()&#123;</div><div class="line">    //val scaleAnimation = ScaleAnimation(0f,2f,0f,2f)</div><div class="line">    //设置中心点缩放</div><div class="line">    val scaleAnimation = ScaleAnimation(0f,2f,0f,2f,</div><div class="line">            ScaleAnimation.RELATIVE_TO_SELF,0.5F,</div><div class="line">            ScaleAnimation.RELATIVE_TO_SELF,0.5F)</div><div class="line">    scaleAnimation.duration = 1000</div><div class="line">    tv_target?.startAnimation(scaleAnimation)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="SVG动画"><a href="#SVG动画" class="headerlink" title="SVG动画"></a>SVG动画</h1><p>使用步骤</p>
<h2 id="创建静态SVG图形"><a href="#创建静态SVG图形" class="headerlink" title="创建静态SVG图形"></a>创建静态SVG图形</h2><p>在drawable的资源文件夹下创建xml文件,line_svg_vector.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;vector xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:height=&quot;200dp&quot;</div><div class="line">    android:width=&quot;200dp&quot;</div><div class="line">    android:viewportHeight=&quot;100&quot;</div><div class="line">    android:viewportWidth=&quot;100&quot;&gt;</div><div class="line">    &lt;group&gt;</div><div class="line">        &lt;path</div><div class="line">            android:name=&quot;path1&quot;</div><div class="line">            android:strokeColor=&quot;#3F51B5&quot;</div><div class="line">            android:strokeWidth=&quot;5&quot;</div><div class="line">            android:strokeLineCap=&quot;round&quot;</div><div class="line">            android:pathData=&quot;M 20,80</div><div class="line">                              L 50,80,80,80&quot;/&gt;</div><div class="line"></div><div class="line">        &lt;path</div><div class="line">            android:name=&quot;path2&quot;</div><div class="line">            android:strokeColor=&quot;#3F51B5&quot;</div><div class="line">            android:strokeWidth=&quot;5&quot;</div><div class="line">            android:strokeLineCap=&quot;round&quot;</div><div class="line">            android:pathData=&quot;M 20,20</div><div class="line">                              L 50,20,80,20&quot;/&gt;</div><div class="line">    &lt;/group&gt;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">&lt;/vector&gt;</div></pre></td></tr></table></figure></p>
<h2 id="创建动画资源xml文件"><a href="#创建动画资源xml文件" class="headerlink" title="创建动画资源xml文件"></a>创建动画资源xml文件</h2><p>在animator下创建, 每个图形都要有一个动画过程<br>line_path_1.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;objectAnimator</div><div class="line">    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:interpolator=&quot;@android:anim/bounce_interpolator&quot;</div><div class="line">    android:duration=&quot;500&quot;</div><div class="line">    android:propertyName=&quot;pathData&quot;</div><div class="line">    android:valueFrom=&quot;M 20,80 L 50,80,80,80&quot;</div><div class="line">    android:valueTo=&quot;M 20,80 L 50,50,80,80&quot;</div><div class="line">    android:valueType=&quot;pathType&quot;</div><div class="line">    &gt;</div><div class="line"></div><div class="line">&lt;/objectAnimator&gt;</div></pre></td></tr></table></figure></p>
<p>line_path_2.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;objectAnimator</div><div class="line">    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:interpolator=&quot;@android:anim/bounce_interpolator&quot;</div><div class="line">    android:duration=&quot;500&quot;</div><div class="line">    android:propertyName=&quot;pathData&quot;</div><div class="line">    android:valueFrom=&quot;M 20,20 L 50,20,80,20&quot;</div><div class="line">    android:valueTo=&quot;M 20,20 L 50,50,80,20&quot;</div><div class="line">    android:valueType=&quot;pathType&quot;</div><div class="line">    &gt;</div><div class="line"></div><div class="line">&lt;/objectAnimator&gt;</div></pre></td></tr></table></figure></p>
<h2 id="把静态SVG和动画资源联合起来"><a href="#把静态SVG和动画资源联合起来" class="headerlink" title="把静态SVG和动画资源联合起来"></a>把静态SVG和动画资源联合起来</h2><p>在drawable-v21目录下创建xml文件:line_animated_vector.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;animated-vector</div><div class="line">    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:drawable=&quot;@drawable/line_svg_vector&quot;&gt;</div><div class="line">    &lt;target</div><div class="line">        android:animation=&quot;@animator/line_path_1&quot;</div><div class="line">        android:name=&quot;path1&quot;/&gt;</div><div class="line">    &lt;target</div><div class="line">        android:animation=&quot;@animator/line_path_2&quot;</div><div class="line">        android:name=&quot;path2&quot;/&gt;</div><div class="line"></div><div class="line">&lt;/animated-vector&gt;</div></pre></td></tr></table></figure></p>
<h2 id="使用SVG资源"><a href="#使用SVG资源" class="headerlink" title="使用SVG资源"></a>使用SVG资源</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:orientation=&quot;vertical&quot; android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;&gt;</div><div class="line"></div><div class="line">    &lt;ImageView</div><div class="line">        android:id=&quot;@+id/id_svg_animation_activity_iv_line_svg&quot;</div><div class="line">        android:layout_width=&quot;150dp&quot;</div><div class="line">        android:layout_height=&quot;150dp&quot;</div><div class="line">        android:layout_gravity=&quot;center_horizontal&quot;</div><div class="line">        android:src=&quot;@drawable/line_animated_vector&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;ImageView</div><div class="line">        android:id=&quot;@+id/id_svg_animation_activity_iv_sun_system_svg&quot;</div><div class="line">        android:layout_width=&quot;150dp&quot;</div><div class="line">        android:layout_height=&quot;150dp&quot;</div><div class="line">        android:layout_gravity=&quot;center_horizontal&quot;</div><div class="line">        android:src=&quot;@drawable/sun_system_animated_vector&quot;/&gt;</div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure>
<h2 id="开启动画"><a href="#开启动画" class="headerlink" title="开启动画"></a>开启动画</h2><p>点击时候开启动画<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">fun startLineSVGAnimation(imageView: ImageView)&#123;</div><div class="line">        val drawable = imageView.drawable</div><div class="line">        (drawable as Animatable).start()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>kotlin语言</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;顺便学习一下Kotlin语言&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h1&gt;&lt;p&gt;动画能带来良好的用户体验,作为Androi
    
    </summary>
    
      <category term="Android" scheme="https://devallever.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://devallever.github.io/tags/Android/"/>
    
      <category term="Animation" scheme="https://devallever.github.io/tags/Animation/"/>
    
  </entry>
  
</feed>
