<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Allever Blog</title>
  <subtitle>Android Developer</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://devallever.github.io/"/>
  <updated>2017-07-30T08:43:08.124Z</updated>
  <id>https://devallever.github.io/</id>
  
  <author>
    <name>Allever</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Android  选择器</title>
    <link href="https://devallever.github.io/2017/07/30/selected-demo/"/>
    <id>https://devallever.github.io/2017/07/30/selected-demo/</id>
    <published>2017-07-30T06:13:16.000Z</published>
    <updated>2017-07-30T08:43:08.124Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
      <category term="Android" scheme="https://devallever.github.io/tags/Android/"/>
    
      <category term="选择器" scheme="https://devallever.github.io/tags/%E9%80%89%E6%8B%A9%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>NoteBook-1</title>
    <link href="https://devallever.github.io/2017/07/15/notebook-1/"/>
    <id>https://devallever.github.io/2017/07/15/notebook-1/</id>
    <published>2017-07-15T07:22:53.000Z</published>
    <updated>2017-07-15T07:39:43.993Z</updated>
    
    <content type="html"><![CDATA[<h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><ul>
<li><a href="https://devallever.github.io/2016/07/14/101-choose-network-framework/">101.Android 选择适当的网络请求框架</a></li>
<li><a href="https://devallever.github.io/2016/07/14/102-mvc-in-android/">102.MVC在Android中的应用</a></li>
<li><a href="https://devallever.github.io/2016/07/15/104-self-study-in-android-to-find-job/">104.自学到什么程度才能找到工作</a></li>
<li><a href="https://devallever.github.io/2016/07/15/105-recyclerview-basic-using/">105.RecyclerView简单使用</a></li>
<li><a href="https://devallever.github.io/2016/07/15/107-viewpager-basic-using/">107.ViewPager 简单使用</a></li>
<li><a href="https://devallever.github.io/2016/07/15/108-listview-basic-using/">108.ListView 简单使用</a></li>
<li><a href="https://devallever.github.io/2016/07/15/111-toolbar-basic-using/">111. Toolbar 简单使用</a></li>
<li><a href="https://devallever.github.io/2016/07/15/112-property-animation-basic-using/">112.属性动画基本使用</a></li>
<li><a href="https://devallever.github.io/2016/07/15/123-retrofit-2-basic-using/">123.Retrofit 基本使用</a></li>
<li><a href="https://devallever.github.io/2016/07/15/133-first-code-android-chapter-1-note/">133. 第一行代码 第一章 Android架构 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/135-first-code-android-chapter-2-note-activity/">135. 第一行代码 第二章 Activity 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/140-first-code-android-chapter-3-note-ui/">140. 第一行代码 第三章 UI 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/141-first-code-android-chapter-4-note-fragment/">141. 第一行代码 第四章 Fragment 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/143-first-code-android-chapter-5-note-broadcast-receiver/">143. 第一行代码 第五章 Broadcast Receiver 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/145-java-basic/">145. Java 基础</a></li>
<li><a href="https://devallever.github.io/2016/07/15/147-java-basic-common-class/">147. Java常用类</a></li>
<li><a href="https://devallever.github.io/2016/07/15/150-first-code-android-chapter-6-note-file/">150. 第一行代码 第六章 持久化 File 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/151-first-code-android-chapter-6-note-share-preferences/">151. 第一行代码 第六章 持久化 SharePreferences 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/152-java-oop-concept/">152. 面向对象基本概念</a></li>
<li><a href="https://devallever.github.io/2016/07/15/155-java-inner-class/">155. Java 内部类</a></li>
<li><a href="https://devallever.github.io/2016/07/15/157-first-code-android-chapter-6-note-sqlite/">157. 第一行代码 第六章 持久化 Sqlite 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/159-java-list-set-map/">159. List Set Map</a></li>
<li><a href="https://devallever.github.io/2016/07/15/161-first-code-android-chapter-6-note-litepal/">161. 第一行代码 第六章 持久化 LitePal 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/163-first-code-android-chapter-8-note-notification/">163. 第一行代码 第八章 多媒体 Notification 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/165-first-code-android-chapter-8-note-camera/">165-first-code-android-chapter-8-note-camera 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/167-first-code-android-chapter-8-note-choose-pic/">167. 第一行代码 第八章 多媒体 选择图片 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/170-java-exception/">170. Java 异常</a></li>
<li><a href="https://devallever.github.io/2016/07/15/173-first-code-android-chapter-8-note-media/">173. 第一行代码 第八章 多媒体 音频视频 笔记</a></li>
<li><a href="https://devallever.github.io/2016/07/15/174-java-thread/">174. Java 多线程</a></li>
<li><a href="https://devallever.github.io/2016/07/15/176-java-async/">176. Java 同步</a></li>
<li><a href="https://devallever.github.io/2016/07/15/179-android-java-http-url-connection/">179. HttpUrlConnection</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;目录&quot;&gt;&lt;a href=&quot;#目录&quot; class=&quot;headerlink&quot; title=&quot;目录&quot;&gt;&lt;/a&gt;目录&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://devallever.github.io/2016/07/14/101-choose-netw
    
    </summary>
    
      <category term="NoteBook" scheme="https://devallever.github.io/categories/NoteBook/"/>
    
    
      <category term="NoteBook1" scheme="https://devallever.github.io/tags/NoteBook1/"/>
    
  </entry>
  
  <entry>
    <title>Java 线程池</title>
    <link href="https://devallever.github.io/2017/07/02/java-thread-pool-executor-basic/"/>
    <id>https://devallever.github.io/2017/07/02/java-thread-pool-executor-basic/</id>
    <published>2017-07-02T08:35:49.000Z</published>
    <updated>2017-07-02T09:42:58.460Z</updated>
    
    <content type="html"><![CDATA[<h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>当我们使用线程的时候就去创建一个线程，这样实现起来非常简便，但是就会有一个问题：<br>　　如果并发的线程数量很多，并且每个线程都是执行一个时间很短的任务就结束了，这样频繁创建线程就会大大降低系统的效率，因为频繁创建线程和销毁线程需要时间。<br>　　那么有没有一种办法使得线程可以复用，就是执行完一个任务，并不被销毁，而是可以继续执行其他的任务？<br>　　在Java中可以通过线程池来达到这样的效果。今天我们就来详细讲解一下Java的线程池。</p>
<h1 id="ThreadPoolEXecutor"><a href="#ThreadPoolEXecutor" class="headerlink" title="ThreadPoolEXecutor"></a>ThreadPoolEXecutor</h1><p>合理利用线程池能够带来三个好处。</p>
<ul>
<li>降低资源消耗。通过重复利用已创建的线程降低线程创建和销毁造成的消耗。</li>
<li>提高响应速度。当任务到达时，任务可以不需要等到线程创建就能立即执行。</li>
<li>提高线程的可管理性。</li>
</ul>
<p>线程是稀缺资源，如果无限制的创建，不仅会消耗系统资源，还会降低系统的稳定性，使用线程池可以进行统一的分配，调优和监控。但是要做到合理的利用线程池，必须对其原理了如指掌。</p>
<h1 id="构造方法详解"><a href="#构造方法详解" class="headerlink" title="构造方法详解"></a>构造方法详解</h1><p>构造方法有三个：<br>其一：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public ThreadPoolExecutor(</div><div class="line">	int corePoolSize,</div><div class="line">	int maximumPoolSize,</div><div class="line">	long keepAliveTime,</div><div class="line">	TimeUnit unit,</div><div class="line">	BlockingQueue&lt;Runnable&gt; workQueue) </div><div class="line">&#123;</div><div class="line">        this(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,</div><div class="line">             Executors.defaultThreadFactory(), defaultHandler);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其二：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public ThreadPoolExecutor(</div><div class="line">	int corePoolSize,</div><div class="line">	int maximumPoolSize,</div><div class="line">	long keepAliveTime,</div><div class="line">	TimeUnit unit,</div><div class="line">	BlockingQueue&lt;Runnable&gt; workQueue,</div><div class="line">	ThreadFactory threadFactory)</div><div class="line">&#123;</div><div class="line">        this(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,</div><div class="line">             threadFactory, defaultHandler);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其三：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public ThreadPoolExecutor(</div><div class="line">	int corePoolSize,</div><div class="line">	int maximumPoolSize,</div><div class="line">	long keepAliveTime,</div><div class="line">	TimeUnit unit,</div><div class="line">	BlockingQueue&lt;Runnable&gt; workQueue,</div><div class="line">	RejectedExecutionHandler handler) </div><div class="line">&#123;</div><div class="line">        this(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,</div><div class="line">             Executors.defaultThreadFactory(), handler);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>源码对各个参数介绍如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Creates a new &#123;@code ThreadPoolExecutor&#125; with the given initial</div><div class="line"> * parameters and default thread factory.</div><div class="line"> *</div><div class="line"> * @param corePoolSize the number of threads to keep in the pool, even</div><div class="line"> *        if they are idle, unless &#123;@code allowCoreThreadTimeOut&#125; is set</div><div class="line"> * @param maximumPoolSize the maximum number of threads to allow in the</div><div class="line"> *        pool</div><div class="line"> * @param keepAliveTime when the number of threads is greater than</div><div class="line"> *        the core, this is the maximum time that excess idle threads</div><div class="line"> *        will wait for new tasks before terminating.</div><div class="line"> * @param unit the time unit for the &#123;@code keepAliveTime&#125; argument</div><div class="line"> * @param workQueue the queue to use for holding tasks before they are</div><div class="line"> *        executed.  This queue will hold only the &#123;@code Runnable&#125;</div><div class="line"> *        tasks submitted by the &#123;@code execute&#125; method.</div><div class="line"> * @param handler the handler to use when execution is blocked</div><div class="line"> *        because the thread bounds and queue capacities are reached</div><div class="line"> * @throws IllegalArgumentException if one of the following holds:&lt;br&gt;</div><div class="line"> *         &#123;@code corePoolSize &lt; 0&#125;&lt;br&gt;</div><div class="line"> *         &#123;@code keepAliveTime &lt; 0&#125;&lt;br&gt;</div><div class="line"> *         &#123;@code maximumPoolSize &lt;= 0&#125;&lt;br&gt;</div><div class="line"> *         &#123;@code maximumPoolSize &lt; corePoolSize&#125;</div><div class="line"> * @throws NullPointerException if &#123;@code workQueue&#125;</div><div class="line"> *         or &#123;@code handler&#125; is null</div><div class="line"> */</div></pre></td></tr></table></figure></p>
<p>看不懂？没关系，下面一一解释</p>
<ul>
<li>corePoolSize：线程池的核心线程数<br>当提交一个任务到线程池时，线程池会创建一个线程来执行任务，即使其他空闲的基本线程能够执行新任务也会创建线程，等到需要执行的任务数大于线程池基本大小时就不再创建。如果调用了线程池的prestartAllCoreThreads方法，线程池会提前创建并启动所有基本线程。</li>
<li>maximumPoolSize：线程池所能容纳的最大线程数<br>如果队列满了，并且已创建的线程数小于最大线程数，则线程池会再创建新的线程执行任务。值得注意的是如果使用了无界的任务队列这个参数就没什么效果。</li>
<li>keepAliveTime：非核心线程闲置时的超时时长<br>线程池的工作线程空闲后，保持存活的时间。所以如果任务很多，并且每个任务执行的时间比较短，可以调大这个时间，提高线程的利用率。</li>
<li>unit：用于指定keepAliveTime参数的时间单位<br>可选的单位有天（DAYS），小时（HOURS），分钟（MINUTES），毫秒(TimeUnit.MILLISECONDS)，微秒(MICROSECONDS, 千分之一毫秒)和毫微秒(NANOSECONDS, 千分之一微秒)。常用的有分钟，秒，毫秒</li>
<li>workQueue：任务队列<br>用于保存等待执行的任务的阻塞队列。有一下几种<ul>
<li>ArrayBlockingQueue：<br>是一个基于数组结构的有界阻塞队列，此队列按 FIFO（先进先出）原则对元素进行排序。</li>
<li>LinkedBlockingQueue：<br>一个基于链表结构的阻塞队列，此队列按FIFO （先进先出） 排序元素，吞吐量通常要高于ArrayBlockingQueue。静态工厂方法Executors.newFixedThreadPool()使用了这个队列。</li>
<li>SynchronousQueue：<br>一个不存储元素的阻塞队列。每个插入操作必须等到另一个线程调用移除操作，否则插入操作一直处于阻塞状态，吞吐量通常要高于LinkedBlockingQueue，静态工厂方法Executors.newCachedThreadPool使用了这个队列。</li>
<li>PriorityBlockingQueue：一个具有优先级的无限阻塞队列。</li>
</ul>
</li>
<li>handler：饱和策略(不常用)<br>当队列和线程池都满了，说明线程池处于饱和状态，那么必须采取一种策略处理提交的新任务。这个策略默认情况下是AbortPolicy，表示无法处理新任务时抛出异常。以下是JDK1.5提供的四种策略。<ul>
<li>AbortPolicy：直接抛出异常。</li>
<li>CallerRunsPolicy：只用调用者所在线程来运行任务。</li>
<li>DiscardOldestPolicy：丢弃队列里最近的一个任务，并执行当前任务。</li>
<li>DiscardPolicy：不处理，丢弃掉。</li>
<li>当然也可以根据应用场景需要来实现RejectedExecutionHandler接口自定义策略。如记录日志或持久化不能处理的任务。</li>
</ul>
</li>
</ul>
<h1 id="四种常用的线程池"><a href="#四种常用的线程池" class="headerlink" title="四种常用的线程池"></a>四种常用的线程池</h1><h2 id="FixedThreadPool"><a href="#FixedThreadPool" class="headerlink" title="FixedThreadPool"></a>FixedThreadPool</h2><p>是一种线程数量固定的线程池，当线程处于空闲状态时，它们并不会回收，除非线程池关闭了。当所有线程都处于活动状态时，新任务都会处于等待状态，知道有线程空闲出来。由于FixedThreadPool只有核心线程并且这些核心线程都不会被回收，意味着它能够更加快速的响应外界的请求。没有超时机制，任务队列也没有大小限制。  </p>
<p>创建实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ExecutorService fixedThreadPoolExecutor = Executors.newFixedThreadPool(3);</div></pre></td></tr></table></figure></p>
<p>newFixedThreadPool()方法定义如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Creates a thread pool that reuses a fixed number of threads</div><div class="line"> * operating off a shared unbounded queue.  At any point, at most</div><div class="line"> * &#123;<span class="doctag">@code</span> nThreads&#125; threads will be active processing tasks.</div><div class="line"> * If additional tasks are submitted when all threads are active,</div><div class="line"> * they will wait in the queue until a thread is available.</div><div class="line"> * If any thread terminates due to a failure during execution</div><div class="line"> * prior to shutdown, a new one will take its place if needed to</div><div class="line"> * execute subsequent tasks.  The threads in the pool will exist</div><div class="line"> * until it is explicitly &#123;<span class="doctag">@link</span> ExecutorService#shutdown shutdown&#125;.</div><div class="line"> *</div><div class="line"> * <span class="doctag">@param</span> nThreads the number of threads in the pool</div><div class="line"> * <span class="doctag">@return</span> the newly created thread pool</div><div class="line"> * <span class="doctag">@throws</span> IllegalArgumentException if &#123;<span class="doctag">@code</span> nThreads &lt;= 0&#125;</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newFixedThreadPool</span><span class="params">(<span class="keyword">int</span> nThreads)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(nThreads, nThreads,</div><div class="line">                                  <span class="number">0L</span>, TimeUnit.MILLISECONDS,</div><div class="line">                                  <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>举个例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">private static void fixedThreadPoolTest()&#123;</div><div class="line">    ExecutorService fixedThreadPoolExecutor = Executors.newFixedThreadPool(3);</div><div class="line">    for (int i=0; i&lt;10; i++)&#123;</div><div class="line">        final int index = i;</div><div class="line">        System.out.println(System.currentTimeMillis() +</div><div class="line">                &quot;in main thread index = &quot; + index + &quot; &quot; +</div><div class="line">                &quot;Thread id = &quot; + Thread.currentThread().getId());</div><div class="line">        fixedThreadPoolExecutor.execute(new Runnable() &#123;</div><div class="line">            @Override</div><div class="line">            public void run() &#123;</div><div class="line">                System.out.println(System.currentTimeMillis() +</div><div class="line">                        &quot;in thread pool index = &quot; + index + &quot; &quot; +</div><div class="line">                        &quot;Thread id = &quot; + Thread.currentThread().getId());</div><div class="line">                try &#123;</div><div class="line">                    Thread.sleep(2000);</div><div class="line">                &#125;catch (InterruptedException itre)&#123;</div><div class="line">                    itre.printStackTrace();</div><div class="line">                &#125;</div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行结果<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="number">1498982458294</span>in main thread index = <span class="number">0</span> Thread id = <span class="number">1</span></div><div class="line"><span class="number">1498982458296</span>in main thread index = <span class="number">1</span> Thread id = <span class="number">1</span></div><div class="line"><span class="number">1498982458296</span>in thread pool index = <span class="number">0</span> Thread id = <span class="number">10</span></div><div class="line"><span class="number">1498982458296</span>in main thread index = <span class="number">2</span> Thread id = <span class="number">1</span></div><div class="line"><span class="number">1498982458302</span>in thread pool index = <span class="number">1</span> Thread id = <span class="number">11</span></div><div class="line"><span class="number">1498982458302</span>in main thread index = <span class="number">3</span> Thread id = <span class="number">1</span></div><div class="line"><span class="number">1498982458303</span>in main thread index = <span class="number">4</span> Thread id = <span class="number">1</span></div><div class="line"><span class="number">1498982458303</span>in main thread index = <span class="number">5</span> Thread id = <span class="number">1</span></div><div class="line"><span class="number">1498982458303</span>in main thread index = <span class="number">6</span> Thread id = <span class="number">1</span></div><div class="line"><span class="number">1498982458303</span>in main thread index = <span class="number">7</span> Thread id = <span class="number">1</span></div><div class="line"><span class="number">1498982458303</span>in main thread index = <span class="number">8</span> Thread id = <span class="number">1</span></div><div class="line"><span class="number">1498982458303</span>in main thread index = <span class="number">9</span> Thread id = <span class="number">1</span></div><div class="line"><span class="number">1498982458304</span>in thread pool index = <span class="number">2</span> Thread id = <span class="number">12</span></div><div class="line"><span class="comment">// 睡两秒</span></div><div class="line"><span class="number">1498982460296</span>in thread pool index = <span class="number">3</span> Thread id = <span class="number">10</span></div><div class="line"><span class="number">1498982460303</span>in thread pool index = <span class="number">4</span> Thread id = <span class="number">11</span></div><div class="line"><span class="number">1498982460304</span>in thread pool index = <span class="number">5</span> Thread id = <span class="number">12</span></div><div class="line"><span class="comment">// 睡两秒</span></div><div class="line"><span class="number">1498982462297</span>in thread pool index = <span class="number">6</span> Thread id = <span class="number">10</span></div><div class="line"><span class="number">1498982462303</span>in thread pool index = <span class="number">7</span> Thread id = <span class="number">11</span></div><div class="line"><span class="number">1498982462304</span>in thread pool index = <span class="number">8</span> Thread id = <span class="number">12</span></div><div class="line"><span class="comment">// 睡两秒</span></div><div class="line"><span class="number">1498982464297</span>in thread pool index = <span class="number">9</span> Thread id = <span class="number">10</span></div></pre></td></tr></table></figure></p>
<p>可以看到主线程很快就执行完了，它只负责创建了10个任务。然后交给线程池执行。<br>线程池数量为3，因此每次只执行其中3个任务，即打印连续3条记录，执行线程为10,11,12，其余任务处于等待状态。然后等待两秒，此时线程池所有线程应该是空闲的，下一次依然在线程10,11,12中执行3个任务，直到所有任务完成。</p>
<p>主线程id为1，子线程id为10,11,12<br>因为线程池只设置了核心线程数为3，并且最大线程数也是3。</p>
<h2 id="CacheThreadPool"><a href="#CacheThreadPool" class="headerlink" title="CacheThreadPool"></a>CacheThreadPool</h2><p>它是一种线程数量不固定的线程池，它只有非核心线程，并且虽大线程数为Integer.MAX_VALUE(一个很大的数)，相当于最大线程数可以任意大。当线程池中的线程都处于活动状态时，线程池会创建新的线程来处理新任务，否则就会利用空闲的线程来处理新任务。空闲线程有超时机制，60秒，超过60秒，回收空闲线程。<br>从CacheThreadPool的特性可以知道，这类线程池适合执行大量耗时少的任务。当整个线程池都处于闲置状态时候，线程池中的线程都会因为超时而被回收，几乎不占用任何系统资源。</p>
<p>创建实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ExecutorService cacheThreadPoolExecutor = Executors.newCachedThreadPool();</div></pre></td></tr></table></figure></p>
<p>newCachedThreadPool()方法如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Creates a thread pool that creates new threads as needed, but</div><div class="line"> * will reuse previously constructed threads when they are</div><div class="line"> * available.  These pools will typically improve the performance</div><div class="line"> * of programs that execute many short-lived asynchronous tasks.</div><div class="line"> * Calls to &#123;<span class="doctag">@code</span> execute&#125; will reuse previously constructed</div><div class="line"> * threads if available. If no existing thread is available, a new</div><div class="line"> * thread will be created and added to the pool. Threads that have</div><div class="line"> * not been used for sixty seconds are terminated and removed from</div><div class="line"> * the cache. Thus, a pool that remains idle for long enough will</div><div class="line"> * not consume any resources. Note that pools with similar</div><div class="line"> * properties but different details (for example, timeout parameters)</div><div class="line"> * may be created using &#123;<span class="doctag">@link</span> ThreadPoolExecutor&#125; constructors.</div><div class="line"> *</div><div class="line"> * <span class="doctag">@return</span> the newly created thread pool</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newCachedThreadPool</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">0</span>, Integer.MAX_VALUE,</div><div class="line">                                  <span class="number">60L</span>, TimeUnit.SECONDS,</div><div class="line">                                  <span class="keyword">new</span> SynchronousQueue&lt;Runnable&gt;());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>举个例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">private static void cacheThreadPoolTest()&#123;</div><div class="line">    ExecutorService cacheThreadPoolExecutor = Executors.newCachedThreadPool();</div><div class="line"></div><div class="line">    for (int i=0; i&lt;10; i++)&#123;</div><div class="line">        final int index = i;</div><div class="line">        /*</div><div class="line">        try &#123;</div><div class="line">            Thread.sleep(1000);</div><div class="line">        &#125;catch (InterruptedException itre)&#123;</div><div class="line">            itre.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        */</div><div class="line">        </div><div class="line">        cacheThreadPoolExecutor.execute(new Runnable() &#123;</div><div class="line">            @Override</div><div class="line">            public void run() &#123;</div><div class="line">                System.out.println(System.currentTimeMillis() + &quot; &quot; +</div><div class="line">                        &quot;index = &quot; +  index + &quot; &quot; +</div><div class="line">                        &quot;Thread id = &quot; + Thread.currentThread().getId());</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行情况：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">1498985856125 index = 0 Thread id = 10</div><div class="line">1498985856126 index = 1 Thread id = 11</div><div class="line">1498985856126 index = 2 Thread id = 12</div><div class="line">1498985856127 index = 3 Thread id = 13</div><div class="line">1498985856127 index = 7 Thread id = 10</div><div class="line">1498985856127 index = 6 Thread id = 14</div><div class="line">1498985856127 index = 9 Thread id = 14</div><div class="line">1498985856127 index = 4 Thread id = 12</div><div class="line">1498985856127 index = 5 Thread id = 11</div><div class="line">1498985856131 index = 8 Thread id = 15</div></pre></td></tr></table></figure></p>
<p>可以看出，当线程池的所有线程活动的时候，线程池不断创建线程了执行新的任务</p>
<p>如果去掉线程等待的注释，再运行一次<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">private static void cacheThreadPoolTest()&#123;</div><div class="line">    ExecutorService cacheThreadPoolExecutor = Executors.newCachedThreadPool();</div><div class="line"></div><div class="line">    for (int i=0; i&lt;10; i++)&#123;</div><div class="line">        final int index = i;</div><div class="line">        </div><div class="line">        try &#123;</div><div class="line">            Thread.sleep(1000);</div><div class="line">        &#125;catch (InterruptedException itre)&#123;</div><div class="line">            itre.printStackTrace();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        cacheThreadPoolExecutor.execute(new Runnable() &#123;</div><div class="line">            @Override</div><div class="line">            public void run() &#123;</div><div class="line">                System.out.println(System.currentTimeMillis() + &quot; &quot; +</div><div class="line">                        &quot;index = &quot; +  index + &quot; &quot; +</div><div class="line">                        &quot;Thread id = &quot; + Thread.currentThread().getId());</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">1498985981855 index = 0 Thread id = 10</div><div class="line">// 间隔一秒</div><div class="line">1498985982854 index = 1 Thread id = 10</div><div class="line">// 间隔一秒</div><div class="line">1498985983854 index = 2 Thread id = 10</div><div class="line">// 间隔一秒 下同省略了</div><div class="line">1498985984854 index = 3 Thread id = 10</div><div class="line">1498985985855 index = 4 Thread id = 10</div><div class="line">1498985986855 index = 5 Thread id = 10</div><div class="line">1498985987855 index = 6 Thread id = 10</div><div class="line">1498985988855 index = 7 Thread id = 10</div><div class="line">1498985989855 index = 8 Thread id = 10</div><div class="line">1498985990855 index = 9 Thread id = 10</div></pre></td></tr></table></figure></p>
<p>可以看到，当等待的时候，活动线程已经执行完毕，变成闲置线程，由于等待时间少于60秒，闲置线程未被回收，因此始终在10号线程中执行。</p>
<h2 id="ScheduledThreadPool"><a href="#ScheduledThreadPool" class="headerlink" title="ScheduledThreadPool"></a>ScheduledThreadPool</h2><p>它的核心线程数量是固定的，而非核心线程数没有限制，并且非核心线程闲置时会立即被回收。这类线程池主要用于执行定时任务或具有固定周期的重复任务</p>
<p>创建实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ScheduledExecutorService scheduledThreadPool = Executors.newScheduledThreadPool(4);</div></pre></td></tr></table></figure></p>
<p>newScheduledThreadPool()方法如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Creates a thread pool that can schedule commands to run after a</div><div class="line"> * given delay, or to execute periodically.</div><div class="line"> * <span class="doctag">@param</span> corePoolSize the number of threads to keep in the pool,</div><div class="line"> * even if they are idle</div><div class="line"> * <span class="doctag">@return</span> a newly created scheduled thread pool</div><div class="line"> * <span class="doctag">@throws</span> IllegalArgumentException if &#123;<span class="doctag">@code</span> corePoolSize &lt; 0&#125;</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ScheduledExecutorService <span class="title">newScheduledThreadPool</span><span class="params">(<span class="keyword">int</span> corePoolSize)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ScheduledThreadPoolExecutor(corePoolSize);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ScheduledThreadPoolExecutor()构造如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Creates a new &#123;@code ScheduledThreadPoolExecutor&#125; with the</div><div class="line"> * given core pool size.</div><div class="line"> *</div><div class="line"> * @param corePoolSize the number of threads to keep in the pool, even</div><div class="line"> *        if they are idle, unless &#123;@code allowCoreThreadTimeOut&#125; is set</div><div class="line"> * @throws IllegalArgumentException if &#123;@code corePoolSize &lt; 0&#125;</div><div class="line"> */</div><div class="line">public ScheduledThreadPoolExecutor(int corePoolSize) &#123;</div><div class="line">    super(corePoolSize, Integer.MAX_VALUE, 0, NANOSECONDS,</div><div class="line">          new DelayedWorkQueue());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>举个例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">private static void scheduledThreadPoolTest()&#123;</div><div class="line">    Runnable runnable = new Runnable() &#123;</div><div class="line">        @Override</div><div class="line">        public void run() &#123;</div><div class="line">            System.out.println(&quot;Thread id = &quot; + Thread.currentThread().getId());</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    ScheduledExecutorService scheduledThreadPool = Executors.newScheduledThreadPool(4);</div><div class="line">    //延时2s</div><div class="line">    scheduledThreadPool.schedule(runnable,2, TimeUnit.SECONDS);</div><div class="line">    //延迟1000ms后, 每隔500ms执行一次runnable</div><div class="line">    scheduledThreadPool.scheduleAtFixedRate(runnable,1000, 500, TimeUnit.MILLISECONDS);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="SingleThreadExecutor"><a href="#SingleThreadExecutor" class="headerlink" title="SingleThreadExecutor"></a>SingleThreadExecutor</h2><p>这类线程池内部只有一个核心线程，它确保所有的任务都在同一线程中按顺序执行。SingleThreadExecutor的意义在于同一所有的外界任务到一个线程中，这使得在这些任务之间不需要处理线程同步问题。</p>
<p>创建实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ExecutorService singleThreadExecutor = Executors.newSingleThreadExecutor();</div></pre></td></tr></table></figure></p>
<p>newSingleThreadExecutor()方法如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Creates an Executor that uses a single worker thread operating</div><div class="line"> * off an unbounded queue. (Note however that if this single</div><div class="line"> * thread terminates due to a failure during execution prior to</div><div class="line"> * shutdown, a new one will take its place if needed to execute</div><div class="line"> * subsequent tasks.)  Tasks are guaranteed to execute</div><div class="line"> * sequentially, and no more than one task will be active at any</div><div class="line"> * given time. Unlike the otherwise equivalent</div><div class="line"> * &#123;<span class="doctag">@code</span> newFixedThreadPool(1)&#125; the returned executor is</div><div class="line"> * guaranteed not to be reconfigurable to use additional threads.</div><div class="line"> *</div><div class="line"> * <span class="doctag">@return</span> the newly created single-threaded Executor</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newSingleThreadExecutor</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FinalizableDelegatedExecutorService</div><div class="line">        (<span class="keyword">new</span> ThreadPoolExecutor(<span class="number">1</span>, <span class="number">1</span>,</div><div class="line">                                <span class="number">0L</span>, TimeUnit.MILLISECONDS,</div><div class="line">                                <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;()));</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>举个例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">private static void singleThreadExecutorTest()&#123;</div><div class="line">    ExecutorService singleThreadExecutor = Executors.newSingleThreadExecutor();</div><div class="line">    for (int i=0; i&lt;10; i++)&#123;</div><div class="line">        final int index = i;</div><div class="line">        singleThreadExecutor.execute(new Runnable() &#123;</div><div class="line">            @Override</div><div class="line">            public void run() &#123;</div><div class="line">                System.out.println(&quot;index = &quot; + index+ &quot; Thread id = &quot; + Thread.currentThread().getId());</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">index = 0 Thread id = 10</div><div class="line">index = 1 Thread id = 10</div><div class="line">index = 2 Thread id = 10</div><div class="line">index = 3 Thread id = 10</div><div class="line">index = 4 Thread id = 10</div><div class="line">index = 5 Thread id = 10</div><div class="line">index = 6 Thread id = 10</div><div class="line">index = 7 Thread id = 10</div><div class="line">index = 8 Thread id = 10</div><div class="line">index = 9 Thread id = 10</div></pre></td></tr></table></figure></p>
<p>可以看出，所有任务都在同一个线程中排队等待执行。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;引言&quot;&gt;&lt;a href=&quot;#引言&quot; class=&quot;headerlink&quot; title=&quot;引言&quot;&gt;&lt;/a&gt;引言&lt;/h1&gt;&lt;p&gt;当我们使用线程的时候就去创建一个线程，这样实现起来非常简便，但是就会有一个问题：&lt;br&gt;　　如果并发的线程数量很多，并且每个线程都是执行一个
    
    </summary>
    
      <category term="Java" scheme="https://devallever.github.io/categories/Java/"/>
    
    
      <category term="Java" scheme="https://devallever.github.io/tags/Java/"/>
    
      <category term="ThreadPoolExecutor" scheme="https://devallever.github.io/tags/ThreadPoolExecutor/"/>
    
  </entry>
  
  <entry>
    <title>IntentService 工作原理</title>
    <link href="https://devallever.github.io/2017/07/02/android-intent-service/"/>
    <id>https://devallever.github.io/2017/07/02/android-intent-service/</id>
    <published>2017-07-02T01:22:13.000Z</published>
    <updated>2017-07-02T01:50:58.132Z</updated>
    
    <content type="html"><![CDATA[<h1 id="IntentService简介"><a href="#IntentService简介" class="headerlink" title="IntentService简介"></a>IntentService简介</h1><p>是一种特殊的Service，继承了Service并且是个抽象类，可用于执行后台耗时任务，当任务结束后自动停止，同时由于是服务的原因，它的优先级比普通线程高很多，因此不容易被系统杀死。在实现上，IntentService封装了HandlerThread和Handler。</p>
<h1 id="基本流程"><a href="#基本流程" class="headerlink" title="基本流程"></a>基本流程</h1><p>startService(intentService):<br>onCreate()-&gt;<br>onStartCommand()-&gt;<br>onStart()-&gt;<br>sendMessage()-&gt;<br>handlerMessage()-&gt;<br>onHandlerIntent()-&gt;<br>stopSelf(startId)-&gt;<br>onDestroy-&gt;</p>
<h1 id="详细解剖"><a href="#详细解剖" class="headerlink" title="详细解剖"></a>详细解剖</h1><h2 id="onCreate"><a href="#onCreate" class="headerlink" title="onCreate()"></a>onCreate()</h2><p>当服务第一次创建的时候调用onCreate()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void onCreate() &#123;</div><div class="line">    // TODO: It would be nice to have an option to hold a partial wakelock</div><div class="line">    // during processing, and to have a static startService(Context, Intent)</div><div class="line">    // method that would launch the service &amp; hand off a wakelock.</div><div class="line"></div><div class="line">    super.onCreate();</div><div class="line">    HandlerThread thread = new HandlerThread(&quot;IntentService[&quot; + mName + &quot;]&quot;);</div><div class="line">    thread.start();</div><div class="line"></div><div class="line">    mServiceLooper = thread.getLooper();</div><div class="line">    mServiceHandler = new ServiceHandler(mServiceLooper);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>该方法封装了HandlerThread 和 Handler</p>
<h2 id="onStartCommand"><a href="#onStartCommand" class="headerlink" title="onStartCommand()"></a>onStartCommand()</h2><p>每一次启动服务的时候调用onStartCommand()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public int onStartCommand(@Nullable Intent intent, int flags, int startId) &#123;</div><div class="line">    onStart(intent, startId);</div><div class="line">    return mRedelivery ? START_REDELIVER_INTENT : START_NOT_STICKY;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>该方法仅仅调用了onStart()方法</p>
<h2 id="onStart"><a href="#onStart" class="headerlink" title="onStart()"></a>onStart()</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void onStart(@Nullable Intent intent, int startId) &#123;</div><div class="line">    Message msg = mServiceHandler.obtainMessage();</div><div class="line">    msg.arg1 = startId;</div><div class="line">    msg.obj = intent;</div><div class="line">    mServiceHandler.sendMessage(msg);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>该方法把startService传来的Intent和startId封装成Message消息，然后通过handler发送消息，接着执行mServiceHandler.handleMessage()<br>其中ServiceHandler是IntentService的一个内部类，它的定义如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">private final class ServiceHandler extends Handler &#123;</div><div class="line">    public ServiceHandler(Looper looper) &#123;</div><div class="line">        super(looper);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void handleMessage(Message msg) &#123;</div><div class="line">        onHandleIntent((Intent)msg.obj);</div><div class="line">        stopSelf(msg.arg1);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="handleMessage"><a href="#handleMessage" class="headerlink" title="handleMessage()"></a>handleMessage()</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void handleMessage(Message msg) &#123;</div><div class="line">	onHandleIntent((Intent)msg.obj);</div><div class="line">	stopSelf(msg.arg1);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>该方法会执行onHandleIntent()方法，它是个抽象方法，因此我们自定义IntentService的时候必须重写onHandleIntent()方法。因为发送消息那那个handler是HandlerThread所关联的，所以处理信息的时候是在子线程进行的。不会的可以看看HandlerThread原理。</p>
<h2 id="stopSelf"><a href="#stopSelf" class="headerlink" title="stopSelf()"></a>stopSelf()</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void handleMessage(Message msg) &#123;</div><div class="line">	onHandleIntent((Intent)msg.obj);</div><div class="line">	stopSelf(msg.arg1);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>当onHandleIntent()方法执行完毕之后，会调用stopSelf(int)方法结束服务</p>
<h2 id="onDestroy"><a href="#onDestroy" class="headerlink" title="onDestroy()"></a>onDestroy()</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void onDestroy() &#123;</div><div class="line">    mServiceLooper.quit();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最后销毁服务的时候，终止线程执行</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;IntentService简介&quot;&gt;&lt;a href=&quot;#IntentService简介&quot; class=&quot;headerlink&quot; title=&quot;IntentService简介&quot;&gt;&lt;/a&gt;IntentService简介&lt;/h1&gt;&lt;p&gt;是一种特殊的Service，继承了S
    
    </summary>
    
      <category term="Android" scheme="https://devallever.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://devallever.github.io/tags/Android/"/>
    
      <category term="Thread" scheme="https://devallever.github.io/tags/Thread/"/>
    
      <category term="IntentService" scheme="https://devallever.github.io/tags/IntentService/"/>
    
      <category term="Service" scheme="https://devallever.github.io/tags/Service/"/>
    
  </entry>
  
  <entry>
    <title>HandlerThread简单使用</title>
    <link href="https://devallever.github.io/2017/07/01/handler-thread-basic/"/>
    <id>https://devallever.github.io/2017/07/01/handler-thread-basic/</id>
    <published>2017-07-01T08:59:50.000Z</published>
    <updated>2017-07-01T09:35:43.310Z</updated>
    
    <content type="html"><![CDATA[<h1 id="HandlerThread简介"><a href="#HandlerThread简介" class="headerlink" title="HandlerThread简介"></a>HandlerThread简介</h1><p>HandlerThread继承了Thread，它是一种可以使用Handler的Thread，它的实现就是在run()方法中通过Looper.prepare()创建消息队列，并通过Looper.loop()开启消息循环。这样在实际使用中就允许在HandlerThread中创建Handler了。<br>由于HandlerThread的run()方法是一个无限循环，因此当明确不需要使用HandlerThread的时候可以通过Looper的quit()或quitSafely()来终止线程执行。</p>
<h1 id="使用Handler"><a href="#使用Handler" class="headerlink" title="使用Handler"></a>使用Handler</h1><p>通常我们会在主线程中创建Handler，在子线程中调用handler.post(runnable)传递消息到主线程的消息队列中处理runnable的run方法.这样完成了子线程到主线的切换。<br>在onCreate()方法中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mainHandler = new Handler();</div></pre></td></tr></table></figure></p>
<p>然后在子线程中post<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">btn_post_to_main_thread.setOnClickListener(new View.OnClickListener() &#123;</div><div class="line">	@Override</div><div class="line">	public void onClick(View v) &#123;</div><div class="line">		new Thread(new Runnable() &#123;</div><div class="line">			@Override</div><div class="line">			public void run() &#123;</div><div class="line">				Log.d(TAG, &quot;Thread id = &quot; + Thread.currentThread().getId());</div><div class="line">				mainHandler.post(runnable);</div><div class="line">			&#125;</div><div class="line">		&#125;).start();</div><div class="line">                </div><div class="line">	&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>runnable<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">private Runnable runnable = new Runnable() &#123;</div><div class="line">    @Override</div><div class="line">    public void run() &#123;</div><div class="line">        Log.d(TAG, &quot;Thread id = &quot; + Thread.currentThread().getId());</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>运行结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">HandlerThreadActivity: Thread id = 10383</div><div class="line">HandlerThreadActivity: Thread id = 1</div></pre></td></tr></table></figure></p>
<h1 id="使用HandlerThread"><a href="#使用HandlerThread" class="headerlink" title="使用HandlerThread"></a>使用HandlerThread</h1><p>先创建HandlerThread实例，在onCreate()方法中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">handlerThread = new HandlerThread(&quot;handlerThread&quot;);</div><div class="line">handlerThread.start();</div></pre></td></tr></table></figure></p>
<p>这样就开启了一个带Looper的子线程，因为HandlerThread是继承自Thread，它的run方法是这样定义的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public void run() &#123;</div><div class="line">    mTid = Process.myTid();</div><div class="line">    Looper.prepare();</div><div class="line">    synchronized (this) &#123;</div><div class="line">        mLooper = Looper.myLooper();</div><div class="line">        notifyAll();</div><div class="line">    &#125;</div><div class="line">    Process.setThreadPriority(mPriority);</div><div class="line">    onLooperPrepared();</div><div class="line">    Looper.loop();</div><div class="line">    mTid = -1;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>关于Looper原理，可以参考《Android开发艺术探索》中的消息机制，我的理解是:</p>
<ul>
<li>Looper.prepare();创建Looper实例</li>
<li>Looper.loop();进入一个无限循环中，不断监听消息队列中是否有消息，有则把他取出来分发给handler的handlerMessage()中处理。</li>
</ul>
<p>因为线程中需要有一个Looper，线程绑定的handler才可以发送消息到消息队列中，那么相应的线程才会得到处理。</p>
<p>然后就是利用handlerThread获取到Looper用来创建Handler实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">handler = new Handler(handlerThread.getLooper());</div></pre></td></tr></table></figure></p>
<p>此时这个handler即使实在主线程中创建，但是它与子线程的Looper关联了，所以处理消息时候也会在子线程中处理的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">btn_post_to_sub_thread.setOnClickListener(new View.OnClickListener() &#123;</div><div class="line">	@Override</div><div class="line">	public void onClick(View v) &#123;</div><div class="line">		handler.post(runnable);</div><div class="line">	&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>运行结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">HandlerThreadActivity: Thread id = 10382</div><div class="line">HandlerThreadActivity: Thread id = 10382</div><div class="line">HandlerThreadActivity: Thread id = 10382</div></pre></td></tr></table></figure></p>
<p>可以知道是在子线程中处理的。</p>
<h1 id="HandlerThread和Thread的区别"><a href="#HandlerThread和Thread的区别" class="headerlink" title="HandlerThread和Thread的区别"></a>HandlerThread和Thread的区别</h1><ul>
<li>普通Thread主要用于在run()方法中执行一个耗时的任务</li>
<li>HandlerThread内部创建消息队列，需要handler消息方式来通知HandlerThread去执行一个具体的任务。</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;HandlerThread简介&quot;&gt;&lt;a href=&quot;#HandlerThread简介&quot; class=&quot;headerlink&quot; title=&quot;HandlerThread简介&quot;&gt;&lt;/a&gt;HandlerThread简介&lt;/h1&gt;&lt;p&gt;HandlerThread继承了Th
    
    </summary>
    
      <category term="Android" scheme="https://devallever.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://devallever.github.io/tags/Android/"/>
    
      <category term="Thread" scheme="https://devallever.github.io/tags/Thread/"/>
    
      <category term="HandlerThread" scheme="https://devallever.github.io/tags/HandlerThread/"/>
    
  </entry>
  
  <entry>
    <title>OkHttp的简单使用</title>
    <link href="https://devallever.github.io/2017/06/30/okhttp-sample/"/>
    <id>https://devallever.github.io/2017/06/30/okhttp-sample/</id>
    <published>2017-06-30T12:07:13.000Z</published>
    <updated>2017-06-30T12:46:53.374Z</updated>
    
    <content type="html"><![CDATA[<h1 id="OkHttp简介"><a href="#OkHttp简介" class="headerlink" title="OkHttp简介"></a>OkHttp简介</h1><p>关于Okhttp的简介，相信大家都不陌生了，这里就不讲了。</p>
<h1 id="初级用法"><a href="#初级用法" class="headerlink" title="初级用法"></a>初级用法</h1><h2 id="Get请求"><a href="#Get请求" class="headerlink" title="Get请求"></a>Get请求</h2><p>比如这里的使用get方法进行登录操作<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doLoginGet</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">final</span> String url = <span class="string">"xxxxx?username=allever?password=123456"</span></div><div class="line">    OkHttpUtil.loginGet(url, <span class="keyword">new</span> Callback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, <span class="keyword">final</span> Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">            handleLogin(response.body().string(););</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>loginGet方法如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loginGet</span><span class="params">(String url, Callback callback)</span></span>&#123;</div><div class="line">    OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</div><div class="line">    Request request = <span class="keyword">new</span> Request.Builder()</div><div class="line">            .url(url)</div><div class="line">            .build();</div><div class="line">    client.newCall(request).enqueue(callback);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>是不是很简单，创建OkhttpClient实例，创建请求，然后执行请求，然后进行回调</p>
<p>处理结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">private void handleLogin(final String result)&#123;</div><div class="line">    runOnUiThread(new Runnable() &#123;</div><div class="line">        @Override</div><div class="line">        public void run() &#123;</div><div class="line">            Gson gson = new Gson();</div><div class="line">            LoginRoot loginRoot = gson.fromJson(result,LoginRoot.class);</div><div class="line">            User user = loginRoot.getUser();</div><div class="line">            tv_result.setText(user.getNickname() + &quot;\n&quot; + user.getSignature());</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>因为回调方法在子线程中，所以要切回到主线程中，方法有很多，可以使用Handler，这里直接runOnUiThread()就好了。简单起见，另外Gson处理json数据不在讨论范围之内，</p>
<h2 id="Post请求"><a href="#Post请求" class="headerlink" title="Post请求"></a>Post请求</h2><p>例子同上，登录操作<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doLoginPost</span><span class="params">()</span></span>&#123;</div><div class="line">    OkHttpUtil.loginPost(username, password, <span class="keyword">new</span> Callback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">            handleLogin(response.body().string());</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public static void loginPost(String username, String password, Callback callback)&#123;</div><div class="line">    String url = BASE_URL + &quot;LoginServlet&quot;;</div><div class="line">    OkHttpClient client = new OkHttpClient();</div><div class="line">    FormBody.Builder builder = new FormBody.Builder();</div><div class="line">    builder.add(&quot;username&quot;,username);</div><div class="line">    RequestBody requestBody = builder.build();</div><div class="line">    Request request = new Request.Builder()</div><div class="line">            .url(url)</div><div class="line">            .post(requestBody)</div><div class="line">            .build();</div><div class="line">    client.newCall(request).enqueue(callback);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>唯一不同的就是这里啦，首先还是创建OkhttpClient实例，这里使用了FormBody表单, 用这个表单创建请求体，然后创建请求，最后执行请求，回调<br>最后的处理方法同上。</p>
<h2 id="异步请求"><a href="#异步请求" class="headerlink" title="异步请求"></a>异步请求</h2><p>上面两个例子都是异步请求，因为不用咋们手动开启子线程，它会自动的开启线程去处理的</p>
<h2 id="同步请求"><a href="#同步请求" class="headerlink" title="同步请求"></a>同步请求</h2><p>例如，退出登录的例子<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doLogoutTongBu</span><span class="params">()</span></span>&#123;</div><div class="line">        OkHttpUtil.logoutTongBu(handler);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">logoutTongBu</span><span class="params">(<span class="keyword">final</span> Handler handler)</span></span>&#123;</div><div class="line">    <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">            String url = <span class="string">"xxxxx/logout"</span>;</div><div class="line">            OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</div><div class="line">            FormBody.Builder builder = <span class="keyword">new</span> FormBody.Builder();</div><div class="line">            <span class="keyword">if</span> (!SharePreferenceUtil.getSessionId().equals(<span class="string">""</span>))&#123;</div><div class="line">                RequestBody requestBody = builder.build();</div><div class="line">                Request request = <span class="keyword">new</span> Request.Builder()</div><div class="line">                        .url(url)</div><div class="line">                        .post(requestBody)</div><div class="line">                        .addHeader(<span class="string">"Cookie"</span>, <span class="string">"JSESSIONID="</span> + SharePreferenceUtil.getSessionId())</div><div class="line">                        .build();</div><div class="line">                Response response = <span class="keyword">null</span>;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    response = client.newCall(request).execute();</div><div class="line">                    String result = response.body().string();</div><div class="line">                    Message message = <span class="keyword">new</span> Message();</div><div class="line">                    message.what = MESSAGE_LOGOUT;</div><div class="line">                    message.obj = result;</div><div class="line">                    handler.sendMessage(message);</div><div class="line">                &#125;<span class="keyword">catch</span> (IOException ioe)&#123;</div><div class="line">                    ioe.printStackTrace();</div><div class="line">                &#125;</div><div class="line"></div><div class="line">            &#125;<span class="keyword">else</span> &#123;</div><div class="line">                Message message = <span class="keyword">new</span> Message();</div><div class="line">                message.what = MESSAGE_LOGOUT;</div><div class="line">                message.obj = <span class="string">"未登录"</span>;</div><div class="line">                handler.sendMessage(message);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;).start();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里手动开启了一个线程进行网络请求，还是使用Post方法，跟上面的没啥区别，注意这里<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">addHeader(&quot;Cookie&quot;, &quot;JSESSIONID=&quot; + SharePreferenceUtil.getSessionId())</div></pre></td></tr></table></figure></p>
<p>添加Cookie的头部信息，Cookie就是用来持久化用户登录<br>还有就是执行请求的方法有些区别，同步执行是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">response = client.newCall(request).execute();</div></pre></td></tr></table></figure></p>
<p>异步执行是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">client.newCall(request).enqueue(callback);</div></pre></td></tr></table></figure></p>
<p>同步执行的结果为Response对象，就是服务器返回的数据</p>
<h1 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h1><h2 id="上传文件和表单数据"><a href="#上传文件和表单数据" class="headerlink" title="上传文件和表单数据"></a>上传文件和表单数据</h2><p>例如发一条说说，包括图片和文字<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doAddNews</span><span class="params">(String content)</span></span>&#123;</div><div class="line">    OkHttpUtil.addNews(content, <span class="keyword">new</span> Callback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">            Log.d(TAG, <span class="string">"onResponse: result = "</span> + response.body().string());</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">public static void addNews(String content,Callback callback)&#123;</div><div class="line">    OkHttpClient client = new OkHttpClient();</div><div class="line">    MultipartBody multipartBody = new MultipartBody.Builder()</div><div class="line">            .setType(MultipartBody.FORM)</div><div class="line">            .addFormDataPart(&quot;content&quot;,content)</div><div class="line">            .addFormDataPart(&quot;city&quot;,&quot;番禺&quot;)</div><div class="line">            .addFormDataPart(&quot;longitude&quot;,&quot;111.22&quot;)</div><div class="line">            .addFormDataPart(&quot;latitude&quot;,&quot;22.22&quot;)</div><div class="line">            .addPart(Headers.of(&quot;Content-Disposition&quot;,</div><div class="line">                    &quot;form-data; name=\&quot;part1&quot;+ &quot;\&quot;&quot;),</div><div class="line">                    RequestBody.create(</div><div class="line">                            MediaType.parse(&quot;application/octet-stream&quot;),</div><div class="line">                            new File(Environment.getExternalStorageDirectory().getPath()+&quot;/&quot;,&quot;jiaxin.png&quot;)))</div><div class="line">            .build();</div><div class="line"></div><div class="line">    if (SharePreferenceUtil.getSessionId().equals(&quot;&quot;))&#123;</div><div class="line">    &#125;</div><div class="line">    Request request = new Request.Builder()</div><div class="line">            .url(BASE_URL + &quot;AddNewsServlet&quot;)</div><div class="line">            .post(multipartBody)</div><div class="line">            .addHeader(&quot;Cookie&quot;, &quot;JSESSIONID=&quot; + SharePreferenceUtil.getSessionId())</div><div class="line">            .build();</div><div class="line"></div><div class="line">    client.newCall(request).enqueue(callback);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>设置表单类型<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">setType(MultipartBody.FORM)</div></pre></td></tr></table></figure></p>
<p>使用MultipartBody对象把表单数据和文件数据形式封装，表单使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">addFormDataPart(&quot;content&quot;,content)</div></pre></td></tr></table></figure></p>
<p>用键值对保存</p>
<p>文件用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">.addPart(Headers.of(&quot;Content-Disposition&quot;,</div><div class="line">                        &quot;form-data; name=\&quot;part1&quot;+ &quot;\&quot;&quot;),</div><div class="line">                        RequestBody.create(</div><div class="line">                                MediaType.parse(&quot;application/octet-stream&quot;),</div><div class="line">                                fileObject))</div></pre></td></tr></table></figure></p>
<p>其中：part1是服务器根据键找到part的那个键<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">request.getPart(&quot;part1&quot;);</div></pre></td></tr></table></figure></p>
<p>如果多文件的话就多次调用addPart()</p>
<blockquote>
<p>必须设置表单类型</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">setType(MultipartBody.FORM)</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;OkHttp简介&quot;&gt;&lt;a href=&quot;#OkHttp简介&quot; class=&quot;headerlink&quot; title=&quot;OkHttp简介&quot;&gt;&lt;/a&gt;OkHttp简介&lt;/h1&gt;&lt;p&gt;关于Okhttp的简介，相信大家都不陌生了，这里就不讲了。&lt;/p&gt;
&lt;h1 id=&quot;初级用法
    
    </summary>
    
      <category term="Android" scheme="https://devallever.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://devallever.github.io/tags/Android/"/>
    
      <category term="Network" scheme="https://devallever.github.io/tags/Network/"/>
    
      <category term="OkHttp" scheme="https://devallever.github.io/tags/OkHttp/"/>
    
  </entry>
  
  <entry>
    <title>社交圈</title>
    <link href="https://devallever.github.io/2017/06/21/social-app/"/>
    <id>https://devallever.github.io/2017/06/21/social-app/</id>
    <published>2017-06-21T13:17:26.000Z</published>
    <updated>2017-06-24T11:45:08.943Z</updated>
    
    <content type="html"><![CDATA[<h1 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h1><p>一款社交 APP<br>附近人模块:中可以关注,聊天,加好友,好友分组管理。查找,筛选用户<br>动态模块:可以,点赞,评论。可以发布语音动态,和语音评论并且实时通知。<br>聊天模块,集成环信 IM。文本,表情,图片,位置,语音通话,视频聊天。设置在<br>线状态,离开自动回复。<br>推荐模块包括热点(浏览量最多的动态)、圈子(好友的动态)、定位(查看好友登录地<br>理位置)<br>通知模块:使用极光推送。刷新,发布动态,评论,点赞,好友请求。<br>其他功能:查看关注用户,粉丝用户,谁看过我,照片墙。</p>
<h1 id="项目架构"><a href="#项目架构" class="headerlink" title="项目架构"></a>项目架构</h1><ul>
<li>发现<ul>
<li>用户<ul>
<li>查看用户资料</li>
<li>查找用户</li>
<li>添加好友 删除好友</li>
<li>关注</li>
<li>聊天</li>
</ul>
</li>
<li>动态<ul>
<li>查看动态详细信息</li>
<li>发布动态</li>
<li>评论</li>
<li>点赞</li>
</ul>
</li>
</ul>
</li>
<li>聊天<ul>
<li>消息列表</li>
<li>好友管理<ul>
<li>分组管理：添加分组，删除分组，修改分组</li>
<li>修改好友备注，移动分组</li>
</ul>
</li>
</ul>
</li>
<li>推荐<ul>
<li>热点：浏览量最多的动态</li>
<li>圈子：好友的动态</li>
<li>足迹(定位)：好友位置</li>
</ul>
</li>
<li>我的<ul>
<li>修改用户资料</li>
<li>修改在线状态</li>
<li>动态数，关注数，粉丝数</li>
<li>照片墙：添加照片，删除照片</li>
<li>访客：访问主页，访问动态</li>
<li>设置：视频聊天，清理缓存，自动回复</li>
</ul>
</li>
</ul>
<h1 id="功能实现细节"><a href="#功能实现细节" class="headerlink" title="功能实现细节"></a>功能实现细节</h1><h1 id="欢迎界面"><a href="#欢迎界面" class="headerlink" title="欢迎界面"></a>欢迎界面</h1><h1 id="登录-注册"><a href="#登录-注册" class="headerlink" title="登录-注册"></a>登录-注册</h1><h1 id="刷刷"><a href="#刷刷" class="headerlink" title="刷刷"></a>刷刷</h1><h1 id="主界面"><a href="#主界面" class="headerlink" title="主界面"></a>主界面</h1><h2 id="发现"><a href="#发现" class="headerlink" title="发现"></a>发现</h2><h3 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h3><h4 id="用户列表"><a href="#用户列表" class="headerlink" title="用户列表"></a>用户列表</h4><h4 id="查找用户"><a href="#查找用户" class="headerlink" title="查找用户"></a>查找用户</h4><h4 id="用户资料"><a href="#用户资料" class="headerlink" title="用户资料"></a>用户资料</h4><h4 id="添加好友"><a href="#添加好友" class="headerlink" title="添加好友"></a>添加好友</h4><h4 id="删除好友"><a href="#删除好友" class="headerlink" title="删除好友"></a>删除好友</h4><h4 id="关注-粉丝数"><a href="#关注-粉丝数" class="headerlink" title="关注-粉丝数"></a>关注-粉丝数</h4><h3 id="动态"><a href="#动态" class="headerlink" title="动态"></a>动态</h3><h4 id="发布动态"><a href="#发布动态" class="headerlink" title="发布动态"></a>发布动态</h4><h4 id="查看动态"><a href="#查看动态" class="headerlink" title="查看动态"></a>查看动态</h4><h4 id="评论"><a href="#评论" class="headerlink" title="评论"></a>评论</h4><h4 id="点赞"><a href="#点赞" class="headerlink" title="点赞"></a>点赞</h4><h4 id="查看大图"><a href="#查看大图" class="headerlink" title="查看大图"></a>查看大图</h4><h2 id="聊天"><a href="#聊天" class="headerlink" title="聊天"></a>聊天</h2><h3 id="好友管理"><a href="#好友管理" class="headerlink" title="好友管理"></a>好友管理</h3><h4 id="好友列表"><a href="#好友列表" class="headerlink" title="好友列表"></a>好友列表</h4><h4 id="分组管理"><a href="#分组管理" class="headerlink" title="分组管理"></a>分组管理</h4><h4 id="添加分组"><a href="#添加分组" class="headerlink" title="添加分组"></a>添加分组</h4><h4 id="修改分组"><a href="#修改分组" class="headerlink" title="修改分组"></a>修改分组</h4><h4 id="删除分组"><a href="#删除分组" class="headerlink" title="删除分组"></a>删除分组</h4><h4 id="移动分组"><a href="#移动分组" class="headerlink" title="移动分组"></a>移动分组</h4><h4 id="修改备注"><a href="#修改备注" class="headerlink" title="修改备注"></a>修改备注</h4><p>##推荐</p>
<h3 id="热点"><a href="#热点" class="headerlink" title="热点"></a>热点</h3><h3 id="圈子"><a href="#圈子" class="headerlink" title="圈子"></a>圈子</h3><h3 id="足迹-定位"><a href="#足迹-定位" class="headerlink" title="足迹(定位)"></a>足迹(定位)</h3><h3 id="排行榜"><a href="#排行榜" class="headerlink" title="排行榜"></a>排行榜</h3><h2 id="我的"><a href="#我的" class="headerlink" title="我的"></a>我的</h2><h3 id="修改用户资料"><a href="#修改用户资料" class="headerlink" title="修改用户资料"></a>修改用户资料</h3><h3 id="修改在线状态"><a href="#修改在线状态" class="headerlink" title="修改在线状态"></a>修改在线状态</h3><h3 id="照片墙"><a href="#照片墙" class="headerlink" title="照片墙"></a>照片墙</h3><h3 id="访客"><a href="#访客" class="headerlink" title="访客"></a>访客</h3><h3 id="动态数-关注数-粉丝数"><a href="#动态数-关注数-粉丝数" class="headerlink" title="动态数-关注数-粉丝数"></a>动态数-关注数-粉丝数</h3><h3 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h3><h4 id="视频聊天"><a href="#视频聊天" class="headerlink" title="视频聊天"></a>视频聊天</h4><h4 id="清理缓存"><a href="#清理缓存" class="headerlink" title="清理缓存"></a>清理缓存</h4><h4 id="自动回复"><a href="#自动回复" class="headerlink" title="自动回复"></a>自动回复</h4>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;项目简介&quot;&gt;&lt;a href=&quot;#项目简介&quot; class=&quot;headerlink&quot; title=&quot;项目简介&quot;&gt;&lt;/a&gt;项目简介&lt;/h1&gt;&lt;p&gt;一款社交 APP&lt;br&gt;附近人模块:中可以关注,聊天,加好友,好友分组管理。查找,筛选用户&lt;br&gt;动态模块:可以,点赞,评论
    
    </summary>
    
      <category term="Android" scheme="https://devallever.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://devallever.github.io/tags/Android/"/>
    
      <category term="Project" scheme="https://devallever.github.io/tags/Project/"/>
    
      <category term="社交" scheme="https://devallever.github.io/tags/%E7%A4%BE%E4%BA%A4/"/>
    
  </entry>
  
  <entry>
    <title>深入理解Java垃圾回收机制</title>
    <link href="https://devallever.github.io/2017/06/11/java-gc/"/>
    <id>https://devallever.github.io/2017/06/11/java-gc/</id>
    <published>2017-06-11T02:43:45.000Z</published>
    <updated>2017-06-15T05:26:47.239Z</updated>
    
    <content type="html"><![CDATA[<h1 id="垃圾回收机制的意义"><a href="#垃圾回收机制的意义" class="headerlink" title="垃圾回收机制的意义"></a>垃圾回收机制的意义</h1><p>Java语言中一个显著的特点就是引入了垃圾回收机制，使c++程序员最头疼的内存管理的问题迎刃而解，它使得Java程序员在编写程序的时候不再需要考虑内存管理。由于有个垃圾回收机制，Java中的对象不再有“作用域”的概念，只有对象的引用才有“作用域”。垃圾回收可以有效的防止内存泄露，有效的使用空闲的内存。  </p>
<p>　　ps:内存泄露是指该内存空间使用完毕之后未回收，在不涉及复杂数据结构的一般情况下，Java 的内存泄露表现为一个内存对象的生命周期超出了程序需要它的时间长度，我们有时也将其称为“对象游离”。
　　</p>
<h1 id="垃圾回收机制中的算法"><a href="#垃圾回收机制中的算法" class="headerlink" title="垃圾回收机制中的算法"></a>垃圾回收机制中的算法</h1><p>　Java语言规范没有明确地说明JVM使用哪种垃圾回收算法，但是任何一种垃圾回收算法一般要做2件基本的事情：<br>　（1）发现无用信息对象；<br>　（2）回收被无用对象占用的内存空间，使该空间可被程序再次使用。
　</p>
<h1 id="Jvm-Java虚拟机-内存模型"><a href="#Jvm-Java虚拟机-内存模型" class="headerlink" title="Jvm(Java虚拟机)内存模型"></a>Jvm(Java虚拟机)内存模型</h1><p>在了解垃圾回收算法之前先简单了解一下jvm内存模型.<br>从Jvm内存模型中入手对于理解GC会有很大的帮助，不过这里只需要了解一个大概，说多了反而混淆视线。  </p>
<p>Jvm(Java虚拟机)主要管理两种类型内存：堆和非堆。</p>
<ul>
<li>堆是运行时数据区域，所有类实例和数组的内存均从此处分配。</li>
<li>非堆是JVM留给自己用的，包含方法区、JVM内部处理或优化所需的内存（如 JIT Compiler，Just-in-time Compiler，即时编译后的代码缓存）、每个类结构（如运行时常数池、字段和方法数据）以及方法和构造方法的代码。</li>
</ul>
<p>简言之，Java程序内存主要（这里强调主要二字）分两部分，堆和非堆。大家一般new的对象和数组都是在堆中的，而GC主要回收的内存也是这块堆内存。  </p>
<p>配一张示意图总结一下：<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.jayfeng.com/images/gc_jvm_memory.gif" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure></p>
<blockquote>
<p>堆内存（Heap Memory）： 存放Java对象<br>非堆内存（Non-Heap Memory）： 存放类加载信息和其它meta-data<br>其它（Other）： 存放JVM 自身代码等</p>
</blockquote>
<p>重点是堆内存，我们就再看看堆的内存模型。</p>
<ul>
<li>堆内存由垃圾回收器的自动内存管理系统回收。</li>
<li>堆内存分为两大部分：新生代和老年代。比例为1：2。</li>
<li>老年代主要存放应用程序中生命周期长的存活对象。</li>
<li>新生代又分为三个部分：一个Eden区和两个Survivor区，比例为8：1：1。</li>
<li>Eden区存放新生的对象。</li>
<li>Survivor存放每次垃圾回收后存活的对象。</li>
</ul>
<p><img src="http://www.jayfeng.com/images/gc_heap.png" alt=""></p>
<p>其实只需要关注这几个问题:</p>
<ul>
<li>为什么要分新生代和老年代？</li>
<li>新生代为什么分一个Eden区和两个Survivor区?</li>
<li>一个Eden区和两个Survivor区的比例为什么是8:1:1？</li>
</ul>
<p>现在还不能解释为什么，但这几个问题都是垃圾回收机制所采用的算法决定的。<br>所以问题转化为，是何种算法？为什么要采用此种算法？</p>
<h1 id="可回收对象的判定"><a href="#可回收对象的判定" class="headerlink" title="可回收对象的判定"></a>可回收对象的判定</h1><p>讲算法之前，我们先要搞清楚一个问题，什么样的对象是垃圾（无用对象），需要被回收？<br>目前市面上有两种算法用来判定一个对象是否为垃圾。</p>
<ul>
<li>引用计数算法</li>
<li>可达性分析算法（根搜索算法）</li>
</ul>
<h2 id="引用计数法-Reference-Counting-Collector"><a href="#引用计数法-Reference-Counting-Collector" class="headerlink" title="引用计数法(Reference Counting Collector)"></a>引用计数法(Reference Counting Collector)</h2><h3 id="算法分析"><a href="#算法分析" class="headerlink" title="算法分析"></a>算法分析</h3><p>引用计数是垃圾收集器中的早期策略。在这种方法中，堆中每个对象实例都有一个引用计数。当一个对象被创建时，且将该对象实例分配给一个变量，该变量计数设置为1。当任何其它变量被赋值为这个对象的引用时，计数加1（a = b,则b引用的对象实例的计数器+1），但当一个对象实例的某个引用超过了生命周期或者被设置为一个新值时，对象实例的引用计数器减1。任何引用计数器为0的对象实例可以被当作垃圾收集。当一个对象实例被垃圾收集时，它引用的任何对象实例的引用计数器减1。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.jayfeng.com/images/gc_recycled_object.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<h3 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h3><ul>
<li>优点: 简单，高效<br>引用计数收集器可以很快的执行，交织在程序运行中。对程序需要不被长时间打断的实时环境比较有利。</li>
<li>缺点: 无法检测出循环引用<br> 如父对象有一个对子对象的引用，子对象反过来引用父对象。这样，他们的引用计数永远不可能为0.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        MyObject object1 = <span class="keyword">new</span> MyObject();</div><div class="line">        MyObject object2 = <span class="keyword">new</span> MyObject();</div><div class="line">         </div><div class="line">        object1.object = object2;</div><div class="line">        object2.object = object1;</div><div class="line">         </div><div class="line">        object1 = <span class="keyword">null</span>;</div><div class="line">        object2 = <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最后面两句将object1和object2赋值为null，也就是说object1和object2指向的对象已经不可能再被访问，但是由于它们互相引用对方，导致它们的引用计数器都不为0，那么垃圾收集器就永远不会回收它们。</p>
<h2 id="可达性分析算法（根搜索算法）"><a href="#可达性分析算法（根搜索算法）" class="headerlink" title="可达性分析算法（根搜索算法）"></a>可达性分析算法（根搜索算法）</h2><h3 id="算法分析-1"><a href="#算法分析-1" class="headerlink" title="算法分析"></a>算法分析</h3><p>根搜索算法是从离散数学中的图论引入的，程序把所有的引用关系看作一张图，从一个节点GC ROOT开始，寻找对应的引用节点，找到这个节点以后，继续寻找这个节点的引用节点，当所有的引用节点寻找完毕之后，剩余的节点则被认为是没有被引用到的节点，即无用的节点。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://images0.cnblogs.com/blog2015/694841/201506/141050566294022.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>java中可作为GC Root的对象有:</p>
<ul>
<li>虚拟机栈中引用的对象（本地变量表）</li>
<li>方法区中静态属性引用的对象</li>
<li>方法区中常量引用的对象</li>
<li>本地方法栈中引用的对象（Native对象）</li>
</ul>
<h3 id="优缺点-1"><a href="#优缺点-1" class="headerlink" title="优缺点"></a>优缺点</h3><ul>
<li>优点:<br>  解决循环引用问题</li>
<li>缺点:</li>
</ul>
<h1 id="Stop-The-World"><a href="#Stop-The-World" class="headerlink" title="Stop The World"></a>Stop The World</h1><p>在学习GC前，你应该知道一个技术名词:这个词是“stop-the-world。“ 无论你选择哪种GC算法，Stop-the-world都会发生。Stop-the-world意味着JVM停止应用程序，而去进行垃圾回收。当stop-the-world发生时，除了进行垃圾回收的线程，其他所有线程都将停止运行。被中断的任务将在GC任务完成后恢复执行。GC调优往往意味着减少stop-the-world的时间.  </p>
<p>垃圾回收的时候，需要整个的引用状态保持不变，否则判定是判定垃圾，等我稍后回收的时候它又被引用了，这就全乱套了。所以，GC的时候，其他所有的程序执行处于暂停状态，卡住了。  </p>
<p>幸运的是，这个卡顿是非常短（尤其是新生代），对程序的影响微乎其微 （关于其他GC比如并发GC之类的，在此不讨论）。<br>所以GC的卡顿问题由此而来，也是情有可原，暂时无可避免。</p>
<h1 id="垃圾回收算法"><a href="#垃圾回收算法" class="headerlink" title="垃圾回收算法"></a>垃圾回收算法</h1><h2 id="标记清除算法-Mark-Sweep"><a href="#标记清除算法-Mark-Sweep" class="headerlink" title="标记清除算法 (Mark-Sweep)"></a>标记清除算法 (Mark-Sweep)</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>分为两个阶段: 标记阶段(Mark) 和清除阶段(Sweep):</p>
<ul>
<li>标记阶段:<br>  collector从mutator根对象开始进行遍历，对从mutator根对象可以访问到的对象都打上一个标识，一般是在对象的header中，将其记录为可达对象。</li>
<li>清除阶段:<br>  collector对堆内存(heap memory)从头到尾进行线性的遍历，如果发现某个对象没有标记为可达对象-通过读取对象的header信息，则就将其回收。</li>
</ul>
<blockquote>
<p>collector指的就是垃圾收集器，而mutator是指除了垃圾收集器之外的部分，比如说我们应用程序本身。mutator的职责一般是NEW(分配内存),READ(从内存中读取内容),WRITE(将内容写入内存)，而collector则就是回收不再使用的内存来供mutator进行NEW操作的使用。<br>mutator根对象一般指的是分配在堆内存之外，可以直接被mutator直接访问到的对象，一般是指静态/全局变量以及Thread-Local变量<br>可达对象的定义，从mutator根对象开始进行遍历，可以被访问到的对象都称为是可达对象。这些对象也是mutator(你的应用程序)正在使用的对象。</p>
</blockquote>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.processon.com/chart_image/530043e10cf2a3dc99dd9439.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<h3 id="优缺点-2"><a href="#优缺点-2" class="headerlink" title="优缺点"></a>优缺点</h3><ul>
<li>优点:简单,容易实现</li>
<li>缺点:容易产生内存碎片，碎片太多可能会导致后续过程中需要为大对象分配空间时无法找到足够的空间而提前触发新的一次垃圾收集动作。</li>
</ul>
<h2 id="复制算法-Copying"><a href="#复制算法-Copying" class="headerlink" title="复制算法 (Copying)"></a>复制算法 (Copying)</h2><h3 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h3><p>复制算法将内存划分为两个区间,活动区和空闲区，在任意时间点，所有动态分配的对象都只能分配在活动区<br>当有效内存空间耗尽时，JVM将暂停程序运行，开启复制算法GC线程。接下来GC线程会将活动区间内的存活对象，全部复制到空闲区间，且严格按照内存地址依次排列，与此同时，GC线程将更新存活对象的内存引用地址指向新的内存地址。<br>此时，空闲区间已经与活动区间交换，而垃圾对象现在已经全部留在了原来的活动区间，也就是现在的空闲区间。事实上，在活动区间转换为空间区间的同时，垃圾对象已经被一次性全部回收。</p>
<p>清理前:<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://images.cnitblog.com/blog/558323/201308/20004315-b6d8b69879b94b518e98b5854b12f0f1.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure></p>
<p>清理后:<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://images.cnitblog.com/blog/558323/201308/20004628-0ff08e1b8cd04e448703b01f0461e266.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure></p>
<blockquote>
<p>通俗的讲,就是:<br>    复制算法将可用内存按容量划分为大小相等的两块，每次只使用其中的一块。当这一块的内存用完了，就将还存活着的对象复制到另外一块上面，然后再把已使用的内存空间一次清理掉，这样一来就不容易出现内存碎片的问题。</p>
</blockquote>
<p><img src="http://jayfeng.com/images/gc_copying.png" alt=""></p>
<h3 id="优缺点-3"><a href="#优缺点-3" class="headerlink" title="优缺点"></a>优缺点</h3><ul>
<li>优点:实现简单，运行高效且不容易产生内存碎片</li>
<li>缺点:浪费内存</li>
</ul>
<h2 id="标记整理算法-Mark-Compact"><a href="#标记整理算法-Mark-Compact" class="headerlink" title="标记整理算法 (Mark-Compact)"></a>标记整理算法 (Mark-Compact)</h2><h3 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h3><p>分为两个阶段: 标记阶段(Mark) 和整理阶段(Compact)</p>
<ul>
<li>标记阶段: 与标记/清除算法是一模一样</li>
<li>整理阶段: 移动所有存活的对象，且按照内存地址次序依次排列，然后将末端内存地址以后的内存全部回收。</li>
</ul>
<p>标记-整理算法采用标记-清除算法一样的方式进行对象的标记，但在清除时不同，在回收不存活的对象占用的空间后，会将所有的存活对象往左端空闲空间移动，并更新对应的指针。标记-整理算法是在标记-清除算法的基础上，又进行了对象的移动，因此成本更高，但是却解决了内存碎片的问题。</p>
<h3 id="优缺点-4"><a href="#优缺点-4" class="headerlink" title="优缺点"></a>优缺点</h3><ul>
<li>优点: 标记/整理算法不仅可以弥补标记/清除算法当中，内存区域分散的缺点，也消除了复制算法当中，内存减半的高额代价</li>
<li>缺点: 低效</li>
</ul>
<h2 id="分代回收算法-Generational-Collector"><a href="#分代回收算法-Generational-Collector" class="headerlink" title="分代回收算法(Generational Collector)"></a>分代回收算法(Generational Collector)</h2><p>分代回收算法其实不算一种新的算法，而是根据复制算法和标记整理算法的的特点综合而成。这种综合是考虑到java的语言特性的。<br>这里重复一下两种老算法的适用场景：</p>
<ul>
<li>复制算法：适用于存活对象很少。回收对象多</li>
<li><p>适用用于存活对象多，回收对象少</p>
<p>复习下面这个图:</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.jayfeng.com/images/gc_heap.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
</li>
</ul>
<p>解析：</p>
<ul>
<li>堆内存分为两大部分：新生代和老年代。比例为1：2。</li>
<li>新生代又分为三个部分：一个Eden区和两个Survivor区，比例为8：1：1。</li>
<li>Eden区存放新生的对象。new</li>
<li>Survivor存放每次垃圾回收后存活的对象。</li>
<li>老年代主要存放应用程序中生命周期长的存活对象。</li>
</ul>
<h3 id="原理-过程"><a href="#原理-过程" class="headerlink" title="原理(过程)"></a>原理(过程)</h3><p>所有新生成的对象首先都是放在年轻代的。年轻代的目标就是尽可能快速的收集掉那些生命周期短的对象。</p>
<ul>
<li>分配对象时，保存在Eden区</li>
<li>Eden区满，触发GC(Minor GC), 将Eden区存活对象复制到一个survivor0区，然后清空Eden区</li>
<li>当这个survivor0区也存放满了时，则将eden区和survivor0区存活对象复制到另一个survivor1区，然后清空eden和这个survivor0区</li>
<li>此时survivor0区是空的，然后将survivor0区和survivor1区交换，即保持survivor1区为空， 如此往复</li>
<li>当survivor1区不足以存放 eden和survivor0的存活对象时，就将存活对象直接存放到老年代。若是老年代也满了就会触发一次Full GC，也就是新生代、老年代都进行回收</li>
</ul>
<h3 id="年轻代-年老代-持久代"><a href="#年轻代-年老代-持久代" class="headerlink" title="年轻代 年老代 持久代"></a>年轻代 年老代 持久代</h3><ul>
<li>年轻代(Young Generation)：<br>  所有新生成的对象首先都是放在年轻代的。年轻代的目标就是尽可能快速的收集掉那些生命周期短的对象。<br>  新生代发生的GC也叫做Minor GC，MinorGC发生频率比较高(不一定等Eden区满了才触发)</li>
<li>年老代(Old Generation)：<br>  年老代中存放的都是一些生命周期较长的对象。<br>  老年代内存满时触发Major GC即Full GC，Full GC发生频率比较低，老年代对象存活时间比较长，存活率标记高。</li>
<li>持久代(Permanent Generation)：<br>  用于存放静态文件，如Java类、方法等。持久代对垃圾回收没有显著影响，但是有些应用可能动态生成或者调用一些class，例如Hibernate 等，在这种时候需要设置一个比较大的持久代空间来存放这些运行过程中新增的类。</li>
</ul>
<h1 id="深入理解分代回收算法"><a href="#深入理解分代回收算法" class="headerlink" title="深入理解分代回收算法"></a>深入理解分代回收算法</h1><h2 id="为什么不是一块Survivor空间而是两块？"><a href="#为什么不是一块Survivor空间而是两块？" class="headerlink" title="为什么不是一块Survivor空间而是两块？"></a>为什么不是一块Survivor空间而是两块？</h2><p>这里涉及到一个新生代和老年代的存活周期的问题，比如一个对象在新生代经历15次（仅供参考）GC，就可以移到老年代了。问题来了，当我们第一次GC的时候，我们可以把Eden区的存活对象放到Survivor A空间，但是第二次GC的时候，Survivor A空间的存活对象也需要再次用Copying算法，放到Survivor B空间上，而把刚刚的Survivor A空间和Eden空间清除。第三次GC时，又把Survivor B空间的存活对象复制到Survivor A空间，如此反复。<br>所以，这里就需要两块Survivor空间来回倒腾</p>
<h2 id="为什么Eden空间这么大而Survivor空间要分的少一点？"><a href="#为什么Eden空间这么大而Survivor空间要分的少一点？" class="headerlink" title="为什么Eden空间这么大而Survivor空间要分的少一点？"></a>为什么Eden空间这么大而Survivor空间要分的少一点？</h2><p>新创建的对象都是放在Eden空间，这是很频繁的，尤其是大量的局部变量产生的临时对象，这些对象绝大部分都应该马上被回收，能存活下来被转移到survivor空间的往往不多。所以，设置较大的Eden空间和较小的Survivor空间是合理的，大大提高了内存的使用率，缓解了Copying算法的缺点。<br>我看8：1：1就挺好的，当然这个比例是可以调整的，包括上面的新生代和老年代的1：2的比例也是可以调整的。<br>新的问题又来了，从Eden空间往Survivor空间转移的时候Survivor空间不够了怎么办？直接放到老年代去</p>
<h1 id="垃圾收集器"><a href="#垃圾收集器" class="headerlink" title="垃圾收集器"></a>垃圾收集器</h1><ul>
<li>新生代收集器使用的收集器：Serial、PraNew、Parallel Scavenge</li>
<li>老年代收集器使用的收集器：Serial Old、Parallel Old、CMS</li>
</ul>
<p><img src="http://images0.cnblogs.com/blog2015/694841/201506/141513122384006.jpg" alt=""></p>
<h2 id="Serial收集器（复制算法"><a href="#Serial收集器（复制算法" class="headerlink" title="Serial收集器（复制算法)"></a>Serial收集器（复制算法)</h2><p>　　新生代单线程收集器，标记和清理都是单线程，优点是简单高效。</p>
<h2 id="Serial-Old收集器-标记-整理算法"><a href="#Serial-Old收集器-标记-整理算法" class="headerlink" title="Serial Old收集器(标记-整理算法)"></a>Serial Old收集器(标记-整理算法)</h2><p>　　老年代单线程收集器，Serial收集器的老年代版本。</p>
<h2 id="ParNew收集器-停止-复制算法"><a href="#ParNew收集器-停止-复制算法" class="headerlink" title="ParNew收集器(停止-复制算法)　"></a>ParNew收集器(停止-复制算法)　</h2><p>　　新生代收集器，可以认为是Serial收集器的多线程版本,在多核CPU环境下有着比Serial更好的表现。<br>Parallel Scavenge收集器(停止-复制算法)<br>并行收集器，追求高吞吐量，高效利用CPU。吞吐量一般为99%， 吞吐量= 用户线程时间/(用户线程时间+GC线程时间)。适合后台应用等对交互相应要求不高的场景。</p>
<h2 id="Parallel-Old收集器-停止-复制算法"><a href="#Parallel-Old收集器-停止-复制算法" class="headerlink" title="Parallel Old收集器(停止-复制算法)"></a>Parallel Old收集器(停止-复制算法)</h2><p>　　Parallel Scavenge收集器的老年代版本，并行收集器，吞吐量优先</p>
<h2 id="CMS-Concurrent-Mark-Sweep-收集器（标记-清理算法）"><a href="#CMS-Concurrent-Mark-Sweep-收集器（标记-清理算法）" class="headerlink" title="CMS(Concurrent Mark Sweep)收集器（标记-清理算法）"></a>CMS(Concurrent Mark Sweep)收集器（标记-清理算法）</h2><p>　　高并发、低停顿，追求最短GC回收停顿时间，cpu占用比较高，响应时间快，停顿时间短，多核cpu 追求高响应时间的选择</p>
<h1 id="GC的执行机制"><a href="#GC的执行机制" class="headerlink" title="GC的执行机制"></a>GC的执行机制</h1><h2 id="Scavenge-GC-Minor-GC"><a href="#Scavenge-GC-Minor-GC" class="headerlink" title="Scavenge GC(Minor GC)"></a>Scavenge GC(Minor GC)</h2><p>一般情况下，当新对象生成，并且在Eden申请空间失败时，就会触发Scavenge GC，对Eden区域进行GC，清除非存活对象，并且把尚且存活的对象移动到Survivor区。然后整理Survivor的两个区。这种方式的GC是对年轻代的Eden区进行，不会影响到年老代。因为大部分对象都是从Eden区开始的，同时Eden区不会分配的很大，所以Eden区的GC会频繁进行。因而，一般在这里需要使用速度快、效率高的算法，使Eden去能尽快空闲出来。</p>
<h2 id="Full-GC"><a href="#Full-GC" class="headerlink" title="Full GC"></a>Full GC</h2><p>对整个堆进行整理，包括Young、Tenured和Perm。Full GC因为需要对整个堆进行回收，所以比Scavenge GC要慢，因此应该尽可能减少Full GC的次数。在对JVM调优的过程中，很大一部分工作就是对于FullGC的调节。有如下原因可能导致Full GC：</p>
<ul>
<li>年老代（Tenured）被写满</li>
<li>持久代（Perm）被写满 </li>
<li>System.gc()被显示调用 </li>
<li>上一次GC之后Heap的各域分配策略动态变化</li>
</ul>
<blockquote>
<p>参考:</p>
<p><a href="http://www.cnblogs.com/sunniest/p/4575144.html" target="_blank" rel="external">深入理解java垃圾回收机制</a><br><a href="http://jayfeng.com/2016/03/11/%E7%90%86%E8%A7%A3Java%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/" target="_blank" rel="external">理解Java垃圾回收机制</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;垃圾回收机制的意义&quot;&gt;&lt;a href=&quot;#垃圾回收机制的意义&quot; class=&quot;headerlink&quot; title=&quot;垃圾回收机制的意义&quot;&gt;&lt;/a&gt;垃圾回收机制的意义&lt;/h1&gt;&lt;p&gt;Java语言中一个显著的特点就是引入了垃圾回收机制，使c++程序员最头疼的内存管理的
    
    </summary>
    
      <category term="Java" scheme="https://devallever.github.io/categories/Java/"/>
    
    
      <category term="Java" scheme="https://devallever.github.io/tags/Java/"/>
    
      <category term="GC" scheme="https://devallever.github.io/tags/GC/"/>
    
  </entry>
  
  <entry>
    <title>Adapter中的观察者模式</title>
    <link href="https://devallever.github.io/2017/06/02/observer-adapter/"/>
    <id>https://devallever.github.io/2017/06/02/observer-adapter/</id>
    <published>2017-06-02T01:02:15.000Z</published>
    <updated>2017-06-02T02:01:03.218Z</updated>
    
    <content type="html"><![CDATA[<p>当我们调用Adapter.notifyDataSetChanged()时候, 会调用被观察者的()方法，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseAdapter</span> <span class="keyword">implements</span> <span class="title">ListAdapter</span>, <span class="title">SpinnerAdapter</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="comment">//数据集被观察者</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DataSetObservable mDataSetObservable = <span class="keyword">new</span> DataSetObservable();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasStableIds</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerDataSetObserver</span><span class="params">(DataSetObserver observer)</span> </span>&#123;</div><div class="line">        mDataSetObservable.registerObserver(observer);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unregisterDataSetObserver</span><span class="params">(DataSetObserver observer)</span> </span>&#123;</div><div class="line">        mDataSetObservable.unregisterObserver(observer);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">        <span class="comment">/**</span></div><div class="line">     * Notifies the attached observers that the underlying data has been changed</div><div class="line">     * and any View reflecting the data set should refresh itself.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyDataSetChanged</span><span class="params">()</span> </span>&#123;</div><div class="line">    	<span class="comment">//通知观察者更新</span></div><div class="line">        mDataSetObservable.notifyChanged();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>//</p>
<p>在DataSetObservable.notifyChanged()方法中，遍历每个观察者，并调用观察者的onChanged()方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSetObservable</span> <span class="keyword">extends</span> <span class="title">Observable</span>&lt;<span class="title">DataSetObserver</span>&gt; </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Invokes &#123;<span class="doctag">@link</span> DataSetObserver#onChanged&#125; on each observer.</div><div class="line">     * Called when the contents of the data set have changed.  The recipient</div><div class="line">     * will obtain the new contents the next time it queries the data set.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyChanged</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">synchronized</span>(mObservers) &#123;</div><div class="line">            <span class="comment">// since onChanged() is implemented by the app, it could do anything, including</span></div><div class="line">            <span class="comment">// removing itself from &#123;@link mObservers&#125; - and that could cause problems if</span></div><div class="line">            <span class="comment">// an iterator is used on the ArrayList &#123;@link mObservers&#125;.</span></div><div class="line">            <span class="comment">// to avoid such problems, just march thru the list in the reverse order.</span></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = mObservers.size() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</div><div class="line">                mObservers.get(i).onChanged();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>//<br>这些观察者从哪里来的，又是什么时候绑定到DataSetObservable中的?<br>查看ListView的setAdapter()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">/**</span></div><div class="line">   * Sets the data behind this ListView.</div><div class="line">   *</div><div class="line">   * The adapter passed to this method may be wrapped by a &#123;<span class="doctag">@link</span> WrapperListAdapter&#125;,</div><div class="line">   * depending on the ListView features currently in use. For instance, adding</div><div class="line">   * headers and/or footers will cause the adapter to be wrapped.</div><div class="line">   *</div><div class="line">   * <span class="doctag">@param</span> adapter The ListAdapter which is responsible for maintaining the</div><div class="line">   *        data backing this list and for producing a view to represent an</div><div class="line">   *        item in that data set.</div><div class="line">   *</div><div class="line">   * <span class="doctag">@see</span> #getAdapter() </div><div class="line">   */</div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAdapter</span><span class="params">(ListAdapter adapter)</span> </span>&#123;</div><div class="line">   <span class="comment">//如果已存在adapter先注销原来Adapter对应的观察者</span></div><div class="line">      <span class="keyword">if</span> (mAdapter != <span class="keyword">null</span> &amp;&amp; mDataSetObserver != <span class="keyword">null</span>) &#123;</div><div class="line">          mAdapter.unregisterDataSetObserver(mDataSetObserver);</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      resetList();</div><div class="line">      mRecycler.clear();</div><div class="line"></div><div class="line">      <span class="keyword">if</span> (mHeaderViewInfos.size() &gt; <span class="number">0</span>|| mFooterViewInfos.size() &gt; <span class="number">0</span>) &#123;</div><div class="line">          mAdapter = wrapHeaderListAdapterInternal(mHeaderViewInfos, mFooterViewInfos, adapter);</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">          mAdapter = adapter;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      mOldSelectedPosition = INVALID_POSITION;</div><div class="line">      mOldSelectedRowId = INVALID_ROW_ID;</div><div class="line"></div><div class="line">      <span class="comment">// AbsListView#setAdapter will update choice mode states.</span></div><div class="line">      <span class="keyword">super</span>.setAdapter(adapter);</div><div class="line"></div><div class="line">      <span class="keyword">if</span> (mAdapter != <span class="keyword">null</span>) &#123;</div><div class="line">          mAreAllItemsSelectable = mAdapter.areAllItemsEnabled();</div><div class="line">          mOldItemCount = mItemCount;</div><div class="line">          mItemCount = mAdapter.getCount();</div><div class="line">          checkFocus();</div><div class="line"></div><div class="line"><span class="comment">//创建一个数据集观察者</span></div><div class="line">          mDataSetObserver = <span class="keyword">new</span> AdapterDataSetObserver();</div><div class="line">          </div><div class="line">          	<span class="comment">//注册观察者</span></div><div class="line">          mAdapter.registerDataSetObserver(mDataSetObserver);</div><div class="line"></div><div class="line">          mRecycler.setViewTypeCount(mAdapter.getViewTypeCount());</div><div class="line"></div><div class="line">          <span class="keyword">int</span> position;</div><div class="line">          <span class="keyword">if</span> (mStackFromBottom) &#123;</div><div class="line">              position = lookForSelectablePosition(mItemCount - <span class="number">1</span>, <span class="keyword">false</span>);</div><div class="line">          &#125; <span class="keyword">else</span> &#123;</div><div class="line">              position = lookForSelectablePosition(<span class="number">0</span>, <span class="keyword">true</span>);</div><div class="line">          &#125;</div><div class="line">          setSelectedPositionInt(position);</div><div class="line">          setNextSelectedPositionInt(position);</div><div class="line"></div><div class="line">          <span class="keyword">if</span> (mItemCount == <span class="number">0</span>) &#123;</div><div class="line">              <span class="comment">// Nothing selected</span></div><div class="line">              checkSelectionChanged();</div><div class="line">          &#125;</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">          mAreAllItemsSelectable = <span class="keyword">true</span>;</div><div class="line">          checkFocus();</div><div class="line">          <span class="comment">// Nothing selected</span></div><div class="line">          checkSelectionChanged();</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      requestLayout();</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>///<br>AdapterDataSetObserver是AbsListView中定义的内部类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AdapterDataSetObserver</span> <span class="keyword">extends</span> <span class="title">AdapterView</span>&lt;<span class="title">ListAdapter</span>&gt;.<span class="title">AdapterDataSetObserver</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChanged</span><span class="params">()</span> </span>&#123;</div><div class="line">    	<span class="comment">//调用父类的onChange()方法。</span></div><div class="line">        <span class="keyword">super</span>.onChanged();</div><div class="line">        <span class="keyword">if</span> (mFastScroll != <span class="keyword">null</span>) &#123;</div><div class="line">            mFastScroll.onSectionsChanged();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onInvalidated</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onInvalidated();</div><div class="line">        <span class="keyword">if</span> (mFastScroll != <span class="keyword">null</span>) &#123;</div><div class="line">            mFastScroll.onSectionsChanged();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>而它又继承AdapterView的AdapterDataSetObserver<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">  <span class="class"><span class="keyword">class</span> <span class="title">AdapterDataSetObserver</span> <span class="keyword">extends</span> <span class="title">DataSetObserver</span> </span>&#123;</div><div class="line"></div><div class="line">      <span class="keyword">private</span> Parcelable mInstanceState = <span class="keyword">null</span>;</div><div class="line"></div><div class="line"><span class="comment">//最终调用</span></div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChanged</span><span class="params">()</span> </span>&#123;</div><div class="line">          mDataChanged = <span class="keyword">true</span>;</div><div class="line">          mOldItemCount = mItemCount;</div><div class="line">          mItemCount = getAdapter().getCount();</div><div class="line"></div><div class="line">          <span class="comment">// Detect the case where a cursor that was previously invalidated has</span></div><div class="line">          <span class="comment">// been repopulated with new data.</span></div><div class="line">          <span class="keyword">if</span> (AdapterView.<span class="keyword">this</span>.getAdapter().hasStableIds() &amp;&amp; mInstanceState != <span class="keyword">null</span></div><div class="line">                  &amp;&amp; mOldItemCount == <span class="number">0</span> &amp;&amp; mItemCount &gt; <span class="number">0</span>) &#123;</div><div class="line">              AdapterView.<span class="keyword">this</span>.onRestoreInstanceState(mInstanceState);</div><div class="line">              mInstanceState = <span class="keyword">null</span>;</div><div class="line">          &#125; <span class="keyword">else</span> &#123;</div><div class="line">              rememberSyncState();</div><div class="line">          &#125;</div><div class="line">          checkFocus();</div><div class="line">          requestLayout();</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onInvalidated</span><span class="params">()</span> </span>&#123;</div><div class="line">          mDataChanged = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">          <span class="keyword">if</span> (AdapterView.<span class="keyword">this</span>.getAdapter().hasStableIds()) &#123;</div><div class="line">              <span class="comment">// Remember the current state for the case where our hosting activity is being</span></div><div class="line">              <span class="comment">// stopped and later restarted</span></div><div class="line">              mInstanceState = AdapterView.<span class="keyword">this</span>.onSaveInstanceState();</div><div class="line">          &#125;</div><div class="line"></div><div class="line">          <span class="comment">// Data is invalid so we should reset our state</span></div><div class="line">          mOldItemCount = mItemCount;</div><div class="line">          mItemCount = <span class="number">0</span>;</div><div class="line">          mSelectedPosition = INVALID_POSITION;</div><div class="line">          mSelectedRowId = INVALID_ROW_ID;</div><div class="line">          mNextSelectedPosition = INVALID_POSITION;</div><div class="line">          mNextSelectedRowId = INVALID_ROW_ID;</div><div class="line">          mNeedSync = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">          checkFocus();</div><div class="line">          requestLayout();</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearSavedState</span><span class="params">()</span> </span>&#123;</div><div class="line">          mInstanceState = <span class="keyword">null</span>;</div><div class="line">      &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>我们只关注onChanged()方法<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChanged</span><span class="params">()</span> </span>&#123;</div><div class="line">    mDataChanged = <span class="keyword">true</span>;</div><div class="line">    mOldItemCount = mItemCount;</div><div class="line">    mItemCount = getAdapter().getCount();</div><div class="line"></div><div class="line">    <span class="comment">// Detect the case where a cursor that was previously invalidated has</span></div><div class="line">    <span class="comment">// been repopulated with new data.</span></div><div class="line">    <span class="keyword">if</span> (AdapterView.<span class="keyword">this</span>.getAdapter().hasStableIds() &amp;&amp; mInstanceState != <span class="keyword">null</span></div><div class="line">            &amp;&amp; mOldItemCount == <span class="number">0</span> &amp;&amp; mItemCount &gt; <span class="number">0</span>) &#123;</div><div class="line">        AdapterView.<span class="keyword">this</span>.onRestoreInstanceState(mInstanceState);</div><div class="line">        mInstanceState = <span class="keyword">null</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        rememberSyncState();</div><div class="line">    &#125;</div><div class="line">    checkFocus();</div><div class="line">    requestLayout();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>它会调用requestLayout()方法进行重新布局，从而刷新listvew(GridView ， AdapterView)界面</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;当我们调用Adapter.notifyDataSetChanged()时候, 会调用被观察者的()方法，&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;li
    
    </summary>
    
      <category term="设计模式" scheme="https://devallever.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="Android" scheme="https://devallever.github.io/tags/Android/"/>
    
      <category term="设计模式" scheme="https://devallever.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="观察者模式" scheme="https://devallever.github.io/tags/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>设计模式(四) 抽象工厂模式</title>
    <link href="https://devallever.github.io/2017/05/25/abstract-factory-patterns/"/>
    <id>https://devallever.github.io/2017/05/25/abstract-factory-patterns/</id>
    <published>2017-05-25T01:03:48.000Z</published>
    <updated>2017-05-25T01:55:13.783Z</updated>
    
    <content type="html"><![CDATA[<h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><h1 id="UML类图"><a href="#UML类图" class="headerlink" title="UML类图"></a>UML类图</h1><h1 id="简单实现"><a href="#简单实现" class="headerlink" title="简单实现"></a>简单实现</h1><h2 id="最基本的数据访问程序"><a href="#最基本的数据访问程序" class="headerlink" title="最基本的数据访问程序"></a>最基本的数据访问程序</h2><h3 id="User表"><a href="#User表" class="headerlink" title="User表"></a>User表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">public class User &#123;</div><div class="line">    private int id;</div><div class="line">    private String name;</div><div class="line"></div><div class="line">    public int getId() &#123;</div><div class="line">        return id;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setId(int id) &#123;</div><div class="line">        this.id = id;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public String getName() &#123;</div><div class="line">        return name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setName(String name) &#123;</div><div class="line">        this.name = name;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="SqlServerUser类"><a href="#SqlServerUser类" class="headerlink" title="SqlServerUser类"></a>SqlServerUser类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public class SqlServerUser &#123;</div><div class="line">    private static final String TAG = &quot;SqlServerUser&quot;;</div><div class="line">    public void insertUser(User user)&#123;</div><div class="line">        Log.d(TAG, &quot;insert: 在SQL Server中录入一个用户记录&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public User getUser(int id)&#123;</div><div class="line">        Log.d(TAG, &quot;getUser: 在SQL Server中获取一个用户记录&quot;);</div><div class="line">        return null;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="客户端调用"><a href="#客户端调用" class="headerlink" title="客户端调用"></a>客户端调用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">User user = <span class="keyword">new</span> User();</div><div class="line">user.setId(<span class="number">1</span>);</div><div class="line">user.setName(<span class="string">"Allever"</span>);</div><div class="line">SqlServerUser sqlServerUser = <span class="keyword">new</span> SqlServerUser();</div><div class="line">sqlServerUser.insertUser(user);</div><div class="line">sqlServerUser.getUser(<span class="number">1</span>);</div></pre></td></tr></table></figure>
<p>如果换为MySQL数据库改动就很多</p>
<h2 id="使用工厂方法改进"><a href="#使用工厂方法改进" class="headerlink" title="使用工厂方法改进"></a>使用工厂方法改进</h2><h3 id="IUser接口"><a href="#IUser接口" class="headerlink" title="IUser接口"></a>IUser接口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public interface IUser &#123;</div><div class="line">    void insertUser(User user);</div><div class="line">    User getUser(int id);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="SqlServerUser类-1"><a href="#SqlServerUser类-1" class="headerlink" title="SqlServerUser类"></a>SqlServerUser类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">public class SqlServerUser implements IUser &#123;</div><div class="line"></div><div class="line">    private static final String TAG = &quot;SqlServerUser&quot;;</div><div class="line">    @Override</div><div class="line">    public void insertUser(User user)&#123;</div><div class="line">        Log.d(TAG, &quot;insert: 在SQL Server中录入一个用户记录&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public User getUser(int id)&#123;</div><div class="line">        Log.d(TAG, &quot;getUser: 在SQL Server中获取一个用户记录&quot;);</div><div class="line">        return null;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="MySQLUser类"><a href="#MySQLUser类" class="headerlink" title="MySQLUser类"></a>MySQLUser类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public class MySQLUser implements IUser &#123;</div><div class="line">    private static final String TAG = &quot;MySQLUser&quot;;</div><div class="line">    @Override</div><div class="line">    public void insertUser(User user)&#123;</div><div class="line">        Log.d(TAG, &quot;insert: 在MySQL Server中录入一个用户记录&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public User getUser(int id)&#123;</div><div class="line">        Log.d(TAG, &quot;getUser: 在MySQL Server中获取一个用户记录&quot;);</div><div class="line">        return null;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="IFactory抽象工厂接口"><a href="#IFactory抽象工厂接口" class="headerlink" title="IFactory抽象工厂接口"></a>IFactory抽象工厂接口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public interface IFactory &#123;</div><div class="line">    IUser createUser();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="SqlServerFactory具体工厂类"><a href="#SqlServerFactory具体工厂类" class="headerlink" title="SqlServerFactory具体工厂类"></a>SqlServerFactory具体工厂类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public class SqlServerFactory implements IFactory &#123;</div><div class="line">    @Override</div><div class="line">    public IUser createUser() &#123;</div><div class="line">        return new SqlServerUser();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="MySQLServerFactory具体工厂"><a href="#MySQLServerFactory具体工厂" class="headerlink" title="MySQLServerFactory具体工厂"></a>MySQLServerFactory具体工厂</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public class MySQLServerFactory implements IFactory &#123;</div><div class="line">    @Override</div><div class="line">    public IUser createUser() &#123;</div><div class="line">        return new MySQLUser();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="客户端调用-1"><a href="#客户端调用-1" class="headerlink" title="客户端调用"></a>客户端调用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">User user = new User();</div><div class="line">user.setId(1);</div><div class="line">user.setName(&quot;Allever&quot;);</div><div class="line"></div><div class="line">IFactory factory = new SqlServerFactory();</div><div class="line">IUser iUser = factory.createUser();</div><div class="line">iUser.insertUser(user);</div><div class="line">iUser.getUser(1);</div></pre></td></tr></table></figure>
<p>如果改为MySQL数据库，这改动这里<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">IFactory factory = new MySQLServerFactory();</div></pre></td></tr></table></figure></p>
<h2 id="使用抽象工厂"><a href="#使用抽象工厂" class="headerlink" title="使用抽象工厂"></a>使用抽象工厂</h2><h3 id="新增Department表"><a href="#新增Department表" class="headerlink" title="新增Department表"></a>新增Department表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">public class Department &#123;</div><div class="line">    private int id;</div><div class="line">    private String deptName;</div><div class="line"></div><div class="line">    public int getId() &#123;</div><div class="line">        return id;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setId(int id) &#123;</div><div class="line">        this.id = id;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public String getDeptName() &#123;</div><div class="line">        return deptName;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setDeptName(String deptName) &#123;</div><div class="line">        this.deptName = deptName;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="新增IDepartment接口"><a href="#新增IDepartment接口" class="headerlink" title="新增IDepartment接口"></a>新增IDepartment接口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public interface IDepartment &#123;</div><div class="line">    void insertDepartment(Department department);</div><div class="line">    Department getDepartment(int id);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="新增SqlServerDepartment类"><a href="#新增SqlServerDepartment类" class="headerlink" title="新增SqlServerDepartment类"></a>新增SqlServerDepartment类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public class SqlServerDepartment implements IDepartment &#123;</div><div class="line">    private static final String TAG = &quot;SqlServerDepartment&quot;;</div><div class="line">    @Override</div><div class="line">    public void insertDepartment(Department department) &#123;</div><div class="line">        Log.d(TAG, &quot;insertDepartment: 在Sql Server 中插入Department&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public Department getDepartment(int id) &#123;</div><div class="line">        Log.d(TAG, &quot;insertDepartment: 在Sql Server 中获取Department&quot;);</div><div class="line">        return null;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="新增MySQLDepartment类"><a href="#新增MySQLDepartment类" class="headerlink" title="新增MySQLDepartment类"></a>新增MySQLDepartment类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public class MySQLDepartment implements IDepartment &#123;</div><div class="line">    private static final String TAG = &quot;MySQLDepartment&quot;;</div><div class="line">    @Override</div><div class="line">    public void insertDepartment(Department department) &#123;</div><div class="line">        Log.d(TAG, &quot;insertDepartment: 在MySQL 中插入Department&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public Department getDepartment(int id) &#123;</div><div class="line">        Log.d(TAG, &quot;insertDepartment: 在MySQL 中获取Department&quot;);</div><div class="line">        return null;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="修改IFactory接口"><a href="#修改IFactory接口" class="headerlink" title="修改IFactory接口"></a>修改IFactory接口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public interface IFactory &#123;</div><div class="line">    IUser createUser();</div><div class="line">    IDepartment createDepartment();	//新增</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="修改SqlServerFactory类"><a href="#修改SqlServerFactory类" class="headerlink" title="修改SqlServerFactory类"></a>修改SqlServerFactory类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public class SqlServerFactory implements IFactory &#123;</div><div class="line">    @Override</div><div class="line">    public IUser createUser() &#123;</div><div class="line">        return new SqlServerUser();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public IDepartment createDepartment() &#123;</div><div class="line">        return new SqlServerDepartment();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="修改MySQLServerFactory类"><a href="#修改MySQLServerFactory类" class="headerlink" title="修改MySQLServerFactory类"></a>修改MySQLServerFactory类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public class MySQLServerFactory implements IFactory &#123;</div><div class="line">    @Override</div><div class="line">    public IUser createUser() &#123;</div><div class="line">        return new MySQLUser();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public IDepartment createDepartment() &#123;</div><div class="line">        return new MySQLDepartment();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="客户端调用-2"><a href="#客户端调用-2" class="headerlink" title="客户端调用"></a>客户端调用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">User user = new User();</div><div class="line">user.setId(1);</div><div class="line">user.setName(&quot;Allever&quot;);</div><div class="line">Department department = new Department();</div><div class="line">department.setId(1);</div><div class="line">department.setDeptName(&quot;Computer&quot;);</div><div class="line"></div><div class="line">IFactory factory = new MySQLServerFactory();</div><div class="line">IUser iUser = factory.createUser();</div><div class="line">iUser.insertUser(user);</div><div class="line">iUser.getUser(1);</div><div class="line"></div><div class="line">IDepartment iDepartment = factory.createDepartment();</div><div class="line">iDepartment.insertDepartment(department);</div><div class="line">iDepartment.getDepartment(1);</div></pre></td></tr></table></figure>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>只有一个User类和User操作类的时候，只需要工厂方法模式， 但现在数据库中有很多表， 而SQL Server 和 MySQL 又是两大不同的分类， 所以解决这种涉及到多个产品系列的时候，就要用到抽象工厂模式。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;定义&quot;&gt;&lt;a href=&quot;#定义&quot; class=&quot;headerlink&quot; title=&quot;定义&quot;&gt;&lt;/a&gt;定义&lt;/h1&gt;&lt;h1 id=&quot;UML类图&quot;&gt;&lt;a href=&quot;#UML类图&quot; class=&quot;headerlink&quot; title=&quot;UML类图&quot;&gt;&lt;/a&gt;UML类
    
    </summary>
    
      <category term="设计模式" scheme="https://devallever.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="设计模式" scheme="https://devallever.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="抽象工厂" scheme="https://devallever.github.io/tags/%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82/"/>
    
  </entry>
  
  <entry>
    <title>Android动画实例</title>
    <link href="https://devallever.github.io/2017/05/24/animation-demo-1/"/>
    <id>https://devallever.github.io/2017/05/24/animation-demo-1/</id>
    <published>2017-05-24T06:54:12.000Z</published>
    <updated>2017-05-24T07:13:15.040Z</updated>
    
    <content type="html"><![CDATA[<h1 id="灵动菜单"><a href="#灵动菜单" class="headerlink" title="灵动菜单"></a>灵动菜单</h1><h2 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h2><p>把菜单项目放在菜单按钮同一位置, 当点击带单按钮时候, 每个菜单项开始动画, 从原来位置,移动到指定位置  </p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>布局文件:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;&gt;</div><div class="line">    &lt;ImageView</div><div class="line">        android:id=&quot;@+id/id_dynamic_activity_fab_left&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:src=&quot;@mipmap/ic_launcher&quot;</div><div class="line">        android:layout_centerInParent=&quot;true&quot;</div><div class="line">        android:visibility=&quot;visible&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;ImageView</div><div class="line">        android:id=&quot;@+id/id_dynamic_activity_fab_top&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:src=&quot;@mipmap/ic_launcher&quot;</div><div class="line">        android:layout_centerInParent=&quot;true&quot;</div><div class="line">        android:visibility=&quot;visible&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;ImageView</div><div class="line">        android:id=&quot;@+id/id_dynamic_activity_fab_right&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:src=&quot;@mipmap/ic_launcher&quot;</div><div class="line">        android:layout_centerInParent=&quot;true&quot;</div><div class="line">        android:visibility=&quot;visible&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;ImageView</div><div class="line">        android:id=&quot;@+id/id_dynamic_activity_fab_bottom&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:src=&quot;@mipmap/ic_launcher&quot;</div><div class="line">        android:layout_centerInParent=&quot;true&quot;</div><div class="line">        android:visibility=&quot;visible&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;ImageView</div><div class="line">        android:id=&quot;@+id/id_dynamic_activity_fab_main&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:background=&quot;@mipmap/ic_launcher&quot;</div><div class="line">        android:layout_centerInParent=&quot;true&quot;/&gt;</div><div class="line"></div><div class="line">&lt;/RelativeLayout&gt;</div></pre></td></tr></table></figure></p>
<p>展开菜单:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startMenu</span><span class="params">()</span></span>&#123;</div><div class="line">        ObjectAnimator mainAnimator = ObjectAnimator.ofFloat(ivMain,<span class="string">"alpha"</span>,<span class="number">1f</span>,<span class="number">0.5f</span>);</div><div class="line"></div><div class="line">        <span class="keyword">float</span> leftCurrentX = ivLeft.getTranslationX();</div><div class="line">        ObjectAnimator leftAnimator = ObjectAnimator.ofFloat(ivLeft,<span class="string">"translationX"</span>,leftCurrentX,-<span class="number">200f</span>);</div><div class="line"></div><div class="line">        <span class="keyword">float</span> rightCurrentX = ivRight.getTranslationX();</div><div class="line">        ObjectAnimator rightAnimator = ObjectAnimator.ofFloat(ivRight,<span class="string">"translationX"</span>,rightCurrentX,<span class="number">200f</span>);</div><div class="line"></div><div class="line">        <span class="keyword">float</span> topCurrentY = ivTop.getTranslationY();</div><div class="line">        ObjectAnimator topAnimator = ObjectAnimator.ofFloat(ivTop,<span class="string">"translationY"</span>,topCurrentY,-<span class="number">200f</span>);</div><div class="line"></div><div class="line">        <span class="keyword">float</span> bottomCurrentY = ivBottom.getTranslationY();</div><div class="line">        ObjectAnimator bottomAnimator = ObjectAnimator.ofFloat(ivBottom,<span class="string">"translationY"</span>,bottomCurrentY,<span class="number">200f</span>);</div><div class="line"></div><div class="line"></div><div class="line">        AnimatorSet animatorSet = <span class="keyword">new</span> AnimatorSet();</div><div class="line">        animatorSet.playTogether(mainAnimator,leftAnimator,rightAnimator,topAnimator,bottomAnimator);</div><div class="line">        animatorSet.setDuration(<span class="number">500</span>);</div><div class="line">        animatorSet.setInterpolator(<span class="keyword">new</span> BounceInterpolator());</div><div class="line">        animatorSet.start();</div><div class="line"></div><div class="line">        flag = <span class="keyword">false</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>关闭菜单:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">closeMenu</span><span class="params">()</span></span>&#123;</div><div class="line">        ObjectAnimator mainAnimator = ObjectAnimator.ofFloat(ivMain,<span class="string">"alpha"</span>,<span class="number">0.5f</span>,<span class="number">1f</span>);</div><div class="line"></div><div class="line">        <span class="keyword">float</span> leftCurrentX = ivLeft.getTranslationX();</div><div class="line">        ObjectAnimator leftAnimator = ObjectAnimator.ofFloat(ivLeft,<span class="string">"translationX"</span>,leftCurrentX, <span class="number">0f</span>);</div><div class="line"></div><div class="line">        <span class="keyword">float</span> rightCurrentX = ivRight.getTranslationX();</div><div class="line">        ObjectAnimator rightAnimator = ObjectAnimator.ofFloat(ivRight,<span class="string">"translationX"</span>,rightCurrentX,<span class="number">0f</span>);</div><div class="line"></div><div class="line">        <span class="keyword">float</span> topCurrentY = ivTop.getTranslationY();</div><div class="line">        ObjectAnimator topAnimator = ObjectAnimator.ofFloat(ivTop,<span class="string">"translationY"</span>,topCurrentY,<span class="number">0f</span>);</div><div class="line"></div><div class="line">        <span class="keyword">float</span> bottomCurrentY = ivBottom.getTranslationY();</div><div class="line">        ObjectAnimator bottomAnimator = ObjectAnimator.ofFloat(ivBottom,<span class="string">"translationY"</span>,bottomCurrentY,<span class="number">0f</span>);</div><div class="line"></div><div class="line"></div><div class="line">        AnimatorSet animatorSet = <span class="keyword">new</span> AnimatorSet();</div><div class="line">        animatorSet.playTogether(mainAnimator,leftAnimator,rightAnimator,topAnimator,bottomAnimator);</div><div class="line">        animatorSet.setDuration(<span class="number">500</span>);</div><div class="line">        animatorSet.setInterpolator(<span class="keyword">new</span> BounceInterpolator());</div><div class="line">        animatorSet.start();</div><div class="line"></div><div class="line">        flag = <span class="keyword">true</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>对主菜单按钮监听<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ivMain.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (flag) startMenu();</div><div class="line">		<span class="keyword">else</span> closeMenu();</div><div class="line">	&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h1 id="下拉展开动画"><a href="#下拉展开动画" class="headerlink" title="下拉展开动画"></a>下拉展开动画</h1><h2 id="实现思路-1"><a href="#实现思路-1" class="headerlink" title="实现思路"></a>实现思路</h2><p>两个LinearLayout, 一个visibility为显示,另一个为gone. 当点击showVIew时,把隐藏的LinearLayout设置为visibility,对这个过程使用动画.</p>
<h2 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h2><p>布局文件:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:orientation=&quot;vertical&quot; android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;&gt;</div><div class="line"></div><div class="line">    &lt;LinearLayout</div><div class="line">        android:id=&quot;@+id/id_show_hide_ll_show_view&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:gravity=&quot;center_vertical&quot;</div><div class="line">        android:orientation=&quot;horizontal&quot;&gt;</div><div class="line">        &lt;ImageView</div><div class="line">            android:layout_width=&quot;wrap_content&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:src=&quot;@mipmap/ic_launcher&quot;/&gt;</div><div class="line"></div><div class="line">        &lt;TextView</div><div class="line">            android:layout_width=&quot;wrap_content&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:text=&quot;click me&quot;/&gt;</div><div class="line"></div><div class="line"></div><div class="line">    &lt;/LinearLayout&gt;</div><div class="line"></div><div class="line">    &lt;LinearLayout</div><div class="line">        android:id=&quot;@+id/id_show_hide_ll_hide_view&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;40dp&quot;</div><div class="line">        android:gravity=&quot;center_vertical&quot;</div><div class="line">        android:visibility=&quot;gone&quot;</div><div class="line">        android:background=&quot;@color/colorPrimary&quot;&gt;</div><div class="line"></div><div class="line">        &lt;ImageView</div><div class="line">            android:layout_width=&quot;wrap_content&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:src=&quot;@mipmap/ic_launcher&quot;/&gt;</div><div class="line"></div><div class="line">        &lt;TextView</div><div class="line">            android:layout_width=&quot;wrap_content&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:text=&quot;I am hide&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;/LinearLayout&gt;</div><div class="line"></div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure></p>
<p>获取ValueAnimator:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">private ValueAnimator createValueAnimator(final View view, int start, int end)&#123;</div><div class="line">        final ValueAnimator animator = ValueAnimator.ofInt(start,end);</div><div class="line">        animator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onAnimationUpdate(ValueAnimator valueAnimator) &#123;</div><div class="line">                int value = (int)valueAnimator.getAnimatedValue();</div><div class="line">                ViewGroup.LayoutParams params = view.getLayoutParams();</div><div class="line">                params.height = value;</div><div class="line">                view.setLayoutParams(params);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        return animator;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>展开动画:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">private void openAnimation(View view)&#123;</div><div class="line">        view.setVisibility(View.VISIBLE);</div><div class="line">        ValueAnimator valueAnimator = createValueAnimator(view,0,measureHiddenViewHeight);</div><div class="line">        valueAnimator.start();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>关闭动画:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">private void closeAnimation(final View view) &#123;</div><div class="line">	int origHeight = view.getHeight();</div><div class="line">	ValueAnimator valueAnimator = createValueAnimator(view,origHeight,0);</div><div class="line">	valueAnimator.addListener(new AnimatorListenerAdapter() &#123;</div><div class="line">		@Override</div><div class="line">		public void onAnimationEnd(Animator animation) &#123;</div><div class="line">			view.setVisibility(View.GONE);</div><div class="line">		&#125;</div><div class="line">	&#125;);</div><div class="line">	valueAnimator.start();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;灵动菜单&quot;&gt;&lt;a href=&quot;#灵动菜单&quot; class=&quot;headerlink&quot; title=&quot;灵动菜单&quot;&gt;&lt;/a&gt;灵动菜单&lt;/h1&gt;&lt;h2 id=&quot;实现思路&quot;&gt;&lt;a href=&quot;#实现思路&quot; class=&quot;headerlink&quot; title=&quot;实现思路&quot;&gt;&lt;/a
    
    </summary>
    
      <category term="Android" scheme="https://devallever.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://devallever.github.io/tags/Android/"/>
    
      <category term="动画" scheme="https://devallever.github.io/tags/%E5%8A%A8%E7%94%BB/"/>
    
  </entry>
  
  <entry>
    <title>设计模式(三) 工厂方法模式</title>
    <link href="https://devallever.github.io/2017/05/24/factory-method-patterns/"/>
    <id>https://devallever.github.io/2017/05/24/factory-method-patterns/</id>
    <published>2017-05-24T03:51:32.000Z</published>
    <updated>2017-05-24T04:20:19.029Z</updated>
    
    <content type="html"><![CDATA[<h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><p>定义一个用于创建对象的接口,让子类决定实例化那个类</p>
<h1 id="UML类图"><a href="#UML类图" class="headerlink" title="UML类图"></a>UML类图</h1><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://timgsa.baidu.com/timg?image&quality=80&size=b10000_10000&sec=1495597696&di=b6e459e489113ecdbc79ac8f57f17f19&src=http://pic002.cnblogs.com/images/2012/448009/2012102412230955.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>解读: </p>
<ul>
<li>Product: 产品抽象类, </li>
<li>ConcreteProduct: 产品实现类</li>
<li>Creator: 工厂抽象类, 返回一个Product实例</li>
<li>ConcreteCreator: 工厂实现类, 返回一个ConcreteProduct实例</li>
</ul>
<h1 id="简单实现"><a href="#简单实现" class="headerlink" title="简单实现"></a>简单实现</h1><p>##　Fruit: 作为产品抽象类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Fruit</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">getName</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>##　Banana: 作为产品实现类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Banana</span> <span class="keyword">extends</span> <span class="title">Fruit</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"I am banana"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Apple-作为产品实现类"><a href="#Apple-作为产品实现类" class="headerlink" title="Apple: 作为产品实现类"></a>Apple: 作为产品实现类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Apple</span> <span class="keyword">extends</span> <span class="title">Fruit</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"I am apple"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="FruitFactory-作为抽象工厂类"><a href="#FruitFactory-作为抽象工厂类" class="headerlink" title="FruitFactory: 作为抽象工厂类"></a>FruitFactory: 作为抽象工厂类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">FruitFactory</span>  </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">abstract</span> Fruit <span class="title">createFruit</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="AppleFactory-作为工厂实现类"><a href="#AppleFactory-作为工厂实现类" class="headerlink" title="AppleFactory: 作为工厂实现类"></a>AppleFactory: 作为工厂实现类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppleFactory</span> <span class="keyword">extends</span> <span class="title">FruitFactory</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function">Fruit <span class="title">createFruit</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Apple();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="BananaFactory-作为工厂实现类"><a href="#BananaFactory-作为工厂实现类" class="headerlink" title="BananaFactory: 作为工厂实现类"></a>BananaFactory: 作为工厂实现类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BananaFactory</span> <span class="keyword">extends</span> <span class="title">FruitFactory</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function">Fruit <span class="title">createFruit</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Banana();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>在需要哪一个产品时就生产哪个<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">FruitFactory fruitFactory = new AppleFactory();</div><div class="line">Fruit apple = fruitFactory.createFruit();</div><div class="line">apple.getName();</div></pre></td></tr></table></figure></p>
<h2 id="使用反射"><a href="#使用反射" class="headerlink" title="使用反射"></a>使用反射</h2><h3 id="FruitFactory"><a href="#FruitFactory" class="headerlink" title="FruitFactory"></a>FruitFactory</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">FruitFactory</span>  </span>&#123;</div><div class="line">    <span class="keyword">abstract</span> &lt;T extends Fruit&gt; <span class="function">T <span class="title">createFruit</span><span class="params">(Class&lt;T&gt; className)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>###　ConcreteFruitFactory: 具体工厂类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteFruitFactory</span> <span class="keyword">extends</span> <span class="title">FruitFactory</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    &lt;T extends Fruit&gt; <span class="function">T <span class="title">createFruit</span><span class="params">(Class&lt;T&gt; className)</span> </span>&#123;</div><div class="line">        Fruit fruit = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            fruit = (Fruit)Class.forName(className.getName()).newInstance();</div><div class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> (T)fruit;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h3><p>需要哪个类对象就传入那个类的类型<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">FruitFactory fruitFactory = <span class="keyword">new</span> ConcreteFruitFactory();</div><div class="line">Fruit apple = fruitFactory.createFruit(Apple.class);</div><div class="line">apple.getName();</div></pre></td></tr></table></figure></p>
<h1 id="简单工厂方法模式"><a href="#简单工厂方法模式" class="headerlink" title="简单工厂方法模式"></a>简单工厂方法模式</h1><p>当工厂只有一个的时候, 只需将对应的工厂方法改为静态方法, 并去掉abstract关键字, 此时就变成了简单工厂模式或者静态工厂模式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">public class FruitFactory  &#123;</div><div class="line">    static Fruit createFruit()&#123;</div><div class="line">        return new Apple();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;定义&quot;&gt;&lt;a href=&quot;#定义&quot; class=&quot;headerlink&quot; title=&quot;定义&quot;&gt;&lt;/a&gt;定义&lt;/h1&gt;&lt;p&gt;定义一个用于创建对象的接口,让子类决定实例化那个类&lt;/p&gt;
&lt;h1 id=&quot;UML类图&quot;&gt;&lt;a href=&quot;#UML类图&quot; class=&quot;h
    
    </summary>
    
      <category term="设计模式" scheme="https://devallever.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="设计模式" scheme="https://devallever.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="工厂方法模式" scheme="https://devallever.github.io/tags/%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Android练手项目 极简天气</title>
    <link href="https://devallever.github.io/2017/05/23/myCoolWeather/"/>
    <id>https://devallever.github.io/2017/05/23/myCoolWeather/</id>
    <published>2017-05-23T12:55:18.000Z</published>
    <updated>2017-05-23T13:41:25.138Z</updated>
    
    <content type="html"><![CDATA[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.bing.com/az/hprichbg/rb/CivitadiBagnoregio_ZH-CN12942138675_1366x768.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<blockquote>
<p>项目地址:  <a href="https://github.com/devallever/MyCoolWeather" target="_blank" rel="external">https://github.com/devallever/MyCoolWeather</a></p>
<p><a href="https://raw.githubusercontent.com/devallever/MyCoolWeather/master/app/simpleWeather.apk" target="_blank" rel="external">下载apk</a></p>
<p>我的博客: <a href="https://devallever.github.io/">https://devallever.github.io/</a></p>
</blockquote>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>极简天气, 天气应用,是我看完Android第一行代码后, 参考并修改的练习项目, 以巩固所学知识</p>
<p>感谢开源</p>
<ul>
<li>OkHttp</li>
<li>Retrofit</li>
<li>Glide</li>
<li>RxJava/RxAndroid</li>
<li>LitePal</li>
<li><p>EventBus</p>
<p>感谢郭神提供天气数据接口</p>
</li>
</ul>
<h1 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h1><h2 id="第一版"><a href="#第一版" class="headerlink" title="第一版"></a>第一版</h2><ul>
<li>显示实时天气, 三天预报, 空气质量, 温馨提示</li>
<li>获取Bing每日图片</li>
<li>滑动切换城市</li>
<li>城市管理: 增加,删除</li>
<li>下拉刷新</li>
<li>缓存省市县, 天气信息</li>
</ul>
<p><img src="https://github.com/devallever/MyCoolWeather/blob/master/pic_01.png?raw=true" alt=""><br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/MyCoolWeather/blob/master/pic_02.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/MyCoolWeather/blob/master/pic_03.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/MyCoolWeather/blob/master/pic_04.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/MyCoolWeather/blob/master/pic_05.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/MyCoolWeather/blob/master/pic_06.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/MyCoolWeather/blob/master/pic_07.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure><br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/devallever/MyCoolWeather/blob/master/pic_08.png?raw=true" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>  </p>
<h2 id="第二版"><a href="#第二版" class="headerlink" title="第二版"></a>第二版</h2><ul>
<li>后台自动刷新</li>
<li>自动下载壁纸</li>
<li>天气提醒</li>
<li>查看历史天气</li>
<li>关于</li>
<li>设置刷新频，全局提醒，背景图片</li>
<li>检查更新</li>
</ul>
<h1 id="功能实现细节"><a href="#功能实现细节" class="headerlink" title="功能实现细节"></a>功能实现细节</h1><h2 id="第二版功能细节"><a href="#第二版功能细节" class="headerlink" title="第二版功能细节"></a>第二版功能细节</h2><h3 id="后台自动更新天气信息"><a href="#后台自动更新天气信息" class="headerlink" title="后台自动更新天气信息"></a>后台自动更新天气信息</h3><p>使用服务, 启动服务后通过AlarmManager设置一个定时任务,每隔一小时更新天气信息, 在退出程序时候启动该服务,在服务中主要执行了两个方法分别更新天气信息和壁纸, 请求网络后把数据保存到Weather表中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public int onStartCommand(Intent intent,  int flags, int startId) &#123;</div><div class="line">    Log.d(TAG, &quot;onStartCommand: ()&quot;);</div><div class="line">    updateWeather();</div><div class="line">    updateImage();</div><div class="line">    int anHour = 1 * 60 * 60 * 1000;   //１小时</div><div class="line">    //int anHour = 10* 1000;   //10秒</div><div class="line">    long triggerAtTime = SystemClock.elapsedRealtime() + anHour;</div><div class="line">    AlarmManager alarmManager = (AlarmManager) getSystemService(ALARM_SERVICE);</div><div class="line">    Intent serviceIntent = new Intent(this, AutoUpdateService.class);</div><div class="line">    //Intent receiverIntent = new Intent(this, AutoUpdateReceiver.class);</div><div class="line">    PendingIntent pendingIntent = PendingIntent.getService(this,0,serviceIntent,0);</div><div class="line">    alarmManager.cancel(pendingIntent);</div><div class="line">    alarmManager.set(AlarmManager.ELAPSED_REALTIME_WAKEUP, triggerAtTime,pendingIntent);</div><div class="line">    return super.onStartCommand(intent, flags, startId);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>启动服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">protected void onDestroy() &#123;</div><div class="line">    //启动后台更新服务</div><div class="line">    Intent serviceIntent = new Intent(this, AutoUpdateService.class);</div><div class="line">    startService(serviceIntent);</div><div class="line">    super.onDestroy();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="天气提醒功能"><a href="#天气提醒功能" class="headerlink" title="天气提醒功能"></a>天气提醒功能</h3><p>每次后台获取更新后,判断该城市是否显示通知, 是的话就对天气信息进一步分析:  </p>
<p>昼夜温度大于10度时提醒,<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">int max = Integer.valueOf(newWeather.getDaily_forecast().get(0).getTmp().getMax());</div><div class="line">int min = Integer.valueOf(newWeather.getDaily_forecast().get(0).getTmp().getMin());</div><div class="line">if ((max-min) &gt;=10 )&#123;</div><div class="line">//显示通知</div><div class="line">builder.setContentText( county + &quot;: 昼夜温差较大,请预防感冒!&quot;);</div><div class="line">notificationManager.notify(id,builder.build());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>今明天气相差5度时提醒<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">//2.比较今天明天气温相差5度提示</div><div class="line">Daily_forecast today = newWeather.getDaily_forecast().get(0);</div><div class="line">Daily_forecast tomorrow = newWeather.getDaily_forecast().get(1);</div><div class="line">int todayTmp = Integer.valueOf(today.getTmp().getMin());</div><div class="line">int tomorrowTmp = Integer.valueOf(tomorrow.getTmp().getMin());</div><div class="line">if ( Math.abs(todayTmp-tomorrowTmp) &gt;= 5)&#123;</div><div class="line">	if (tomorrowTmp &gt; todayTmp)&#123;</div><div class="line">		builder.setContentText( county + &quot;: 明天将大幅度升温!&quot;);</div><div class="line">	&#125;else &#123;</div><div class="line">		builder.setContentText( county + &quot;: 明天将大幅度降温温!&quot;);</div><div class="line">	&#125;</div><div class="line">notificationManager.notify(id+1000,builder.build());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>有降水提示带伞<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//3. 有雨的要带伞</div><div class="line">if (tomorrow.getCond().getTxt_d().contains(&quot;雨&quot;))&#123;</div><div class="line">	builder.setContentText( county + &quot;: 明天将有&quot; + tomorrow.getCond().getTxt_d() + &quot;, 出门记得带伞.&quot;);</div><div class="line">	notificationManager.notify(id+1001,builder.build());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当实时天气与上一次的天气有不同时候,提醒<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//4. 比较实时天气</div><div class="line">String old = oldWeather.getNow().getCond().getTxt();</div><div class="line">String newInfo = newWeather.getNow().getCond().getTxt();</div><div class="line">if (!old.equals(newInfo))&#123;</div><div class="line">	builder.setContentText( county + &quot;: &quot; + newWeather.getNow().getCond().getTxt());</div><div class="line">	notificationManager.notify(id+1002,builder.build());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="查看历史天气"><a href="#查看历史天气" class="headerlink" title="查看历史天气"></a>查看历史天气</h3><p>创建一个数据库表HistoryWeather用来保存历史天气信息<br>id, weatherId, countyName, date,  weatehr, min, max<br>每次后台自动更新天气数据时候，解析json数据，获取所需数据封装成HIstoryWeather，然后保存，根据date和weatherId字段获取要保存的记录，如果存在的就更新，不存在的就天机记录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">private void saveHistoryWeather(String result)&#123;</div><div class="line">    Gson gson = new Gson();</div><div class="line">    HeWeather5 heWeather5 = gson.fromJson(result,Root.class).getHeWeather5().get(0);</div><div class="line"></div><div class="line">    List&lt;Daily_forecast&gt; daily_forecastList = heWeather5.getDaily_forecast();</div><div class="line">    //for (Daily_forecast daily_forecast :daily_forecastList)&#123;</div><div class="line">    Daily_forecast today = daily_forecastList.get(0);</div><div class="line">        String date = today.getDate();</div><div class="line">        String weather = today.getCond().getTxt_d();</div><div class="line">        String weatherId = heWeather5.getBasic().getId();</div><div class="line">        String countyName = heWeather5.getBasic().getCity();</div><div class="line">        String min = today.getTmp().getMin();</div><div class="line">        String max = today.getTmp().getMax();</div><div class="line">        HistoryWeather historyWeather = new HistoryWeather();</div><div class="line">        historyWeather.setDate(date);</div><div class="line">        historyWeather.setWeatherId(weatherId);</div><div class="line">        historyWeather.setCountyName(countyName);</div><div class="line">        historyWeather.setWeather(weather);</div><div class="line">        historyWeather.setMin(min);</div><div class="line">        historyWeather.setMax(max);</div><div class="line">        historyWeather.saveOrUpdate(&quot;weatherId=? and date=?&quot;, weatherId, date);</div><div class="line">    //&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>查找历史天气信息时候，默认是查找前30条记录，并且按date降序排列<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">List&lt;HistoryWeather&gt; historyWeatherList;</div><div class="line">historyWeatherList = DataSupport.where(&quot;weatherId=? order by date desc&quot;, weatherId).find(HistoryWeather.class);</div><div class="line">for (HistoryWeather historyWeather: historyWeatherList)&#123;</div><div class="line">    HistoryWeatherItem historyWeatherItem = new HistoryWeatherItem();</div><div class="line">    historyWeatherItem.setWeather(historyWeather.getWeather());</div><div class="line">    historyWeatherItem.setDate(historyWeather.getDate());</div><div class="line">    historyWeatherItem.setMax(historyWeather.getMax());</div><div class="line">    historyWeatherItem.setMin(historyWeather.getMin());</div><div class="line">    historyWeatherItemList.add(historyWeatherItem);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="第一版功能细节"><a href="#第一版功能细节" class="headerlink" title="第一版功能细节"></a>第一版功能细节</h2><h3 id="选择城市-ChooseCItyActivity"><a href="#选择城市-ChooseCItyActivity" class="headerlink" title="选择城市 ChooseCItyActivity"></a>选择城市 ChooseCItyActivity</h3><p>首先访问数据库中是否有所有省份数据,有则获取,没有则请求服务器,然后得到全国省份的json数据,保存到数据库中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">private void queryProvince()&#123;</div><div class="line">    toolbar.setTitle(&quot;中国&quot;);</div><div class="line">    provinceList = DataSupport.findAll(Province.class);</div><div class="line">    if (provinceList.size() &gt; 0)&#123;</div><div class="line">        dataList.clear();</div><div class="line">        for (Province province:provinceList)&#123;</div><div class="line">            dataList.add(province.getProvinceName());</div><div class="line">        &#125;</div><div class="line">        adapter.notifyDataSetChanged();</div><div class="line">        listView.setSelection(0);</div><div class="line">        currentLevel = LEVEL_PROVINCE;</div><div class="line">    &#125;else &#123;</div><div class="line">        String address = &quot;http://guolin.tech/api/china/&quot;;</div><div class="line">        queryFromServer(address, &quot;province&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">public static boolean handleProvinceResponse(String response)&#123;</div><div class="line">    if (!TextUtils.isEmpty(response))&#123;</div><div class="line">        try &#123;</div><div class="line">            JSONArray allProvince = new JSONArray(response);</div><div class="line">            for (int i = 0; i&lt;allProvince.length(); i++)&#123;</div><div class="line">                JSONObject provinceObject = allProvince.getJSONObject(i);</div><div class="line">                Province province = new Province();</div><div class="line">                province.setProvinceCode(provinceObject.getInt(&quot;id&quot;));</div><div class="line">                province.setProvinceName(provinceObject.getString(&quot;name&quot;));</div><div class="line">                province.save();</div><div class="line">            &#125;</div><div class="line">            return  true;</div><div class="line">        &#125;catch (JSONException je)&#123;</div><div class="line">            je.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return false;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后解析json数据,设置到Listview中,点击时记录省份id, 然后根据这个id访问数据库中是否有该省份的城市信息,有则获取,没有则请求服务器,然后得到该省份所有城市的json数据,保存到数据库中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">private void queryCity()&#123;</div><div class="line">    toolbar.setTitle(selectedProvince.getProvinceName());</div><div class="line">    cityList = DataSupport.where(&quot;provinceCode = ? &quot;, String.valueOf(selectedProvince.getProvinceCode())).find(City.class);</div><div class="line">    if (cityList.size() &gt; 0)&#123;</div><div class="line">        dataList.clear();</div><div class="line">        for (City city: cityList)&#123;</div><div class="line">            dataList.add(city.getCityName());</div><div class="line">        &#125;</div><div class="line">        adapter.notifyDataSetChanged();</div><div class="line">        listView.setSelection(0);</div><div class="line">        currentLevel = LEVEL_CITY;</div><div class="line">    &#125;else &#123;</div><div class="line">        int provinceCode = selectedProvince.getProvinceCode();</div><div class="line">        String address = &quot;http://guolin.tech/api/china/&quot; + provinceCode;</div><div class="line">        queryFromServer(address,&quot;city&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">public static boolean handleCityResponse(String response, int provinceCode)&#123;</div><div class="line">    if (!TextUtils.isEmpty(response))&#123;</div><div class="line">        try &#123;</div><div class="line">            Log.d(TAG, &quot;handleCityResponse: \n response = &quot; + response);</div><div class="line">            JSONArray allCity = new JSONArray(response);</div><div class="line">            for (int i = 0; i&lt; allCity.length(); i++)&#123;</div><div class="line">                JSONObject cityObject = allCity.getJSONObject(i);</div><div class="line">                City city = new City();</div><div class="line">                city.setCityCode(cityObject.getInt(&quot;id&quot;));</div><div class="line">                city.setCityName(cityObject.getString(&quot;name&quot;));</div><div class="line">                city.setProvinceCode(provinceCode);</div><div class="line">                city.save();</div><div class="line">            &#125;</div><div class="line">            return true;</div><div class="line">        &#125;catch (JSONException je)&#123;</div><div class="line">            je.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return false;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后解析json数据,清空listview数据源, 然后加载该省的所有城市数据,设置到ListView中,点击时记录该市的id, 然后根据这个id访问数据库中是否存在该市的所有县数据,有则获取, 没有则请求服务器,然后得到该市所有县的json数据,保存到数据库中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">private void queryCounty()&#123;</div><div class="line">    toolbar.setTitle(selectedCity.getCityName());</div><div class="line">    Toast.makeText(this,&quot;cityCode = &quot;+ selectedCity.getCityCode() + &quot;\n&quot; +</div><div class="line">            &quot;id = &quot; + selectedCity.getId(),Toast.LENGTH_LONG ).show();</div><div class="line">    countyList = DataSupport.where(&quot;cityCode = ?&quot;, String.valueOf(selectedCity.getId())).find(County.class);</div><div class="line">    if (countyList.size() &gt; 0 )&#123;</div><div class="line">        dataList.clear();</div><div class="line">        for (County county: countyList)&#123;</div><div class="line">            dataList.add(county.getCountyName());</div><div class="line">        &#125;</div><div class="line">        adapter.notifyDataSetChanged();</div><div class="line">        listView.setSelection(0);</div><div class="line">        currentLevel = LEVEL_COUNTY;</div><div class="line">    &#125;else &#123;</div><div class="line">        int provinceCode = selectedProvince.getProvinceCode();</div><div class="line">        int cityCode = selectedCity.getCityCode();</div><div class="line">        String address = &quot;http://guolin.tech/api/china/&quot; + provinceCode + &quot;/&quot;  + cityCode;</div><div class="line">        queryFromServer(address,&quot;county&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">public static boolean handleCountyResponse(String response, int cityCode)&#123;</div><div class="line">    if (!TextUtils.isEmpty(response)) &#123;</div><div class="line">        try &#123;</div><div class="line">            JSONArray allCounty = new JSONArray(response);</div><div class="line">            for (int i = 0; i &lt; allCounty.length(); i++) &#123;</div><div class="line">                JSONObject countyObject = allCounty.getJSONObject(i);</div><div class="line">                County county = new County();</div><div class="line">                county.setCountyName(countyObject.getString(&quot;name&quot;));</div><div class="line">                county.setWeatherId(countyObject.getString(&quot;weather_id&quot;));</div><div class="line">                county.setCityCode(cityCode);</div><div class="line">                boolean successed = county.save();</div><div class="line">                if (successed) Log.d(TAG, &quot;handleCountyResponse: save success&quot;);</div><div class="line">                else Log.d(TAG, &quot;handleCountyResponse: save fail&quot;);</div><div class="line">            &#125;</div><div class="line">            return true;</div><div class="line">        &#125; catch (JSONException je) &#123;</div><div class="line">            je.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return false;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>选择其中某一项, 获取weatherId和县名称countyName, 通过setResult返回父Activity中,<br>在父Activity中onActivityResult方法中, 把weatherId和countyName保存到Weather数据表中, 然后重新获取weather表中数据.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">listView.setOnItemClickListener(new AdapterView.OnItemClickListener() &#123;</div><div class="line">    @Override</div><div class="line">    public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id) &#123;</div><div class="line">        if (currentLevel == LEVEL_PROVINCE)&#123;</div><div class="line">            selectedProvince = provinceList.get(position);</div><div class="line">            queryCity();</div><div class="line">        &#125;else if (currentLevel == LEVEL_CITY)&#123;</div><div class="line">            selectedCity = cityList.get(position);</div><div class="line">            Toast.makeText(ChooseCityActivity.this,&quot;id = &quot;  + selectedCity.getId() + &quot;\n&quot;+</div><div class="line">                    &quot;cityName = &quot; + selectedCity.getCityName() + &quot;\n&quot; +</div><div class="line">                    &quot;cityCode = &quot; + selectedCity.getCityCode() + &quot;\n&quot; +</div><div class="line">                    &quot;provinceCode = &quot; + selectedCity.getProvinceCode(),Toast.LENGTH_SHORT).show();</div><div class="line">            queryCounty();</div><div class="line">        &#125;else if (currentLevel == LEVEL_COUNTY)&#123;</div><div class="line">            selectedCounty = countyList.get(position);</div><div class="line">            Toast.makeText(ChooseCityActivity.this,&quot;id = &quot;  + selectedCounty.getId() + &quot;\n&quot;+</div><div class="line">                    &quot;countyName = &quot; + selectedCounty.getCountyName() + &quot;\n&quot; +</div><div class="line">                    &quot;weather_id = &quot; + selectedCounty.getWeatherId(),Toast.LENGTH_SHORT).show();</div><div class="line">            Intent intent = new Intent();</div><div class="line">            intent.putExtra(&quot;weather_id&quot;, selectedCounty.getWeatherId());</div><div class="line">            intent.putExtra(&quot;county_name&quot;,selectedCounty.getCountyName());</div><div class="line">            setResult(RESULT_OK,intent);</div><div class="line">            finish();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>回到父Activity进行操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">String weather_id = data.getStringExtra(&quot;weather_id&quot;);</div><div class="line">List&lt;Weather&gt; weatherList = DataSupport.where(&quot;weatherId = ? &quot;, weather_id).find(Weather.class);</div><div class="line">if (weatherList != null &amp;&amp; weatherList.size()==0)&#123;</div><div class="line">	Weather weather = new Weather();</div><div class="line">	weather.setCountyName(data.getStringExtra(&quot;county_name&quot;));</div><div class="line">	weather.setWeatherId(data.getStringExtra(&quot;weather_id&quot;));</div><div class="line">	weather.setIsShow(&quot;1&quot;);</div><div class="line">	weather.save();</div><div class="line">	titleList.add(weather.getCountyName());</div><div class="line">	WeatherFragment weatherFragment = new WeatherFragment(weather.getWeatherId());</div><div class="line">	weatherFragmentList.add(weatherFragment);</div><div class="line">	weatherPageAdapter.notifyDataSetChanged();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="构造ViewPager天气页面数据源"><a href="#构造ViewPager天气页面数据源" class="headerlink" title="构造ViewPager天气页面数据源"></a>构造ViewPager天气页面数据源</h3><p>在MainActivity中,访问数据库weather表, (条件:isShow=1,表示显示是否显示在主界面), 把查询结果存到List中,如果list大小为0, 则打开选择城市界面,如果存在数据,则遍历每个weather对象,创建WeatherFragment,并把weather对象中的weatherId传到Fragment的构造方法中,并添加到fragmengList中, WeatherFragment会根据这个weatherId获取天气信息,同时把weather的countyName添加到titleLists中用于设置每个pager的标题,,,然后通知adapter数据更新了,<br>pagerAdapter是通过fragmengList和titleList绑定数据的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">private void showWeather()&#123;</div><div class="line">    weatherList.clear();</div><div class="line">    weatherFragmentList.clear();</div><div class="line">    titleList.clear();</div><div class="line">    weatherList = DataSupport.where(&quot;isShow=?&quot;, &quot;1&quot;).find(Weather.class);</div><div class="line">    if (weatherList.size() ==0)&#123;</div><div class="line">        //转到选择城市Activity</div><div class="line">        Intent intent = new Intent(this, ChooseCityActivity.class);</div><div class="line">        startActivityForResult(intent, REQUEST_CODE_CHOOSE_CITY);</div><div class="line">    &#125;else &#123;</div><div class="line">        for (Weather weather: weatherList) &#123;</div><div class="line">            titleList.add(weather.getCountyName());</div><div class="line">            WeatherFragment weatherFragment = new WeatherFragment(weather.getWeatherId());</div><div class="line">            weatherFragmentList.add(weatherFragment);</div><div class="line">        &#125;</div><div class="line">        weatherPageAdapter.notifyDataSetChanged();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>选择城市后返回的操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">String weather_id = data.getStringExtra(&quot;weather_id&quot;);</div><div class="line">List&lt;Weather&gt; weatherList = DataSupport.where(&quot;weatherId = ? &quot;, weather_id).find(Weather.class);</div><div class="line">if (weatherList != null &amp;&amp; weatherList.size()==0)&#123;</div><div class="line">	Weather weather = new Weather();</div><div class="line">	weather.setCountyName(data.getStringExtra(&quot;county_name&quot;));</div><div class="line">	weather.setWeatherId(data.getStringExtra(&quot;weather_id&quot;));</div><div class="line">	weather.setIsShow(&quot;1&quot;);</div><div class="line">	weather.save();</div><div class="line">	titleList.add(weather.getCountyName());</div><div class="line">	WeatherFragment weatherFragment = new WeatherFragment(weather.getWeatherId());</div><div class="line">	weatherFragmentList.add(weatherFragment);</div><div class="line">	weatherPageAdapter.notifyDataSetChanged();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="城市管理-CityManageActivity"><a href="#城市管理-CityManageActivity" class="headerlink" title="城市管理-CityManageActivity"></a>城市管理-CityManageActivity</h3><p>该页面有一个RecyclerView,和一个FloatingActionButton, 其中recyclerView的item是一个CardView, 显示了该城市粗略的天气信息,如温度和天气,fab用于添加城市,可以通过左右滑动每一个卡片来删除数据,<br>请求数据库, 访问weather表的所有数据, 抽取其中所需的信息封装到CityItem中,然后添加到cityItemList中,作为RecyclerView的数据源,当成功选择一个城市并返回后,根据返回的weatherId访问数据库是否存在该数据,有则不操作,没有则添加到weather表中.以免产生冗余数据.当滑动删除城市后,会从数据表中删除掉这条记录,(改进的做法是滑动删除后显示一个Snackbar来确认操作)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">weatherList = DataSupport.findAll(Weather.class);</div><div class="line">Gson gson = new Gson();</div><div class="line">Root root;</div><div class="line">for (Weather weather: weatherList)&#123;</div><div class="line">	CityItem cityItem = new CityItem();</div><div class="line">	cityItem.setIsShow(weather.getIsShow());</div><div class="line">	root = gson.fromJson(weather.getWeatherInfo(),Root.class);</div><div class="line">	if (root!=null)&#123;</div><div class="line">		cityItem.setTmp(root.getHeWeather5().get(0).getNow().getTmp());</div><div class="line">		cityItem.setWeather(root.getHeWeather5().get(0).getNow().getCond().getTxt());</div><div class="line">		cityItem.setCounty(weather.getCountyName());</div><div class="line">		cityItem.setWeatherId(weather.getWeatherId());</div><div class="line">		cityItemList.add(cityItem);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">cityRecyclerAdapter.notifyDataSetChanged();</div></pre></td></tr></table></figure></p>
<p>滑动删除后的操作-我还在进一步研究,不是很懂,因为是复制别人的代码<br>关联<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//关联ItemTouchHelper和RecyclerView</div><div class="line">ItemTouchHelper.Callback callback = new ItemTouchHelperCallback(cityRecyclerAdapter);</div><div class="line">ItemTouchHelper mItemTouchHelper = new ItemTouchHelper(callback);</div><div class="line">mItemTouchHelper.attachToRecyclerView(recyclerView);</div></pre></td></tr></table></figure></p>
<p>ItemTouchHelperCallback:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">public class ItemTouchHelperCallback extends ItemTouchHelper.Callback &#123;</div><div class="line"></div><div class="line">    private OnMoveAndSwipedListener moveAndSwipedListener;</div><div class="line"></div><div class="line">    public ItemTouchHelperCallback(OnMoveAndSwipedListener listener) &#123;</div><div class="line">        this.moveAndSwipedListener = listener;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //设置拖动方向以及侧滑方向</div><div class="line">    @Override</div><div class="line">    public int getMovementFlags(RecyclerView recyclerView, RecyclerView.ViewHolder viewHolder) &#123;</div><div class="line">        if (recyclerView.getLayoutManager() instanceof LinearLayoutManager) &#123;</div><div class="line">            //单列的RecyclerView支持上下拖动和左右侧滑</div><div class="line">            final int dragFlags = ItemTouchHelper.UP | ItemTouchHelper.DOWN;</div><div class="line">            final int swipeFlags = ItemTouchHelper.START | ItemTouchHelper.END;</div><div class="line">            return makeMovementFlags(dragFlags, swipeFlags);</div><div class="line">        &#125; else &#123;</div><div class="line">            //多列的RecyclerView支持上下左右拖动和不支持左右侧滑</div><div class="line">            final int dragFlags = ItemTouchHelper.UP | ItemTouchHelper.DOWN | ItemTouchHelper.LEFT | ItemTouchHelper.RIGHT;</div><div class="line">            final int swipeFlags = 0;</div><div class="line">            return makeMovementFlags(dragFlags, swipeFlags);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //拖动item时会调用此方法</div><div class="line">    @Override</div><div class="line">    public boolean onMove(RecyclerView recyclerView, RecyclerView.ViewHolder viewHolder, RecyclerView.ViewHolder target) &#123;</div><div class="line">        //如果两个item不是同一个类型的，不让他拖拽</div><div class="line">        if (viewHolder.getItemViewType() != target.getItemViewType()) &#123;</div><div class="line">            return false;</div><div class="line">        &#125;</div><div class="line">        moveAndSwipedListener.onItemMove(viewHolder.getAdapterPosition(), target.getAdapterPosition());</div><div class="line">        return true;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //侧滑item时会调用此方法</div><div class="line">    @Override</div><div class="line">    public void onSwiped(RecyclerView.ViewHolder viewHolder, int direction) &#123;</div><div class="line">        moveAndSwipedListener.onItemDismiss(viewHolder.getAdapterPosition());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>OnMoveAndSwipedListener:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public interface OnMoveAndSwipedListener &#123;</div><div class="line"></div><div class="line">    boolean onItemMove(int fromPosition, int toPosition);</div><div class="line"></div><div class="line">    void onItemDismiss(int position);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>监听到滑动删除执行以下方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public boolean onItemMove(int fromPosition, int toPosition) &#123;</div><div class="line">    notifyItemMoved(fromPosition, toPosition);</div><div class="line">    return true;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@Override</div><div class="line">public void onItemDismiss(int position) &#123;</div><div class="line">    DataSupport.deleteAll(Weather.class,&quot;weatherId=?&quot;,cityItemList.get(position).getWeatherId());</div><div class="line">    cityItemList.remove(position);</div><div class="line">    notifyItemRemoved(position);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="显示天气-WeatherFragmeng"><a href="#显示天气-WeatherFragmeng" class="headerlink" title="显示天气-WeatherFragmeng"></a>显示天气-WeatherFragmeng</h3><p>显示天气信息是在WeatherFragment中完成的, 也就是每个页面. 从构造方法中获取到该所显示城市的天气数据, 根据这个weatherId访问数据库中该weatherId所在记录是否有weatherInfo信息,如果有则获取该天气信息的json数据, 没有则向服务器请求数据,获取天气信息,成功获取信息之后保存到数据库中.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">weatherList = DataSupport.where(<span class="string">"weatherId = ? "</span>, weather_id).find(Weather.class);</div><div class="line"><span class="keyword">if</span> (weatherList != <span class="keyword">null</span> &amp;&amp; weatherList.size()&gt;<span class="number">0</span>)&#123;</div><div class="line">	<span class="keyword">if</span> (TextUtils.isEmpty(weatherList.get(<span class="number">0</span>).getWeatherInfo())) sendWeatherInfoRequest();</div><div class="line">	<span class="keyword">else</span> handleWeatherInfoResponse(weatherList.get(<span class="number">0</span>).getWeatherInfo());</div><div class="line">&#125;<span class="keyword">else</span> &#123;</div><div class="line">	<span class="comment">//get dada from internet</span></div><div class="line">	sendWeatherInfoRequest();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>获取后保存到数据库<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">String responseText = response.body().string();</div><div class="line">Weather weather = <span class="keyword">new</span> Weather();</div><div class="line">weather.setWeatherInfo(responseText);</div><div class="line">weather.updateAll(<span class="string">"weatherId=?"</span>, weather_id);</div><div class="line">getActivity().runOnUiThread(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">		handleWeatherInfoResponse(responseText);</div><div class="line">	&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<hr>
<p>持续更新……..<br>欢迎大家共同学习共同成长…..</p>
]]></content>
    
    <summary type="html">
    
      &lt;figure class=&quot;image-bubble&quot;&gt;
                &lt;div class=&quot;img-lightbox&quot;&gt;
                    &lt;div class=&quot;overlay&quot;&gt;&lt;/div&gt;
                   
    
    </summary>
    
      <category term="Android" scheme="https://devallever.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://devallever.github.io/tags/Android/"/>
    
      <category term="Project" scheme="https://devallever.github.io/tags/Project/"/>
    
  </entry>
  
  <entry>
    <title>排序算法</title>
    <link href="https://devallever.github.io/2017/05/23/algorithms-sort/"/>
    <id>https://devallever.github.io/2017/05/23/algorithms-sort/</id>
    <published>2017-05-23T12:54:18.000Z</published>
    <updated>2017-06-25T13:25:04.244Z</updated>
    
    <content type="html"><![CDATA[<h1 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h1><h2 id="思想"><a href="#思想" class="headerlink" title="思想"></a>思想</h2><p>比较相邻记录关键字，如果逆序，则进行交换，从而使记录小的像气泡一样逐渐往上“漂浮”(左移)，或者说使记录大的像石头那样”下沉”(右移)</p>
<h2 id="算法实现"><a href="#算法实现" class="headerlink" title="算法实现"></a>算法实现</h2><h3 id="java实现"><a href="#java实现" class="headerlink" title="java实现"></a>java实现</h3><p>原序列<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> a[<span class="number">10</span>] = &#123;<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">0</span>&#125;;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">popSort</span><span class="params">(<span class="keyword">int</span>[] a)</span></span>&#123;</div><div class="line">    <span class="comment">//最基本的冒泡排序写法</span></div><div class="line">    <span class="comment">/*int i;</span></div><div class="line">    for (i=0;i&lt;a.length;i++)&#123;</div><div class="line">        for (int j=0;j&lt;a.length-1;j++)&#123;</div><div class="line">            if (a[j]&gt;a[j+1])&#123;</div><div class="line">                int temp = a[j];</div><div class="line">                a[j] = a[j+1];</div><div class="line">                a[j+1] = temp;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;*/</div><div class="line"></div><div class="line">    <span class="comment">//改进的冒泡排序写法</span></div><div class="line">    <span class="keyword">int</span> len = a.length-<span class="number">1</span>;</div><div class="line">    <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;<span class="comment">//用来标识是否发生交换操作</span></div><div class="line">    <span class="keyword">while</span> (len&gt;<span class="number">0</span> &amp;&amp; flag)&#123;</div><div class="line">        flag = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;len;j++)&#123;</div><div class="line">            <span class="keyword">if</span> (a[j] &gt; a[j+<span class="number">1</span>])&#123;</div><div class="line">                <span class="comment">//交换</span></div><div class="line">                <span class="keyword">int</span> temp = a[j];</div><div class="line">                a[j] = a[j+<span class="number">1</span>];</div><div class="line">                a[j+<span class="number">1</span>] = temp;</div><div class="line">                flag = <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        show(a);</div><div class="line">        len--;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">原序列: 1 6 5 9 3 8 2 7 0 4 </div><div class="line">1 5 6 3 8 2 7 0 4 9 </div><div class="line">1 5 3 6 2 7 0 4 8 9 </div><div class="line">1 3 5 2 6 0 4 7 8 9 </div><div class="line">1 3 2 5 0 4 6 7 8 9 </div><div class="line">1 2 3 0 4 5 6 7 8 9 </div><div class="line">1 2 0 3 4 5 6 7 8 9 </div><div class="line">1 0 2 3 4 5 6 7 8 9 </div><div class="line">0 1 2 3 4 5 6 7 8 9 </div><div class="line">0 1 2 3 4 5 6 7 8 9 </div><div class="line">排序后: 0 1 2 3 4 5 6 7 8 9</div></pre></td></tr></table></figure></p>
<h1 id="快速排序-冒泡排序升级版"><a href="#快速排序-冒泡排序升级版" class="headerlink" title="快速排序(冒泡排序升级版)"></a>快速排序(冒泡排序升级版)</h1><h2 id="思想-1"><a href="#思想-1" class="headerlink" title="思想"></a>思想</h2><p>在待排记录中选择一个记录(通常第一个)作为枢纽(关键记录)pivotkey. 经过一趟排序，以枢纽记录分为两个子表，左边子表记录比枢纽记录小，右边子表比枢纽记录大。然后对每个子表重复以上过程。知道每个子表只有一个记录时，排序结束。</p>
<h2 id="每一趟操做"><a href="#每一趟操做" class="headerlink" title="每一趟操做"></a>每一趟操做</h2><p> 参考《大话数据结构》有详细解析</p>
<ol>
<li>选择表中一个记录作为枢纽(通常是第一个记录) 保存好记录的值pivotkey</li>
<li>(1)从high往左每个记录依次与pivotkey比较，比pivotkey大或相等的，high往左移(high–), 比pivotkey小的结束high移动，交换low和high的值<br> (2) 从low往右每个记录依次与pivotkey比较，比pivotkey小或相等的，low往右移(low++), 比pivotkey小的结束low移动，交换low和high的值</li>
<li>返回pivotkey的值<h2 id="算法实现-1"><a href="#算法实现-1" class="headerlink" title="算法实现"></a>算法实现</h2><h3 id="java实现-1"><a href="#java实现-1" class="headerlink" title="java实现"></a>java实现</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">int a[10] = &#123;4,3,2,6,1,9,5,8,7,0&#125;;</div></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">private static void quickSort(int[] a,int low, int high)&#123;</div><div class="line">    if (low&lt;high)&#123;</div><div class="line">        int povit = partition(a,low,high);</div><div class="line">        quickSort(a,povit+1,high);  //对枢纽记录右边子表进行排序</div><div class="line">        quickSort(a,low,povit-1);   //对枢纽记录左边的子表进行排序</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">private static int partition(int[] a, int low, int high)&#123;</div><div class="line">    System.out.println(&quot;low = &quot; + low);</div><div class="line">    int pivot = a[low]; //用子表的第一个记录作为枢纽记录</div><div class="line">    while (low&lt;high)&#123;   //</div><div class="line">        while (low&lt;high &amp;&amp; a[high]&gt;=pivot)  //右往左比较</div><div class="line">            high--;                         //如果记录比枢纽记录大或者相等，high向左移动一个</div><div class="line">        swap(a,low,high);                   //交换，比枢纽记录小的放左边</div><div class="line">        show(a);</div><div class="line">        while (low&lt;high &amp;&amp; a[low]&lt;=pivot)   //左往右比较</div><div class="line">            low++;                          //如果记录比枢纽记录小或者相等，high向右移动一个</div><div class="line">        swap(a,low,high);                   //交换，比枢纽记录大的放右边</div><div class="line">        show(a);</div><div class="line">    &#125;</div><div class="line">    System.out.println(&quot;pivot = &quot; + pivot);</div><div class="line">    System.out.println();</div><div class="line">    return low;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>调用<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">quickSort(a, <span class="number">0</span>, a.length-<span class="number">1</span>);</div></pre></td></tr></table></figure></p>
<p>运行结果<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">原序列: <span class="number">1</span> <span class="number">6</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">0</span> <span class="number">4</span> </div><div class="line">low = <span class="number">0</span></div><div class="line"><span class="number">0</span> <span class="number">6</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">1</span> <span class="number">4</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">6</span> <span class="number">4</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">6</span> <span class="number">4</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">6</span> <span class="number">4</span> </div><div class="line">pivot = <span class="number">1</span></div><div class="line"></div><div class="line">low = <span class="number">2</span></div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">4</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">4</span> <span class="number">5</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">6</span> <span class="number">9</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">4</span> <span class="number">2</span> <span class="number">3</span> <span class="number">8</span> <span class="number">5</span> <span class="number">7</span> <span class="number">6</span> <span class="number">9</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">4</span> <span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">9</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">4</span> <span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">9</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">4</span> <span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">9</span> </div><div class="line">pivot = <span class="number">5</span></div><div class="line"></div><div class="line">low = <span class="number">6</span></div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">4</span> <span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">4</span> <span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line">pivot = <span class="number">8</span></div><div class="line"></div><div class="line">low = <span class="number">6</span></div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">4</span> <span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">4</span> <span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line">pivot = <span class="number">6</span></div><div class="line"></div><div class="line">low = <span class="number">2</span></div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">3</span> <span class="number">2</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">3</span> <span class="number">2</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line">pivot = <span class="number">4</span></div><div class="line"></div><div class="line">low = <span class="number">2</span></div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line">pivot = <span class="number">3</span></div><div class="line"></div><div class="line">排序后: <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span></div></pre></td></tr></table></figure></p>
<h1 id="选择排序"><a href="#选择排序" class="headerlink" title="选择排序"></a>选择排序</h1><h2 id="思想-2"><a href="#思想-2" class="headerlink" title="思想"></a>思想</h2><p>一个简单的选择排序算法是这样的:<br>首先, 找到数组中最小的一个元素<br>其次, 将它和数组的第一个元素交换位置,(如果第一个元素是最小的那么它就和自己交换).<br>再次, 在剩下元素中继续找到最小的元素,将它和数组中第二个元素交换位置.<br>如此反复操作,直到将整个数组排序<br>这种方法就是简单选择排序.</p>
<h2 id="算法实现-2"><a href="#算法实现-2" class="headerlink" title="算法实现"></a>算法实现</h2><h3 id="C语言"><a href="#C语言" class="headerlink" title="C语言"></a>C语言</h3><p>原序列<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">int a[10] = &#123;4,3,2,6,1,9,5,8,7,0&#125;;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">/**简单选择排序</div><div class="line"> * */</div><div class="line">void SelectSort(int a[], int length)&#123;</div><div class="line">    int i, j;</div><div class="line">    int min;</div><div class="line">    for (i = 0; i &lt; length; ++i) &#123;</div><div class="line">        min = i;</div><div class="line">        for (j = i+1; j &lt; length; ++j) &#123;</div><div class="line">            if (a[j] &lt; a[min])&#123;</div><div class="line">                min = j;</div><div class="line">            &#125;</div><div class="line">            //printf(&quot;min = %d\n&quot;, min);//调试加上,</div><div class="line">        &#125;</div><div class="line">        if (min != i)&#123;</div><div class="line">            int temp = a[i];</div><div class="line">            a[i] = a[min];</div><div class="line">            a[min] = temp;</div><div class="line">        &#125;</div><div class="line">        show(a,length);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">原序列: <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">6</span> <span class="number">1</span> <span class="number">9</span> <span class="number">5</span> <span class="number">8</span> <span class="number">7</span> <span class="number">0</span> </div><div class="line"><span class="number">0</span> <span class="number">3</span> <span class="number">2</span> <span class="number">6</span> <span class="number">1</span> <span class="number">9</span> <span class="number">5</span> <span class="number">8</span> <span class="number">7</span> <span class="number">4</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">6</span> <span class="number">3</span> <span class="number">9</span> <span class="number">5</span> <span class="number">8</span> <span class="number">7</span> <span class="number">4</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">6</span> <span class="number">3</span> <span class="number">9</span> <span class="number">5</span> <span class="number">8</span> <span class="number">7</span> <span class="number">4</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">6</span> <span class="number">9</span> <span class="number">5</span> <span class="number">8</span> <span class="number">7</span> <span class="number">4</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">9</span> <span class="number">5</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">9</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">8</span> <span class="number">7</span> <span class="number">9</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line">排序后: <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span></div></pre></td></tr></table></figure></p>
<h3 id="java实现-2"><a href="#java实现-2" class="headerlink" title="java实现"></a>java实现</h3><p>原序列:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">int[] a = &#123;1,6,5,9,3,8,2,7,0, 4&#125;;</div></pre></td></tr></table></figure></p>
<p>第一次从0-9中选择最小的与第0个交换<br>第二次从1-9中选择最小的与第1个交换<br>重复以上步骤<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">selectSort</span><span class="params">(<span class="keyword">int</span>[] a)</span></span>&#123;</div><div class="line">    System.out.println(<span class="string">"选择排序算法:"</span>);</div><div class="line">    <span class="keyword">int</span> min, i, j;</div><div class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;a.length; i++)&#123;</div><div class="line">        min = i;</div><div class="line">        <span class="keyword">for</span> (j=i+<span class="number">1</span>; j&lt;a.length; j++)&#123;</div><div class="line">            <span class="keyword">if</span> (a[j] &lt; a[min])&#123;</div><div class="line">                min = j;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//System.out.println("min = " + min);</span></div><div class="line">        <span class="keyword">int</span> temp = a[i];</div><div class="line">        a[i] = a[min];</div><div class="line">        a[min] = temp;</div><div class="line">        System.out.print(<span class="string">"第"</span> + (i+<span class="number">1</span>) + <span class="string">"次排序后:"</span>);</div><div class="line">        show(a);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行结果:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">原序列: <span class="number">1</span> <span class="number">6</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">0</span> <span class="number">4</span> </div><div class="line">选择排序算法:</div><div class="line">第<span class="number">1</span>次排序后:<span class="number">0</span> <span class="number">6</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">1</span> <span class="number">4</span> </div><div class="line">第<span class="number">2</span>次排序后:<span class="number">0</span> <span class="number">1</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">6</span> <span class="number">4</span> </div><div class="line">第<span class="number">3</span>次排序后:<span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">5</span> <span class="number">7</span> <span class="number">6</span> <span class="number">4</span> </div><div class="line">第<span class="number">4</span>次排序后:<span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">9</span> <span class="number">8</span> <span class="number">5</span> <span class="number">7</span> <span class="number">6</span> <span class="number">4</span> </div><div class="line">第<span class="number">5</span>次排序后:<span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">8</span> <span class="number">5</span> <span class="number">7</span> <span class="number">6</span> <span class="number">9</span> </div><div class="line">第<span class="number">6</span>次排序后:<span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">9</span> </div><div class="line">第<span class="number">7</span>次排序后:<span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line">第<span class="number">8</span>次排序后:<span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line">第<span class="number">9</span>次排序后:<span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line">第<span class="number">10</span>次排序后:<span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line">排序后: <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span></div></pre></td></tr></table></figure></p>
<h1 id="插入排序"><a href="#插入排序" class="headerlink" title="插入排序"></a>插入排序</h1><h2 id="思想-3"><a href="#思想-3" class="headerlink" title="思想"></a>思想</h2><p>和整理扑克牌一样, 将每一张牌插入到其他已经有序的牌中的适当位置.在计算机实现中,为了要给插入的元素腾出空间, 我们需要将其余所有元素在插入之前都向右移动一位. 这种算法叫做插入排序.</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="C语言实现"><a href="#C语言实现" class="headerlink" title="C语言实现"></a>C语言实现</h3><p>原序列<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> a[<span class="number">10</span>] = &#123;<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">0</span>&#125;;</div></pre></td></tr></table></figure></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 直接插入排序*/</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">InsertSort</span><span class="params">(<span class="keyword">int</span> a[], <span class="keyword">int</span> length)</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> i,j;</div><div class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; length- <span class="number">1</span>; ++i) &#123;</div><div class="line">        <span class="keyword">for</span> (j = i+<span class="number">1</span>; j &gt; <span class="number">0</span> ; j--) &#123;</div><div class="line">            <span class="keyword">if</span> (a[j] &lt; a[j<span class="number">-1</span>])&#123;</div><div class="line">                <span class="comment">//交换</span></div><div class="line">                <span class="keyword">int</span> temp = a[j];</div><div class="line">                a[j] = a[j<span class="number">-1</span>];</div><div class="line">                a[j<span class="number">-1</span>] = temp;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        show(a,MAX_SIZE);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">原序列: 4 3 2 6 1 9 5 8 7 0 </div><div class="line">3 4 2 6 1 9 5 8 7 0 </div><div class="line">2 3 4 6 1 9 5 8 7 0 </div><div class="line">2 3 4 6 1 9 5 8 7 0 </div><div class="line">1 2 3 4 6 9 5 8 7 0 </div><div class="line">1 2 3 4 6 9 5 8 7 0 </div><div class="line">1 2 3 4 5 6 9 8 7 0 </div><div class="line">1 2 3 4 5 6 8 9 7 0 </div><div class="line">1 2 3 4 5 6 7 8 9 0 </div><div class="line">0 1 2 3 4 5 6 7 8 9 </div><div class="line">排序后: 0 1 2 3 4 5 6 7 8 9</div></pre></td></tr></table></figure></p>
<h3 id="Java实现"><a href="#Java实现" class="headerlink" title="Java实现"></a>Java实现</h3><p>原序列:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span>[] a = &#123;<span class="number">1</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">4</span>&#125;;</div></pre></td></tr></table></figure></p>
<p>第一次把第2个数依次从右往左和1个数比较<br>第二次把第3个数依次从右往左和2个数比较<br>重复以上步骤</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">insertSort</span><span class="params">(<span class="keyword">int</span>[] a)</span></span>&#123;</div><div class="line">    System.out.println(<span class="string">"插入排序算法:"</span>);</div><div class="line">    <span class="keyword">int</span> i, j;</div><div class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;a.length; i++)&#123;</div><div class="line">        <span class="keyword">for</span> (j=i; j&gt;<span class="number">0</span>; j--)&#123;</div><div class="line">            <span class="keyword">if</span> (a[j] &lt; a[j-<span class="number">1</span>])&#123;</div><div class="line">                <span class="keyword">int</span> temp = a[j];</div><div class="line">                a[j] = a[j-<span class="number">1</span>];</div><div class="line">                a[j-<span class="number">1</span>] = temp;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        System.out.print(<span class="string">"第"</span> + (i+<span class="number">1</span>) + <span class="string">"次排序后:"</span>);</div><div class="line">        show(a);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">原序列: <span class="number">1</span> <span class="number">6</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">0</span> <span class="number">4</span> </div><div class="line">插入排序算法:</div><div class="line">第<span class="number">1</span>次排序后:<span class="number">1</span> <span class="number">6</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">0</span> <span class="number">4</span> </div><div class="line">第<span class="number">2</span>次排序后:<span class="number">1</span> <span class="number">6</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">0</span> <span class="number">4</span> </div><div class="line">第<span class="number">3</span>次排序后:<span class="number">1</span> <span class="number">5</span> <span class="number">6</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">0</span> <span class="number">4</span> </div><div class="line">第<span class="number">4</span>次排序后:<span class="number">1</span> <span class="number">5</span> <span class="number">6</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">0</span> <span class="number">4</span> </div><div class="line">第<span class="number">5</span>次排序后:<span class="number">1</span> <span class="number">3</span> <span class="number">5</span> <span class="number">6</span> <span class="number">9</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">0</span> <span class="number">4</span> </div><div class="line">第<span class="number">6</span>次排序后:<span class="number">1</span> <span class="number">3</span> <span class="number">5</span> <span class="number">6</span> <span class="number">8</span> <span class="number">9</span> <span class="number">2</span> <span class="number">7</span> <span class="number">0</span> <span class="number">4</span> </div><div class="line">第<span class="number">7</span>次排序后:<span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">6</span> <span class="number">8</span> <span class="number">9</span> <span class="number">7</span> <span class="number">0</span> <span class="number">4</span> </div><div class="line">第<span class="number">8</span>次排序后:<span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">0</span> <span class="number">4</span> </div><div class="line">第<span class="number">9</span>次排序后:<span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">4</span> </div><div class="line">第<span class="number">10</span>次排序后:<span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line">排序后: <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span></div></pre></td></tr></table></figure></p>
<h1 id="希尔排序"><a href="#希尔排序" class="headerlink" title="希尔排序"></a>希尔排序</h1><h2 id="思想-4"><a href="#思想-4" class="headerlink" title="思想"></a>思想</h2><p>希尔排序的思想是使数组中任意间隔为h的元素都是有序的. 这样的数组成为h有序数组<br>简单地说, 一个h有序数组就是h个互相独立的有序数组编织在一起组成的一个数组.<br>在进行排序时, 如果h很大, 我们能将元素移动到很远的地方, 为实现更小的h有序数组创造方便, 用这种方式,对于任意以1结尾的h序列, 我们都能够将数组排序.<br>这就是希尔排序.</p>
<p>##　实现</p>
<h3 id="C语言实现-1"><a href="#C语言实现-1" class="headerlink" title="C语言实现"></a>C语言实现</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 希尔排序*/</div><div class="line"> <span class="function"><span class="keyword">void</span> <span class="title">ShellSort</span><span class="params">(<span class="keyword">int</span> a[], <span class="keyword">int</span> length)</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> h = <span class="number">1</span>;  <span class="comment">//增量</span></div><div class="line">    <span class="comment">//while(h &lt;= length/3) h = 3*h + 1;   //增量初始值 我写的</span></div><div class="line">    <span class="keyword">while</span>(h &lt; length/<span class="number">3</span>) h = <span class="number">3</span>*h + <span class="number">1</span>;   <span class="comment">//增量初始值</span></div><div class="line"></div><div class="line">    <span class="keyword">while</span> (h &gt;= <span class="number">1</span>)&#123;     <span class="comment">//对每个增量都进行排序</span></div><div class="line">        <span class="keyword">int</span> i;</div><div class="line">        <span class="keyword">for</span> (i = h; i &lt; length; ++i) &#123;      <span class="comment">//对同一增量的每个分组进行排序</span></div><div class="line">            <span class="keyword">int</span> j;</div><div class="line">            <span class="comment">//for (j = i; j &lt; length; j= j-h) &#123;   //对每个分组进行插入排序     我写的</span></div><div class="line">            <span class="keyword">for</span> (j = i; j &gt;= h; j= j-h) &#123;   <span class="comment">//对每个分组进行插入排序</span></div><div class="line">                <span class="keyword">if</span>(a[j] &lt; a[j-h])&#123;</div><div class="line">                    <span class="keyword">int</span> temp = a[j];</div><div class="line">                    a[j] = a[j-h];</div><div class="line">                    a[j-h] = temp;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        show(a,MAX_SIZE);</div><div class="line">        h = h/<span class="number">3</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">原序列: <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">6</span> <span class="number">1</span> <span class="number">9</span> <span class="number">5</span> <span class="number">8</span> <span class="number">7</span> <span class="number">0</span> </div><div class="line"><span class="number">1</span> <span class="number">0</span> <span class="number">2</span> <span class="number">6</span> <span class="number">4</span> <span class="number">3</span> <span class="number">5</span> <span class="number">8</span> <span class="number">7</span> <span class="number">9</span> </div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line">排序后: <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span></div></pre></td></tr></table></figure></p>
<h3 id="Java实现-1"><a href="#Java实现-1" class="headerlink" title="Java实现"></a>Java实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">shellSort</span><span class="params">(<span class="keyword">int</span>[] a)</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> N = a.length;</div><div class="line">    <span class="keyword">int</span> h = <span class="number">1</span>;</div><div class="line">    <span class="keyword">while</span> (h &lt; (N/<span class="number">3</span>)) h = h * <span class="number">3</span> + <span class="number">1</span>;</div><div class="line">    <span class="keyword">while</span> (h &gt;= <span class="number">1</span>)&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=h; i&lt;N; i++)&#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=i; j&gt;=h;j=j-h)&#123;</div><div class="line">                <span class="comment">//进行插入排序</span></div><div class="line">                <span class="keyword">if</span> (a[j] &lt; a[j-h])&#123;</div><div class="line">                    <span class="keyword">int</span> temp = a[j];</div><div class="line">                    a[j]= a[j-h];</div><div class="line">                    a[j-h] = temp;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        System.out.print(<span class="string">"h = "</span> + h + <span class="string">": "</span>);</div><div class="line">        show(a);</div><div class="line">        h = h/<span class="number">3</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">原序列: <span class="number">1</span> <span class="number">6</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">7</span> <span class="number">0</span> <span class="number">4</span> </div><div class="line">h = <span class="number">4</span>: <span class="number">0</span> <span class="number">4</span> <span class="number">2</span> <span class="number">7</span> <span class="number">1</span> <span class="number">6</span> <span class="number">5</span> <span class="number">9</span> <span class="number">3</span> <span class="number">8</span> </div><div class="line">h = <span class="number">1</span>: <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </div><div class="line">排序后: <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span></div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;冒泡排序&quot;&gt;&lt;a href=&quot;#冒泡排序&quot; class=&quot;headerlink&quot; title=&quot;冒泡排序&quot;&gt;&lt;/a&gt;冒泡排序&lt;/h1&gt;&lt;h2 id=&quot;思想&quot;&gt;&lt;a href=&quot;#思想&quot; class=&quot;headerlink&quot; title=&quot;思想&quot;&gt;&lt;/a&gt;思想&lt;/h
    
    </summary>
    
      <category term="算法" scheme="https://devallever.github.io/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="Java" scheme="https://devallever.github.io/tags/Java/"/>
    
      <category term="算法" scheme="https://devallever.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
      <category term="排序" scheme="https://devallever.github.io/tags/%E6%8E%92%E5%BA%8F/"/>
    
      <category term="C" scheme="https://devallever.github.io/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>Kotlin学习笔记 1</title>
    <link href="https://devallever.github.io/2017/05/22/kotlin-note-1/"/>
    <id>https://devallever.github.io/2017/05/22/kotlin-note-1/</id>
    <published>2017-05-22T09:30:55.000Z</published>
    <updated>2017-05-22T11:51:54.960Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>这里并没有系统的讲解Kotlin语法, 只是在做Demo时候刻意使用Kotlin语言,并记录一下使用方法<br>如果要学习可以看看官网的文档,以及它推荐的一些书籍</p>
</blockquote>
<h1 id="Activity"><a href="#Activity" class="headerlink" title="Activity"></a>Activity</h1><p>例如创建一个BaseActivity,则这样写<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">open class BaseActivity : AppCompatActivity() &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>open: 关键字, 如果该类用来继承的要加上open, 或者abstract</li>
<li>继承的方式是 : </li>
</ul>
<p>既然是Activity的子类,那么在重写onCreate方法时候会自动补全代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">open class BaseActivity : AppCompatActivity() &#123;</div><div class="line">    override fun onCreate(savedInstanceState: Bundle?) &#123;</div><div class="line">        super.onCreate(savedInstanceState)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>override: 不用看就知道是方法覆盖啦</li>
<li>fun 是定义方法</li>
<li>注意方法参数的表达方式跟Java有点区别,先是变量名,再指明类型.</li>
<li>注意问号?, Kotlin是空安全的, 这里表示Bundle可以为空, 第一次自学Kotlin,理解的不是很到位,望指正哈.</li>
</ul>
<h1 id="Button"><a href="#Button" class="headerlink" title="Button"></a>Button</h1><p>创建了Activity自然就是添加几个按钮,监听,<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">val btn_scale = findViewById(R.id.btn) as TextView</div><div class="line">btn_scale.setOnClickListener &#123;</div><div class="line">	//do something</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>val 定义变量, 相当与final, 之后不能修改引用,<br>var 则是初始化以后也可以指向其他引用</li>
<li>findViewById(R.id.btn) as TextView<br>找到控件之后通过 as 关键字转化TextView类型</li>
<li>设置监听,方法跟java一样,但是不再是传递一个OnClickListener,直接大括号{}<br>当然也可以看看标准使用方式是这样的<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">btn.setOnClickListener(View.OnClickListener &#123; </div><div class="line">	//do something</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</li>
</ul>
<p>如果不想每个Button设置监听都串OnClickListener,则要Activity实现OnClickListener只要在继承的类后面加入 , OnClickListener, 并从写onClick方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">class AnimationActivity : BaseActivity(), View.OnClickListener &#123;</div><div class="line"></div><div class="line">	...</div><div class="line">	override fun onClick(v: View?) &#123;</div><div class="line">        val intent: Intent</div><div class="line">        when(v?.id)&#123;</div><div class="line">            R.id.id_animation_activity_view_animation -&gt;&#123;</div><div class="line">                intent = Intent(this, ViewAnimationActivity::class.java)</div><div class="line">                startActivity(intent)</div><div class="line">            &#125;</div><div class="line">            R.id.id_animation_activity_property_animation -&gt;&#123;</div><div class="line">                intent = Intent(this, PropertyAnimationActivity::class.java)</div><div class="line">                startActivity(intent)</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>细心的你已经发现,这里有很多新奇好玩的东西,下面逐一讲解</p>
<h1 id="使用分支"><a href="#使用分支" class="headerlink" title="使用分支"></a>使用分支</h1><p>在java使用条件的分之是通过switch(){}来使用的,而在Kotlin就是用 when 关键字<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">when(v?.id)&#123;</div><div class="line">	R.id.id_animation_activity_view_animation -&gt;&#123;</div><div class="line">		// do something</div><div class="line">	&#125;</div><div class="line">	R.id.id_animation_activity_property_animation -&gt;&#123;</div><div class="line">		//do something</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>很明显when()括号内就是判断的类型,这里是view的id<br>然后每个分之就是这么判断<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">R.id.id_animation_activity_view_animation -&gt;&#123;</div><div class="line">	//do something</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="启动另一个Acivity"><a href="#启动另一个Acivity" class="headerlink" title="启动另一个Acivity"></a>启动另一个Acivity</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">val intent: Intent</div><div class="line">intent = Intent(this, XXXActivity::class.java)</div><div class="line">startActivity(intent)</div></pre></td></tr></table></figure>
<p>至于为什么这样用,我现在还不是很清楚哎<br>另外,如果在某某控件的监听方法中启动另一个Activity,应该是这样,这里使用的是recyclerView的监听<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">intent = Intent(this@MainActivity, XXXActivity::class.java)</div><div class="line">startActivity(intent)</div></pre></td></tr></table></figure></p>
<h1 id="声明变量"><a href="#声明变量" class="headerlink" title="声明变量"></a>声明变量</h1><p>在声明局部变量时候, 通常使用val,但是当声明一个全局变量时候,通常使用var,并在声明的时候初始化为空, 例如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">private var tv_target: TextView? = null</div></pre></td></tr></table></figure></p>
<p>表示声明一个TextView对象, 并初始化为空,不初始化就报错的<br>然后在Activity中正常使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tv_target = findViewById(R.id.id_view_animation_activity_tv_target) as TextView</div></pre></td></tr></table></figure></p>
<p>当要修改TextView的显示的值时候, 不再是setText(),<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tv_target.setText(&quot;&quot;);</div></pre></td></tr></table></figure></p>
<p>而是通过设置属性值方式,它会调用setText()方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tv_target.text = &quot;hello&quot;</div></pre></td></tr></table></figure></p>
<p>以后setXXX方法都是按这种方式使用 ,但上面的还是报错,因为tv_target定义为 TevtView?<br>报错信息:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Smart cast to &apos;TextView&apos; is impossible, because &apos;tv_target&apos; is a mutable property that could have been changed by this time</div></pre></td></tr></table></figure></p>
<p>so 正确的姿势是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tv_target?.text = &quot;hello&quot;</div></pre></td></tr></table></figure></p>
<h1 id="定义实体类"><a href="#定义实体类" class="headerlink" title="定义实体类"></a>定义实体类</h1><p>在Java中, 需要定义属性,并且创建该属性的gettet和setter方法<br>在Kotlin中只需要这样<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class ListItem(</div><div class="line">        var title: String,</div><div class="line">        var description: String</div><div class="line">)</div></pre></td></tr></table></figure></p>
<p>这样它会自动生成getter和setter方法,并不需要要我们实现<br>通常我们这样使用,<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var listItemA = ListItem(&quot;titleText&quot;, &quot;descriptionText&quot;)</div><div class="line">listItemA.title = &quot;HI Title&quot;</div><div class="line">listItemA.description = &quot;Hi Description&quot;</div></pre></td></tr></table></figure></p>
<h1 id="定义方法并设置参数的默认值"><a href="#定义方法并设置参数的默认值" class="headerlink" title="定义方法并设置参数的默认值"></a>定义方法并设置参数的默认值</h1><p>例如在Activity中定义Toast的方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">private fun toast(message: String, length: Int=Toast.LENGTH_LONG):Unit&#123;</div><div class="line">	Toast.makeText(this@MainActivity, message,length).show()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Unit为返回类型,Unit表相当于示返回值为void,并且可以省略Unit,如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">private fun toast(message: String, length: Int=Toast.LENGTH_LONG)&#123;</div><div class="line">        Toast.makeText(this@MainActivity, message,length).show()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里length参数指定了一个默认值就是Toast.LENGTH_LONG<br>调用是应该这样<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">toast(&quot;HI Android&quot;)</div><div class="line">//或</div><div class="line">toast(&quot;Hi Android&quot;,1000)</div></pre></td></tr></table></figure></p>
<h1 id="使用RecyclerView"><a href="#使用RecyclerView" class="headerlink" title="使用RecyclerView"></a>使用RecyclerView</h1><p>在Activity通常定义一个ArrayList类型的全局变量,作为Adapter的参数<br>因此这样声明一个全局变量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">private var listItems: ArrayList&lt;ListItem&gt;? = null</div></pre></td></tr></table></figure></p>
<blockquote>
<p>注意这里是ArrayList? 类型</p>
</blockquote>
<p>然后创建Adapter,他的构造方法如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class MyRecyclerViewAdapter(private val context: Context,</div><div class="line">                            private val listItems: ArrayList&lt;ListItem&gt;?) </div><div class="line">    : RecyclerView.Adapter&lt;MyRecyclerViewAdapter.MyViewHolder&gt;() &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>构造方法中listItems的类型也是ArrayList?, 因为在Activity中, 定义一个可变的全局变量时候初始化为空,因此这里与之对应<br>初始化listItems对象<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">listItems =  ArrayList&lt;ListItem&gt;()</div><div class="line">listItems?.add(ListItem(&quot;chapter1&quot;, &quot;Android Framework&quot;))</div><div class="line">listItems!!.add(ListItem(&quot;chapter2&quot;, &quot;Android Developer tools&quot;))</div><div class="line">listItems!!.add(ListItem(&quot;chapter3&quot;, &quot;Custom View&quot;))</div><div class="line">listItems!!.add(ListItem(&quot;chapter4&quot;, &quot;listView Demo&quot;))</div><div class="line">listItems!!.add(ListItem(&quot;chapter5&quot;, &quot;Scroll Analysis&quot;))</div><div class="line">listItems!!.add(ListItem(&quot;chapter6&quot;, &quot;Draw&quot;))</div><div class="line">listItems!!.add(ListItem(&quot;chapter7&quot;, &quot;Animation Demo&quot;))</div></pre></td></tr></table></figure></p>
<p>在这里不知道?. 和 !!. 到底有什么区别.有待深入研究,这时候要知道该这么用就够了<br>最后就是这样使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">val recyclerView = findViewById(R.id.id_main_recycler_view) as RecyclerView</div><div class="line">val recyclerViewAdapter = MyRecyclerViewAdapter(this,listItems)</div><div class="line">recyclerView.layoutManager = LinearLayoutManager(this)</div><div class="line">recyclerView.adapter = recyclerViewAdapter</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;这里并没有系统的讲解Kotlin语法, 只是在做Demo时候刻意使用Kotlin语言,并记录一下使用方法&lt;br&gt;如果要学习可以看看官网的文档,以及它推荐的一些书籍&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;Activity&quot;&gt;&lt;a hre
    
    </summary>
    
      <category term="Kotlin" scheme="https://devallever.github.io/categories/Kotlin/"/>
    
    
      <category term="Android" scheme="https://devallever.github.io/tags/Android/"/>
    
      <category term="Kotlin" scheme="https://devallever.github.io/tags/Kotlin/"/>
    
  </entry>
  
  <entry>
    <title>Android 动画 简单使用</title>
    <link href="https://devallever.github.io/2017/05/22/animation-primary/"/>
    <id>https://devallever.github.io/2017/05/22/animation-primary/</id>
    <published>2017-05-22T08:54:53.000Z</published>
    <updated>2017-05-24T07:26:15.204Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>顺便学习一下Kotlin语言</p>
</blockquote>
<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>动画能带来良好的用户体验,作为Android程序员,必须掌握最最最基本的几种动画实现方式,包括透明度,位移,旋转,缩放.</p>
<h1 id="属性动画"><a href="#属性动画" class="headerlink" title="属性动画"></a>属性动画</h1><p>属性动画是Android 3.0推出的动画框架,能实现视图动画所有动画效果,并且能完成视图动画不具备的功能. 例如一个在左上角的按钮使用视图动画将他移动到右下角,点击时候发现原来的点击监听已经不起作用了. 简单说,视图动画仅仅改变了控件的绘制,并没有改变其属性值.如果使用属性动画将它移动,那么原来的监听还是有的,这是真正的移动啊.属性动画就是这么强大  </p>
<p> 属性动画最重要的两个类</p>
<ul>
<li>ValueAnimator</li>
<li>ObjectAnimator</li>
</ul>
<blockquote>
<p>原理:<br>属性动画作用于任何对象, 变化的属性名必须有该对象要有对应的getXXX和setXXX方法.</p>
</blockquote>
<p>下面逐一讲讲</p>
<h2 id="ValueAnimator"><a href="#ValueAnimator" class="headerlink" title="ValueAnimator"></a>ValueAnimator</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">fun startValueAnimation()&#123;</div><div class="line">    val valueAnimator = ValueAnimator.ofFloat(0f,1f)</div><div class="line">    valueAnimator.duration = 3000</div><div class="line">    valueAnimator.repeatCount = 2</div><div class="line">    valueAnimator.repeatMode = ValueAnimator.RESTART    //重复</div><div class="line">    //valueAnimator.repeatMode = ValueAnimator.REVERSE    //倒回</div><div class="line">    valueAnimator.start()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>ofFloat()传入的值类型为float, 表示该值从1f 变化到 3f, 1f是初始值, 3f是最终值, ofFloat()传入的是可变参数, 即可以传入多个值,表示变化过程, 如: ofFloat(1f, 3f, 2f, 5f), 这里逐步并不是一下子从1f直接变化到3f,而是有个过程,每个过程值都不一样,</li>
<li>也许这里看不到变化, 但是动画所设置的值是变化了的,</li>
</ul>
<h2 id="ObjectAnimator"><a href="#ObjectAnimator" class="headerlink" title="ObjectAnimator"></a>ObjectAnimator</h2><p>ObjectAnimator继承了ValueAnimator, 所以可以使用父类方法对动画进行一些通用设置, 不同的是创建ObjectAnimator对象</p>
<h3 id="透明动画"><a href="#透明动画" class="headerlink" title="透明动画"></a>透明动画</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">fun startAlpha(view: View)&#123;</div><div class="line">        val alphaAnimator = ObjectAnimator.ofFloat(view,&quot;alpha&quot;, 1f,0f,1f)</div><div class="line">        alphaAnimator.duration = 1000</div><div class="line">        alphaAnimator.start()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>view: 动画作用的对象</li>
<li>“alpha”: 值变化属性名, 及view对象中必须要有getAlpha()和serAlpha()方法,</li>
<li>1f,0f,1f: 表示变化过程, 不透明-&gt;全透明-&gt;不透明</li>
</ul>
<h3 id="旋转动画"><a href="#旋转动画" class="headerlink" title="旋转动画"></a>旋转动画</h3><p>如旋转30度:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">fun startRotate(view: View)&#123;</div><div class="line">        val rotateAnimator = ObjectAnimator.ofFloat(view,&quot;rotation&quot;, 0f,360f)</div><div class="line">        rotateAnimator.duration = 1000</div><div class="line">        rotateAnimator.start()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="位移动画"><a href="#位移动画" class="headerlink" title="位移动画"></a>位移动画</h3><h4 id="X轴位移"><a href="#X轴位移" class="headerlink" title="X轴位移"></a>X轴位移</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">fun startTranslateX(view: View)&#123;</div><div class="line">        val currentX: Float= view.translationX</div><div class="line">        val translateXAnimator = ObjectAnimator.ofFloat(view,&quot;translationX&quot;,currentX,-500f,currentX,500f,currentX)</div><div class="line">        translateXAnimator.duration = 1000</div><div class="line">        translateXAnimator.start()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>currentX: view原来的X坐标值</li>
<li>动画过程,从原来位置开始,左移500像素,回到原来位置,右移500像素,回到原来位置<h4 id="Y轴位移"><a href="#Y轴位移" class="headerlink" title="Y轴位移"></a>Y轴位移</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">fun startTranslateY(view: View)&#123;</div><div class="line">        val currentY: Float= view.translationY</div><div class="line">        val translateYAnimator = ObjectAnimator.ofFloat(view,&quot;translationY&quot;,currentY,-500f,currentY,500f,currentY)</div><div class="line">        translateYAnimator.duration = 1000</div><div class="line">        translateYAnimator.start()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="缩放动画"><a href="#缩放动画" class="headerlink" title="缩放动画"></a>缩放动画</h3><p>同样，支持Ｘ方向　和Ｙ方向</p>
<h4 id="X轴缩放"><a href="#X轴缩放" class="headerlink" title="X轴缩放"></a>X轴缩放</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">fun startScaleX(view: View)&#123;</div><div class="line">        val scaleXAnimator = ObjectAnimator.ofFloat(view,&quot;scaleX&quot;,1F,3F,1F)</div><div class="line">        scaleXAnimator.duration = 1000</div><div class="line">        scaleXAnimator.start()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="动画集合"><a href="#动画集合" class="headerlink" title="动画集合"></a>动画集合</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">fun startAnimatorSet(view: View)&#123;</div><div class="line">        val animatorSet = AnimatorSet()</div><div class="line"></div><div class="line">        val alphaAnimator = ObjectAnimator.ofFloat(view,&quot;alpha&quot;, 1f,0f,1f)</div><div class="line"></div><div class="line">        val rotateAnimator = ObjectAnimator.ofFloat(view,&quot;rotation&quot;, 0f,360f)</div><div class="line"></div><div class="line">        val scaleXAnimator = ObjectAnimator.ofFloat(view,&quot;scaleX&quot;,1F,3F,1F)</div><div class="line"></div><div class="line">        animatorSet.play(alphaAnimator).after(rotateAnimator).after(scaleXAnimator)</div><div class="line">        animatorSet.duration = 2000</div><div class="line">        animatorSet.start()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="使用XML动画"><a href="#使用XML动画" class="headerlink" title="使用XML动画"></a>使用XML动画</h2><p>在res建立animator文件夹<br>在animator下创建动画的xml文件,如:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;set xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:ordering=&quot;sequentially&quot;&gt;</div><div class="line">    &lt;objectAnimator</div><div class="line">        android:propertyName=&quot;alpha&quot;</div><div class="line">        android:duration=&quot;500&quot;</div><div class="line">        android:valueFrom=&quot;1&quot;</div><div class="line">        android:valueTo=&quot;0&quot;</div><div class="line">        android:valueType=&quot;floatType&quot;&gt;</div><div class="line">    &lt;/objectAnimator&gt;</div><div class="line"></div><div class="line">    &lt;objectAnimator</div><div class="line">        android:propertyName=&quot;alpha&quot;</div><div class="line">        android:duration=&quot;500&quot;</div><div class="line">        android:valueFrom=&quot;0&quot;</div><div class="line">        android:valueTo=&quot;1&quot;</div><div class="line">        android:valueType=&quot;floatType&quot;&gt;</div><div class="line">    &lt;/objectAnimator&gt;</div><div class="line">    &lt;set</div><div class="line">        android:ordering=&quot;together&quot;&gt;</div><div class="line">        &lt;objectAnimator</div><div class="line">            android:propertyName=&quot;rotation&quot;</div><div class="line">            android:duration=&quot;1000&quot;</div><div class="line">            android:valueFrom=&quot;0&quot;</div><div class="line">            android:valueTo=&quot;360&quot;</div><div class="line">            android:valueType=&quot;floatType&quot;&gt;</div><div class="line">        &lt;/objectAnimator&gt;</div><div class="line">        &lt;set</div><div class="line">            android:ordering=&quot;sequentially&quot;&gt;</div><div class="line">            &lt;objectAnimator</div><div class="line">                android:propertyName=&quot;scaleY&quot;</div><div class="line">                android:duration=&quot;500&quot;</div><div class="line">                android:valueFrom=&quot;1&quot;</div><div class="line">                android:valueTo=&quot;3&quot;</div><div class="line">                android:valueType=&quot;floatType&quot;&gt;</div><div class="line">            &lt;/objectAnimator&gt;</div><div class="line">            &lt;objectAnimator</div><div class="line">                android:propertyName=&quot;scaleY&quot;</div><div class="line">                android:duration=&quot;500&quot;</div><div class="line">                android:valueFrom=&quot;3&quot;</div><div class="line">                android:valueTo=&quot;1&quot;</div><div class="line">                android:valueType=&quot;floatType&quot;&gt;</div><div class="line">            &lt;/objectAnimator&gt;</div><div class="line">        &lt;/set&gt;</div><div class="line">    &lt;/set&gt;</div><div class="line">&lt;/set&gt;</div></pre></td></tr></table></figure></p>
<p>在代码中这样调用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">fun startXMLAnimation(view: View)&#123;</div><div class="line">        val animator = AnimatorInflater.loadAnimator(this,R.animator.animator_test)</div><div class="line">        animator.setTarget(view)</div><div class="line">        animator.start()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="视图动画"><a href="#视图动画" class="headerlink" title="视图动画"></a>视图动画</h1><h2 id="透明度动画"><a href="#透明度动画" class="headerlink" title="透明度动画"></a>透明度动画</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 1:不透明</div><div class="line"> * 0:全透明**/</div><div class="line">fun startAlpha()&#123;</div><div class="line">    val alphaAnimation = AlphaAnimation(0f,1f)</div><div class="line">    alphaAnimation.duration = 1000</div><div class="line">    tv_target?.startAnimation(alphaAnimation)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="旋转动画-1"><a href="#旋转动画-1" class="headerlink" title="旋转动画"></a>旋转动画</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 参数1: 开始角</div><div class="line"> * 参数2: 旋转角</div><div class="line"> * 参数3: **/</div><div class="line">fun startRotate()&#123;</div><div class="line">    //val rotateAnimation = RotateAnimation(0f,360f,0f,0f)</div><div class="line"></div><div class="line">    //以自身中心旋转</div><div class="line">    val rotateAnimation = RotateAnimation(</div><div class="line">            0f,360f,</div><div class="line">            RotateAnimation.RELATIVE_TO_SELF,0.5F,</div><div class="line">            RotateAnimation.RELATIVE_TO_SELF,0.5F</div><div class="line">    )</div><div class="line">    rotateAnimation.duration = 1000</div><div class="line">    tv_target?.startAnimation(rotateAnimation)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="位移动画-1"><a href="#位移动画-1" class="headerlink" title="位移动画"></a>位移动画</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * fromX</div><div class="line"> * toX</div><div class="line"> * fromY</div><div class="line"> * toY**/</div><div class="line">fun startTranslate()&#123;</div><div class="line">    val translateAnimation = TranslateAnimation(0f,200f,0f,300f)</div><div class="line">    translateAnimation.duration = 1000</div><div class="line">    tv_target?.startAnimation(translateAnimation)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="缩放动画-1"><a href="#缩放动画-1" class="headerlink" title="缩放动画"></a>缩放动画</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * fromX</div><div class="line"> * toX</div><div class="line"> * fromY</div><div class="line"> * toY**/</div><div class="line">fun startScale()&#123;</div><div class="line">    //val scaleAnimation = ScaleAnimation(0f,2f,0f,2f)</div><div class="line">    //设置中心点缩放</div><div class="line">    val scaleAnimation = ScaleAnimation(0f,2f,0f,2f,</div><div class="line">            ScaleAnimation.RELATIVE_TO_SELF,0.5F,</div><div class="line">            ScaleAnimation.RELATIVE_TO_SELF,0.5F)</div><div class="line">    scaleAnimation.duration = 1000</div><div class="line">    tv_target?.startAnimation(scaleAnimation)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="SVG动画"><a href="#SVG动画" class="headerlink" title="SVG动画"></a>SVG动画</h1><p>使用步骤</p>
<h2 id="创建静态SVG图形"><a href="#创建静态SVG图形" class="headerlink" title="创建静态SVG图形"></a>创建静态SVG图形</h2><p>在drawable的资源文件夹下创建xml文件,line_svg_vector.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;vector xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:height=&quot;200dp&quot;</div><div class="line">    android:width=&quot;200dp&quot;</div><div class="line">    android:viewportHeight=&quot;100&quot;</div><div class="line">    android:viewportWidth=&quot;100&quot;&gt;</div><div class="line">    &lt;group&gt;</div><div class="line">        &lt;path</div><div class="line">            android:name=&quot;path1&quot;</div><div class="line">            android:strokeColor=&quot;#3F51B5&quot;</div><div class="line">            android:strokeWidth=&quot;5&quot;</div><div class="line">            android:strokeLineCap=&quot;round&quot;</div><div class="line">            android:pathData=&quot;M 20,80</div><div class="line">                              L 50,80,80,80&quot;/&gt;</div><div class="line"></div><div class="line">        &lt;path</div><div class="line">            android:name=&quot;path2&quot;</div><div class="line">            android:strokeColor=&quot;#3F51B5&quot;</div><div class="line">            android:strokeWidth=&quot;5&quot;</div><div class="line">            android:strokeLineCap=&quot;round&quot;</div><div class="line">            android:pathData=&quot;M 20,20</div><div class="line">                              L 50,20,80,20&quot;/&gt;</div><div class="line">    &lt;/group&gt;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">&lt;/vector&gt;</div></pre></td></tr></table></figure></p>
<h2 id="创建动画资源xml文件"><a href="#创建动画资源xml文件" class="headerlink" title="创建动画资源xml文件"></a>创建动画资源xml文件</h2><p>在animator下创建, 每个图形都要有一个动画过程<br>line_path_1.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;objectAnimator</div><div class="line">    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:interpolator=&quot;@android:anim/bounce_interpolator&quot;</div><div class="line">    android:duration=&quot;500&quot;</div><div class="line">    android:propertyName=&quot;pathData&quot;</div><div class="line">    android:valueFrom=&quot;M 20,80 L 50,80,80,80&quot;</div><div class="line">    android:valueTo=&quot;M 20,80 L 50,50,80,80&quot;</div><div class="line">    android:valueType=&quot;pathType&quot;</div><div class="line">    &gt;</div><div class="line"></div><div class="line">&lt;/objectAnimator&gt;</div></pre></td></tr></table></figure></p>
<p>line_path_2.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;objectAnimator</div><div class="line">    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:interpolator=&quot;@android:anim/bounce_interpolator&quot;</div><div class="line">    android:duration=&quot;500&quot;</div><div class="line">    android:propertyName=&quot;pathData&quot;</div><div class="line">    android:valueFrom=&quot;M 20,20 L 50,20,80,20&quot;</div><div class="line">    android:valueTo=&quot;M 20,20 L 50,50,80,20&quot;</div><div class="line">    android:valueType=&quot;pathType&quot;</div><div class="line">    &gt;</div><div class="line"></div><div class="line">&lt;/objectAnimator&gt;</div></pre></td></tr></table></figure></p>
<h2 id="把静态SVG和动画资源联合起来"><a href="#把静态SVG和动画资源联合起来" class="headerlink" title="把静态SVG和动画资源联合起来"></a>把静态SVG和动画资源联合起来</h2><p>在drawable-v21目录下创建xml文件:line_animated_vector.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;animated-vector</div><div class="line">    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:drawable=&quot;@drawable/line_svg_vector&quot;&gt;</div><div class="line">    &lt;target</div><div class="line">        android:animation=&quot;@animator/line_path_1&quot;</div><div class="line">        android:name=&quot;path1&quot;/&gt;</div><div class="line">    &lt;target</div><div class="line">        android:animation=&quot;@animator/line_path_2&quot;</div><div class="line">        android:name=&quot;path2&quot;/&gt;</div><div class="line"></div><div class="line">&lt;/animated-vector&gt;</div></pre></td></tr></table></figure></p>
<h2 id="使用SVG资源"><a href="#使用SVG资源" class="headerlink" title="使用SVG资源"></a>使用SVG资源</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:orientation=&quot;vertical&quot; android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;&gt;</div><div class="line"></div><div class="line">    &lt;ImageView</div><div class="line">        android:id=&quot;@+id/id_svg_animation_activity_iv_line_svg&quot;</div><div class="line">        android:layout_width=&quot;150dp&quot;</div><div class="line">        android:layout_height=&quot;150dp&quot;</div><div class="line">        android:layout_gravity=&quot;center_horizontal&quot;</div><div class="line">        android:src=&quot;@drawable/line_animated_vector&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;ImageView</div><div class="line">        android:id=&quot;@+id/id_svg_animation_activity_iv_sun_system_svg&quot;</div><div class="line">        android:layout_width=&quot;150dp&quot;</div><div class="line">        android:layout_height=&quot;150dp&quot;</div><div class="line">        android:layout_gravity=&quot;center_horizontal&quot;</div><div class="line">        android:src=&quot;@drawable/sun_system_animated_vector&quot;/&gt;</div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure>
<h2 id="开启动画"><a href="#开启动画" class="headerlink" title="开启动画"></a>开启动画</h2><p>点击时候开启动画<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">fun startLineSVGAnimation(imageView: ImageView)&#123;</div><div class="line">        val drawable = imageView.drawable</div><div class="line">        (drawable as Animatable).start()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>kotlin语言</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;顺便学习一下Kotlin语言&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h1&gt;&lt;p&gt;动画能带来良好的用户体验,作为Androi
    
    </summary>
    
      <category term="Android" scheme="https://devallever.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://devallever.github.io/tags/Android/"/>
    
      <category term="Animation" scheme="https://devallever.github.io/tags/Animation/"/>
    
  </entry>
  
  <entry>
    <title>Hello Kotlin</title>
    <link href="https://devallever.github.io/2017/05/21/hello-kotlin/"/>
    <id>https://devallever.github.io/2017/05/21/hello-kotlin/</id>
    <published>2017-05-21T09:26:42.000Z</published>
    <updated>2017-05-21T10:03:42.521Z</updated>
    
    <content type="html"><![CDATA[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iNDA1cHgiIGhlaWdodD0iNDAwcHgiIHZpZXdCb3g9IjAgMCA0MDUgNDAwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPCEtLSBHZW5lcmF0b3I6IFNrZXRjaCA0My4xICgzOTAxMikgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+U2xpY2U8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZGVmcz4KICAgICAgICA8bGluZWFyR3JhZGllbnQgeDE9IjAlIiB5MT0iNC42NTI1NTk0NiUiIHgyPSI2NC42NTA0NTElIiB5Mj0iNjIuNTEwODM2NCUiIGlkPSJsaW5lYXJHcmFkaWVudC0xIj4KICAgICAgICAgICAgPHN0b3Agc3RvcC1jb2xvcj0iI0ZGRkZGRiIgc3RvcC1vcGFjaXR5PSIwLjIiIG9mZnNldD0iMCUiPjwvc3RvcD4KICAgICAgICAgICAgPHN0b3Agc3RvcC1jb2xvcj0iI0ZGRkZGRiIgc3RvcC1vcGFjaXR5PSIwIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD4KICAgICAgICA8L2xpbmVhckdyYWRpZW50PgogICAgICAgIDxwYXRoIGQ9Ik0xLjM5OTcxNDYzLDY4LjYxNTI2NTcgTDAuMzgxNzQwMzUzLDY4Ljk5NjQ2MTcgTDUyLjI5ODQyODMsMjA4LjUxNDE2OSBDNTYuNjI0ODE5LDIyMC4yMDQxNzcgNjkuMzQ5NDk3NCwyMjYuMzAzMzEyIDgwLjY3NDQ2MTIsMjIyLjExMDE1NiBMOTcuOTgwMDIzOSwyMTUuNzU2ODkxIEwxMDIuNjg4MTU1LDIyOC40NjM0MjIgTDExNi4wNDkwNjcsMjY0LjQyMjkwNCBDMTIwLjM3NTQ1OCwyNzYuMTEyOTEyIDEzMy4xMDAxMzYsMjgyLjIxMjA0NyAxNDQuNDI1MSwyNzguMDE4ODkyIEMxNTUuNzUwMDY0LDI3My44MjU3MzYgMTYxLjM0ODkyMiwyNjAuOTkyMTQgMTU3LjAyMjUzMiwyNDkuMzAyMTMyIEwxNDMuNjYxNjE5LDIxMy4zNDI2NSBMMTM4Ljk1MzQ4OCwyMDAuNjM2MTIgTDE2Ni45NDc3ODEsMTkwLjIxNjc2NCBMMTcxLjY1NTkxMiwyMDIuOTIzMjk1IEwxODUuMDE2ODI0LDIzOC44ODI3NzcgQzE4OS4zNDMyMTUsMjUwLjU3Mjc4NSAyMDIuMDY3ODkzLDI1Ni42NzE5MiAyMTMuMzkyODU3LDI1Mi40Nzg3NjUgQzIyNC43MTc4MjEsMjQ4LjI4NTYxIDIzMC4zMTY2NzksMjM1LjQ1MjAxNCAyMjUuOTkwMjg5LDIyMy43NjIwMDUgTDIxMi41MDIxMywxODcuNjc1NDU4IEwyMDcuNzkzOTk5LDE3NC45Njg5MjggTDIyNS4wOTk1NjEsMTY4LjYxNTY2MiBDMjM2LjI5NzI3OCwxNjQuNDIyNTA3IDI0Mi4wMjMzODQsMTUxLjQ2MTg0NiAyMzcuNjk2OTkzLDEzOS44OTg5MDMgTDE4NS43ODAzMDUsMC4zODExOTU5MjEgTDE4NS4zOTg1NjUsMC41MDgyNjEyMjggTDEuMzk5NzE0NjMsNjguNjE1MjY1NyBMMS4zOTk3MTQ2Myw2OC42MTUyNjU3IFoiIGlkPSJwYXRoLTIiPjwvcGF0aD4KICAgICAgICA8bGluZWFyR3JhZGllbnQgeDE9IjYwLjg0NzM3NjElIiB5MT0iLTYuNTE0NDYwMTUlIiB4Mj0iNDEuNzE2Njc0NiUiIHkyPSIxMTcuODg5ODg3JSIgaWQ9ImxpbmVhckdyYWRpZW50LTQiPgogICAgICAgICAgICA8c3RvcCBzdG9wLWNvbG9yPSIjMDAwMDAwIiBzdG9wLW9wYWNpdHk9IjAuNSIgb2Zmc2V0PSIwJSI+PC9zdG9wPgogICAgICAgICAgICA8c3RvcCBzdG9wLWNvbG9yPSIjMDAwMDAwIiBzdG9wLW9wYWNpdHk9IjAiIG9mZnNldD0iMTAwJSI+PC9zdG9wPgogICAgICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICAgICAgPGxpbmVhckdyYWRpZW50IHgxPSI0NC4xMTA2ODMzJSIgeTE9IjE0Ni41NTkxMzYlIiB4Mj0iNTYuMDAwOTc0JSIgeTI9IjUyLjM4MTM5NTMlIiBpZD0ibGluZWFyR3JhZGllbnQtNSI+CiAgICAgICAgICAgIDxzdG9wIHN0b3AtY29sb3I9IiMwMDk1RDUiIG9mZnNldD0iOS42NzclIj48L3N0b3A+CiAgICAgICAgICAgIDxzdG9wIHN0b3AtY29sb3I9IiMyMzhBRDkiIG9mZnNldD0iMzAuMDclIj48L3N0b3A+CiAgICAgICAgICAgIDxzdG9wIHN0b3AtY29sb3I9IiM1NTdCREUiIG9mZnNldD0iNjIuMTElIj48L3N0b3A+CiAgICAgICAgICAgIDxzdG9wIHN0b3AtY29sb3I9IiM3NDcyRTIiIG9mZnNldD0iODYuNDMlIj48L3N0b3A+CiAgICAgICAgICAgIDxzdG9wIHN0b3AtY29sb3I9IiM4MDZFRTMiIG9mZnNldD0iMTAwJSI+PC9zdG9wPgogICAgICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICAgICAgPGxpbmVhckdyYWRpZW50IHgxPSIxMy45ODQwNTMyJSIgeTE9IjM4LjkzOTEwNjYlIiB4Mj0iNjguNjgyMzkyJSIgeTI9Ii00LjUxNDAwNzMlIiBpZD0ibGluZWFyR3JhZGllbnQtNiI+CiAgICAgICAgICAgIDxzdG9wIHN0b3AtY29sb3I9IiMwMDk1RDUiIG9mZnNldD0iMTEuODMlIj48L3N0b3A+CiAgICAgICAgICAgIDxzdG9wIHN0b3AtY29sb3I9IiMzQzgzREMiIG9mZnNldD0iNDEuNzglIj48L3N0b3A+CiAgICAgICAgICAgIDxzdG9wIHN0b3AtY29sb3I9IiM2RDc0RTEiIG9mZnNldD0iNjkuNjIlIj48L3N0b3A+CiAgICAgICAgICAgIDxzdG9wIHN0b3AtY29sb3I9IiM4MDZFRTMiIG9mZnNldD0iODMuMzMlIj48L3N0b3A+CiAgICAgICAgPC9saW5lYXJHcmFkaWVudD4KICAgICAgICA8bGluZWFyR3JhZGllbnQgeDE9Ii0xNi44MzYxNjY3JSIgeTE9IjkxLjkzOTY2NjclIiB4Mj0iNzYuMjE5MTY2NyUiIHkyPSItMS4xMTU2NjY2NyUiIGlkPSJsaW5lYXJHcmFkaWVudC03Ij4KICAgICAgICAgICAgPHN0b3Agc3RvcC1jb2xvcj0iI0M3NTdCQyIgb2Zmc2V0PSIxMC43NSUiPjwvc3RvcD4KICAgICAgICAgICAgPHN0b3Agc3RvcC1jb2xvcj0iI0QwNjA5QSIgb2Zmc2V0PSIyMS4zOCUiPjwvc3RvcD4KICAgICAgICAgICAgPHN0b3Agc3RvcC1jb2xvcj0iI0UxNzI1QyIgb2Zmc2V0PSI0Mi41NCUiPjwvc3RvcD4KICAgICAgICAgICAgPHN0b3Agc3RvcC1jb2xvcj0iI0VFN0UyRiIgb2Zmc2V0PSI2MC40OCUiPjwvc3RvcD4KICAgICAgICAgICAgPHN0b3Agc3RvcC1jb2xvcj0iI0Y1ODYxMyIgb2Zmc2V0PSI3NC4zJSI+PC9zdG9wPgogICAgICAgICAgICA8c3RvcCBzdG9wLWNvbG9yPSIjRjg4OTA5IiBvZmZzZXQ9IjgyLjMyJSI+PC9zdG9wPgogICAgICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICAgICAgPHBhdGggZD0iTTE0Ni44NTg3NDMsMjMuMDU5MDA5OCBDMTQ3LjAyMDQ0LDM1LjY5MjIwMjQgMTM2LjU4NjI4LDQ2LjA3MzU4MTYgMTIzLjQ5NTQ0MSw0Ni4yMTAzMjk4IEw4My4zODI5NDQzLDQ2LjU4MzEzMTcgTDY0LjQ4NTk1MjcsNDYuNzE1Mjg0MSBMMjQuMzczNDU1Nyw0Ny4wODgwODYxIEMxMS4yODI2MTc1LDQ3LjIyNDgzNDIgMC42Mjg5ODI0NTEsMzcuMDQ3NDI4MSAwLjQzMDQyMzM0MSwyNC4yODU0ODUyIEMwLjI2ODcyNjIxOSwxMS42NTIyOTI3IDEwLjcwMjg4NjgsMS4yNzA5MTM0NSAyMy43OTM3MjUsMS4xMzQxNjUzNCBMNjMuOTA2MjIyLDAuNzYxMzYzMzYyIEw4Mi44MDMyMTM3LDAuNjI5MjExMDA3IEwxMjIuOTE1NzExLDAuMjU2NDA5MDMyIEMxMzYuMTcxMTIxLDAuMjExNzM0ODg3IDE0Ni44MjQ3NTYsMTAuMzg5MTQwOSAxNDYuODU4NzQzLDIzLjA1OTAwOTgiIGlkPSJwYXRoLTgiPjwvcGF0aD4KICAgICAgICA8bGluZWFyR3JhZGllbnQgeDE9IjIzLjIxNjE3OTYlIiB5MT0iMCUiIHgyPSI4My4yNTY4NDQ5JSIgeTI9Ijc0LjAyMzU5NTklIiBpZD0ibGluZWFyR3JhZGllbnQtMTAiPgogICAgICAgICAgICA8c3RvcCBzdG9wLWNvbG9yPSIjRkZGRkZGIiBzdG9wLW9wYWNpdHk9IjAuMiIgb2Zmc2V0PSIwJSI+PC9zdG9wPgogICAgICAgICAgICA8c3RvcCBzdG9wLWNvbG9yPSIjRkZGRkZGIiBzdG9wLW9wYWNpdHk9IjAiIG9mZnNldD0iMTAwJSI+PC9zdG9wPgogICAgICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICA8L2RlZnM+CiAgICA8ZyBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0ia290bGluLWFuZHJvaWQiPgogICAgICAgICAgICA8ZyBpZD0iR3JvdXAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEzOS4wMDAwMDAsIDE0OC4wMDAwMDApIj4KICAgICAgICAgICAgICAgIDxnIGlkPSJSZWN0YW5nbGUtMyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMS4wMDAwMDAsIDAuMDAwMDAwKSIgZmlsbC1ydWxlPSJub256ZXJvIj4KICAgICAgICAgICAgICAgICAgICA8ZyBpZD0iTWFzayIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTI1LjMzNjE3OCwgMTIzLjAwMDAwMCkgc2NhbGUoLTEsIDEpIHRyYW5zbGF0ZSgtMTI1LjMzNjE3OCwgLTEyMy4wMDAwMDApIHRyYW5zbGF0ZSgwLjMzNjE3OCwgMC4wMDAwMDApIiBmaWxsPSIjOTRDNjU0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTI0OS42MDc3ODksMjQ2IEMyNDkuMzgxMTk5LDI0NC45ODc2NjcgMjQ5LjA4MjY2NCwyNDMuOTc5MjExIDI0OC43MDkyMzYsMjQyLjk4MTE2OCBMMTk2Ljc5MjU0OCwxMDMuNDYzNDYxIEwxOTYuNDEwODA3LDEwMy41OTA1MjYgTDEyLjQxMTk1NzUsMTcxLjY5NzUzIEwxMi40MTE5NTc1LDE3MS42OTc1MyBMMTEuMzkzOTgzMiwxNzIuMDc4NzI2IEwzOC45MDEyMjc5LDI0NiBMMjQ5LjYwNzc4OSwyNDYgWiBNMTkzLjczODYyNSw5Ni4wOTM2NzI4IEwxODkuOTIxMjIxLDg1LjkyODQ0ODMgQzE4OC42NDg3NTQsODMuMTMzMDExNSAxODcuMTIxNzkyLDgwLjQ2NDY0MDEgMTg1LjQ2NzU4NCw3Ny43OTYyNjg2IEMxNzEuMjE1OTQ0LDU0LjkyNDUxMzQgMTQ2LjY1NzMxNSw0MC4wNTc4NzI1IDExOS4wNDQ3NjMsMzYuMzcyOTc4NiBMMTIzLjExNjY2LDQuMjI1NDU1OTIgQzEyMy4zNzExNTMsMi4xOTI0MTEwMSAxMjEuOTcxNDM5LDAuNDEzNDk2NzEzIDEyMC4wNjI3MzcsMC4wMzIzMDA3OTI2IEMxMTguMTU0MDM1LC0wLjIyMTgyOTgyMSAxMTYuMzcyNTgsMS4wNDg4MjMyNSAxMTYuMTE4MDg3LDIuOTU0ODAyODUgTDExNi4xMTgwODcsMy4wODE4NjgxNiBMMTExLjkxODk0MywzNS43Mzc2NTIgQzgyLjAxNTk0ODUsMzMuOTU4NzM3NyA1Mi43NDkxODgxLDQ0Ljg4NjM1NDEgMzEuMjQ0NDgxNiw2NS43MjUwNjQ1IEw2LjY4NTg1MjIsNDMuNjE1NzAxMSBDNS4yODYxMzc1OCw0Mi4zNDUwNDggMy4xMjI5NDIyNCw0Mi4zNDUwNDggMS43MjMyMjc2Miw0My43NDI3NjY0IEwxLjU5NTk4MDgzLDQzLjg2OTgzMTcgQzAuMzIzNTEyOTkxLDQ1LjM5NDYxNTQgMC40NTA3NTk3NzUsNDcuNjgxNzkwOSAxLjk3NzcyMTE5LDQ5LjA3OTUwOTMgTDI2LjQwOTEwMzgsNzAuODA3Njc2NyBDOC44NDkwNDc1Myw5MC42Mjk4NjQ2IC0wLjA1ODIyNzM2MTcsMTE2LjQyNDEyMiAyLjk5NTY5NTQ2LDE0MS45NjQyNDkgQzMuNzU5MTc2MTcsMTQ4LjY5ODcxIDUuNDEzMzg0MzYsMTU1LjMwNjEwNiA3LjcwMzgyNjQ4LDE2MS42NTkzNzEgQzguMDg1NTY2ODMsMTYyLjY3NTg5NCA4LjQ2NzMwNzE4LDE2My41NjUzNTEgOC44NDkwNDc1MywxNjQuNTgxODczIEwxOTMuNzM4NjI1LDk2LjA5MzY3MjggTDE5My43Mzg2MjUsOTYuMDkzNjcyOCBaIE0xMjQuMTM0NjM0LDYyLjkyOTYyNzcgQzEyOS4wOTcyNTksNjAuODk2NTgyOCAxMzQuNjk2MTE3LDYzLjMxMDgyMzYgMTM2LjczMjA2Niw2OC4xMzkzMDUzIEMxMzguNzY4MDE0LDcyLjk2Nzc4NyAxMzYuMzUwMzI1LDc4LjY4NTcyNTggMTMxLjUxNDk0OCw4MC43MTg3NzA3IEMxMjYuNjc5NTcsODIuNzUxODE1NiAxMjAuOTUzNDY0LDgwLjMzNzU3NDggMTE4LjkxNzUxNiw3NS41MDkwOTMxIEMxMTguOTE3NTE2LDc1LjM4MjAyNzggMTE4Ljc5MDI2OSw3NS4yNTQ5NjI1IDExOC43OTAyNjksNzUuMjU0OTYyNSBDMTE2Ljg4MTU2Nyw3MC4yOTk0MTU1IDExOS4yOTkyNTYsNjQuNzA4NTQyIDEyNC4xMzQ2MzQsNjIuOTI5NjI3NyBaIE0zOS44OTcyNjI5LDk0LjE4NzY5MzIgQzQ0Ljg1OTg4NzUsOTIuMTU0NjQ4MyA1MC40NTg3NDYsOTQuNTY4ODg5MSA1Mi40OTQ2OTQ1LDk5LjM5NzM3MDggQzU0LjUzMDY0MzEsMTA0LjIyNTg1MiA1Mi4xMTI5NTQyLDEwOS45NDM3OTEgNDcuMjc3NTc2NCwxMTEuOTc2ODM2IEM0Mi4zMTQ5NTE4LDExNC4wMDk4ODEgMzYuNzE2MDkzMywxMTEuNTk1NjQgMzQuNjgwMTQ0NywxMDYuNzY3MTU5IEMzNC42ODAxNDQ3LDEwNi42NDAwOTMgMzQuNTUyODk3OSwxMDYuNTEzMDI4IDM0LjU1Mjg5NzksMTA2LjUxMzAyOCBDMzIuNjQ0MTk2MiwxMDEuNTU3NDgxIDM0LjkzNDYzODMsOTYuMDkzNjcyOCAzOS44OTcyNjI5LDk0LjE4NzY5MzIgWiIgaWQ9InBhdGgtMSI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgICAgICAgICA8ZyBpZD0iQ2xpcHBlZCIgZmlsbD0idXJsKCNsaW5lYXJHcmFkaWVudC0xKSIgb3BhY2l0eT0iMC43MDgwNTAyNzIiPgogICAgICAgICAgICAgICAgICAgICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlLXBhdGgiIHN0eWxlPSJtaXgtYmxlbmQtbW9kZTogZGFya2VuOyIgeD0iNDQuODcxNzk0OSIgeT0iLTMuMjAwNTU3MSIgd2lkdGg9IjIwNy4yNjQ5NTciIGhlaWdodD0iMjE3LjYzNzg4MyI+PC9yZWN0PgogICAgICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgICAgIDxnIGlkPSJDbGlwcGVkIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMjAuNDI4MDQ2LCAyNDIuOTIyODk5KSBzY2FsZSgtMSwgMSkgdHJhbnNsYXRlKC0xMjAuNDI4MDQ2LCAtMjQyLjkyMjg5OSkgdHJhbnNsYXRlKDAuNDI4MDQ2LCAxMDIuOTIyODk5KSI+CiAgICAgICAgICAgICAgICAgICAgPGcgaWQ9IkNvbWJpbmVkLVNoYXBlLUNsaXBwZWQiPgogICAgICAgICAgICAgICAgICAgICAgICA8bWFzayBpZD0ibWFzay0zIiBmaWxsPSJ3aGl0ZSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dXNlIHhsaW5rOmhyZWY9IiNwYXRoLTIiPjwvdXNlPgogICAgICAgICAgICAgICAgICAgICAgICA8L21hc2s+CiAgICAgICAgICAgICAgICAgICAgICAgIDxnIGlkPSJwYXRoLTQiPjwvZz4KICAgICAgICAgICAgICAgICAgICAgICAgPHBvbHlnb24gaWQ9IkNvbWJpbmVkLVNoYXBlIiBmaWxsLW9wYWNpdHk9IjAuNjI5OTk5OTk1IiBmaWxsPSJ1cmwoI2xpbmVhckdyYWRpZW50LTQpIiBmaWxsLXJ1bGU9Im5vbnplcm8iIG1hc2s9InVybCgjbWFzay0zKSIgcG9pbnRzPSIyMzYuMzQ4ODAzIDE0My45NjE1MDMgMTc3LjE1ODgxNSAtMS4wMzg0OTc0OSA2Mi44NDI1NzYgMzYuMzAxMzM1NCAtODcuNzk4NDQ5NiAxNzkuMjU5NTUzIDE2LjEzNzQ0NzggMTc5Ljc0OTg4OCAxNi4xMzc0NDc4IDE0My45NjE1MDMiPjwvcG9seWdvbj4KICAgICAgICAgICAgICAgICAgICA8L2c+CiAgICAgICAgICAgICAgICA8L2c+CiAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgPGcgaWQ9ImxvZ28tKDEpIiBmaWxsLXJ1bGU9Im5vbnplcm8iPgogICAgICAgICAgICAgICAgPHBvbHlnb24gaWQ9IlhNTElEXzJfIiBmaWxsPSJ1cmwoI2xpbmVhckdyYWRpZW50LTUpIiBwb2ludHM9IjAgNDAwIDIwMC42NjY2NjcgMTk5LjMzMzMzMyA0MDAgNDAwIj48L3BvbHlnb24+CiAgICAgICAgICAgICAgICA8cG9seWdvbiBpZD0iU2hhcGUiIGZpbGw9InVybCgjbGluZWFyR3JhZGllbnQtNikiIHBvaW50cz0iMCAwIDIwMC42NjY2NjcgMCAwIDIxNi42NjY2NjciPjwvcG9seWdvbj4KICAgICAgICAgICAgICAgIDxwb2x5Z29uIGlkPSJTaGFwZSIgZmlsbD0idXJsKCNsaW5lYXJHcmFkaWVudC03KSIgcG9pbnRzPSIyMDAuNjY2NjY3IDAgMCAyMTEuMzMzMzMzIDAgNDAwIDIwMC42NjY2NjcgMTk5LjMzMzMzMyA0MDAgMCI+PC9wb2x5Z29uPgogICAgICAgICAgICA8L2c+CiAgICAgICAgICAgIDxnIGlkPSJSZWN0YW5nbGUtMyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzMwLjcwNjYzOCwgMzU2LjY0MDQ4Nykgcm90YXRlKDAuNTAwMDAwKSB0cmFuc2xhdGUoLTMzMC43MDY2MzgsIC0zNTYuNjQwNDg3KSB0cmFuc2xhdGUoMjU3LjIwNjYzOCwgMzMyLjY0MDQ4NykiPgogICAgICAgICAgICAgICAgPGcgaWQ9Ik1hc2siPgogICAgICAgICAgICAgICAgICAgIDxnIGlkPSJwYXRoLTEwLWxpbmsiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0iIzAwMDAwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNDYuODU4NzQzLDIzLjA1OTAwOTggQzE0Ny4wMjA0NCwzNS42OTIyMDI0IDEzNi41ODYyOCw0Ni4wNzM1ODE2IDEyMy40OTU0NDEsNDYuMjEwMzI5OCBMODMuMzgyOTQ0Myw0Ni41ODMxMzE3IEw2NC40ODU5NTI3LDQ2LjcxNTI4NDEgTDI0LjM3MzQ1NTcsNDcuMDg4MDg2MSBDMTEuMjgyNjE3NSw0Ny4yMjQ4MzQyIDAuNjI4OTgyNDUxLDM3LjA0NzQyODEgMC40MzA0MjMzNDEsMjQuMjg1NDg1MiBDMC4yNjg3MjYyMTksMTEuNjUyMjkyNyAxMC43MDI4ODY4LDEuMjcwOTEzNDUgMjMuNzkzNzI1LDEuMTM0MTY1MzQgTDYzLjkwNjIyMiwwLjc2MTM2MzM2MiBMODIuODAzMjEzNywwLjYyOTIxMTAwNyBMMTIyLjkxNTcxMSwwLjI1NjQwOTAzMiBDMTM2LjE3MTEyMSwwLjIxMTczNDg4NyAxNDYuODI0NzU2LDEwLjM4OTE0MDkgMTQ2Ljg1ODc0MywyMy4wNTkwMDk4IiBpZD0icGF0aC0xMCI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgICAgICAgICA8ZyBpZD0icGF0aC0xMC1saW5rIiBmaWxsPSIjOTNDNjUzIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE0Ni44NTg3NDMsMjMuMDU5MDA5OCBDMTQ3LjAyMDQ0LDM1LjY5MjIwMjQgMTM2LjU4NjI4LDQ2LjA3MzU4MTYgMTIzLjQ5NTQ0MSw0Ni4yMTAzMjk4IEw4My4zODI5NDQzLDQ2LjU4MzEzMTcgTDY0LjQ4NTk1MjcsNDYuNzE1Mjg0MSBMMjQuMzczNDU1Nyw0Ny4wODgwODYxIEMxMS4yODI2MTc1LDQ3LjIyNDgzNDIgMC42Mjg5ODI0NTEsMzcuMDQ3NDI4MSAwLjQzMDQyMzM0MSwyNC4yODU0ODUyIEMwLjI2ODcyNjIxOSwxMS42NTIyOTI3IDEwLjcwMjg4NjgsMS4yNzA5MTM0NSAyMy43OTM3MjUsMS4xMzQxNjUzNCBMNjMuOTA2MjIyLDAuNzYxMzYzMzYyIEw4Mi44MDMyMTM3LDAuNjI5MjExMDA3IEwxMjIuOTE1NzExLDAuMjU2NDA5MDMyIEMxMzYuMTcxMTIxLDAuMjExNzM0ODg3IDE0Ni44MjQ3NTYsMTAuMzg5MTQwOSAxNDYuODU4NzQzLDIzLjA1OTAwOTgiIGlkPSJwYXRoLTEwIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICAgICAgPGcgaWQ9IkNsaXBwZWQiPgogICAgICAgICAgICAgICAgICAgIDxtYXNrIGlkPSJtYXNrLTkiIGZpbGw9IndoaXRlIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHVzZSB4bGluazpocmVmPSIjcGF0aC04Ij48L3VzZT4KICAgICAgICAgICAgICAgICAgICA8L21hc2s+CiAgICAgICAgICAgICAgICAgICAgPGcgaWQ9InBhdGgtMTAiPjwvZz4KICAgICAgICAgICAgICAgICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlLXBhdGgiIGZpbGw9InVybCgjbGluZWFyR3JhZGllbnQtMTApIiBmaWxsLXJ1bGU9Im5vbnplcm8iIG9wYWNpdHk9IjAuOTY2MzE1NjciIG1hc2s9InVybCgjbWFzay05KSIgeD0iLTEyLjkyNTEyODgiIHk9Ii0zNi44MjY1MDkiIHdpZHRoPSIxNTcuMTk3NjUxIiBoZWlnaHQ9IjEzOC4zOTcxODMiPjwvcmVjdD4KICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgPC9nPgogICAgICAgICAgICA8cGF0aCBkPSJNMjU4Ljg3NzY5NSwyMTAuOTI5NjI4IEMyNjMuODQwMzIsMjA4Ljg5NjU4MyAyNjkuNDM5MTc4LDIxMS4zMTA4MjQgMjcxLjQ3NTEyNywyMTYuMTM5MzA1IEMyNzMuNTExMDc2LDIyMC45Njc3ODcgMjcxLjA5MzM4NywyMjYuNjg1NzI2IDI2Ni4yNTgwMDksMjI4LjcxODc3MSBDMjYxLjQyMjYzMSwyMzAuNzUxODE2IDI1NS42OTY1MjYsMjI4LjMzNzU3NSAyNTMuNjYwNTc3LDIyMy41MDkwOTMgQzI1My42NjA1NzcsMjIzLjM4MjAyOCAyNTMuNTMzMzMsMjIzLjI1NDk2MiAyNTMuNTMzMzMsMjIzLjI1NDk2MiBDMjUxLjYyNDYyOSwyMTguMjk5NDE2IDI1NC4wNDIzMTgsMjEyLjcwODU0MiAyNTguODc3Njk1LDIxMC45Mjk2MjggWiIgaWQ9IlBhdGgiIGZpbGw9IiNGRkZGRkYiIGZpbGwtcnVsZT0ibm9uemVybyI+PC9wYXRoPgogICAgICAgICAgICA8cGF0aCBkPSJNMzQzLjE0NzMyNSwyNDIuMTg3NjkzIEMzNDguMTA5OTUsMjQwLjE1NDY0OCAzNTMuNzA4ODA4LDI0Mi41Njg4ODkgMzU1Ljc0NDc1NywyNDcuMzk3MzcxIEMzNTcuNzgwNzA1LDI1Mi4yMjU4NTIgMzU1LjM2MzAxNiwyNTcuOTQzNzkxIDM1MC41Mjc2MzgsMjU5Ljk3NjgzNiBDMzQ1LjU2NTAxNCwyNjIuMDA5ODgxIDMzOS45NjYxNTUsMjU5LjU5NTY0IDMzNy45MzAyMDcsMjU0Ljc2NzE1OSBDMzM3LjkzMDIwNywyNTQuNjQwMDkzIDMzNy44MDI5NiwyNTQuNTEzMDI4IDMzNy44MDI5NiwyNTQuNTEzMDI4IEMzMzUuODk0MjU4LDI0OS41NTc0ODEgMzM4LjE4NDcsMjQ0LjA5MzY3MyAzNDMuMTQ3MzI1LDI0Mi4xODc2OTMgWiIgaWQ9IlBhdGgiIGZpbGw9IiNGRkZGRkYiIGZpbGwtcnVsZT0ibm9uemVybyI+PC9wYXRoPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<blockquote>
<p>在此仅整理所学资料<br><a href="https://www.gitbook.com/book/wangjiegulu/kotlin-for-android-developers-zh/details" target="_blank" rel="external">原文地址: 《Kotlin for android developers》中文版翻译</a></p>
</blockquote>
<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><h2 id="什么是Kotlin？"><a href="#什么是Kotlin？" class="headerlink" title="什么是Kotlin？"></a>什么是Kotlin？</h2><p>Kotlin，如前面所说，它是JetBrains开发的基于JVM的语言。JetBrains因为创造了一个强大的Java开发IDE被大家所熟知。Android Studio，官方的Android IDE，就是基于Intellij，作为一个该平台的插件。<br>Kotlin是使用Java开发者的思维被创建的，Intellij作为它主要的开发IDE。对于Android开发者，有两个有趣的特点：</p>
<ul>
<li>对Java开发者来说，Kotlin是非常直觉化的，并且非常容易学习。语言的大部分内容都是与我们知道的非常相似，不同的地方，它的基础概念也能迅速地掌握它。</li>
<li>它与我们日常生活使用的IDE无需配置就能完全整合。Android Studio能够非常完美地理解、编译运行Kotlin代码。而且对这门语言的支持来正是自于开发了这个IDE的公司本身，所以我们Android开发者是一等公民。但是这仅仅是开发语言和开发工具之间的整合。相比Java 7的优势到底是什么呢？</li>
<li>它更加易表现：这是它最重要的优点之一。你可以编写少得多的代码。</li>
<li>它更加安全：Kotlin是空安全的，也就是说在我们编译时期就处理了各种null的情况，避免了执行时异常。如果一个对象可以是null，则我们需要明确地指定它，然后在使用它之前检查它是否是null。你可以节约很多调试空指针异常的时间，解决掉null引发的bug。</li>
<li>它是函数式的：Kotlin是基于面向对象的语言。但是就如其他很多现代的语言那样，它使用了很多函数式编程的概念，比如，使用lambda表达式来更方便地解决问题。其中一个很棒的特性就是Collections的处理方式。</li>
<li>它可以扩展函数：这意味着我们可以扩展类的更多的特性，甚至我们没有权限去访问这个类中的代码。</li>
<li>它是高度互操作性的：你可以继续使用所有的你用Java写的代码和库，因为两个语言之间的互操作性是完美的。甚至可以在一个项目中使用Kotlin和Java两种语言混合编程。</li>
</ul>
<h2 id="我们通过什么获得Kotlin"><a href="#我们通过什么获得Kotlin" class="headerlink" title="我们通过什么获得Kotlin"></a>我们通过什么获得Kotlin</h2><p>不深入Kotlin语言（我们会在下一章再去学习），这里有一些Java中没有的有趣的特性：</p>
<h3 id="易表现"><a href="#易表现" class="headerlink" title="易表现"></a>易表现</h3><p>通过Kotlin，可以更容易地避免模版代码因为大部分的典型情况都在语言中默认覆盖实现了。举个例子，在Java中，如果我们要典型的数据类，我们需要去编写（至少生成）这些代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">public class Artist &#123;</div><div class="line">    private long id;</div><div class="line">    private String name;</div><div class="line">    private String url;</div><div class="line">    private String mbid;</div><div class="line"></div><div class="line">    public long getId() &#123;</div><div class="line">        return id;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    public void setId(long id) &#123;</div><div class="line">        this.id = id;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public String getName() &#123;</div><div class="line">        return name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setName(String name) &#123;</div><div class="line">        this.name = name;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    public String getUrl() &#123;</div><div class="line">        return url;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setUrl(String url) &#123;</div><div class="line">        this.url = url;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public String getMbid() &#123;</div><div class="line">        return mbid;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setMbid(String mbid) &#123;</div><div class="line">        this.mbid = mbid;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override public String toString() &#123;</div><div class="line">        return &quot;Artist&#123;&quot; +</div><div class="line">          &quot;id=&quot; + id +</div><div class="line">          &quot;, name=&apos;&quot; + name + &apos;\&apos;&apos; +</div><div class="line">          &quot;, url=&apos;&quot; + url + &apos;\&apos;&apos; +</div><div class="line">          &quot;, mbid=&apos;&quot; + mbid + &apos;\&apos;&apos; +</div><div class="line">          &apos;&#125;&apos;;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>使用Kotlin，我们只需要通过数据类：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">data class Artist(</div><div class="line">	var id: Long,</div><div class="line">	var name: String,</div><div class="line">	var url: String,</div><div class="line">	var mbid: String</div><div class="line">)</div></pre></td></tr></table></figure></p>
<p>这个数据类，它会自动生成所有属性和它们的访问器，以及一些有用的方法，比如， toString()</p>
<h3 id="空安全"><a href="#空安全" class="headerlink" title="空安全"></a>空安全</h3><p>当我们使用Java开发的时候，我们的代码大多是防御性的。如果我们不想遇到 NullPointerException ，我们就需要在使用它之前不停地去判断它是否为null。Kotlin，如很多现代的语言，是空安全的，因为我们需要通过一个 安全调用操作符 （写做 ? ）来明确地指定一个对象是否能为空。<br>我们可以像这样去写：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">// 这里不能通过编译. Artist 不能是null</div><div class="line">var notNullArtist: Artist = null</div><div class="line"></div><div class="line">// Artist 可以是 null</div><div class="line">var artist: Artist? = null</div><div class="line"></div><div class="line">// 无法编译, artist可能是null，我们需要进行处理</div><div class="line">artist.print()</div><div class="line"></div><div class="line">// 只要在artist != null时才会打印</div><div class="line">artist?.print()</div><div class="line"></div><div class="line">// 智能转换. 如果我们在之前进行了空检查，则不需要使用安全调用操作符调用</div><div class="line">if (artist != null) &#123;</div><div class="line">  artist.print()</div><div class="line">&#125;</div><div class="line">// 只有在确保artist不是null的情况下才能这么调用，否则它会抛出异常</div><div class="line">artist!!.print()</div><div class="line"></div><div class="line">// 使用Elvis操作符来给定一个在是null的情况下的替代值</div><div class="line">val name = artist?.name ?: &quot;empty&quot;</div></pre></td></tr></table></figure></p>
<h3 id="扩展方法"><a href="#扩展方法" class="headerlink" title="扩展方法"></a>扩展方法</h3><p>我们可以给任何类添加函数。它比那些我们项目中典型的工具类更加具有可读性。举个例子，我们可以给fragment增加一个显示toast的函数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">fun Fragment.toast(message: CharSequence, duration: Int = Toast.LENGTH_SHORT) &#123; </div><div class="line">    Toast.makeText(getActivity(), message, duration).show()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>我们现在可以这么做：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">fragment.toast(&quot;Hello world!&quot;)</div></pre></td></tr></table></figure></p>
<h3 id="函数式支持（Lambdas）"><a href="#函数式支持（Lambdas）" class="headerlink" title="函数式支持（Lambdas）"></a>函数式支持（Lambdas）</h3><p>每次我们去声明一个点击所触发的事件，可以只需要定义我们需要做些什么，而不是不得不去实现一个内部类？我们确实可以这么做，这个（或者其它更多我们感兴趣的事件）我们需要感谢lambda：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">view.setOnClickListener &#123; toast(&quot;Hello world!&quot;) &#125;</div></pre></td></tr></table></figure></p>
<p>这里只是挑选了很小一部分Kotlin可以简化我们代码的事情。现在你已经知道这门语言的一些有趣的特性了，你可以考虑它是否是适合你的。如果你选择继续，我们将在下一章开始我们的实践之旅。</p>
<p>#准备工作<br>现在你知道使用Kotlin实现的小例子了，我确信你会希望尽可能快地把它用在你的实践当中去。不要担心，在第一章中会帮助你去搭建你的开发环境，这样你才能立即编写代码。</p>
<h2 id="Android-Studio"><a href="#Android-Studio" class="headerlink" title="Android Studio"></a>Android Studio</h2><p>第一件事就是安装Android Studio。就如你知道的，Android Studio是官方的Android IDE，它是2013年发布的预览版，并在2014年发布了正式版。<br>Android Studio是Intellij IDEA的插件实现，Intellij IDEA是由JetBrains开发，Kotlin就是JetBrains创造的。所以，正如你所见，一切都这么紧密地结合起来了。<br>转移Android Studio是Android开发者一个重要的改变。首先，因为我们放弃了Eclipse并转到专为Java开发者设计的完美的语言交互的软件。我们可以享受到完美的特性体验，比如反应快速和令人影响深刻的智能代码提示，还有强大的分析和重构工具。<br>第二，Gradle成为Android官方的系统构建工具，这意味着版本构建和部署的新的可能性。最有趣的两点是系统构建和flavours，它可以让你使用相同的代码库来创建无限的版本（甚至是不同的应用）。<br>如果你仍然在使用Eclipse，为了跟上这本书，恐怕你需要转移到Android Studio了。Kotlin团队也创建了一个针对Eclipse的插件，但是它是远远落后于Android Studio的，而且结合得也并不完美。你一旦使用了它，你就会觉得相见恨晚。<br>我不会去覆盖到Android Studio和Gradle的使用，因为这些都不是本书的重点，但是如果你以前没有使用过这些工具，不要恐慌，我确信你能够跟随本书的同时学习到相关基础。<br>如果你还没有AndroidStudio，点这里从官网下载。</p>
<h2 id="安装Kotlin插件"><a href="#安装Kotlin插件" class="headerlink" title="安装Kotlin插件"></a>安装Kotlin插件</h2><p>IDE它本身并不能理解Kotlin。就像前面部分讲到，它是为Java开发设计的。但是Kotlin团队创建了一系列强大的插件让我们更轻松地实现。前往Android Studio的 Preferences 中 Plugin 栏，然后安装如下两个插件：</p>
<ul>
<li>Kotlin：这是一个基础的插件。它能让Android Studio懂得Kotlin代码。它会每次在新的Kotlin语言版本发布的时候发布新的插件版本，这样我们可以通过它发现新版本特性和弃用的警告。这是你要使用Kotlin编写Android应用唯一的插件。但是我们现在还需要另外一个。</li>
<li>Kotlin Android Extensions：Kotlin团队还为Android开发发布了另外一个有趣的插件。这个Android Extensions可以让你自动地从XML中注入所有的View到Activity中，举个例子，你不需要使用 findViewById() 。你将会立即得到一个从属性转换过来的view。你将需要安装这个插件来使用这个特性。我们会在下一章中深入地去讲解这个。</li>
</ul>
<p>因为从Intellij 15开始，插件是被默认安装了的，但是你的Android Studio可能并没有。所以你需要进入Android Studio 的Preferences的plugin栏，然后安装Kotlin插件。如果你不会就去搜索下。<br>现在我们的环境已经可以理解Kotlin语言了，可以就像我们使用Java一样无缝地编译它，执行它。</p>
<h1 id="创建一个新的项目"><a href="#创建一个新的项目" class="headerlink" title="创建一个新的项目"></a>创建一个新的项目</h1><p>如果你已经使用过Android Studio和Gradle，那么这一章会比较简单。我不会给出很多细节和截图，因为用户界面和细节可能会一直变化。<br>我们的应用是由一个简单的天气app组成，正如所使用的Google’s Beginners Course in Udacity。我们可能会关注不同的事情，但是app的想法都是一样的，你会发现在一个典型的app里面会包括很多不同的东西。如果你的Android开发水平比较低，我推荐这个，这个过程是比较容易的。</p>
<h2 id="在Android-Studio中创建一个项目"><a href="#在Android-Studio中创建一个项目" class="headerlink" title="在Android Studio中创建一个项目"></a>在Android Studio中创建一个项目</h2><p>首先，打开Android Studio并选择 Create new Project ，然后它会让你输入一个名字，你可以任意取一个名字，比如： Weather App 。然后你需要输入公司域名。如果你不会真正发布这个app，这个字段就不是特别重要了，但是如果你有的话可以使用自己的域名。然后给任意选择一个目录作为这个项目的保存地址。<br>下一步，它会让你选择最小的API版本。我们选择API 15，因为我们有一个库需要至少API 15才能用。无论如何你把大部分的Anroid用户作为了目标。现在不要选择任何除了手机和平板的其它平台。<br>最后，我们需要选择一个Activity模版来作为入口。我们可以选择 Add no Activity 然后从头开始（这是一个好的方式如果这是一个Kotlin项目的话），但是我将选择 Blank Activity ，因为我待会儿会给你展示Kotlin插件一个好玩的小特性。<br>暂时不用去关心Activity的名字，layout等。这些你会在下一篇中知道。如果我们需要，我待会儿会修改它。点击 Finish 然后让它继续创建项目。</p>
<h2 id="配置Gradle"><a href="#配置Gradle" class="headerlink" title="配置Gradle"></a>配置Gradle</h2><p>Kotlin插件包括一个让我们配置Gradle的工具。但是我还是倾向于保持我对Gradle文件读写的控制权，否则它只会变得混乱而不会变得简单。不管怎么样，在使用自动工具之前知道它是怎么工作的是个不错的主意。所以这次，我们将手动去做。<br>首先，你需要如下修改父 build.gradle ：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">buildscript &#123;</div><div class="line">    ext.support_version = &apos;23.1.1&apos;</div><div class="line">    ext.kotlin_version = &apos;1.0.0&apos;</div><div class="line">    ext.anko_version = &apos;0.8.2&apos;</div><div class="line">    repositories &#123;</div><div class="line">        jcenter()</div><div class="line">        dependencies &#123;</div><div class="line">            classpath &apos;com.android.tools.build:gradle:1.5.0&apos;</div><div class="line">            classpath &quot;org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version&quot;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">allprojects &#123;</div><div class="line">    repositories &#123;</div><div class="line">        jcenter() </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>正如你看到的，我们创建了一个变量来存储当前的Kotlin版本。你读到这里的时候去检测一下最新版本，因为可能会有更新的版本已经发布了。我们需要在几个不同的地方用到那个版本号，比如你需要加上新的Kotlin插件的 dependency 。你会在你指定的那些模块中的 build.gradle 中再次需要到Kotlin标准库。<br>我们对于 support library 也是如此， Anko 库也是同样的做法。用这个方式可以更方便地在一个地方修改所有的版本号。并且使用相同的版本号，更新的时候也不需要每个地方都修改。<br>我们会增加 Kotlin 标准库， Anko 库，以及 Kotlin 和 Kotlin Android Extensions plugin 插件到dependencies。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">apply plugin: &apos;com.android.application&apos;</div><div class="line">apply plugin: &apos;kotlin-android&apos;</div><div class="line">apply plugin: &apos;kotlin-android-extensions&apos;</div><div class="line">android &#123;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line">dependencies &#123;</div><div class="line">    compile &quot;com.android.support:appcompat-v7:$support_version&quot;</div><div class="line">    compile &quot;org.jetbrains.kotlin:kotlin-stdlib:$kotlin_version&quot;</div><div class="line">    compile &quot;org.jetbrains.anko:anko-common:$anko_version&quot;</div><div class="line">&#125;</div><div class="line"></div><div class="line">buildscript &#123;</div><div class="line">    repositories &#123;</div><div class="line">      jcenter() </div><div class="line">    &#125;</div><div class="line">dependencies &#123;</div><div class="line">      classpath &quot;org.jetbrains.kotlin:kotlin-android-extensions:$kotlin_version&quot;</div><div class="line">    &#125; </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Anko是一个用来简化一些Android任务的很强大的Kotlin库。我们之后将会学习部分anko，但是现在来说仅仅增加 anko-common 就足够了。这个库被分割成了一系列小的部分以至于我们不会把没用到的部分加进来。</p>
<h2 id="把MainActivity转换成Kotlin代码"><a href="#把MainActivity转换成Kotlin代码" class="headerlink" title="把MainActivity转换成Kotlin代码"></a>把MainActivity转换成Kotlin代码</h2><p>Kotlin plugin包含了一个有趣的特性，它能把Java代码转成Kotlin代码。正如任何自动化那样，结果不会很完美，但是在你第一天能够使用Kotlin语言开始编写代码之前，它还是提供了很多的帮助。<br>所以我们在MainActivity.java类中使用它。打开文件，然后选择 Code  -&gt;  Convert Java File to Kotlin File 。对比它们的不同之处，可以让你更熟悉这门语言。</p>
<h2 id="测试是否一切就绪"><a href="#测试是否一切就绪" class="headerlink" title="测试是否一切就绪"></a>测试是否一切就绪</h2><p>我们想再将编写一些代码来测试Kotlin Android Extensions是否在工作。我现在还不会对这些代码做解释，但是我想要确保它们在你的环境中是正常运行的。这可能是配置中最难的一部分。<br>首先，打开 activity_main.xml ，然后设置TextView的id：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;TextView</div><div class="line">    android:id=&quot;@+id/message&quot;</div><div class="line">    android:text=&quot;@string/hello_world&quot;</div><div class="line">    android:layout_width=&quot;wrap_content&quot;</div><div class="line">    android:layout_height=&quot;wrap_content&quot;/&gt;</div></pre></td></tr></table></figure></p>
<p>然后，手动在Activity中增加一个import语句（不要担心你现在对这个还不太理解）。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">import kotlinx.android.synthetic.main.activity_main.*</div></pre></td></tr></table></figure></p>
<p>在 onCreate 中，你现在可以直接得到并访问这个TextView了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">override fun onCreate(savedInstanceState: Bundle?) &#123;</div><div class="line">    super.onCreate(savedInstanceState)</div><div class="line">    setContentView(R.layout.activity_main)</div><div class="line">    message.text = &quot;Hello Kotlin!&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>多亏Kotlin和Java之间的互操作性，我们可以在Kotlin中像操作属性一样去操作Java库中的getter/setter方法。我们之后再去讲解属性，但是我想提醒的是，我们可以使用 message.text 来代替 message.setText 。编译器将会把它转换成一般的Java代码，所以这样使用是没有任何性能开销的。<br>现在运行这个app，并且它是正常运行的。检查TextView是否是显示的新的内容。如果你有疑问或者想查看代码，请在Kotlin for Android Developers repository查看。每个章节只要修改了代码，我都会进行提交，所以一定要检查所有的代码变化。<br>下一章会覆盖你在转换之后的MainActivity所看到的新的东西。一旦你理解了Java和Kotlin之间的细微的变化，你将能更容易独立写新的代码了。</p>
<h1 id="类和函数"><a href="#类和函数" class="headerlink" title="类和函数"></a>类和函数</h1><p>Kotlin中的类遵循一个简单的结构。尽管与Java有一点细微的差别。你可以使用try.kotlinlang.org在不需要一个真正的项目和不需要部署到机器的前提下来测试一些简单的代码范例。</p>
<h2 id="怎么定义一个类"><a href="#怎么定义一个类" class="headerlink" title="怎么定义一个类"></a>怎么定义一个类</h2><p>如果你想定义一个类，你只需要使用 class 关键字。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">class MainActivity&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>它有一个默认唯一的构造器。我们会在以后的课程中学习在特殊的情况下创建其它额外的构造器，但是请记住大部分情况下你只需要这个默认的构造器。你只需要在类名后面写上它的参数。如果这个类没有任何内容可以省略大括号：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">class Person(name: String, surname: String)</div></pre></td></tr></table></figure></p>
<p>那么构造函数的函数体在哪呢？你可以写在 init 块中：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">class Person(name: String, surname: String) &#123;</div><div class="line">    init&#123;</div><div class="line">	...</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="类继承"><a href="#类继承" class="headerlink" title="类继承"></a>类继承</h2><p>默认任何类都是基础继承自 Any （与java中的 Object 类似），但是我们可以继承其它类。所有的类默认都是不可继承的（final），所以我们只能继承那些明确声明 open 或者 abstract 的类：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">open class Animal(name: String)</div><div class="line">class Person(name: String, surname: String) : Animal(name)</div></pre></td></tr></table></figure></p>
<p>当我们只有单个构造器时，我们需要在从父类继承下来的构造器中指定需要的参数。这是用来替换Java中的 super 调用的。</p>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>函数（我们Java中的方法）可以使用 fun 关键字就可以定义:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">fun onCreate(savedInstanceState: Bundle?) &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>如果你没有指定它的返回值，它就会返回 Unit ，与Java中的 void 类似，但是 Unit 是一个真正的对象。你当然也可以指定任何其它的返回类型：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">fun add(x: Int, y: Int) : Int &#123;</div><div class="line">    return x + y</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>小提示：分号不是必须的</p>
</blockquote>
<p>就想你在上面的例子中看到的那样，我在每句的最后没有使用分号。当然你也可以使用分号，分号不是必须的，而且不使用分号是一个不错的实践。当你这么做了，你会发现这节约了你很多时间。<br>然而如果返回的结果可以使用一个表达式计算出来，你可以不使用括号而是使用等号：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">fun add(x: Int,y: Int) : Int = x + y</div></pre></td></tr></table></figure></p>
<h2 id="构造方法和函数参数"><a href="#构造方法和函数参数" class="headerlink" title="构造方法和函数参数"></a>构造方法和函数参数</h2><p>Kotlin中的参数与Java中有些不同。如你所见，我们先写参数的名字再写它的类型：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">fun add(x: Int, y: Int) : Int &#123;</div><div class="line">    return x + y</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>我们可以给参数指定一个默认值使得它们变得可选，这是非常有帮助的。这里有一个例子，在Activity中创建了一个函数用来toast一段信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">fun toast(message: String, length: Int = Toast.LENGTH_SHORT) &#123;</div><div class="line">    Toast.makeText(this, message, length).show()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>如你所见，第二个参数（length）指定了一个默认值。这意味着你调用的时候可以传入第二个值或者不传，这样可以避免你需要的重载函数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">toast(&quot;Hello&quot;)</div><div class="line">toast(&quot;Hello&quot;, Toast.LENGTH_LONG)</div></pre></td></tr></table></figure></p>
<p>这个与下面的Java代码是一样的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">void toast(String message)&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void toast(String message, int length)&#123;</div><div class="line">    Toast.makeText(this, message, length).show();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这跟你想象的一样复杂。再看看这个例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">fun niceToast(message: String,</div><div class="line">                tag: String = javaClass&lt;MainActivity&gt;().getSimpleName(),</div><div class="line">                length: Int = Toast.LENGTH_SHORT) &#123;</div><div class="line">    Toast.makeText(this, &quot;[$className] $message&quot;, length).show()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>我增加了第三个默认值是类名的tag参数。如果在Java中总数开销会以几何增长。现在可以通过以下方式调用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">toast(&quot;Hello&quot;)</div><div class="line">toast(&quot;Hello&quot;, &quot;MyTag&quot;)</div><div class="line">toast(&quot;Hello&quot;, &quot;MyTag&quot;, Toast.LENGTH_SHORT)</div></pre></td></tr></table></figure></p>
<p>而且甚至还有其它选择，因为你可以使用参数名字来调用，这表示你可以通过在值前写明参数名来传入你希望的参数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">toast(message = &quot;Hello&quot;, length = Toast.LENGTH_SHORT)</div></pre></td></tr></table></figure></p>
<blockquote>
<p>小提示：String模版<br>你可以在String中直接使用模版表达式。它可以帮助你很简单地在静态值和变量的基础上编写复杂的String。在上面的例子中，我使用了”[$className] $message”。</p>
</blockquote>
<p>如你所见，任何时候你使用一个 $ 符号就可以插入一个表达式。如果这个表达式有一点复杂，你就需要使用一对大括号括起来：”Your name is ${user.name}”。</p>
]]></content>
    
    <summary type="html">
    
      &lt;figure class=&quot;image-bubble&quot;&gt;
                &lt;div class=&quot;img-lightbox&quot;&gt;
                    &lt;div class=&quot;overlay&quot;&gt;&lt;/div&gt;
                   
    
    </summary>
    
      <category term="Kotlin" scheme="https://devallever.github.io/categories/Kotlin/"/>
    
    
      <category term="Android" scheme="https://devallever.github.io/tags/Android/"/>
    
      <category term="Kotlin" scheme="https://devallever.github.io/tags/Kotlin/"/>
    
  </entry>
  
  <entry>
    <title>JavaWeb 项目搭建Hibernate环境</title>
    <link href="https://devallever.github.io/2017/05/19/hibernate-config/"/>
    <id>https://devallever.github.io/2017/05/19/hibernate-config/</id>
    <published>2017-05-19T08:31:34.000Z</published>
    <updated>2017-05-19T09:58:34.929Z</updated>
    
    <content type="html"><![CDATA[<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><ul>
<li>Eclipse</li>
<li>MySQL</li>
</ul>
<h1 id="下载Hibernate所需jar包"><a href="#下载Hibernate所需jar包" class="headerlink" title="下载Hibernate所需jar包"></a>下载Hibernate所需jar包</h1><p>可到官网下载: <a href="http://hibernate.org/orm/" target="_blank" rel="external">快速通道</a>  </p>
<p>下载好后解压，打开压缩包下的lib目录下的require文件夹，这是hibernate的所以来的必须的jar包，copy到Project/WebContent/WEB-INF/lib 目录下，并添加依赖, 没有的自行创建  </p>
<p>由于我们需要连接MySQL数据库，将所需的mysql-connector-java-5.0.8-bin.jar引用进去，关于这些jar包，可以在网上搜索。  </p>
<blockquote>
<p>注意这里我用的是4.2版本的hibernate-core-4.2.1.Final.jar</p>
</blockquote>
<h1 id="配置Hibernate-conf-xml"><a href="#配置Hibernate-conf-xml" class="headerlink" title="配置Hibernate.conf.xml"></a>配置Hibernate.conf.xml</h1><p>我们需要配置最重要的hibernate配置文件hibernate.cfg.xml以及进行日志处理的log4j.properties属性文件：打开上一步解压后的hibernate文件夹，打开project—&gt;etc文件夹，将该文件夹下的hibernate.cfg.xml和log4j.properties文件拷贝到项目的src文件夹下，打开hibernate.cfg.xml文件，将session-factory标签中的内容替换成如下的内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;session-factory&gt;</div><div class="line">	&lt;!-- MySQL --&gt;</div><div class="line">	&lt;property name=&quot;hibernate.connection.url&quot;&gt;jdbc:mysql://localhost:3306?useUnicode=true&amp;amp;characterEncoding=UTF-8&lt;/property&gt; </div><div class="line">	&lt;property name=&quot;hibernate.connection.driver_class&quot;&gt;com.mysql.jdbc.Driver&lt;/property&gt; </div><div class="line">	&lt;property name=&quot;hibernate.connection.username&quot;&gt;root&lt;/property&gt; </div><div class="line">	&lt;property name=&quot;hibernate.connection.password&quot;&gt;dixm&lt;/property&gt;</div><div class="line">	&lt;property name=&quot;hibernate.dialect&quot;&gt;org.hibernate.dialect.MySQL5InnoDBDialect&lt;/property&gt; </div><div class="line">	&lt;property name=&quot;hibernate.show_sql&quot;&gt;true&lt;/property&gt;</div><div class="line">	&lt;property name=&quot;hibernate.use_sql_comments&quot;&gt;true&lt;/property&gt; </div><div class="line">	&lt;property name=&quot;hibernate.connection.pool_size&quot;&gt;0&lt;/property&gt;</div><div class="line">	</div><div class="line">	&lt;!-- Mappings  --&gt;</div><div class="line">	</div><div class="line">&lt;/session-factory&gt;</div></pre></td></tr></table></figure></p>
<h1 id="自动生成数据库表"><a href="#自动生成数据库表" class="headerlink" title="自动生成数据库表"></a>自动生成数据库表</h1><h2 id="创建DDLCreator类"><a href="#创建DDLCreator类" class="headerlink" title="创建DDLCreator类"></a>创建DDLCreator类</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">import org.hibernate.cfg.Configuration;</div><div class="line">import org.hibernate.tool.hbm2ddl.SchemaExport;</div><div class="line"></div><div class="line">public class DDLCreator &#123;</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * @param args</div><div class="line">	 */</div><div class="line">	public static void main(String[] args) &#123;</div><div class="line">		Configuration cfg = new Configuration().configure();</div><div class="line">		SchemaExport se = new SchemaExport(cfg);</div><div class="line">		se.drop(true, true);    //ɾ</div><div class="line">		se.create(true, true);  //</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="创建HibernateUtil类"><a href="#创建HibernateUtil类" class="headerlink" title="创建HibernateUtil类"></a>创建HibernateUtil类</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">import org.hibernate.Session;</div><div class="line">import org.hibernate.SessionFactory;</div><div class="line">import org.hibernate.Transaction;</div><div class="line">import org.hibernate.cfg.Configuration;</div><div class="line"></div><div class="line"></div><div class="line">@SuppressWarnings(&quot;deprecation&quot;)</div><div class="line">public class HibernateUtil &#123;</div><div class="line">	private static SessionFactory sessionFactory;</div><div class="line">	static &#123;</div><div class="line">		try &#123;</div><div class="line">			sessionFactory = new Configuration().configure().buildSessionFactory();</div><div class="line">		&#125; catch (Throwable ex) &#123;</div><div class="line">			throw new ExceptionInInitializerError(ex);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public static SessionFactory getSessionFactory() &#123;</div><div class="line">		// Alternatively, you could look up in JNDI here</div><div class="line">		return sessionFactory;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public static void shutdown() &#123;</div><div class="line">		// Close caches and connection pools</div><div class="line">		getSessionFactory().close();</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	public static Session getSession()</div><div class="line">	&#123;</div><div class="line">		Session session = sessionFactory.openSession();</div><div class="line">		return session;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	public static void beginSession(Session session)</div><div class="line">	&#123;</div><div class="line">		session.getTransaction().begin();</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	public static void commitTransaction(Session session)</div><div class="line">	&#123;</div><div class="line">		session.getTransaction().commit();</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	public static void rollbackTransaction(Session session)</div><div class="line">	&#123;</div><div class="line">		Transaction tx = session.getTransaction();</div><div class="line">		if (tx.isActive())</div><div class="line">			tx.rollback();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="创建实体类"><a href="#创建实体类" class="headerlink" title="创建实体类"></a>创建实体类</h2><p>如 TVersion<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">import javax.persistence.Entity;</div><div class="line">import javax.persistence.GeneratedValue;</div><div class="line">import javax.persistence.GenerationType;</div><div class="line">import javax.persistence.Id;</div><div class="line">import javax.persistence.Table;</div><div class="line"></div><div class="line">@Entity							//表示实体类</div><div class="line">@Table(catalog = &quot;dbcoolweather&quot;) //数据库名</div><div class="line">public class TVersion &#123;</div><div class="line">	</div><div class="line">	private long id;</div><div class="line">	private int version_code;</div><div class="line">	private String version_name;</div><div class="line">	private String description;</div><div class="line">	private String path;</div><div class="line">	</div><div class="line">	//主键，自增</div><div class="line">	@Id</div><div class="line">	@GeneratedValue(strategy=GenerationType.AUTO)</div><div class="line">	public long getId() &#123;</div><div class="line">		return id;</div><div class="line">	&#125;</div><div class="line">	public void setId(long id) &#123;</div><div class="line">		this.id = id;</div><div class="line">	&#125;</div><div class="line">	public int getVersion_code() &#123;</div><div class="line">		return version_code;</div><div class="line">	&#125;</div><div class="line">	public void setVersion_code(int version_code) &#123;</div><div class="line">		this.version_code = version_code;</div><div class="line">	&#125;</div><div class="line">	public String getVersion_name() &#123;</div><div class="line">		return version_name;</div><div class="line">	&#125;</div><div class="line">	public void setVersion_name(String version_name) &#123;</div><div class="line">		this.version_name = version_name;</div><div class="line">	&#125;</div><div class="line">	public String getDescription() &#123;</div><div class="line">		return description;</div><div class="line">	&#125;</div><div class="line">	public void setDescription(String description) &#123;</div><div class="line">		this.description = description;</div><div class="line">	&#125;</div><div class="line">	public String getPath() &#123;</div><div class="line">		return path;</div><div class="line">	&#125;</div><div class="line">	public void setPath(String path) &#123;</div><div class="line">		this.path = path;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="在Hibernate-cfg-xml中添加映射关系"><a href="#在Hibernate-cfg-xml中添加映射关系" class="headerlink" title="在Hibernate.cfg.xml中添加映射关系"></a>在Hibernate.cfg.xml中添加映射关系</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;!-- Mappings  --&gt;</div><div class="line">&lt;mapping class=&quot;com.allever.mycoolweather.bean.TVersion&quot;/&gt;</div></pre></td></tr></table></figure>
<h2 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h2><p>首先在MySQL中手动创建数据库： dbcoolweather</p>
<h2 id="运行DDLCreator类"><a href="#运行DDLCreator类" class="headerlink" title="运行DDLCreator类"></a>运行DDLCreator类</h2><p>刷新数据库表，此时，tversion表已经建好了, 有木有很惊讶～～～</p>
<h1 id="对数据库进行增删改查"><a href="#对数据库进行增删改查" class="headerlink" title="对数据库进行增删改查"></a>对数据库进行增删改查</h1><h2 id="创建VersionDAO类"><a href="#创建VersionDAO类" class="headerlink" title="创建VersionDAO类"></a>创建VersionDAO类</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div></pre></td><td class="code"><pre><div class="line">import java.util.List;</div><div class="line"></div><div class="line">import org.hibernate.Query;</div><div class="line">import org.hibernate.Session;</div><div class="line"></div><div class="line">import com.allever.mycoolweather.bean.TVersion;</div><div class="line">import com.allever.mycoolweather.util.HibernateUtil;</div><div class="line"></div><div class="line"></div><div class="line">public class VersionDAO &#123;</div><div class="line">	</div><div class="line">	Session session = null;</div><div class="line">	boolean commit = false;</div><div class="line"></div><div class="line">	public VersionDAO() &#123;</div><div class="line">		this.session = HibernateUtil.getSession();</div><div class="line">		commit = true;</div><div class="line">		HibernateUtil.beginSession(session);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	</div><div class="line">	public VersionDAO(Session session) &#123;</div><div class="line">		this.session = session;</div><div class="line">		commit = false;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	public void close() &#123;</div><div class="line">		if (commit == true) &#123;</div><div class="line">			HibernateUtil.commitTransaction(session);</div><div class="line">			session.close();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public Session getSession() &#123;</div><div class="line">		return session;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	</div><div class="line">	public TVersion getById(long id) throws Exception &#123;</div><div class="line">		TVersion d = null;</div><div class="line">		try &#123;</div><div class="line">			d = (TVersion) session.get(TVersion.class, id);</div><div class="line">		&#125; catch (Exception e) &#123;</div><div class="line">			HibernateUtil.rollbackTransaction(session);</div><div class="line">			throw e;</div><div class="line">		&#125;</div><div class="line">		return d;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	</div><div class="line">	@SuppressWarnings(&quot;unchecked&quot;)</div><div class="line">	public List&lt;TVersion&gt; getByQuery(String conditions, long start,</div><div class="line">			long limit) throws Exception &#123;</div><div class="line">		List&lt;TVersion&gt; dl = null;</div><div class="line"></div><div class="line">		try &#123;</div><div class="line">			String hql = &quot;from TVersion&quot;;</div><div class="line">			if ((conditions != null) &amp;&amp; (conditions.length() &gt; 0))</div><div class="line">				hql += &quot; where &quot; + conditions;</div><div class="line"></div><div class="line">			Query query = session.createQuery(hql);</div><div class="line">			if (limit &gt; 0) &#123;</div><div class="line">				query.setFirstResult((int) start);</div><div class="line">				query.setMaxResults((int) limit);</div><div class="line">			&#125;</div><div class="line">			dl = (List&lt;TVersion&gt;) query.list();</div><div class="line">		&#125; catch (Exception e) &#123;</div><div class="line">			HibernateUtil.rollbackTransaction(session);</div><div class="line">			throw e;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		return dl;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	@SuppressWarnings(&quot;unchecked&quot;)</div><div class="line">	public List&lt;TVersion&gt; getUpdateVersion(long start,long limit) throws Exception &#123;</div><div class="line">		List&lt;TVersion&gt; dl = null;</div><div class="line"></div><div class="line">		try &#123;</div><div class="line">			String hql = &quot;from TVersion ORDER BY version_code DESC&quot;;</div><div class="line"></div><div class="line">			Query query = session.createQuery(hql);</div><div class="line">			if (limit &gt; 0) &#123;</div><div class="line">				query.setFirstResult((int) 0);</div><div class="line">				query.setMaxResults((int) 0);</div><div class="line">			&#125;</div><div class="line">			dl = (List&lt;TVersion&gt;) query.list();</div><div class="line">		&#125; catch (Exception e) &#123;</div><div class="line">			HibernateUtil.rollbackTransaction(session);</div><div class="line">			throw e;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		return dl;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	public TVersion add(TVersion d) throws Exception &#123;</div><div class="line">		Long id = null;</div><div class="line"></div><div class="line">		try &#123;</div><div class="line">			id = (Long) session.save(d);</div><div class="line">		&#125; catch (Exception e) &#123;</div><div class="line">			HibernateUtil.rollbackTransaction(session);</div><div class="line">			throw e;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		return getById(id);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	public void deleteById(long id) throws Exception &#123;</div><div class="line">		TVersion d = null;</div><div class="line"></div><div class="line">		try &#123;</div><div class="line">			d = (TVersion) session.get(TVersion.class, id);</div><div class="line">			if (d != null)</div><div class="line">				session.delete(d);</div><div class="line">		&#125; catch (Exception e) &#123;</div><div class="line">			HibernateUtil.rollbackTransaction(session);</div><div class="line">			throw e;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	public TVersion update(TVersion d) throws Exception &#123;</div><div class="line">		try &#123;</div><div class="line">			session.update(d);</div><div class="line">		&#125;</div><div class="line">		catch(RuntimeException e) &#123;</div><div class="line">			HibernateUtil.rollbackTransaction(session);</div><div class="line">			throw e;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		return getById(d.getId());</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>各位看函数名就知道要干什么了吧，这里就不哆嗦了</p>
<h2 id="创建VersionTest类进行测试"><a href="#创建VersionTest类进行测试" class="headerlink" title="创建VersionTest类进行测试"></a>创建VersionTest类进行测试</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">public class VersionTest &#123;</div><div class="line">	public static void main(String[] args)&#123;</div><div class="line">		</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>就是一个普通的JAVA类</p>
<h3 id="初始化DAO"><a href="#初始化DAO" class="headerlink" title="初始化DAO"></a>初始化DAO</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">VersionDAO dao = new VersionDAO();</div><div class="line">//operation</div><div class="line">dao.close();</div></pre></td></tr></table></figure>
<h3 id="增加一条记录"><a href="#增加一条记录" class="headerlink" title="增加一条记录"></a>增加一条记录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">try&#123;</div><div class="line">	TVersion v1 = new TVersion();</div><div class="line">	v1.setVersion_code(5);</div><div class="line">	v1.setDescription(&quot;第3版&quot;);</div><div class="line">	v1.setVersion_name(&quot;1.3&quot;);</div><div class="line">	v1.setPath(&quot;/apk/mycoolweather_1.3.apk&quot;);</div><div class="line">	dao.add(v1);</div><div class="line">&#125;catch(Exception e)&#123;</div><div class="line">	e.printStackTrace();</div><div class="line">&#125;finally&#123;</div><div class="line">	dao.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="查询一条记录"><a href="#查询一条记录" class="headerlink" title="查询一条记录"></a>查询一条记录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">List&lt;TVersion&gt; list_tversion = new ArrayList&lt;&gt;();</div><div class="line">list_tversion = dao.getByQuery(&quot;version_code=&quot;+ 5, 0, 0);</div><div class="line">if(list_tversion.size()&gt;0)&#123;</div><div class="line">	TVersion v = list_tversion.get(0);</div><div class="line">	v.getVersion_name();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="查询所有记录"><a href="#查询所有记录" class="headerlink" title="查询所有记录"></a>查询所有记录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">List&lt;TVersion&gt; list_tversion = new ArrayList&lt;&gt;();</div><div class="line">// null or &quot;&quot;</div><div class="line">list_tversion = dao.getByQuery(null, 0, 0);</div><div class="line">for(TVersion tversion: list_tversion)&#123;</div><div class="line">	tversion.getVersion_name();</div><div class="line">	System.out.println(tversion.getDescription());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="修改数据"><a href="#修改数据" class="headerlink" title="修改数据"></a>修改数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">List&lt;TVersion&gt; list_tversion = new ArrayList&lt;&gt;();</div><div class="line">list_tversion = dao.getByQuery(&quot;version_code=&quot;+ 5, 0, 0);</div><div class="line">if(list_tversion.size()&gt;0)&#123;</div><div class="line">	TVersion v = list_tversion.get(0);</div><div class="line">	v.setDescription(&quot;new Description&quot;);</div><div class="line">	dao.update(v);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">List&lt;TVersion&gt; list_tversion = new ArrayList&lt;&gt;();</div><div class="line">list_tversion = dao.getByQuery(&quot;version_code=&quot;+ 5, 0, 0);</div><div class="line">if(list_tversion.size()&gt;0)&#123;</div><div class="line">	TVersion v = list_tversion.get(0);</div><div class="line">	v.setDescription(&quot;new Description&quot;);</div><div class="line">	dao.deleteById(v.getId());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>OK,大功告成.<br>写这篇复习了以前所学知识，下一步，继续学习新版本的知识</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;环境&quot;&gt;&lt;a href=&quot;#环境&quot; class=&quot;headerlink&quot; title=&quot;环境&quot;&gt;&lt;/a&gt;环境&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;Eclipse&lt;/li&gt;
&lt;li&gt;MySQL&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;下载Hibernate所需jar包&quot;&gt;&lt;a 
    
    </summary>
    
      <category term="JavaWeb" scheme="https://devallever.github.io/categories/JavaWeb/"/>
    
    
      <category term="JavaWeb" scheme="https://devallever.github.io/tags/JavaWeb/"/>
    
      <category term="Hibernate" scheme="https://devallever.github.io/tags/Hibernate/"/>
    
  </entry>
  
  <entry>
    <title>设计模式(二) 建造者模式</title>
    <link href="https://devallever.github.io/2017/05/18/builder-patterns/"/>
    <id>https://devallever.github.io/2017/05/18/builder-patterns/</id>
    <published>2017-05-18T13:27:59.000Z</published>
    <updated>2017-05-19T10:03:51.711Z</updated>
    
    <content type="html"><![CDATA[<h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><blockquote>
<p>将一个复杂对象的构建与它的表示分离,使得同样的构建过程可以创建不同的表示</p>
</blockquote>
<p>你看懂了吗? 反正我是一脸懵逼</p>
<h1 id="UML类图"><a href="#UML类图" class="headerlink" title="UML类图"></a>UML类图</h1><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1495123628735&di=c7dad79192ca076a4d7b2dd4266c3c42&imgtype=0&src=http%3A%2F%2Fimg.my.csdn.net%2Fuploads%2F201302%2F03%2F1359892948_5468.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>解读:  </p>
<ul>
<li>Product产品类: 产品抽象类  </li>
<li>Builder: 抽象Builder类,规划产品组建,一般是由子类实现具体的组建过程</li>
<li>ConcreteBuilder: 具体的Builder类</li>
<li>Director: 统一组建过程</li>
</ul>
<p>好吧, 还是说的有点虚呀, 来一个简单例子</p>
<h1 id="简单实现"><a href="#简单实现" class="headerlink" title="简单实现"></a>简单实现</h1><h2 id="Computer抽象类类：Product角色，即产品抽象类"><a href="#Computer抽象类类：Product角色，即产品抽象类" class="headerlink" title="Computer抽象类类：Product角色，即产品抽象类"></a>Computer抽象类类：Product角色，即产品抽象类</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Created by allever on 17-5-18.</div><div class="line"> * 计算机抽象类: Product角色*/</div><div class="line"></div><div class="line">public abstract class Computer &#123;</div><div class="line"></div><div class="line">    private String strBoard;</div><div class="line">    private String strDisplay;</div><div class="line">    private String strOS;</div><div class="line"></div><div class="line">    protected Computer()&#123;&#125;</div><div class="line">    /**CPU核心数*/</div><div class="line">    public void setBoard(String board)&#123;</div><div class="line">        this.strBoard = board;</div><div class="line">    &#125;</div><div class="line">    public void setDisplay(String display)&#123;</div><div class="line">        this.strDisplay = display;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setStrOS(String os)&#123;</div><div class="line">        this.strOS = os;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public String toString() &#123;</div><div class="line">        String result = &quot;Computer:\nboard=&quot; + strBoard + &quot;\ndisplay = &quot; + strDisplay + &quot;\nOS = &quot; + strOS;</div><div class="line">        return result;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="MacBook类，具体Computer类"><a href="#MacBook类，具体Computer类" class="headerlink" title="MacBook类，具体Computer类"></a>MacBook类，具体Computer类</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Created by allever on 17-5-18.</div><div class="line"> */</div><div class="line"></div><div class="line">public class MacBook extends Computer &#123;</div><div class="line">    protected MacBook()&#123;&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>##Builder抽象类<br>负责规范产品组建，一般是由子类实现具体的组建过程<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Created by allever on 17-5-18.</div><div class="line"> * 抽象Builder类*/</div><div class="line"></div><div class="line">public abstract class Builder &#123;</div><div class="line">    public abstract void buildBoard(String board);</div><div class="line">    public abstract void buildDisplay(String display);</div><div class="line">    public abstract void buildOS(String os);</div><div class="line">    public abstract Computer build();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="MacBookBuilder：具体Builder类，ConcreteBuilder角色"><a href="#MacBookBuilder：具体Builder类，ConcreteBuilder角色" class="headerlink" title="MacBookBuilder：具体Builder类，ConcreteBuilder角色"></a>MacBookBuilder：具体Builder类，ConcreteBuilder角色</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Created by allever on 17-5-18.</div><div class="line"> * Builder实现类*/</div><div class="line"></div><div class="line">public class MacBookBuilder extends Builder &#123;</div><div class="line"></div><div class="line">    private Computer computerMacBook = new MacBook();</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void buildBoard(String board) &#123;</div><div class="line">        computerMacBook.setBoard(board);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void buildDisplay(String display) &#123;</div><div class="line">        computerMacBook.setDisplay(display);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void buildOS(String os) &#123;</div><div class="line">        computerMacBook.setStrOS(os);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public Computer build() &#123;</div><div class="line">        return computerMacBook;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Director类：同一组装过程"><a href="#Director类：同一组装过程" class="headerlink" title="Director类：同一组装过程"></a>Director类：同一组装过程</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Created by allever on 17-5-18.</div><div class="line"> * Director类： 负责构建Computer*/</div><div class="line"></div><div class="line">public class Director &#123;</div><div class="line">    private Builder builder = null;</div><div class="line">    public Director(Builder builder)&#123;</div><div class="line">        this.builder = builder;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //构建对象</div><div class="line">    public void construct(String board, String display, String os)&#123;</div><div class="line">        builder.buildBoard(board);</div><div class="line">        builder.buildDisplay(display);</div><div class="line">        builder.buildOS(os);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="客户端调用"><a href="#客户端调用" class="headerlink" title="客户端调用"></a>客户端调用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Builder builder = new MacBookBuilder();</div><div class="line">Director director = new Director(builder);</div><div class="line">director.construct(&quot;英特尔酷睿i7&quot;,&quot;15.6寸&quot;,&quot;Ubuntu 16.04&quot;);</div><div class="line">Log.d(TAG, builder.build().toString());</div><div class="line">Toast.makeText(BuildPatternsActivity.this,builder.build().toString(),Toast.LENGTH_LONG).show();</div></pre></td></tr></table></figure>
<h1 id="小提示"><a href="#小提示" class="headerlink" title="小提示"></a>小提示</h1><p>通常,Director角色会被省略,直接使用Builder构建对象,这个Builder通常为链式调用,即buildXXX()方法返回自身,return this;</p>
<h2 id="修改后的Builder类"><a href="#修改后的Builder类" class="headerlink" title="修改后的Builder类"></a>修改后的Builder类</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Created by allever on 17-5-18.</div><div class="line"> * 抽象Builder类*/</div><div class="line"></div><div class="line">public abstract class Builder &#123;</div><div class="line">    public abstract Builder buildBoard(String board);</div><div class="line">    public abstract Builder buildDisplay(String display);</div><div class="line">    public abstract Builder buildOS(String os);</div><div class="line">    public abstract Computer build();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="MacBookBuilder"><a href="#MacBookBuilder" class="headerlink" title="MacBookBuilder:"></a>MacBookBuilder:</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Created by allever on 17-5-18.</div><div class="line"> * Builder实现类*/</div><div class="line"></div><div class="line">public class MacBookBuilder extends Builder &#123;</div><div class="line"></div><div class="line">    private Computer computerMacBook = new MacBook();</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public MacBookBuilder buildBoard(String board) &#123;</div><div class="line">        computerMacBook.setBoard(board);</div><div class="line">        return this;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public MacBookBuilder buildDisplay(String display) &#123;</div><div class="line">        computerMacBook.setDisplay(display);</div><div class="line">        return this;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public MacBookBuilder buildOS(String os) &#123;</div><div class="line">        computerMacBook.setStrOS(os);</div><div class="line">        return this;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public Computer build() &#123;</div><div class="line">        return computerMacBook;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="在客户端中的调用"><a href="#在客户端中的调用" class="headerlink" title="在客户端中的调用"></a>在客户端中的调用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Builder builder = new MacBookBuilder();</div><div class="line">//Director director = new Director(builder);</div><div class="line">//director.construct(&quot;英特尔酷睿i7&quot;,&quot;15.6寸&quot;,&quot;Ubuntu 16.04&quot;);</div><div class="line">Log.d(TAG, builder.buildBoard(&quot;英特尔酷睿i7&quot;)</div><div class="line">                    .buildDisplay(&quot;15.6寸&quot;)</div><div class="line">                    .buildOS(&quot;Max OS&quot;)</div><div class="line">                    build().toString());</div></pre></td></tr></table></figure>
<p>现在你是不是感觉到很熟悉的呢? 就像Android中构建一个Notification对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">Notification notification = new NotificationCompat.Builder(this)</div><div class="line">        .setContentTitle(&quot;This is content title&quot;)</div><div class="line">        .setContentText(&quot;This is content text&quot;)</div><div class="line">        .setSmallIcon(R.mipmap.ic_launcher)</div><div class="line">        .setLargeIcon(BitmapFactory.decodeResource(getResources(),R.mipmap.ic_launcher))</div><div class="line">        .setWhen(System.currentTimeMillis())</div><div class="line">        //设置点击行为</div><div class="line">        .setContentIntent(pendingIntent)</div><div class="line">        //点击后消失</div><div class="line">        .setAutoCancel(true)</div><div class="line">        //设置声音</div><div class="line">        .setSound(Uri.fromFile(new File(&quot;/system/media/audio/ringtones/Luna.ogg&quot;)))</div><div class="line">        //设置震动 震动1s 静止1s 震动1s 要申明权限</div><div class="line">        .setVibrate(new long[]&#123;0, 1000,1000,1000&#125;)</div><div class="line">        //设置呼吸灯闪烁</div><div class="line">        .setLights(Color.GREEN, 1000, 1000)</div><div class="line">        //设置默认</div><div class="line">        .setDefaults(NotificationCompat.DEFAULT_ALL)</div><div class="line">        //设置长文本</div><div class="line">        .setStyle(new NotificationCompat.BigTextStyle().bigText(&quot;An Activity is an application component that provides a screen with which users can interact in order to do something, such as dial the phone, take a photo, send an email, or view a map.&quot;))</div><div class="line">        //设置展开大图,,设置了长文本会看不到</div><div class="line">        .setStyle(new NotificationCompat.BigPictureStyle().bigPicture(BitmapFactory.decodeResource(getResources(),R.mipmap.expensive)))</div><div class="line">        //设置通知重要程度</div><div class="line">        .setPriority(NotificationCompat.PRIORITY_MAX)</div><div class="line">        .build();</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;定义&quot;&gt;&lt;a href=&quot;#定义&quot; class=&quot;headerlink&quot; title=&quot;定义&quot;&gt;&lt;/a&gt;定义&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;将一个复杂对象的构建与它的表示分离,使得同样的构建过程可以创建不同的表示&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p
    
    </summary>
    
      <category term="设计模式" scheme="https://devallever.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="设计模式" scheme="https://devallever.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="建造者模式" scheme="https://devallever.github.io/tags/%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntu server 下配置JDK，Tomcat，MySQL</title>
    <link href="https://devallever.github.io/2017/05/16/build-java-tomcat-mysql/"/>
    <id>https://devallever.github.io/2017/05/16/build-java-tomcat-mysql/</id>
    <published>2017-05-16T07:56:38.000Z</published>
    <updated>2017-05-20T02:04:06.824Z</updated>
    
    <content type="html"><![CDATA[<h1 id="配置JDK环境"><a href="#配置JDK环境" class="headerlink" title="配置JDK环境"></a>配置JDK环境</h1><blockquote>
<p>参考：<a href="http://blog.csdn.net/yebhweb/article/details/55098189" target="_blank" rel="external">http://blog.csdn.net/yebhweb/article/details/55098189</a></p>
</blockquote>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>下载好jdk包，如：jdk-8u121-linux-x64.tar.gz<br>为了同一管理安装目录统一为：/opt/<br>复制压缩包到 /opt/jdk目录下<br>进入到 /opt/jdk<br>解压：tar -xvf jdk-8u121-linux-x64.tar.gz<br>删除压缩包</p>
<h2 id="配置jdk环境"><a href="#配置jdk环境" class="headerlink" title="配置jdk环境"></a>配置jdk环境</h2><p>修改文件进行全局配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gedit/.bashrc</div></pre></td></tr></table></figure></p>
<p>在最后加入如下内容<br>打开之后在末尾添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">export JAVA_HOME=/usr/lib/jdk/jdk1.8.0_121  </div><div class="line">export JRE_HOME=$&#123;JAVA_HOME&#125;/jre  </div><div class="line">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib  </div><div class="line">export PATH=$&#123;JAVA_HOME&#125;/bin:$PATH</div></pre></td></tr></table></figure></p>
<p>请记住，在上述添加过程中，等号两侧不要加入空格，不然会出现“不是有效的标识符”，因为source /etc/profile 时不能识别多余到空格，会理解为是路径一部分。<br>然后保存。</p>
<p>使配置文件生效<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">source ~/.bashrc</div></pre></td></tr></table></figure></p>
<p>检验是否安装成功<br>在终端输入如下命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">java -version</div></pre></td></tr></table></figure></p>
<h1 id="安装Tomcat"><a href="#安装Tomcat" class="headerlink" title="安装Tomcat"></a>安装Tomcat</h1><p>下载压缩包，如：apache-tomcat-8.5.11.tar.gz<br>复制到：/opt/tomcat<br>进入到目录：/opt/tomcat<br>解压：<br>tar -xvf apache-tomcat-8.5.11.tar.gz<br>删除压缩包<br>进入到tomcat安装目录下的bin目录<br>执行：startup.sh就可以启动Tomcat</p>
<p>#安装MySQL<br>命令安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">apt install mysql-server-5.7</div></pre></td></tr></table></figure></p>
<p>按提示即可安装完成，并且自动启动MySQL<br>使用root登录mysql<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql -u root -p</div></pre></td></tr></table></figure></p>
<p>退出：ctrl+z</p>
<h2 id="解决中文乱码"><a href="#解决中文乱码" class="headerlink" title="解决中文乱码"></a>解决中文乱码</h2><p>修改配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim /etc/mysql/mysql.conf.d/mysqld.cnf</div></pre></td></tr></table></figure></p>
<p>在[mysqld]中加入如下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">character-set-server = utf8</div></pre></td></tr></table></figure></p>
<p>重启MySQL：systomctl restart mysql.service<br>启动MySQL：systemctl start mysql.service<br>查看mysql编码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">show variables like &apos;character%&apos;;</div></pre></td></tr></table></figure></p>
<p>显示已经改为utf8</p>
<h2 id="创建数据库设置字符集"><a href="#创建数据库设置字符集" class="headerlink" title="创建数据库设置字符集"></a>创建数据库设置字符集</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">create database dbname default charset utf8 COLLATE utf8_general_ci;</div></pre></td></tr></table></figure>
<p>导入sql文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">source path/filename.sql;</div></pre></td></tr></table></figure></p>
<h2 id="解决MySQL查表大小写问题"><a href="#解决MySQL查表大小写问题" class="headerlink" title="解决MySQL查表大小写问题"></a>解决MySQL查表大小写问题</h2><p>修改配置文件：<br>/etc/my.cnf 或<br>/etc/mysql/mysql.conf.d/mysqld.cnf<br>在[mysqld]下添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lower_case_table_names=1</div></pre></td></tr></table></figure></p>
<p>1：表示忽略大小写<br>0：表示不忽略大小写</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;配置JDK环境&quot;&gt;&lt;a href=&quot;#配置JDK环境&quot; class=&quot;headerlink&quot; title=&quot;配置JDK环境&quot;&gt;&lt;/a&gt;配置JDK环境&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;参考：&lt;a href=&quot;http://blog.csdn.net/yebh
    
    </summary>
    
      <category term="Ubuntu" scheme="https://devallever.github.io/categories/Ubuntu/"/>
    
    
      <category term="Java" scheme="https://devallever.github.io/tags/Java/"/>
    
      <category term="Tomcat" scheme="https://devallever.github.io/tags/Tomcat/"/>
    
      <category term="MySQL" scheme="https://devallever.github.io/tags/MySQL/"/>
    
      <category term="Ubuntu" scheme="https://devallever.github.io/tags/Ubuntu/"/>
    
  </entry>
  
</feed>
